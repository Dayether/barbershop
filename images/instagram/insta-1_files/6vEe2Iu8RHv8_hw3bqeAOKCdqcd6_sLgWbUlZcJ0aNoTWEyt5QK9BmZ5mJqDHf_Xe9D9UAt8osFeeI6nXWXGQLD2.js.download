;/*FB_PKG_DELIM*/

__d("BladeRunnerConfig",["RTISubscriptionManagerConfig","WebDriverConfig","cr:3024","gkx","isEmpty"],(function(a,b,c,d,e,f,g){var h,i="javascript-sandbox",j="OverrideServer",k="www_sandbox",l="www_tier";a=function(){function a(){}var d=a.prototype;d.patchRequestHeaders=function(a){var d={},e=c("RTISubscriptionManagerConfig").bladerunner_www_sandbox,f=c("RTISubscriptionManagerConfig").is_intern;if(!(h||(h=c("isEmpty")))(c("WebDriverConfig").auxiliaryServiceInfo)){var g;g=(g=c("WebDriverConfig").auxiliaryServiceInfo.BladeRunner)!=null?g:c("WebDriverConfig").auxiliaryServiceInfo["BladeRunner-sandcastle"];g!=null?(typeof g.ip_address==="string"?d[j]=g.ip_address+":18295":typeof g.hostname==="string"&&(d[j]=g.hostname+":18295"),typeof c("WebDriverConfig").originHost==="string"&&(d[k]="www."+c("WebDriverConfig").originHost)):e!=null&&(d[i]=e)}else e!=null&&(d[i]=e);f===!0&&(d[l]="intern");if(c("WebDriverConfig").isTestRunning&&c("gkx")("20919")){g=b("cr:3024")==null?void 0:b("cr:3024").get();g!=null&&(d.is_test="true",d.original_request_id=g)}c("gkx")("20929")&&(d["Accept-Ack"]="RSAck");for(e in a)d[e]=a[e];d.http_referer=window.location.href;return d};return a}();d=new a();e=d;g["default"]=e}),98);
__d("BladeRunnerLogger",["FBLogger","ODS"],(function(a,b,c,d,e,f,g){var h,i="bladerunner_js_client",j={info:"info",warning:"warning",exception:"exception"};a=function(){function a(){this.setFBLoggerLevel(1)}var b=a.prototype;b.info=function(a){this.$2>=2&&c("FBLogger")(i).info("BladeRunner info: %s",a),this.$3(j.info,a)};b.warn=function(a){this.$2>=1&&c("FBLogger")(i).warn("BladeRunner warn: %s",a),this.$3(j.warning,a)};b.exception=function(a,b){b===void 0&&(b="");var d=b+" "+a.toString();this.$2>=0&&c("FBLogger")(i).warn("BladeRunner exception: %s, %s",b,a.toString());this.$3(j.exception,d)};b.trimForLogging=function(a){var b=1024;return typeof a==="string"&&a.length>b?"[trimmed]:"+a.substring(0,b)+"...":a};b.bumpCounter=function(a,b){b===void 0&&(b=1),(h||(h=d("ODS"))).bumpEntityKey(2966,"BladeRunnerClient",a,b)};b.setClientSessionId=function(a){this.$1=a};b.setFBLoggerLevel=function(a){this.$2=a};b.$3=function(a,b){};return a}();b=new a();e=b;g["default"]=e}),98);
__d("BladeRunnerTypes",[],(function(a,b,c,d,e,f,g){a={REQUEST:1,DATA:2,DATA_ACK:3,STATUS_UPDATE:4,REWRITE_REQUEST:5,LOG:6};b={BLADE_RUNNER:1,GATEWAY:2};g.StreamFrameType=a;g.StreamRequestType=b}),98);
__d("BladeRunnerTypesInternal",["Base64","BladeRunnerLogger","BladeRunnerTypes"],(function(a,b,c,d,e,f,g){var h=function(){function a(){}var b=a.prototype;b.getHeaders=function(){if(this.headers!=null)return this.headers;throw new Error("Expected headers")};b.getInstrumentationData=function(){if(this.instrumentationData!=null&&this.instrumentationData.length>0)try{return JSON.parse(this.instrumentationData)}catch(a){return null}else return null};b.updateRetryRequestPayload=function(a){a!=null?this.payload=c("Base64").encode(a):this.payload=null};a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.requestType=o(b.requestType);c.payload=r(b.payload);c.headers=u(b.headers);c.extraHeader=r(b.extraHeader);c.requestTarget=r(b.requestTarget);c.instrumentationData=r(b.instrumentationData);return c};return a}(),i=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.dataId=p(b.dataId);c.data=r(b.data);c.shouldAck=w(b.shouldAck);return c};var b=a.prototype;b.rawData=function(){if(this.data==null)throw new Error("Expected data");return this.data};b.rawDataSize=function(){return this.data==null?0:this.data.length};b.decodeData=function(){if(this.data==null)throw new Error("Expected data");return c("Base64").decode(this.data)};b.setData=function(a){this.data=c("Base64").encode(a)};b.getInstrumentationData=function(){if(this.instrumentationData!=null)return JSON.parse(this.instrumentationData);else return null};return a}(),j=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.dataId=o(b.dataId);c.success=v(b.success);c.message=r(b.message);c.code=p(b.code);return c};return a}();j.ACK_CODE_LANDED_AND_ACCEPTED=20;j.ACK_CODE_LANDED_BUT_NOT_ACCEPTED=21;j.ACK_CODE_FAILED_TO_LAND=50;var k=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=p(b.streamId);c.message=r(b.message);return c};return a}(),l=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.status=o(b.status);c.message=r(b.message);c.code=p(b.code);c.shouldRetry=w(b.shouldRetry);c.retryDelayMs=p(b.retryDelayMs);return c};return a}(),m=function(){function a(){}a.readObject=function(b){var c=new a();c.streamId=o(b.streamId);c.newBody=r(b.newBody);c.newExtraHeader=r(b.newExtraHeader);c.patchExtraHeader=r(b.patchExtraHeader);c.killBody=w(b.killBody);c.temporary=w(b.temporary);return c};return a}(),n=function(){function a(){}var b=a.prototype;b.getRequest=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REQUEST&&this.request!=null)return this.request;throw new Error("Expected request")};b.getData=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA&&this.data!=null)return this.data;throw new Error("Expected data")};b.getDataAck=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.dataAck!=null)return this.dataAck;throw new Error("Expected dataAck")};b.getStatusUpdate=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE&&this.statusUpdate!=null)return this.statusUpdate;throw new Error("Expected status update")};b.getLog=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.LOG&&this.log!=null)return this.log;throw new Error("Expected log")};b.getRewriteRequest=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST&&this.rewriteRequest!=null)return this.rewriteRequest;throw new Error("Expected rewrite request")};b.getStreamId=function(){if(this.type==d("BladeRunnerTypes").StreamFrameType.REQUEST&&this.request!=null)return this.request.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA&&this.data!=null)return this.data.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE&&this.statusUpdate!=null)return this.statusUpdate.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.LOG&&this.log!=null)return this.log.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST&&this.rewriteRequest!=null)return this.rewriteRequest.streamId;if(this.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.dataAck!=null)return this.dataAck.streamId;throw new Error("Frame with unexpected type")};b.isInstrumented=function(){if(this.type===d("BladeRunnerTypes").StreamFrameType.REQUEST)return this.getRequest().instrumentationData!=null;else if(this.type===d("BladeRunnerTypes").StreamFrameType.DATA)return this.getData().instrumentationData!=null;else return!1};a.readObject=function(b){var e=new a();e.type=o(b.type);switch(e.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:e.request=h.readObject(s(b.request));break;case d("BladeRunnerTypes").StreamFrameType.DATA:e.data=i.readObject(s(b.data));break;case d("BladeRunnerTypes").StreamFrameType.DATA_ACK:e.dataAck=j.readObject(s(b.dataAck));break;case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:e.statusUpdate=l.readObject(s(b.statusUpdate));break;case d("BladeRunnerTypes").StreamFrameType.LOG:e.log=k.readObject(s(b.log));break;case d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST:e.rewriteRequest=m.readObject(s(b.rewriteRequest));break;default:c("BladeRunnerLogger").warn("Frame with unexpected type: "+e.type);return null}return e};a.newRequestFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.REQUEST;c.request=b;return c};a.newDataFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.DATA;c.data=b;return c};a.newDataAckFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.DATA_ACK;c.dataAck=b;return c};a.newStatusUpdateFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE;c.statusUpdate=b;return c};a.newLogFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.LOG;c.log=b;return c};a.newRewriteRequestFrame=function(b){var c=new a();c.type=d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST;c.rewriteRequest=b;return c};return a}();a=function(){function a(a,b,c){this.batchId=a,this.frames=b,this.instrumentationData=c}var b=a.prototype;b.getFrames=function(){if(this.frames!=null)return this.frames;throw new Error("Expected frames")};b.getInstrumentationData=function(){if(this.instrumentationData!=null)try{return JSON.parse(this.instrumentationData)}catch(a){return null}else return null};b.getInstrumentationDataDfTraceId=function(){if(this.instrumentationData!=null)try{var a=JSON.parse(this.instrumentationData);return(a=a.dataFlowTracingData)==null?void 0:a.traceId}catch(a){return null}else return null};b.write=function(){return JSON.stringify(this)};b.isInstrumented=function(){return this.getFrames().some(function(a){return a.isInstrumented()})};a.read=function(b){b=JSON.parse(b);var c=b.batchId||0,d=[];for(var e of b.frames){var f=n.readObject(e);f!=null&&d.push(f)}f=b.instrumentationData||null;return new a(c,d,f)};return a}();function o(a){if(typeof a==="number")return a;throw new Error("Expected number")}function p(a){return a==null?null:o(a)}function q(a){if(typeof a==="string")return a;throw new Error("Expected string")}function r(a){return a==null?null:q(a)}function s(a){if(typeof a==="object"&&a!=null)return a;throw new Error("Expected object")}function t(a){if(typeof a==="object"&&a!=null){var b=a,c={};Object.keys(b).forEach(function(a){var d=b[a];typeof d==="string"&&d!=null&&(c[a]=d)});return c}throw new Error("Expected string map")}function u(a){return a==null?null:t(a)}function v(a){if(typeof a==="boolean"&&a!=null)return a;throw new Error("Expected boolean")}function w(a){return a==null?null:v(a)}g.GatewayStreamRequest=h;g.GatewayStreamData=i;g.GatewayStreamDataAck=j;g.GatewayStreamLog=k;g.GatewayStreamStatusUpdate=l;g.GatewayStreamRewriteRequest=m;g.GatewayStreamFrame=n;g.GatewayStreamBatch=a}),98);
__d("RequestStreamE2EClientLoggerEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({RECEIVED:"received",SENT:"sent",FAILURE:"failure",PUBACK:"puback"});f["default"]=a}),66);
__d("RequestStreamE2EClientLoggerMessageType",[],(function(a,b,c,d,e,f){a=Object.freeze({REQUEST_STREAM:"request_stream",AMENDMENT:"amendment",AMENDMENT_ACK:"amendment_ack",CANCEL:"cancel",RESPONSE:"response",RESPONSE_ACK:"response_ack",TIMED_REQUEST:"timed_request",INTERRUPT:"interrupt"});f["default"]=a}),66);
__d("BladeRunnerEventHandler",["BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes","BladeRunnerTypesInternal","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){var h=1e3;a=function(){function a(a,b,c){this.$2=a,this.$1=b,this.$3=c}var b=a.prototype;b.onProxyResponse=function(a){this.$4(a);var b=[];for(var e of a.getFrames())this.$2.witnessFrame(e)&&b.push(e);e=this.$2.getRequest();(e=e.e2eLogger)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").SENT,{},(e=a.getInstrumentationData())==null?void 0:e.auxId,null,a.getInstrumentationDataDfTraceId());b.length>0&&this.$5(new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(a.batchId,b,a.instrumentationData))};b.onDisconnect=function(){this.$2.resetErrors();var a=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();a.streamId=this.$2.getRequest().streamId;a.status=d("BladeRunnerStreamStatus").StreamStatus.CLOSED;a.shouldRetry=!0;a.retryDelayMs=0;a=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(null,[d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(a)]);this.onProxyResponse(a)};b.$4=function(a){var b=this;a=a.getFrames().filter(function(a){return a.type==d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE});for(a of a){var e=a.getStatusUpdate();if(e.status==d("BladeRunnerStreamStatus").StreamStatus.CLOSED||e.status==d("BladeRunnerStreamStatus").StreamStatus.REJECTED){this.$2.onError();var f=e.shouldRetry!=null&&e.shouldRetry,g=e.message!=null?e.message:"null";if(f&&this.$2.getErrorCount()<=this.$2.getRetriesAllowed()){e.status=d("BladeRunnerStreamStatus").StreamStatus.STOPPED;var i=h;e.retryDelayMs!=null&&(i=e.retryDelayMs);c("BladeRunnerLogger").info("Can retry: stream "+e.streamId+" closed with status "+e.status+", message "+g+". Error count: "+this.$2.getErrorCount()+", retryDelay "+i+"ms. Already retrying: "+this.$2.getRetryRequestScheduled().toString());this.$2.getRetryRequestScheduled()?c("BladeRunnerLogger").bumpCounter("stream_closed_already_retrying"):(c("BladeRunnerLogger").bumpCounter("stream_closed_will_retry"),this.$2.setRetryRequestScheduled(!0),i>0?c("setTimeoutAcrossTransitions")(function(){return b.$6()},i):this.$6())}else c("BladeRunnerLogger").info("Will not retry: stream "+e.streamId+" closed with status "+e.status+", message "+g+". Error count: "+this.$2.getErrorCount()+", shouldRetry "+f.toString()+". Already retrying: "+this.$2.getRetryRequestScheduled().toString()),f?c("BladeRunnerLogger").bumpCounter("stream_closed_retry_exceeded"):c("BladeRunnerLogger").bumpCounter("stream_closed_no_retry"),this.$3.removeStream(e.streamId)}}};b.$6=function(){this.$2.setRetryRequestScheduled(!1);if(this.$2.isAlive()){var a=this.$1.getUpdatedRequestBody();a!=null&&this.$2.updateRetryRequestPayload(a);this.$3.sendRetryStreamRequest(this.$2)}};b.$5=function(a){c("BladeRunnerLogger").bumpCounter("send_to_handler");var b=[];this.$1.onBatch(a);for(a of a.getFrames())try{switch(a.type){case d("BladeRunnerTypes").StreamFrameType.DATA:this.$1.onData(a.getData());b.push(a.getData());break;case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:this.$1.onStatusUpdate(a.getStatusUpdate().status);break;case d("BladeRunnerTypes").StreamFrameType.LOG:var e=a.getLog().message;e!=null&&this.$1.onLog(e);break;case d("BladeRunnerTypes").StreamFrameType.DATA_ACK:break;default:throw new Error("Frame with unexpected type")}}catch(a){c("BladeRunnerLogger").bumpCounter("send_to_handler_error"),c("BladeRunnerLogger").exception(a,"Failed sending frame to stream handler")}this.$7(b)};b.$7=function(a){var b=[];for(a of a)if(a.shouldAck===!0&&a.dataId!=null){var c=new(d("BladeRunnerTypesInternal").GatewayStreamDataAck)();c.streamId=a.streamId;c.dataId=a.dataId;c.success=!0;b.push(c)}this.$3.sendDataAcks(b)};return a}();g["default"]=a}),98);
__d("RtiRequestStreamE2eClientBatchFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("819");b=d("FalcoLoggerInternal").create("rti_request_stream_e2e_client_batch",a);e=b;g["default"]=e}),98);
__d("RtiRequestStreamE2eClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1857112");b=d("FalcoLoggerInternal").create("rti_request_stream_e2e_client",a);e=b;g["default"]=e}),98);
__d("RequestStreamE2ELogger",["ConstUriUtils","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RtiRequestStreamE2eClientBatchFalcoEvent","RtiRequestStreamE2eClientFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=["FBGQLS:COMMENT_CREATE_SUBSCRIBE","FBGQLS:COMMENT_LIKE_SUBSCRIBE","FBGQLS:FEEDBACK_COMMENT_PERMISSION_TOGGLE_SUBSCRIBE","FBGQLS:FEEDBACK_TYPING_SUBSCRIBE","FBLQ:comet_notifications_live_query_experimental"],i=0;function j(){var a=Date.now();i>=a?i+=1:i=a;return i.toString()}var k=function(){function a(a,b,c,e,f,g,h,i,j,k){this.$10=[];this.$11=!1;this.$1=a;this.$2=b;this.$3=c;this.$4=e;this.$5=f;this.$6=g;this.$7=h;this.$8=i;this.$9=j;this.$12=k!=null?k:!1;a=d("ConstUriUtils").getUri(window.location.href);a&&(this.$13=a.getDomain())}var b=a.prototype;b.logE2EEvent=function(a,b,c,d,e,f){c===void 0&&(c=null);d===void 0&&(d=null);e===void 0&&(e=null);f===void 0&&(f=null);if(this.$3==="Falco")return;e={request_id:this.$1,resume_id:"0",retry_id:e,transport:this.$2,method:this.$3,use_case:this.$4,request_log_context:this.$5,force_log_context:this.$6,e2e_sample_rate:this.$7,message_type:a,event:b,timestamp_ms:j(),aux_id:d,additional_data:c,dgw_stream_group_logging_id:this.$8,dgw_count_prior_streams_in_group:this.$9,domain:this.$13,df_trace_id:f};this.$14(e)};b.$14=function(a){if(!this.$12){c("RtiRequestStreamE2eClientFalcoEvent").log(function(){return a});return}this.$10.push(a);if(this.$11||a.event==c("RequestStreamE2EClientLoggerEvent").FAILURE||a.message_type==c("RequestStreamE2EClientLoggerMessageType").RESPONSE){var b={events:this.$10};c("RtiRequestStreamE2eClientBatchFalcoEvent").log(function(){return b});this.$10=[];this.$11=!0}};b.getRequestId=function(){return this.$1};return a}();function a(a,b,c){if(a==null||a.method==null)return null;var d=!1;h.includes(a.method)&&(d=!0);if(b==null||b.length==0)return null;b=JSON.parse(b);return b.requestId==null?null:new k(b.requestId,c,a.method,l(a.method,a),b.requestLogContext,b.forceLogContext,b.sampleRate,b.dgwStreamGroupLoggingId,b.dgwCountPriorStreamsInGroup,d)}function l(a,b){if(a==="FBLQ"&&b.config_id)return b.config_id;if(a==="SKY"){if(b.topic){var c=b.topic.lastIndexOf("/");return c>0?b.topic.substr(0,c):b.topic}return}return a}function b(a,b,d,e,f,g){f===void 0&&(f=null);g===void 0&&(g=null);if(a==null||a.requestId==null||a.clientLoggingDisabled!=null)return;var h={request_id:a.requestId,resume_id:"0",transport:b,e2e_sample_rate:a.sampleRate,message_type:d,event:e,timestamp_ms:j(),aux_id:a.auxId,additional_data:f,df_trace_id:g};c("RtiRequestStreamE2eClientFalcoEvent").log(function(){return h})}g.RequestStreamE2ELogger=k;g.createStreamLogger=a;g.logRequestStreamE2EEventStatic=b}),98);
__d("RequestStreamTransport",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["WEB_BR_MQTT","WEB_RS_MQTT","WEB_RS_STARGATE"]);f.RequestStreamTransport=a}),66);
__d("BladeRunnerSocket",["BladeRunnerEventHandler","BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes","BladeRunnerTypesInternal","CurrentUser","FBMqttChannel","MqttPublishListener","Promise","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamTransport","justknobx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Connected",j="Disconnected",k="/br_sr",l="/sr_res",m=null;function n(a){var b;switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:return(b=a.request)==null?void 0:b.getInstrumentationData();case d("BladeRunnerTypes").StreamFrameType.DATA:return(b=a.data)==null?void 0:b.getInstrumentationData()}return null}function o(a){switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:return c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM;case d("BladeRunnerTypes").StreamFrameType.DATA:return c("RequestStreamE2EClientLoggerMessageType").AMENDMENT}return null}function p(a){if(a===null)return null;switch(a){case d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED:return"Accepted";case d("BladeRunnerStreamStatus").StreamStatus.REJECTED:return"Rejected";case d("BladeRunnerStreamStatus").StreamStatus.STARTED:return"Started";case d("BladeRunnerStreamStatus").StreamStatus.STOPPED:return"Stopped";case d("BladeRunnerStreamStatus").StreamStatus.CLOSED:return"Closed"}return null}function q(a){var b={};a==null?void 0:(a=a.frames)==null?void 0:a.forEach(function(a){if(a.type===d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE){a=(a=a.statusUpdate)==null?void 0:a.status;a=p(a);a!==null&&(b.flow_status=a)}});return b}function r(a,b){var c;switch(a.type){case d("BladeRunnerTypes").StreamFrameType.REQUEST:b.data_base64_size=(c=a.request)==null?void 0:(c=c.payload)==null?void 0:(c=c.length)==null?void 0:c.toString();break;case d("BladeRunnerTypes").StreamFrameType.DATA:b.data_base64_size=(c=a.data)==null?void 0:(b=c.rawDataSize())==null?void 0:b.toString();break}return null}function s(a,b,e){var f=n(a);if(f==null)return;var g=o(a);if(g==null)return;var h=null;switch(b){case d("MqttPublishListener").MqttPublishEvent.SENT:h=c("RequestStreamE2EClientLoggerEvent").SENT;break;case d("MqttPublishListener").MqttPublishEvent.ACKED:h=c("RequestStreamE2EClientLoggerEvent").PUBACK;break;case d("MqttPublishListener").MqttPublishEvent.NOT_ACKED:case d("MqttPublishListener").MqttPublishEvent.NOT_CONNECTED:case d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR:h=c("RequestStreamE2EClientLoggerEvent").FAILURE;e.reason==null&&(e.reason=b);break}if(h==null)return;r(a,e);if(((b=a.request)==null?void 0:b.e2eLogger)!=null&&f.clientLoggingDisabled==null){(b=a.request)==null?void 0:b.e2eLogger.logE2EEvent(g,h,e,f.auxId)}else d("RequestStreamE2ELogger").logRequestStreamE2EEventStatic(f,d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,g,h,e)}a=function(){function a(a){this.$1=[],this.$2=0,this.$3=0,this.$4=null,this.$5=0,this.$6=new Map(),this.$7=a!=null?a:c("FBMqttChannel"),this.$8=new Map(),c("BladeRunnerLogger").setClientSessionId(c("uuidv4")()),this.$9()}a.get=function(){m==null&&(m=new a(c("FBMqttChannel")));return m};var e=a.prototype;e.sendNewStreamRequest=function(b,d){d=new(c("BladeRunnerEventHandler"))(b,d,this);var e=b.getRequest();this.$6.set(e.streamId,d);if(!this.$10()){this.$11(d,e.streamId);return}this.getStreamCount()<=a.maxStreamCount?this.$12(e):(c("BladeRunnerLogger").bumpCounter("socket_request_throttled_max_streams"),c("BladeRunnerLogger").warn("Maximum stream count reached, will not send request: "+JSON.stringify(b.getRequest().getHeaders())),this.$11(d,e.streamId))};e.sendRetryStreamRequest=function(a){this.$12(a.getRequest())};e.sendCancel=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_cancel");var b=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();b.streamId=a.streamId;b.status=d("BladeRunnerStreamStatus").StreamStatus.CLOSED;this.$13(b,a);this.removeStream(a.streamId)};e.sendAmendment=function(a,b,e){c("BladeRunnerLogger").bumpCounter("socket_send_amendment");var f=new(d("BladeRunnerTypesInternal").GatewayStreamData)();f.streamId=a;f.setData(b);e!=null&&(f.instrumentationData=e);this.$14(f)};e.sendAmendmentWithAck=function(a,e,f){var g=this;c("BladeRunnerLogger").bumpCounter("socket_send_amendment");var i=this.$15(),j=new(d("BladeRunnerTypesInternal").GatewayStreamData)();j.streamId=a;j.setData(e);j.shouldAck=!0;j.dataId=i;f!=null&&(j.instrumentationData=f);a=new(h||(h=b("Promise")))(function(a,b){g.$8.set(i,{resolve:a,reject:b})});this.$14(j);return a};e.$14=function(a){this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newDataFrame(a)),this.$16()};e.sendDataAcks=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_data_ack",a.length),this.$17(a)};e.removeStream=function(a){this.$6["delete"](a)};e.getStreamCount=function(){return this.$6.size};e.getNextStreamId=function(){this.$5++;return this.$5};e.onMQTTStateChanged=function(a){this.$16();if(a!=j&&a!=i||this.$4==a)return;this.$4=a;c("BladeRunnerLogger").info("MQTTStateChanged: "+a);a==j?(c("BladeRunnerLogger").bumpCounter("mqtt_state_disconnected"),this.$18()):a==i&&c("BladeRunnerLogger").bumpCounter("mqtt_state_connected")};e.$12=function(a){c("BladeRunnerLogger").bumpCounter("socket_send_request");this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newRequestFrame(a));if(!this.$16()){(a=a.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"MQTT Not Connected"})}};e.$13=function(a,b){this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(a));if(this.$16()){(a=b.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").SENT)}};e.$17=function(a){for(a of a)this.$1.push(d("BladeRunnerTypesInternal").GatewayStreamFrame.newDataAckFrame(a));this.$16()};e.$19=function(){this.$2++;return this.$2};e.$15=function(){this.$3++;return this.$3};e.$16=function(){var a=!1;if(this.$7.getConnectionState()===i&&this.$1.length>0)try{this.$20(this.$1),a=!0}catch(a){}finally{this.$1=[]}return a};e.$20=function(a){var b=this,e=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(this.$19(),a),f=e.write();if(f.length>this.$21()){var g=Math.floor(a.length/2);if(g===0){a.forEach(function(a){return s(a,d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR,{reason:"too long"})});var h=new Error("Publish is too long: "+f.length);h.stack;this.$22(e,h,"Publish is too long");throw h}this.$20(a.slice(0,g));this.$20(a.slice(g,a.length))}else try{c("BladeRunnerLogger").info("send message to "+k+" ("+f.length+" bytes)");h={qos:1,skipBuffer:!1};if(e.isInstrumented()){var i=Date.now();h.listener={onEvent:function(b){var c=(Date.now()-i).toString();a.forEach(function(a){s(a,b,{latency:c})})}}}this.$7.publish(k,f,h)["catch"](function(a){b.$22(e,a,"Failed publishing to MQTT")});c("BladeRunnerLogger").bumpCounter("mqtt_publish_success")}catch(a){this.$22(e,a,"Failed publishing to MQTT");throw a}};e.$9=function(){var a=this;c("BladeRunnerLogger").info("Starting socket with endpoint "+this.$7.getEndpoint()+" useragent "+navigator.userAgent);this.onMQTTStateChanged(this.$7.getConnectionState());this.$7.subscribeChannelEvents({onMQTTStateChanged:function(b){a.onMQTTStateChanged(b)},onJSError:function(a){var b=a!=null&&typeof a.isRecoverable==="boolean"?a.isRecoverable:!1;b?c("BladeRunnerLogger").bumpCounter("mqtt_channel_recoverable_error"):(c("BladeRunnerLogger").warn("JS error in MQTTChannel: "+(typeof a=="object"&&a!=null?a.toString():"unknown error")+", "+JSON.stringify(a)),c("BladeRunnerLogger").bumpCounter("mqtt_channel_error"))}});this.$7.subscribe(k,function(a){throw new Error("Unexpected response: "+k+" "+a.toString())});this.$7.subscribe(l,function(b){a.$23(b)})};e.$23=function(a){a=d("BladeRunnerTypesInternal").GatewayStreamBatch.read(a);this.processBatch(a)};e.$22=function(a,b,e){for(a of a.getFrames())if(a.type===d("BladeRunnerTypes").StreamFrameType.REQUEST){var f=a.getRequest(),g=this.$6.get(f.streamId);g!=null&&this.$24(g,f.streamId,d("BladeRunnerStreamStatus").StreamStatus.CLOSED,!0,null)}else if(a.type===d("BladeRunnerTypes").StreamFrameType.DATA){g=a.getData();f=g.dataId;if(g.shouldAck!=null&&g.shouldAck&&f!=null){var h=new(d("BladeRunnerTypesInternal").GatewayStreamDataAck)();h.streamId=g.streamId;h.dataId=f;h.success=!1;h.code=d("BladeRunnerTypesInternal").GatewayStreamDataAck.ACK_CODE_FAILED_TO_LAND;h.message=e;this.$25(h)}}c("BladeRunnerLogger").info("Failed publishing to MQTT: "+b.message);c("BladeRunnerLogger").bumpCounter("mqtt_publish_error")};e.$25=function(a){var b=this.$8.get(a.dataId);b!=null&&(this.$8["delete"](a.dataId),a.success?b.resolve(!0):a.code===d("BladeRunnerTypesInternal").GatewayStreamDataAck.ACK_CODE_LANDED_BUT_NOT_ACCEPTED?b.resolve(!1):b.reject(a.message))};e.processBatch=function(a){try{d("RequestStreamE2ELogger").logRequestStreamE2EEventStatic(a.getInstrumentationData(),d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").RECEIVED,q(a),a.getInstrumentationDataDfTraceId());c("BladeRunnerLogger").bumpCounter("socket_process_batch");var b=JSON.stringify(a);c("BladeRunnerLogger").info("Received batch ("+b.length+" bytes)");b=null;for(var e of a.getFrames()){var f=e.getStreamId();b==null&&(b=f);if(f!=null&&b!=f)throw new Error("Received batch with frames for multiple streams");e.type==d("BladeRunnerTypes").StreamFrameType.DATA_ACK&&this.$25(e.getDataAck())}if(b!=null){f=this.$6.get(b);f!=null?f.onProxyResponse(a):c("BladeRunnerLogger").info("Received batch with frames for unknown stream id: "+b)}else c("BladeRunnerLogger").info("Received batch with no frames")}catch(a){c("BladeRunnerLogger").exception(a,"Failed processing batch from MQTT");c("BladeRunnerLogger").bumpCounter("socket_process_batch_error");throw a}};e.$18=function(){this.$6.forEach(function(a,b,c){a.onDisconnect()})};e.$11=function(a,b){this.$24(a,b,d("BladeRunnerStreamStatus").StreamStatus.REJECTED,!1,0)};e.$24=function(a,b,c,e,f){var g=new(d("BladeRunnerTypesInternal").GatewayStreamStatusUpdate)();g.streamId=b;g.status=c;g.shouldRetry=e;g.retryDelayMs=f;b=new(d("BladeRunnerTypesInternal").GatewayStreamBatch)(null,[d("BladeRunnerTypesInternal").GatewayStreamFrame.newStatusUpdateFrame(g)]);a.onProxyResponse(b)};e.$10=function(){if(!c("CurrentUser").isLoggedIn()){c("BladeRunnerLogger").bumpCounter("request_stream_user_logged_out");return!1}return!0};e.$21=function(){var a=1024*1024,b=512*1024;try{var d=c("justknobx")._("317");b=d*a}catch(a){}return Math.max(b-1024,0)};return a}();a.maxStreamCount=2e3;g["default"]=a}),98);
__d("BladeRunnerStream",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g;a=function(){function a(a){this.$1=a}var c=a.prototype;c.getStreamHandler=function(){return this.$1};c.cancel=function(){};c.amendWithAck=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){return!1});function c(b){return a.apply(this,arguments)}return c}();c.amendFireAndForget=function(a){};c.amendWithoutAck=function(a){};c.start=function(){return(g||(g=b("Promise"))).resolve()};c.isAlive=function(){return!1};c.canAmend=function(){return!1};c.getStatus=function(){return null};c.getStreamId=function(){return 0};return a}();f["default"]=a}),66);
__d("BladeRunnerStreamState",["BladeRunnerLogger","BladeRunnerStreamStatus","BladeRunnerTypes"],(function(a,b,c,d,e,f,g){a=function(){function a(a){this.$1=a,this.$2=null,this.$3=0,this.$4=!1,this.$5=0,this.$6=!1}var b=a.prototype;b.getRequest=function(){return this.$1};b.updateRetryRequestPayload=function(a){this.$1.updateRetryRequestPayload(a)};b.isAlive=function(){return!(this.$2==d("BladeRunnerStreamStatus").StreamStatus.CLOSED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.REJECTED)};b.canAmend=function(){return this.$2==d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.STARTED||this.$2==d("BladeRunnerStreamStatus").StreamStatus.STOPPED};b.getLastStatus=function(){return this.$2};b.setLastStatus=function(a){this.$2=a};b.onError=function(){this.$3+=1};b.getErrorCount=function(){return this.$3};b.resetErrors=function(){this.$3=0};b.getRetryRequestScheduled=function(){return this.$6};b.setRetryRequestScheduled=function(a){this.$6=a};b.witnessFrame=function(a){switch(a.type){case d("BladeRunnerTypes").StreamFrameType.STATUS_UPDATE:var b=a.getStatusUpdate(),c=!0;switch(b.status){case d("BladeRunnerStreamStatus").StreamStatus.ACCEPTED:c=!this.$4;this.$4||(this.$4=!0);break;case d("BladeRunnerStreamStatus").StreamStatus.STARTED:c=this.getLastStatus()!=d("BladeRunnerStreamStatus").StreamStatus.STARTED;break;case d("BladeRunnerStreamStatus").StreamStatus.STOPPED:c=this.getLastStatus()==d("BladeRunnerStreamStatus").StreamStatus.STARTED;break;case d("BladeRunnerStreamStatus").StreamStatus.CLOSED:case d("BladeRunnerStreamStatus").StreamStatus.REJECTED:default:c=!0}this.setLastStatus(b.status);return c;case d("BladeRunnerTypes").StreamFrameType.REWRITE_REQUEST:this.$7(a.getRewriteRequest());return!1;default:return!0}};b.setRetriesAllowed=function(a){this.$5=a};b.getRetriesAllowed=function(){return this.$5};b.$7=function(a){if(!(a.temporary!=null||a.temporary==!0)){a.newBody!=null&&(this.$1.payload=a.newBody);a.newExtraHeader!=null&&(this.$1.extraHeader=a.newExtraHeader,this.$1.headers=JSON.parse(a.newExtraHeader));if(a.patchExtraHeader!=null)try{var b=JSON.parse(a.patchExtraHeader),d=this.$1.extraHeader!=null?JSON.parse(this.$1.extraHeader):{};this.$1.headers==null&&(this.$1.headers={});for(var e of Object.keys(b))this.$1.headers[e]=b[e],d[e]=b[e];this.$1.extraHeader=JSON.stringify(d)}catch(b){c("BladeRunnerLogger").warn("Failed to patch header: "+a.patchExtraHeader)}a.killBody!=null&&a.killBody==!0&&(this.$1.payload=null)}};return a}();g["default"]=a}),98);
__d("BladeRunnerSocketStream",["BladeRunnerStream","BladeRunnerStreamState","BladeRunnerStreamStatus","Promise","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","asyncToGeneratorRuntime","uuidv4"],(function(a,b,c,d,e,f,g){var h,i=4,j={reason:"stream_dead"};a=function(a){babelHelpers.inheritsLoose(e,a);function e(b,d,e){b=a.call(this,b)||this;b.$BladeRunnerSocketStream$p_1=e;b.$BladeRunnerSocketStream$p_2=new(c("BladeRunnerStreamState"))(d);b.$BladeRunnerSocketStream$p_2.setRetriesAllowed(i);return b}var f=e.prototype;f.start=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.send(),b()})};f.send=function(){var a,b=this.$BladeRunnerSocketStream$p_2.getRequest();(a=b.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_base64_size:(a=b.payload)==null?void 0:(b=a.length)==null?void 0:b.toString()});this.$BladeRunnerSocketStream$p_1.sendNewStreamRequest(this.$BladeRunnerSocketStream$p_2,this.getStreamHandler())};f.amendWithAck=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var d=this.$BladeRunnerSocketStream$p_2.getRequest(),e=d.getInstrumentationData();if(e){var f;e.auxId=c("uuidv4")();(f=d.e2eLogger)==null?void 0:f.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:a==null?void 0:(f=a.length)==null?void 0:f.toString()},e.auxId)}if(this.canAmend()){if(e){(f=d.e2eLogger)==null?void 0:f.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:a==null?void 0:(f=a.length)==null?void 0:f.toString()},e.auxId)}return this.$BladeRunnerSocketStream$p_1.sendAmendmentWithAck(d.streamId,this.$BladeRunnerSocketStream$p_3(a),e==null?null:JSON.stringify(e))}(f=d.e2eLogger)==null?void 0:f.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,j,e==null?void 0:e.auxId);return(h||(h=b("Promise"))).reject("Stream is closed or not accepted")});function d(b){return a.apply(this,arguments)}return d}();f.amendFireAndForget=function(a){var b=this.$BladeRunnerSocketStream$p_2.getRequest(),d=b.getInstrumentationData();if(d){var e;d.auxId=c("uuidv4")();(e=b.e2eLogger)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:a==null?void 0:(e=a.length)==null?void 0:e.toString()},d.auxId)}if(this.canAmend()){this.$BladeRunnerSocketStream$p_1.sendAmendment(this.$BladeRunnerSocketStream$p_2.getRequest().streamId,this.$BladeRunnerSocketStream$p_3(a),d==null?null:JSON.stringify(d));if(d){(e=b.e2eLogger)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:a==null?void 0:(e=a.length)==null?void 0:e.toString()},d.auxId)}}else{(a=b.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,j,d==null?void 0:d.auxId);throw new Error("Stream is closed or not accepted")}};f.amendWithoutAck=function(a){this.amendFireAndForget(a)};f.$BladeRunnerSocketStream$p_3=function(a){return typeof a=="object"?btoa(new TextDecoder("utf8").decode(a)):a};f.cancel=function(){var a=this.$BladeRunnerSocketStream$p_2.getRequest();(a=a.e2eLogger)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").RECEIVED);this.isAlive()&&(this.$BladeRunnerSocketStream$p_1.sendCancel(this.$BladeRunnerSocketStream$p_2.getRequest()),this.$BladeRunnerSocketStream$p_2.setLastStatus(d("BladeRunnerStreamStatus").StreamStatus.CLOSED),this.getStreamHandler().onClientCancel())};f.isAlive=function(){return this.$BladeRunnerSocketStream$p_2.isAlive()};f.canAmend=function(){return this.$BladeRunnerSocketStream$p_2.canAmend()};f.getStatus=function(){return this.$BladeRunnerSocketStream$p_2.getLastStatus()};f.getStreamId=function(){return this.$BladeRunnerSocketStream$p_2.getRequest().streamId};return e}(c("BladeRunnerStream"));g["default"]=a}),98);
__d("RequestStreamE2ESampling",["invariant","Random","RequestStreamE2EClientSamplingConfig","uuidv4"],(function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a==null?!1:a.requestId!=null&&typeof a.requestId=="string"&&a.forceLogContext!=null&&typeof a.forceLogContext=="string"}function j(a,b){var d=c("RequestStreamE2EClientSamplingConfig").sampleRate;if(d>1&&a!=null){a=c("RequestStreamE2EClientSamplingConfig").methodToSamplingMultiplier[a];a==0?d=0:a!=null&&(d/=a)}return d==1?1:d/b}function k(a,b,d,e){var f=c("uuidv4")();(b.requestId==null||b.requestId===""||typeof b.requestId!="string")&&(a.requestId!=null&&typeof a.requestId=="string"?b.requestId=a.requestId:b.requestId=f);b.requestId+="/_"+f.substring(0,4);b.resumeId="0";d!=null?b.sampleRate=d:b.sampleRate=void 0;f="";e!=null&&e.length>0&&(f=e);f.length>0&&(b.requestLogContext!=null&&b.requestLogContext.length>0?b.requestLogContext+=":":b.requestLogContext="",b.requestLogContext+=f);(a==null?void 0:a.method)==="Falco"&&(b.clientLoggingDisabled="Falco");d={};for(e of Object.keys(b).sort())d[e]=b[e];return JSON.stringify(d)}function a(a,b,d,e){b&&(!b.requestId.includes("/")&&!b.requestId.includes("#")||h(0,41721));e=j(a.method,e!=null?e:1);if(c("Random").coinflip(e))return k(a,b||{requestId:""},e,d);return i(b)?k(a,b||{requestId:""},null,d):""}g.isForceLogged=i;g.getSampleRateForLogging=j;g.normalizeInstrumentationData=k;g.validateInstrumentationData=a}),98);
__d("BladeRunnerClient",["Base64","BladeRunnerConfig","BladeRunnerLogger","BladeRunnerSocket","BladeRunnerSocketStream","BladeRunnerTypes","BladeRunnerTypesInternal","RequestStreamE2ELogger","RequestStreamE2ESampling","RequestStreamTransport","cr:2046346"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){this.$2=d("RequestStreamTransport").RequestStreamTransport.WEB_BR_MQTT,this.$1=a!=null?a:c("BladeRunnerSocket").get(),b&&(this.$2=b)}var e=a.prototype;e.createStream=function(a,b,c,d){return this.$3(a,b,c,d)};e.requestStream=function(a,c,d,e){a=this.$3(a,c,d,e);a.send();b("cr:2046346")!=null&&b("cr:2046346").startPulsarTest();return a};e.logInfo=function(a){c("BladeRunnerLogger").info(a)};e.bumpCounter=function(a){c("BladeRunnerLogger").bumpCounter(a)};e.$3=function(a,b,e,f){var g=new(d("BladeRunnerTypesInternal").GatewayStreamRequest)();g.streamId=this.$1.getNextStreamId();g.requestType=d("BladeRunnerTypes").StreamRequestType.BLADE_RUNNER;g.headers=c("BladeRunnerConfig").patchRequestHeaders(a);g.extraHeader=JSON.stringify(g.headers);g.payload=b!=null?c("Base64").encode(b):null;f!=null&&(f.transport="WEB_RS_MQTT");g.instrumentationData=d("RequestStreamE2ESampling").validateInstrumentationData(g.headers||{},f);g.e2eLogger=d("RequestStreamE2ELogger").createStreamLogger(g.headers,g.instrumentationData,this.$2);return new(c("BladeRunnerSocketStream"))(e,g,this.$1)};return a}();g["default"]=a}),98);
__d("BootloaderEventsPerf",["invariant","Bootloader","BootloaderEvents","ResourceTimingStore","objectEntries","objectValues"],(function(a,b,c,d,e,f,g,h){var i={total_count:0,total_bytes:0,downloaded_count:0,downloaded_bytes:0,cached_count:0,cached_bytes:0,inlined_count:0,inlined_bytes:0,duration:0,missing_count:0};function j(a,b,c){return Math.max(0,(c!=null?c:0)-Math.max(a,b!=null?b:0))}function k(){return{blocking:babelHelpers["extends"]({},i),nonblocking:babelHelpers["extends"]({},i),"default":babelHelpers["extends"]({},i)}}function l(a,b,c){var e,f;if(c==null)e=0,f="downloaded";else if(c[1])e=c[0].length,f="inlined";else{c=d("ResourceTimingStore").getEntryForURL(c[0]);c?(e=c.encodedBodySize,f=c.transferSize===0?"cached":"downloaded"):(e=0,f="downloaded",a.missing_count++)}a.total_count++;a.total_bytes+=e;if(!b)return;a.duration=Math.max(a.duration,b);switch(f){case"downloaded":a.downloaded_count++;a.downloaded_bytes+=e;break;case"inlined":a.inlined_count++;a.inlined_bytes+=e;break;case"cached":a.cached_count++;a.cached_bytes+=e;break}}function m(a,b,d,e,f){var g=c("Bootloader").getResourceState(b);l(a,j(d,g.loadStart,g.loadEnd),e);g.loadError!=null&&f.add(b)}function n(a,b,d,e){var f=k();for(a of c("objectEntries")(a)){var g=a[0],i=a[1];for(i of i){var j=i[0],l=i[1],n=void 0,o=void 0;switch(l.type){case"async":o=null;n=d;break;case"js":case"css":o=[l.src,l.d===1];n=f;break;default:l,h(0,3721)}m(n[g],j,b,o,e)}}return f}function o(a,b){var e={unpredicted:d("BootloaderEvents").newResourceMapSet(),ef:d("BootloaderEvents").newResourceMapSet(),overpredicted:d("BootloaderEvents").newResourceMapSet()};for(var f of c("objectEntries")(b)){var g=f[0],h=f[1];for(h of h.entries()){var i=h[0],j=h[1];a[g].has(i)?e.ef[g].set(i,j):e.overpredicted[g].set(i,j)}}for(i of c("objectEntries")(a)){j=i[0];h=i[1];for(g of h.entries()){f=g[0];a=g[1];b[j].has(f)||e.unpredicted[j].set(f,a)}}return e}function a(a){var b=a.efData,c=a.rsrcs,d=a.startTime,e=new Set(),f;if(b){var g=o(c,b.tierOne);f=g.unpredicted;g={ef:n(g.ef,b.fetchRsrcsStart,k(),e),overpredicted:n(g.overpredicted,b.fetchRsrcsStart,k(),e)};b={ef_fetch_predictions:b.fetchPredictionsEnd-b.fetchPredictionsStart,ef_fetch_start_wait:b.fetchPredictionsEnd-b.fetchRsrcsStart,ef_head_start:d-b.fetchRsrcsStart}}else f=c,g={},b={};c=babelHelpers["extends"]({unpredicted:n(f,d,k(),e)},g);return{source:a.source,source_detail:a.sourceDetail,is_first_identical:a.isFirstIdentical,timeslice_context:(f=a.timesliceContext)==null?void 0:f.name,start_time:d,err_count:e.size,resources:c,durations:babelHelpers["extends"]({jsmods_wait:a.jsmodsStart-d,jsmods:a.jsmodsEnd-a.jsmodsStart,jsmods_done_wait:a.jsmodsEnd-d,download_done_wait:a.logTime-d},b),payloadStats:a.payloadStats}}function b(a){var b=a.startTime,e=0,f=0,g=0,h=0;for(var i of a.components){var m=c("Bootloader").getComponentTiming(i),o=m.tierTwoStart,p=m.tierTwoEnd,q=m.tierThreeStart;m=m.tierThreeEnd;e=Math.max(e,j(b,o,p));f=Math.max(f,j(b,b,p));g=Math.max(g,j(b,q,m));h=Math.max(h,j(b,b,m))}o=new Set();p=k();q=n(a.tierOne,b,p,o);m=n(a.tierTwo,b,p,o);i=n(a.tierThree,b,p,o);var r=p.blocking.downloaded_count!=0,s=k(),t=d("BootloaderEvents").newResourceMapSet(),u=new Set();for(var v of[a.tierOne,a.tierTwo,a.tierThree])for(var w of c("objectValues")(v))for(var x of w.keys())u.add(x);x=0;w=0;v=0;for(var y of a.beRequests.values()){x+=j(b,b,y.requestStart);w+=y.serverGenTime;v+=y.jsmodsEnd-y.jsmodsStart;l(s[r?"blocking":"nonblocking"],y.responseStart-y.requestStart,[y.uri,!1]);for(var z of c("objectEntries")(y.rsrcs)){var A=z[0],B=z[1];for(B of B){var C=B[0],D=B[1];u.has(C)||t[A].set(C,D)}}}C=n(t,b,p,o);return{ref:a.ref,components:a.components,timeslice_context:(D=a.timesliceContext)==null?void 0:D.name,start_time:b,err_count:o.size,resources:{t1:q,t2:m,t3:i,be:s,unpredicted:C,async:p},durations:{fetch_start_wait:a.fetchStartTime-b,be_start_wait:x,be_server_gen:w,be_jsmods:v,callback_wait:a.callbackStart-b,callback:a.callbackEnd-a.callbackStart,bootload_done_wait:a.callbackEnd-b,rdfd_requirelazy:e,rdfd_done_wait:f,rd_requirelazy:g,rd_done_wait:h}}}function e(a){a.start_time;var b=a.resources,d=a.durations;a=babelHelpers.objectWithoutPropertiesLoose(a,["start_time","resources","durations"]);for(b of c("objectEntries")(b)){var e=b[0],f=b[1];for(f of c("objectEntries")(f)){var g=f[0],h=f[1];for(h of c("objectEntries")(h)){var i=h[0],j=h[1];a[e+"_"+g+"_resources_"+i]=Math.round(Number(j))}}}for(i of c("objectEntries")(d)){j=i[0];h=i[1];a[j+"_duration"]=Math.round(Number(h))}if(a.payloadStats){for(g of c("objectEntries")(a.payloadStats)){f=g[0];e=g[1];for(b of c("objectEntries")(e)){d=b[0];j=b[1];a[f+"_"+d+"_count"]=Math.round(Number(j))}}delete a.payloadStats}return a}g.computeHRData=a;g.computeBLData=b;g.flattenData=e}),98);
__d("BootloaderLoggingStatusEnum",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["SUCCESS","TIMEOUT","ERROR"]);c=a;f["default"]=c}),66);
__d("CometBootloaderEventsTypedLoggerLite",["generateLiteTypedLogger"],(function(a,b,c,d,e,f){"use strict";e.exports=b("generateLiteTypedLogger")("logger:CometBootloaderEventsLoggerConfig")}),null);
__d("HasteResponseFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1823926");b=d("FalcoLoggerInternal").create("haste_response",a);e=b;g["default"]=e}),98);
__d("CometBootloaderLoggerUtil",["BootloaderEvents","BootloaderEventsPerf","CometBootloaderEventsTypedLoggerLite","CometTimeSpentNavigation","HasteResponseFalcoEvent","ResourceTimingStore","SiteData","UserTimingUtils","gkx","performance","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h,i=!1,j=c("gkx")("10211");function a(a){var b=a.bl_sample_rate,e=a.hr_sample_rate,f=a.parent_lid;if(i||!(b||e||j===!0))return;i=!0;d("ResourceTimingStore").init();var g=function(a){return{ms_since_navstart:Math.round(a-c("performanceNavigationStart")()),parent_lid:f,pkg_cohort:c("SiteData").pkg_cohort,request_path:(a=c("CometTimeSpentNavigation").getPathInfo())==null?void 0:a.name,svn_rev:c("SiteData").client_revision}};e&&d("BootloaderEvents").onHasteResponse(function(a){return c("HasteResponseFalcoEvent").log(function(){var b=d("BootloaderEventsPerf").computeHRData(a),c=d("BootloaderEventsPerf").flattenData(b);return babelHelpers["extends"]({},c,{},g(b.start_time))})});j&&(d("BootloaderEvents").onBootload(function(a){d("UserTimingUtils").measureModern("Bootloader: "+a.components.join(", "),{end:a.callbackEnd-(h||(h=c("performance"))).timeOrigin,start:a.startTime-h.timeOrigin},"Bootloader Events")}),d("BootloaderEvents").onHasteResponse(function(a){d("UserTimingUtils").measureModern("Haste: "+a.source,{end:a.jsmodsEnd-(h||(h=c("performance"))).timeOrigin,properties:[["Source Detail",a.sourceDetail]],start:a.startTime-h.timeOrigin},"Bootloader Events")}));var k=function(a,b,e){a=d("BootloaderEventsPerf").computeBLData(a);var f=d("BootloaderEventsPerf").flattenData(a);c("CometBootloaderEventsTypedLoggerLite").log(babelHelpers["extends"]({},f,{},g(a.start_time),{status:b}),{weight:e})};b&&d("BootloaderEvents").onBootload(function(a){return k(a,"SUCCESS",b)});var l=1;d("BootloaderEvents").onBootloaderCallbackTimeout(function(a){return k(a,"TIMEOUT",l)});var m=1;d("BootloaderEvents").onBootloadError(function(a){return k(a,"ERROR",m)})}g.initLogging=a}),98);
__d("CometSSREntrypoint",["objectValues","relay-runtime/util/withProvidedVariables"],(function(a,b,c,d,e,f,g){"use strict";function h(a){var b,d=c("relay-runtime/util/withProvidedVariables")(a.variables,a.parameters.params.providedVariables);return{actor_id:(b=(b=a.environmentProviderOptions)==null?void 0:b.actorID)!=null?b:null,exclude_from_ssr:(b=(b=a.environmentProviderOptions)==null?void 0:b.excludeFromSSR)!=null?b:!1,graphql_env_override_ref:(b=(b=a.environmentProviderOptions)==null?void 0:b.graphQLEnvOverrideRef)!=null?b:null,id:a.parameters.params.id,name:a.parameters.params.name,num_connections_for_ssr:(b=(b=a.environmentProviderOptions)==null?void 0:b.numConnectionsForSSR)!=null?b:null,preloader_group:(b=a.environmentProviderOptions)==null?void 0:b.preloaderGroup,variables:d}}function i(a,b){b=a.getPreloadProps(b);var d=b.entryPoints;b=b.queries;b=b!=null?b:{};var e=c("objectValues")(b).filter(function(a){return a!=null}),f=[a.root.getModuleId()];if(d!=null){b=Object.keys(d);b.forEach(function(a){a=d[a];if(a==null)return;var b=a.entryPoint;a=a.entryPointParams;b=i(b,a);e=e.concat(b.queries);f=f.concat(b.roots)})}return{queries:e,roots:f}}function a(a,b){a=i(a,b);b=a.queries;return b.map(h)}function b(a){a=a.map(function(a){return i(a.entryPoint,a.entryPointParams)});return a.map(function(a){var b=a.queries;a=a.roots;return{quries:b.map(h),roots:a}})}function d(a,b){a=i(a,b);b=a.queries;a=a.roots;return{queries:b.map(h),roots:a}}function e(){throw new Error("This function should not be called. It exists solely for the type-generation")}function f(a,b){var d;a=a.map(function(a){return i(a.entryPoint,a.entryPointParams)});a=a.map(function(a){var b=a.queries;a=a.roots;return{queries:b.map(h),roots:a}});d=c("objectValues")((d=b==null?void 0:b.getDisplayQueries())!=null?d:{}).filter(function(a){return a!=null}).map(h);b=c("objectValues")((b=b==null?void 0:b.getDeferredQueries())!=null?b:{}).filter(function(a){return a!=null}).map(h);return{appshellQueries:{deferred:b,display:d},routeObjects:a}}g.processRootEntryPoint=a;g.processRootEntryPoints=b;g.processRootEntryPointData=d;g.preloadQuery=e;g.processServerEntryPoints=f}),98);
__d("CometRouterSSREntrypoint",["CometSSREntrypoint"],(function(a,b,c,d,e,f){"use strict";a=importNamespace("CometSSREntrypoint").processRootEntryPoint;b=importNamespace("CometSSREntrypoint").processRootEntryPointData;f.processRootEntryPoint=a;f.processRootEntryPointData=b}),66);
__d("CometRelayEF",["Bootloader","BootloaderEvents","ClientConsistencyEventEmitter","CometRouterSSREntrypoint","cometAsyncFetch","gkx","performanceAbsoluteNow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Map();function j(a){if(!c("gkx")("26332"))return;a=a.filter(function(a){return!i.has(a)});if(a.length===0)return;a.forEach(function(a){d("BootloaderEvents").notifyHasteResponseEFStart("relay_3d",a)});var b=(h||(h=c("performanceAbsoluteNow")))(),e=c("cometAsyncFetch")("/ajax/relay-ef/",{data:{queries:a},method:"POST"}).then(function(a){return{fetchPredictionsEnd:(h||(h=c("performanceAbsoluteNow")))(),fetchPredictionsStart:b,payload:a}});a.forEach(function(a){return i.set(a,e)})}function a(a,b){a=d("CometRouterSSREntrypoint").processRootEntryPoint(a,b);j(a.map(function(a){a=a.name;return a}))}function k(a){if(!c("gkx")("26332"))return;j(a);var b=(h||(h=c("performanceAbsoluteNow")))();a.forEach(function(a){var e=i.get(a);e&&e!==!0&&c("promiseDone")(e,function(e){var f=e.fetchPredictionsEnd,g=e.fetchPredictionsStart;e=e.payload;if(e!=null&&typeof e==="object"){var h;c("Bootloader").loadPredictedResourceMap(e.predictions[a],{onLog:function(c){return d("BootloaderEvents").notifyHasteResponseEF("relay_3d",a,{fetchPredictionsEnd:f,fetchPredictionsStart:g,fetchRsrcsStart:b,tierOne:c})}},(h=(h=e.consistency)==null?void 0:h.rev)!=null?h:null);e.consistency!=null&&c("ClientConsistencyEventEmitter").emit("newEntry",e.consistency)}});i.set(a,!0)})}function b(a,b){a=d("CometRouterSSREntrypoint").processRootEntryPoint(a,b);b=a.map(function(a){a=a.name;return a});k(b)}e={fetchPredictedResources:b,fetchPredictedResourcesForQueries:k,fetchPredictions:a,fetchPredictionsForQueries:j};g["default"]=e}),98);
__d("CometToast.react",["fbt","ix","BaseToast.react","CometPressable.react","FDSCircleButton.react","FDSText.react","fbicon","react"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useMemo,m={pressable:{alignItems:"x6s0dn4",display:"x78zum5",flexDirection:"x1q0g3np",width:"xh8yej3",$$css:!0}};function a(a){var b=a.action,e=a.href,f=a.icon,g=a.impressionLoggingRef,j=a.message,n=a.onDismiss,o=a.target,p=a.testid;p=p===void 0?"Toast":p;p=a.truncateText;var q=p===void 0?!0:p;p=a.withoutCloseButton;p=p===void 0?!1:p;var r=babelHelpers.objectWithoutPropertiesLoose(a,["action","href","icon","impressionLoggingRef","message","onDismiss","target","testid","truncateText","withoutCloseButton"]),s=l(function(){return e!=null?{target:o,url:e}:void 0},[e,o]);return k.jsx(c("BaseToast.react"),{action:b!=null?{label:b.label,labelRenderer:function(a){return k.jsx(c("FDSText.react"),{color:"blueLink",numberOfLines:1,type:"bodyLink3",children:a})},onPress:b.onPress,testid:b.testid}:void 0,addOnStart:f,closeButton:p!==!0&&k.jsx(c("FDSCircleButton.react"),{icon:d("fbicon")._(i("478231"),12),label:h._(/*BTDS*/"Close"),onPress:n,size:24,testid:void 0}),linkWrapper:r.onPress!=null||s!=null?function(a){return k.jsx(c("CometPressable.react"),babelHelpers["extends"]({},r,{expanding:!0,linkProps:s,xstyle:m.pressable,children:a}))}:void 0,message:function(a){a=a.toastMessageId;return k.jsx(c("FDSText.react"),{color:"primary",id:a,numberOfLines:q?4:void 0,type:"body3",children:j})},onDismiss:n,testid:void 0,toastRef:g})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("ContextualConfigConstants",[],(function(a,b,c,d,e,f){"use strict";a=1e3;b=", ";c={SAME:"same",NULL:"null",NNULL:"nnull",CATCH_ALL:"catch_all",EQ:"eq",NEQ:"neq",LT:"lt",LTE:"lte",GT:"gt",GTE:"gte",COR:"cor",CONTAINS:"contains",REGEX:"regex",IN:"in",NIN:"nin"};d={DENSE:"dense",MULTI_OUTPUT_RESOLVED:"multi-output-resolved",TABLE:"table"};e=[];var g=[],h=[],i={BAD_BOOLEAN_FORMAT:"Bad boolean format",BAD_CONFIG:"Bad config",BAD_CONTEXT_IDENTIFIER:"Bad context identifier",BAD_CONTEXT_VALUE:"Bad context value",BAD_MONITORED_CONTEXTS:"Bad monitored contexts",BAD_NUMBER_FORMAT:"Bad number format",BAD_OUTPUT_NAME:"Bad output name",BAD_OUTPUT_TYPE:"Bad output type",BAD_VALUE_ORDER:"Bad values order",DUPLICATE_OUTPUT_NAME:"Duplicate output name",ILLEGAL_BOOLEAN_STRATEGY:"Illegal boolean strategy",ILLEGAL_BUCKET_VALUES:"Illegal bucket values",ILLEGAL_NUMERIC_STRATEGY:"Illegal numeric strategy",ILLEGAL_STRING_STRATEGY:"Illegal string strategy",INVALID_BOOLEAN:"Invalid boolean",INVALID_FLOAT:"Invalid float",INVALID_INTEGER:"Invalid integer",INVALID_STRING:"Invalid string",INVALID_VALUE_TYPE:"Invalid value type",MISMATCH_NUMBER_OF_VALUES:"Mismatching number of values",MISSING_BUCKETS:"Missing buckets",MISSING_BUCKET_MATCH:"Missing bucket match",MISSING_BUCKET_NAME:"Missing bucket name",MISSING_BUCKET_STRATEGY:"Missing bucket strategy",MISSING_CONTEXT_IN_CONFIG:"Missing context in config",MISSING_DEFAULT_VALUE:"Missing default value",MISSING_OUTPUTS_DEFINITION:"Missing outputs field definition",MISSING_RESULTS:"Missing results",MISSING_TABLE:"Missing table",MISSING_TABLE_ITEM_BUCKET:"Missing table item bucket",MISSING_TABLE_ITEM_VALUES:"Missing table item values",MISSING_VECTOR:"Missing vector",REGEX_SYNTAX_ERROR:"Regex syntax error",REQUESTED_PARAM_NOT_FOUND:"Requested param not found",RESULTS_VECTOR_SIZE_MISMATCH:"Results vector size mismatch",UNDECLARED_OUTPUT_PARAM:"Undeclared output param",UNKNOWN_BUCKET_DEFINITION:"Unknown bucket definition",UNKNOWN_CONFIG_TYPE:"Unknown config type",UNSUPPORTED_CONFIG_VERSION:"Unsupported config version"},j=10,k=", ",l={BOOL:"BOOL",FLOAT:"FLOAT",INT:"INT",STRING:"STRING"};f.ANALYTICS_SAMPLE_RATE=a;f.BUCKET_DELIMITER=b;f.CONTEXT_BUCKET_STRATEGY=c;f.CONFIG_TYPE=d;f.EMPTY_RESOLVED_CONTEXTS=e;f.EMPTY_RESOLVED_MONITORS=g;f.EMPTY_RESULT_PARAMS=h;f.ERROR=i;f.JSON_SUB_SAMPLE_RATE=j;f.LIST_DELIMITER=k;f.TYPE=l}),66);
__d("ContextualConfigResolvedContextsUtils",[],(function(a,b,c,d,e,f){"use strict";a=function(a){var b=[];for(a of a){var c=a.bucketIndex;if(c==void 0)break;b.push(c)}return b};b=function(a){var b=[];for(a of a){var c=a.bucketName;if(c===void 0)break;b.push(c)}return b};var g=function(a){return a.name};c=function(a){return a.map(g)};d=function(a){var b=[];for(a of a){var c=a.value;if(c===void 0)break;b.push(c)}return b};f.getBucketIndices=a;f.getBucketNames=b;f.getContextNames=c;f.getContextValues=d}),66);
__d("ContextualConfigCollateExposureData",["ContextualConfigConstants","ContextualConfigResolvedContextsUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=["cfg_ver_timestamp","policy_id","version","sample_rate"],i=function(a){return a.join(d("ContextualConfigConstants").LIST_DELIMITER)},j=function(a,b){for(var c of h)b[c]!=null&&(a[c]=b[c]);b.name&&(a.config_name=b.name)},k=function(a,b){var c=b[0],e=b[1],f=b[2];b=b[3];c!=null&&(a.exception=c.message);a.result=i(e.map(function(a){return a.value}))||"INVALID";a.context=i(d("ContextualConfigResolvedContextsUtils").getContextNames(f));a.context_value=i(d("ContextualConfigResolvedContextsUtils").getContextValues(f));a.bucket_name=i(d("ContextualConfigResolvedContextsUtils").getBucketNames(f));a.monitor=i(d("ContextualConfigResolvedContextsUtils").getContextNames(b));a.monitor_value=i(d("ContextualConfigResolvedContextsUtils").getContextValues(b))};function a(a,b,c){var e={sample_rate:d("ContextualConfigConstants").ANALYTICS_SAMPLE_RATE};j(e,a);k(e,b);c&&(e.config_contents=JSON.stringify(a));return e}g["default"]=a}),98);
__d("ContextualConfigExposureEvent",["Random"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){this.$2=a,this.$4=d("Random").random()<1/a.sample_rate,this.$3=b,this.$1=c}var b=a.prototype;b.getData=function(){return this.$2};b.log=function(a){var b=this.$2,c=this.$3,d=this.$4;a&&c(b);d&&this.$1(b);return this};b.isSampled=function(){return this.$4};return a}();g["default"]=a}),98);
__d("ContextualConfigExposureLoggerFactory",["ContextualConfigExposureEvent"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){function a(a,b){this.$2=a,this.$1=b}var b=a.prototype;b.createEvent=function(a){var b=this.$1,d=this.$2;a=new(c("ContextualConfigExposureEvent"))(a,d,b);return a};return a}();function a(a,b){return new h(a,b)}g["default"]=a}),98);
__d("MarauderLogger",["Banzai","CacheStorage","MarauderConfig"],(function(a,b,c,d,e,f){var g="client_event",h="navigation",i=18e4,j="marauder",k="marauder_last_event_time",l="marauder_last_session_id",m={},n=[],o=!1,p=null,q=null,r=null,s=0,t,u,v=!1,w=null;function a(){F().set(k,x())}b("Banzai").subscribe(b("Banzai").SHUTDOWN,a);function x(){t=t||F().get(k)||0;return t}function y(){v||(u=F().get(l),v=!0);var a=Date.now();(!u||a-i>x())&&(u=a.toString(16)+"-"+(~~(Math.random()*16777215)).toString(16),F().set(l,u));return u}function z(){return{user_agent:window.navigator.userAgent,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth,density:window.screen.devicePixelRatio||null,platform:window.navigator.platform||null,locale:window.navigator.language||null}}function A(){return{locale:navigator.language}}function B(a,b,c,d,e,f,g){var h=g!=null&&g!=0?g:Date.now();t=g!=null&&g!=0?Date.now():h;g=b!=null&&b!=""?b:p;return{name:a,time:h/1e3,module:g,obj_type:d,obj_id:e,uuid:f,extra:c}}function C(a,b,c){return B("content",null,{flags:b},null,null,a,c)}function D(a){var b=window.__mrdr;if(b)for(var c in b){var d=b[c];if(d[3]!==0){delete b[c];if(c==="1")if(r!==null)c=r;else continue;a.push(C(c,1,d[1]));a.push(C(c,2,d[2]));a.push(C(c,3,d[3]))}}}function E(a,c){D(a);if(a.length===0)return;o&&a.push(B("counters",null,m));var d=b("Banzai").BASIC;c==="vital"&&(d=b("Banzai").VITAL);var e=b("MarauderConfig").gk_enabled;s===0&&e&&(a.push(B("device_status",null,A())),d={delay:5e3});c==="signal"&&(d={signal:!0});e&&Math.random()<.01&&a.push(B("device_info",null,z()));if(r!==null)for(c=0;c<a.length;c++){e=a[c];(e.uuid===null||e.uuid===void 0)&&(e.uuid=r)}e={app_ver:b("MarauderConfig").app_version,data:a,device_id:void 0,log_type:g,seq:s++,session_id:y()};c=F().get("device_id");c&&(e.device_id=c);m={};o=!1;b("Banzai").post(j,e,d)}function F(){w||(w=new(b("CacheStorage"))("localstorage",""));return w}function c(a){m[a]||(m[a]=0),m[a]++,o=!0}function G(b,a,c,d,f,g,h,i){E([B(b,a,c,d,f,g,h)],i)}function H(a,b){p!==b&&(n.push(B(h,p,{dest_module:b,source_url:q,destination_url:a})),p=b,q=a)}function d(a,b){p!==b&&(r=null,H(a,b))}function f(a,b,c){G(b?"show_module":"hide_module",a,c)}function I(a){p=a}function J(){return p}function K(a){r===null&&(r=a,a!==null&&(E(n),n=[]))}e.exports={count:c,log:G,navigateTo:d,navigateWithinSession:H,toggleModule:f,setUUID:K,setNavigationModule:I,getNavigationModule:J}}),null);
__d("ContextualConfigExposureLogger",["ContextualConfigExposureLoggerFactory","MarauderLogger"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){};b=function(a){d("MarauderLogger").log("contextual_config_exposure","",a)};e=c("ContextualConfigExposureLoggerFactory")(a,b);g["default"]=e}),98);
__d("ContextualConfigAssert",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a===!1)throw new Error(b)}f["default"]=a}),66);
__d("ContextualConfigValidators",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return Array.isArray(a)};b=function(a){return typeof a==="boolean"};c=function(a){return a!=null};e=function(a){return function(b){return Object.prototype.hasOwnProperty.call(a,b)}};f=function(a){return i(a)&&a%1===0};var h=function(a){return j(a)&&a.length>0},i=function(a){return typeof a==="number"&&!isNaN(a)&&a!==Infinity&&a!==-Infinity},j=function(a){return typeof a==="string"},k=function(a){switch(a){case d("ContextualConfigConstants").TYPE.BOOL:case d("ContextualConfigConstants").TYPE.FLOAT:case d("ContextualConfigConstants").TYPE.INT:case d("ContextualConfigConstants").TYPE.STRING:return!0;default:return!1}};g.isArray=a;g.isBoolean=b;g.isDefined=c;g.isKey=e;g.isInteger=f;g.isNonEmptyString=h;g.isNumber=i;g.isString=j;g.isType=k}),98);
__d("ContextualConfigParseBoolean",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a.toUpperCase()){case"TRUE":return!0;case"FALSE":return!1;default:throw new Error(d("ContextualConfigConstants").ERROR.BAD_BOOLEAN_FORMAT)}}g["default"]=a}),98);
__d("ContextualConfigParsePredBoolean",["ContextualConfigConstants","ContextualConfigParseBoolean"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:var f=c("ContextualConfigParseBoolean")(a);e=function(a){return a===f};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:e=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:e=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:e=function(a){return!0};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_BOOLEAN_STRATEGY)}return function(a){return e(a)}}g["default"]=a}),98);
__d("ContextualConfigParseFloat",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=/^[-\+]?([1-9]\d*|0)(\.\d+)?$/,j=function(a){return i.test(a)};function a(a){(h||(h=c("ContextualConfigAssert")))(j(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);a=parseFloat(a);h(d("ContextualConfigValidators").isNumber(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);return a}g["default"]=a}),98);
__d("ContextualConfigParseInteger",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=/^[-\+]?([1-9]\d*|0)$/,j=function(a){return i.test(a)};function a(a){(h||(h=c("ContextualConfigAssert")))(j(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);a=parseInt(a,10);h(d("ContextualConfigValidators").isNumber(a),d("ContextualConfigConstants").ERROR.BAD_NUMBER_FORMAT);return a}g["default"]=a}),98);
__d("ContextualConfigPredAssertions",["ContextualConfigAssert","ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a){return(h||(h=c("ContextualConfigAssert")))(a>0,d("ContextualConfigConstants").ERROR.MISMATCH_NUMBER_OF_VALUES)};b=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a===b,d("ContextualConfigConstants").ERROR.MISMATCH_NUMBER_OF_VALUES)};e=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a<b,d("ContextualConfigConstants").ERROR.BAD_VALUE_ORDER)};g.assertHasValues=a;g.assertNumberOfValues=b;g.assertValueOrder=e}),98);
__d("ContextualConfigParsePredNumeric",["ContextualConfigConstants","ContextualConfigParseFloat","ContextualConfigParseInteger","ContextualConfigPredAssertions","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f){var g=e.map(f?c("ContextualConfigParseInteger"):h||(h=c("ContextualConfigParseFloat"))),i;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:var j=f?c("ContextualConfigParseInteger")(a):(h||(h=c("ContextualConfigParseFloat")))(a);i=function(a){return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a===j};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:i=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:i=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:i=function(a){return!0};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.COR:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,2);d("ContextualConfigPredAssertions").assertValueOrder(g[0],g[1]);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>=g[0]&&a<g[1]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.LT:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a<g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.LTE:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a<=g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.EQ:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a===g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NEQ:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a!==g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.GT:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>g[0]};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.GTE:d("ContextualConfigPredAssertions").assertNumberOfValues(g.length,1);i=function(a){if(typeof a!=="number")return!1;return f&&!d("ContextualConfigValidators").isInteger(a)?!1:a>=g[0]};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_NUMERIC_STRATEGY)}return function(a){return i(a)}}g["default"]=a}),98);
__d("ContextualConfigParseRegExp",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=/^\/(.+)\/(.*)$/;function a(a){try{var b=a.match(h);if(b!=null)return new RegExp(b[1],b[2]);else return new RegExp(a)}catch(a){throw new Error(d("ContextualConfigConstants").ERROR.REGEX_SYNTAX_ERROR)}}g["default"]=a}),98);
__d("ContextualConfigParsePredString",["ContextualConfigConstants","ContextualConfigParseRegExp","ContextualConfigPredAssertions"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){if(typeof a!=="string")throw new Error(d("ContextualConfigConstants").ERROR.INVALID_VALUE_TYPE);return a},i=function(a){var b=[];for(a of a)b.push(h(a));return b};function a(a,b,e){var f=i(e),g;switch(b){case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.SAME:g=function(b){return typeof b!=="string"?!1:b===a};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NULL:g=function(a){return a==null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NNULL:g=function(a){return a!=null};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CATCH_ALL:g=function(a){return!0};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.IN:d("ContextualConfigPredAssertions").assertHasValues(f.length);g=function(a){return typeof a!=="string"?!1:f.indexOf(a)!==-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.NIN:d("ContextualConfigPredAssertions").assertHasValues(f.length);g=function(a){return typeof a!=="string"?!1:f.indexOf(a)===-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.CONTAINS:d("ContextualConfigPredAssertions").assertNumberOfValues(f.length,1);g=function(a){return typeof a!=="string"?!1:a.indexOf(f[0])!==-1};break;case d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY.REGEX:d("ContextualConfigPredAssertions").assertNumberOfValues(f.length,1);var h=c("ContextualConfigParseRegExp")(f[0]);g=function(a){return typeof a!=="string"?!1:h.test(a)};break;default:throw new Error(d("ContextualConfigConstants").ERROR.ILLEGAL_STRING_STRATEGY)}return function(a){return g(a)}}g["default"]=a}),98);
__d("ContextualConfigParseContextBuckets",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParsePredBoolean","ContextualConfigParsePredNumeric","ContextualConfigParsePredString","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKETS)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKETS)},k=d("ContextualConfigValidators").isKey(d("ContextualConfigConstants").CONTEXT_BUCKET_STRATEGY),l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isString(a)&&k(a.toUpperCase()),d("ContextualConfigConstants").ERROR.MISSING_BUCKET_STRATEGY)},m=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.ILLEGAL_BUCKET_VALUES)},n=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.MISSING_BUCKET_NAME)},o=function(a,b){var e=b.name;n(e);var f=b.strategy;l(f);b=b.values||[];m(b);switch(a){case d("ContextualConfigConstants").TYPE.BOOL:return c("ContextualConfigParsePredBoolean")(e,f);case d("ContextualConfigConstants").TYPE.FLOAT:return c("ContextualConfigParsePredNumeric")(e,f,b,!1);case d("ContextualConfigConstants").TYPE.INT:return c("ContextualConfigParsePredNumeric")(e,f,b,!0);case d("ContextualConfigConstants").TYPE.STRING:return c("ContextualConfigParsePredString")(e,f,b);default:throw new Error(d("ContextualConfigConstants").ERROR.UNKNOWN_BUCKET_DEFINITION)}},p=function(a,b){i(b);var c=b.name;n(c);return{name:c,pred:o(a,b)}};function a(a,b){j(b);return b.map(function(b){return p(a,b)})}g["default"]=a}),98);
__d("ContextualConfigParseContexts",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseContextBuckets","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a)&&a.length>0,d("ContextualConfigConstants").ERROR.MISSING_CONTEXT_IN_CONFIG)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},m=function(a){i(a);var b=a.name,d=a.type;a=a.buckets;k(b);l(d);return{name:b,type:d,buckets:c("ContextualConfigParseContextBuckets")(d,a)}};function a(a){j(a);return a.map(m)}g["default"]=a}),98);
__d("ContextualConfigIsEqualParams",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c+=1){var d=a[c],e=b[c];if(d.name!==e.name||d.type!==e.type)return!1}return!0}f["default"]=a}),66);
__d("ContextualConfigParseResultParamValue",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseBoolean","ContextualConfigParseFloat","ContextualConfigParseInteger","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isString(a),d("ContextualConfigConstants").ERROR.INVALID_STRING)};function a(a,b){j(b);switch(a){case d("ContextualConfigConstants").TYPE.BOOL:return c("ContextualConfigParseBoolean")(b);case d("ContextualConfigConstants").TYPE.FLOAT:return(i||(i=c("ContextualConfigParseFloat")))(b);case d("ContextualConfigConstants").TYPE.INT:return c("ContextualConfigParseInteger")(b);case d("ContextualConfigConstants").TYPE.STRING:return b;default:throw new Error(d("ContextualConfigConstants").ERROR.INVALID_VALUE_TYPE)}}g["default"]=a}),98);
__d("ContextualConfigParseResultParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParamValue","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_RESULTS)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},m=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_VALUE)},n=function(a,b){for(a of a)if(a.name===b)return a.type;throw new Error(d("ContextualConfigConstants").ERROR.UNDECLARED_OUTPUT_PARAM)},o=function(a){return function(b){k(b);var d=b.name;l(d);var e=n(a,d);m(e);b=(i||(i=c("ContextualConfigParseResultParamValue")))(e,b.value);return{name:d,type:e,value:b}}};function a(a,b){j(b);return b.map(o(a))}g["default"]=a}),98);
__d("ContextualConfigParseDenseResultParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigIsEqualParams","ContextualConfigParseResultParams"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return(h||(h=c("ContextualConfigAssert")))(c("ContextualConfigIsEqualParams")(a,b),d("ContextualConfigConstants").ERROR.RESULTS_VECTOR_SIZE_MISMATCH)};function a(a,b){b=c("ContextualConfigParseResultParams")(a,b.map(function(b,c){return{name:a[c].name,value:b}}));i(a,b);return b}g["default"]=a}),98);
__d("ContextualConfigParseDenseDefaults",["ContextualConfigConstants","ContextualConfigParseDenseResultParams"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){try{return c("ContextualConfigParseDenseResultParams")(a,b)}catch(a){throw new Error(d("ContextualConfigConstants").ERROR.MISSING_DEFAULT_VALUE)}}g["default"]=a}),98);
__d("ContextualConfigParseMonitors",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.BAD_MONITORED_CONTEXTS)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_CONTEXT_IDENTIFIER)},m=function(a){i(a);var b=a.name;a=a.type;k(b);l(a);return{name:b,type:a}};function a(a){j(a);return a.map(m)}g["default"]=a}),98);
__d("ContextualConfigParseOutputParams",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_OUTPUTS_DEFINITION)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isType(a),d("ContextualConfigConstants").ERROR.BAD_OUTPUT_TYPE)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.BAD_OUTPUT_NAME)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(m(a),d("ContextualConfigConstants").ERROR.DUPLICATE_OUTPUT_NAME)},m=function(a){var b={};for(a of a){if(b[a.name])return!1;b[a.name]=!0}return!0},n=function(a){k(a.name);j(a.type);return a};function a(a){i(a);a=a.map(n);l(a);return a}g["default"]=a}),98);
__d("ContextualConfigParseVector",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParamValue","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_VECTOR)},k=function(a,b){return(h||(h=c("ContextualConfigAssert")))(a===b,d("ContextualConfigConstants").ERROR.RESULTS_VECTOR_SIZE_MISMATCH)},l=function(a,b){k(a.length,b.length);for(var d=0;d<a.length;d+=1){var e=a[d].type,f=b[d];(i||(i=c("ContextualConfigParseResultParamValue")))(e,f)}},m=function(a){return a.reduce(function(a,b){b=b.buckets;return a*b.length},1)};function a(a,b,c){j(c);b=m(b);var d=a.length;k(b*d,c.length);for(var e=0;e<b;e+=1){var f=e*d;l(a,c.slice(f,f+d))}return c}g["default"]=a}),98);
__d("ContextualConfigResolveContexts",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,b){for(var c=0;c<a.length;c+=1){var d=a[c];try{if(d.pred(b))return[d.name,c]}catch(a){return null}}return null};function a(a,b,c){var e=null;a=a.map(function(a){var f=a.name,g={name:f};if(e!=null)return g;var i;c[f]!=null?i=c[f]:b[f]!=null?i=b[f]():i=null;g.value=i;if(a.buckets!=null){f=h(a.buckets,i);if(f==null){e=new Error(d("ContextualConfigConstants").ERROR.MISSING_BUCKET_MATCH);return g}a=f[0];i=f[1];g.bucketName=a;g.bucketIndex=i}return g});return[e,a]}g["default"]=a}),98);
__d("DenseContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseContexts","ContextualConfigParseDenseDefaults","ContextualConfigParseDenseResultParams","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseVector","ContextualConfigResolveContexts","ContextualConfigResolvedContextsUtils","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)},j=function(a){var b=[],c=1;for(var d=a.length-1;d>=0;d-=1)b.push(c),c*=a[d].buckets.length;return b.reverse()},k=function(a,b,d,e){try{b=b.slice(d,d+a.length);return[null,c("ContextualConfigParseDenseResultParams")(a,b)]}catch(a){return[a,e]}},l=function(a,b,d){try{d=d.reduce(function(b,d,e){(h||(h=c("ContextualConfigAssert")))(e<a.length,"Auxillery index out of range.");return b+a[e]*d},0);return[null,d*b]}catch(a){return[a,-1]}};a=function(){function a(a,b){i(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);var d=c("ContextualConfigParseContexts")(a.contexts);this.aux=j(d);this.contexts=d;this.defaults=c("ContextualConfigParseDenseDefaults")(b,a.vectorDefaults);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.outputs=b;this.vector=c("ContextualConfigParseVector")(b,d,a.vector)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.defaults,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.aux,e=this.globalContextProviders,f=this.contexts,g=this.defaults,h=this.monitors,i=this.outputs,j=this.vector;f=c("ContextualConfigResolveContexts")(f,e,a);var m=f[0];f=f[1];if(m!=null)return[m,g,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];m=l(b,i.length,d("ContextualConfigResolvedContextsUtils").getBucketIndices(f));b=m[0];m=m[1];if(b!=null)return[b,g,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];b=k(i,j,m,g);i=b[0];j=b[1];if(i!=null)return[i,j,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS];m=c("ContextualConfigResolveContexts")(h,e,a);g=m[0];b=m[1];return g!=null?[g,j,f,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]:[null,j,f,b]};return a}();g["default"]=a}),98);
__d("MultiOutputResolvedContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseResultParams","ContextualConfigResolveContexts","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)};a=function(){function a(a,b){i(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.values=c("ContextualConfigParseResultParams")(b,a.values)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.values,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.globalContextProviders,e=this.monitors,f=this.values;e=c("ContextualConfigResolveContexts")(e,b,a);b=e[0];a=e[1];return b!=null?[b,f,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]:[null,f,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,a]};return a}();g["default"]=a}),98);
__d("ContextualConfigMergePartialResultParams",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){var c={};for(b of b)c[b.name]=b;b=[];for(a of a){var d=c[a.name];b.push(d!=null&&d.name===a.name&&d.type===a.type?d:a)}return b}f["default"]=a}),66);
__d("ContextualConfigParseDefaults",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigIsEqualParams","ContextualConfigParseResultParams"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a,b){return(h||(h=c("ContextualConfigAssert")))(c("ContextualConfigIsEqualParams")(a,b),d("ContextualConfigConstants").ERROR.MISSING_DEFAULT_VALUE)};function a(a,b){b=c("ContextualConfigParseResultParams")(a,b);i(a,b);return b}g["default"]=a}),98);
__d("ContextualConfigParseTable",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigParseResultParams","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE)},j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isNonEmptyString(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE_ITEM_BUCKET)},l=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isArray(a),d("ContextualConfigConstants").ERROR.MISSING_TABLE_ITEM_VALUES)},m=function(a,b){j(b);var d=b.bucket;b=b.values;k(d);l(b);return{bucket:d,values:c("ContextualConfigParseResultParams")(a,b)}};function a(a,b){i(b);return b.reduce(function(b,c){c=m(a,c);b[c.bucket]=c.values;return b},{})}g["default"]=a}),98);
__d("TableContextualConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigMergePartialResultParams","ContextualConfigParseContexts","ContextualConfigParseDefaults","ContextualConfigParseMonitors","ContextualConfigParseOutputParams","ContextualConfigParseTable","ContextualConfigResolveContexts","ContextualConfigResolvedContextsUtils","ContextualConfigValidators"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[],j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a),d("ContextualConfigConstants").ERROR.BAD_CONFIG)};a=function(){function a(a,b){j(a);this.globalContextProviders=babelHelpers["extends"]({},b);b=c("ContextualConfigParseOutputParams")(a.outputs);this.contexts=c("ContextualConfigParseContexts")(a.contexts);this.defaults=c("ContextualConfigParseDefaults")(b,a.defaults);this.monitors=a.monitors!=null?c("ContextualConfigParseMonitors")(a.monitors):[];this.table=c("ContextualConfigParseTable")(b,a.table)}var b=a.prototype;b.resolve=function(a){try{return this.unsafeResolve(a)}catch(a){return[a,this.defaults,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]}};b.unsafeResolve=function(a){var b=this.globalContextProviders,e=this.contexts,f=this.defaults,g=this.monitors,h=this.table;e=c("ContextualConfigResolveContexts")(e,b,a);var j=e[0];e=e[1];if(j!=null)return[j,f,e,[]];j=d("ContextualConfigResolvedContextsUtils").getBucketNames(e).join(d("ContextualConfigConstants").BUCKET_DELIMITER);h=h[j]||i;j=c("ContextualConfigMergePartialResultParams")(f,h);f=c("ContextualConfigResolveContexts")(g,b,a);h=f[0];g=f[1];return h!=null?[h,j,e,[]]:[null,j,e,g]};return a}();g["default"]=a}),98);
__d("ContextualConfigParseConfig",["ContextualConfigAssert","ContextualConfigConstants","ContextualConfigValidators","DenseContextualConfig","MultiOutputResolvedContextualConfig","TableContextualConfig"],(function(a,b,c,d,e,f,g){"use strict";var h,i=[1],j=function(a){return(h||(h=c("ContextualConfigAssert")))(d("ContextualConfigValidators").isDefined(a)&&d("ContextualConfigValidators").isDefined(a.version),d("ContextualConfigConstants").ERROR.BAD_CONFIG)},k=function(a){return(h||(h=c("ContextualConfigAssert")))(i.indexOf(a)!==-1,d("ContextualConfigConstants").ERROR.UNSUPPORTED_CONFIG_VERSION)};function a(a,b){j(a);k(a.version);switch(a.cctype){case d("ContextualConfigConstants").CONFIG_TYPE.DENSE:return new(c("DenseContextualConfig"))(a,b);case d("ContextualConfigConstants").CONFIG_TYPE.MULTI_OUTPUT_RESOLVED:return new(c("MultiOutputResolvedContextualConfig"))(a,b);case d("ContextualConfigConstants").CONFIG_TYPE.TABLE:return new(c("TableContextualConfig"))(a,b);default:throw new Error(d("ContextualConfigConstants").ERROR.UNKNOWN_CONFIG_TYPE)}}g["default"]=a}),98);
__d("ContextualConfigWarn",[],(function(a,b,c,d,e,f){"use strict";function a(a){}f["default"]=a}),66);
__d("ContextualConfigResult",["ContextualConfigConstants","ContextualConfigWarn"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=a.reduce(function(a,b){var c=b.name;b=b.value;a[c]=b;return a},{}),this.$2=a}var b=a.prototype;b.get=function(a,b){try{a=this.$1[a];if(typeof a!==typeof b){c("ContextualConfigWarn")(d("ContextualConfigConstants").ERROR.REQUESTED_PARAM_NOT_FOUND);return b}return a}catch(a){c("ContextualConfigWarn")(a.message);return b}};b.getParams=function(){return this.$2};return a}();g["default"]=a}),98);
__d("ErrorContextualConfig",["ContextualConfigConstants"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.error=a}var b=a.prototype;b.resolve=function(a){return[this.error,d("ContextualConfigConstants").EMPTY_RESULT_PARAMS,d("ContextualConfigConstants").EMPTY_RESOLVED_CONTEXTS,d("ContextualConfigConstants").EMPTY_RESOLVED_MONITORS]};return a}();g["default"]=a}),98);
__d("ContextualConfig",["ContextualConfigCollateExposureData","ContextualConfigConstants","ContextualConfigExposureLogger","ContextualConfigParseConfig","ContextualConfigResult","ErrorContextualConfig","Random"],(function(a,b,c,d,e,f,g){"use strict";var h=1/d("ContextualConfigConstants").JSON_SUB_SAMPLE_RATE,i=1;a=function(){function a(a,b){b===void 0&&(b={}),this.isDebugLoggingEnabled=!1,this.$3=!1,this.$4=a,this.$2=b}var b=a.prototype;b.$5=function(){if(this.$1)return this.$1;var a=this.$2,b=this.$4;try{b=c("ContextualConfigParseConfig")(b,a)}catch(a){b=new(c("ErrorContextualConfig"))(a)}this.$1=b;return b};b.$6=function(a){var b=this.isDebugLoggingEnabled,e=this.$4,f=this.$3;f=!f&&d("Random").random()<h;f&&(this.$3=!0);e=c("ContextualConfigCollateExposureData")(e,a,f);a=c("ContextualConfigExposureLogger").createEvent(e);a.log(b)};b.resolve=function(a){a===void 0&&(a={});var b=this.$1||this.$5();b=b.resolve(a);this.$6(b);return new(c("ContextualConfigResult"))(b[i])};return a}();g["default"]=a}),98);
__d("DgwClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1755537");b=d("FalcoLoggerInternal").create("dgw_client",a);e=b;g["default"]=e}),98);
__d("DGWLoggingContext",["$InternalEnum","DgwClientFalcoEvent","ODS","Random"],(function(a,b,c,d,e,f,g){"use strict";var h;a="dgw_client";var i=b("$InternalEnum")({STREAM_GROUP_COMPONENT:"WebStreamGroup",GROUPED_STREAM_COMPONENT:"GroupedWebStream",WEBSOCKET_TRANSPORT_COMPONENT:"WebSocketTransport",ACK_MANAGER_COMPONENT:"WebStreamAckManager",CODEC_COMPONENT:"WebCodec",RAW_CLIENT:"RAWDGWClient",PINGER:"DGWPinger"}),j={VERBOSE:-1,INFO:0,WARNING:1,ERROR:2,FATAL:3};function k(a){switch(a){case i.GROUPED_STREAM_COMPONENT:case i.ACK_MANAGER_COMPONENT:return!0;default:return!1}}e=function(){function a(a,b,c,d,e,f,g){f===void 0&&(f=!1),g===void 0&&(g=!1),this.$5=""+a,this.$1=b,this.$4=c,this.$3=d,this.$6=e,this.$2=f,this.$7=g}a.bumpODSKey=function(a,b,c){c===void 0&&(c=1);if(!d("Random").coinflip(c))return;a=a+"."+b;(h||(h=d("ODS"))).bumpEntityKey(3589,"dgw_web_client",a,c)};var b=a.prototype;b.bumpODSKey=function(a,b,c){c===void 0&&(c=1);if(!d("Random").coinflip(c))return;a=this.$4+"."+a+"."+b;(h||(h=d("ODS"))).bumpEntityKey(3589,"dgw_web_client",a,c)};b.logEvent=function(a,b,c,d,e){d===void 0&&(d=!1),this.$2||this.$8(a,b,null,j.INFO,c,d,e)};b.$8=function(a,b,d,e,f,g,h){var i=this;g===void 0&&(g=!1);if(g&&!this.$7)return;(k(a)&&this.$1!=null||!k(a)&&this.$6!=null)&&c("DgwClientFalcoEvent").log(function(){return{event:b,logging_id:h!=null?h:i.$1,dgw_version:i.$5,message:d,severity:e,uuid:i.$3,dgw_component:a,extra_info:f,destination_tier:i.$4,sg_transport_id:i.$6,source:2}})};b.logError=function(a,b,c,d,e,f){e===void 0&&(e=!1),this.$2||this.$8(a,b,c,j.ERROR,d,e,f)};b.logWarn=function(a,b,c,d,e){e===void 0&&(e=!1),this.$2||this.$8(a,b,c,j.WARNING,d,e)};return a}();g.DGW_MODULE=a;g.DGWLoggingComponent=i;g.DGWLoggingContext=e}),98);
__d("DGWAckManager",["DGWLoggingContext","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(){var b=a.prototype;b.stopTracking=function(a){window.clearTimeout(this.$1),this.$3(a)};function a(a,b,c){var d=this;this.$3=c;this.sendId=a;this.$2=b;this.handleAckReceived=function(){d.stopTracking(!0)};this.$1=window.setTimeout(function(){d.stopTracking(!1)},b)}return a}();a=function(){function a(a){this.$1=new Map(),this.$2=a}var c=a.prototype;c.waitForAck=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_expected");var e=this.$1;try{var f=(yield new(h||(h=b("Promise")))(function(b,d){e.set(a,new i(a,c,b))}));f===!0?this.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Received ACK","sendId:"+a,!0):(this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_timeout"),this.$2.logWarn(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ACK timeout","Request "+a+" timed out after "+c+"ms"));e["delete"](a);return f}catch(b){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_error");e["delete"](a);throw b}});function c(b,c){return a.apply(this,arguments)}return c}();c.handleAckReceived=function(a){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_received");var b=this.$1.get(a);if(b===void 0){this.$2.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"ack_received.not_tracked");this.$2.logWarn(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"untracked ACK","Received ACK for ackId "+a+" which was not being tracked");return}b.handleAckReceived()};c.clearPendingAcks=function(){var a=this;this.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending acks","ACKs cleared size: "+this.$1.size);this.$1.forEach(function(b,c,e){a.$2.logEvent(d("DGWLoggingContext").DGWLoggingComponent.ACK_MANAGER_COMPONENT,"Clearing pending ACK with ackId "+b.sendId,null,!0),b.stopTracking(!1),e["delete"](c)})};return a}();g.DGWAckManager=a}),98);
__d("DGWAuth",["$InternalEnum","err"],(function(a,b,c,d,e,f,g){"use strict";var h=b("$InternalEnum")({TEST:"0:0",FACEBOOK:"1:0",INTERNALFB:"2:0",OCULUS:"3:0",ENTERPRISEFB:"7:0",RECRUITINGFB:"8:0",INSTAGRAM:"6:0",HORIZON_WEB:"12:0",SPARK_WEB:"13:0",ABRA:"15:0"});function a(a){if(a==="TEST")return h.TEST;else if(a==="FACEBOOK")return h.FACEBOOK;else if(a==="INTERNALFB")return h.INTERNALFB;else if(a==="OCULUS")return h.OCULUS;else if(a==="ENTERPRISEFB")return h.ENTERPRISEFB;else if(a==="RECRUITINGFB")return h.RECRUITINGFB;else if(a==="INSTAGRAM")return h.INSTAGRAM;else if(a==="HORIZON_WEB")return h.HORIZON_WEB;else if(a==="SPARK_WEB")return h.SPARK_WEB;else if(a==="ABRA")return h.ABRA;else throw c("err")("failed to convert string ("+a+") to DGWAuth Type")}function d(a){if(a===h.FACEBOOK)return"FACEBOOK";else if(a===h.INTERNALFB)return"INTERNALFB";else if(a===h.OCULUS)return"OCULUS";else if(a===h.ENTERPRISEFB)return"ENTERPRISEFB";else if(a===h.RECRUITINGFB)return"RECRUITINGFB";else if(a===h.INSTAGRAM)return"INSTAGRAM";else if(a===h.HORIZON_WEB)return"HORIZON_WEB";else if(a===h.SPARK_WEB)return"SPARK_WEB";else if(a===h.ABRA)return"ABRA";else return"TEST"}g.DGWAuth=h;g.fromStringToDGWAuth=a;g.fromDGWAuthToString=d}),98);
__d("DGWStream",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum").Mirrored(["ABNORMAL_CLOSURE","GOING_AWAY","SERVER_INTERNAL_ERROR","PREMATURE_CLOSE","UNKNOWN_ERROR","KEEPALIVE_TIMEOUT","TRANSPORT_CLOSED_BEFORE_STREAM_INIT","TRANSPORT_ESTABLISHMENT_ERROR","TRANSPORT_ESTABLISHMENT_TIMEOUT","ESTABLISHMENT_TIMEOUT","UNAUTHENTICATED","UNAUTHORIZED","REJECTED","BAD_REQUEST","DGW_SERVER_ERROR","ESTABLISHMENT_ERROR"]);function a(a){switch(a){case g.UNAUTHENTICATED:case g.UNAUTHORIZED:case g.REJECTED:case g.BAD_REQUEST:case g.UNKNOWN_ERROR:case g.SERVER_INTERNAL_ERROR:return!1;default:return!0}}f.StreamError=g;f.isRetryableError=a}),66);
__d("DGWCppBridge",[],(function(l,m,n,o,p,q){var r=function(){var l=typeof document!=="undefined"&&document.currentScript?document.currentScript.src:void 0;return function(m){m=m||{};var m=typeof m!=="undefined"?m:{},n=function(){function m(){}function n(l,m){return function(){l.apply(m,arguments)}}function l(m){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof m!=="function")throw new TypeError("not a function");this._state=0;this._handled=!1;this._value=void 0;this._deferreds=[];t(m,this)}function o(m,n){while(m._state===3)m=m._value;if(m._state===0){m._deferreds.push(n);return}m._handled=!0;l._immediateFn(function(){var l=m._state===1?n.onFulfilled:n.onRejected;if(l===null){(m._state===1?p:q)(n.promise,m._value);return}var o;try{o=l(m._value)}catch(l){q(n.promise,l);return}p(n.promise,o)})}function p(m,o){try{if(o===m)throw new TypeError("A promise cannot be resolved with itself.");if(o&&(typeof o==="object"||typeof o==="function")){var p=o.then;if(o instanceof l){m._state=3;m._value=o;r(m);return}else if(typeof p==="function"){t(n(p,o),m);return}}m._state=1;m._value=o;r(m)}catch(l){q(m,l)}}function q(l,m){l._state=2,l._value=m,r(l)}function r(m){m._state===2&&m._deferreds.length===0&&l._immediateFn(function(){m._handled||l._unhandledRejectionFn(m._value)});for(var n=0,p=m._deferreds.length;n<p;n++)o(m,m._deferreds[n]);m._deferreds=null}function s(l,m,n){this.onFulfilled=typeof l==="function"?l:null,this.onRejected=typeof m==="function"?m:null,this.promise=n}function t(l,m){var n=!1;try{l(function(l){if(n)return;n=!0;p(m,l)},function(l){if(n)return;n=!0;q(m,l)})}catch(l){if(n)return;n=!0;q(m,l)}}l.prototype["catch"]=function(l){return this.then(null,l)};l.prototype.then=function(l,n){var p=new this.constructor(m);o(this,new s(l,n,p));return p};l.all=function(m){return new l(function(l,n){if(!Array.isArray(m))return n(new TypeError("Promise.all accepts an array"));var o=Array.prototype.slice.call(m);if(o.length===0)return l([]);var p=o.length;function q(m,r){try{if(r&&(typeof r==="object"||typeof r==="function")){var s=r.then;if(typeof s==="function"){s.call(r,function(l){q(m,l)},n);return}}o[m]=r;--p===0&&l(o)}catch(l){n(l)}}for(var r=0;r<o.length;r++)q(r,o[r])})};l.resolve=function(m){return m&&typeof m==="object"&&m.constructor===l?m:new l(function(l){l(m)})};l.reject=function(m){return new l(function(l,n){n(m)})};l.race=function(m){return new l(function(n,o){if(!Array.isArray(m))return o(new TypeError("Promise.race accepts an array"));for(var p=0,q=m.length;p<q;p++)l.resolve(m[p]).then(n,o)})};l._immediateFn=typeof setImmediate==="function"&&function(l){setImmediate(l)}||function(l){setTimeout(l,0)};l._unhandledRejectionFn=function(l){typeof console!=="undefined"&&console};return l}(),o,s;m.ready=new n(function(l,m){o=l,s=m});var t={},u;for(u in m)Object.prototype.hasOwnProperty.call(m,u)&&(t[u]=m[u]);var v=[];(function(l,m){throw m});var w=!0,x=!1,y="";function z(l){return m.locateFile?m.locateFile(l,y):y+l}var A;(w||x)&&(x?y=self.location.href:typeof document!=="undefined"&&document.currentScript&&(y=document.currentScript.src),l&&(y=l),y.indexOf("blob:")!==0?y=y.substr(0,y.lastIndexOf("/")+1):y="",(function(l){try{var m=new XMLHttpRequest();m.open("GET",l,!1);m.send(null);return m.responseText}catch(n){m=ga(l);if(m)return fa(m);throw n}},x&&(A=function(l){try{var m=new XMLHttpRequest();m.open("GET",l,!1);m.responseType="arraybuffer";m.send(null);return new Uint8Array(m.response)}catch(n){m=ga(l);if(m)return m;throw n}}),function(l,m,n){var o=new XMLHttpRequest();o.open("GET",l,!0);o.responseType="arraybuffer";o.onload=function(){if(o.status==200||o.status==0&&o.response){m(o.response);return}var p=ga(l);if(p){m(p.buffer);return}n()};o.onerror=n;o.send(null)}),function(l){document.title=l});m.print||emptyFunction.bind(console);var B=m.printErr||emptyFunction.bind(console);for(u in t)Object.prototype.hasOwnProperty.call(t,u)&&(m[u]=t[u]);t=null;m.arguments&&(v=m.arguments);m.thisProgram&&m.thisProgram;m.quit&&m.quit;var C;m.wasmBinary&&(C=m.wasmBinary);m.noExitRuntime||!0;var D={Memory:function(l){this.buffer=new ArrayBuffer(l.initial*65536)},Module:function(l){},Instance:function(l,m){this.exports=function(l){function m(l){l.set=function(l,m){this[l]=m};l.get=function(l){return this[l]};return l}var n,o=new Uint8Array(123);for(var p=25;p>=0;--p)o[48+p]=52+p,o[65+p]=p,o[97+p]=26+p;o[43]=62;o[47]=63;function q(m,n,p){var q,r,l=0,s=n,t=p.length;n=n+(t*3>>2)-(p[t-2]=="=")-(p[t-1]=="=");for(;l<t;l+=4)q=o[p.charCodeAt(l+1)],r=o[p.charCodeAt(l+2)],m[s++]=o[p.charCodeAt(l)]<<2|q>>4,s<n&&(m[s++]=q<<4|r>>2),s<n&&(m[s++]=r<<6|o[p.charCodeAt(l+3)])}function r(l){q(n,1024,"U3Q5dHlwZV9pbmZvAAAAAOAEAAAABAAATjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAAAACAUAABgEAAAQBAAATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAAAACAUAAEgEAAA8BAAATjEwX19jeHhhYml2MTE3X19wYmFzZV90eXBlX2luZm9FAAAACAUAAHgEAAA8BAAATjEwX19jeHhhYml2MTE5X19wb2ludGVyX3R5cGVfaW5mb0UACAUAAKgEAACcBAAAAAAAAGwEAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAAAAABQBQAAAQAAAAkAAAADAAAABAAAAAUAAAAKAAAACwAAAAwAAABOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UAAAAACAUAACgFAABsBA=="),q(n,1372,"gAkQ")}function s(l){var o=l.a,p=o.buffer;o.grow=xa;var q=new Int8Array(p),s=new Int16Array(p),t=new Int32Array(p),u=new Uint8Array(p),v=new Uint16Array(p),w=new Uint32Array(p);new Float32Array(p);new Float64Array(p);var x=Math.imul;Math.fround;Math.abs;var y=Math.clz32;Math.min;Math.max;Math.floor;Math.ceil;Math.trunc;Math.sqrt;l.abort;NaN;Infinity;var z=l.b,A=1051008,B;function C(o,p,l,r,m,n){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;n=n|0;var y=0,z=0,B;y=A-80|0;A=y;t[y+72>>2]=o;t[y+68>>2]=p;t[y+64>>2]=l;t[y+60>>2]=r;t[y+56>>2]=m;t[y+52>>2]=n;a:{if(t[y+52>>2]?!t[y+56>>2]|(!t[y+72>>2]|!t[y+68>>2]|(!t[y+64>>2]|!t[y+60>>2])):1){t[y+76>>2]=5;break a}t[t[y+64>>2]>>2]=0;t[t[y+60>>2]>>2]=0;p=t[y+68>>2];l=t[y+56>>2];r=t[y+52>>2];o=A+-64|0;A=o;t[o+56>>2]=t[y+72>>2];t[o+52>>2]=p;t[o+48>>2]=l;t[o+44>>2]=r;t[o+40>>2]=0;t[o+36>>2]=t[o+56>>2];b:{c:{d:{while(1){if(!t[o+52>>2])break c;t[o+32>>2]=t[o+36>>2];q[o+31|0]=u[t[o+36>>2]];t[o+52>>2]=t[o+52>>2]-1;t[o+36>>2]=t[o+36>>2]+1;if(u[o+31|0]!=10?u[o+31|0]==2|u[o+31|0]==4|u[o+31|0]==9:1){t[o+40>>2]=t[o+40>>2]+1;continue}t[o+24>>2]=1;if(V(u[o+31|0])&1){z=o,B=X(u[o+31|0])&1,q[z+23|0]=B;t[o+16>>2]=q[o+23|0]&1?1:2;if(w[o+52>>2]<w[o+16>>2]){t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[o+52>>2]=t[o+52>>2]-t[o+16>>2];t[o+24>>2]=t[o+16>>2]+t[o+24>>2];t[o+36>>2]=t[o+16>>2]+t[o+36>>2];if(!(u[o+31|0]!=14?u[o+31|0]!=8:0)){t[o+40>>2]=t[o+40>>2]+1;continue}}if(w[o+52>>2]<3)break d;t[o+12>>2]=0;p=t[o+36>>2];l=u[p|0]|u[p+1|0]<<8;q[o+12|0]=l;q[o+13|0]=l>>>8;q[o+14|0]=u[p+2|0];t[o+52>>2]=t[o+52>>2]-3;t[o+24>>2]=t[o+24>>2]+3;t[o+36>>2]=t[o+36>>2]+3;if(w[o+12>>2]<=w[o+52>>2]){t[o+40>>2]=t[o+40>>2]+1;t[o+36>>2]=t[o+12>>2]+t[o+36>>2];t[o+52>>2]=t[o+52>>2]-t[o+12>>2];continue}break}t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[t[o+48>>2]>>2]=t[o+32>>2];t[t[o+44>>2]>>2]=t[o+52>>2]+t[o+24>>2];break b}t[t[o+44>>2]>>2]=t[o+52>>2]}t[o+60>>2]=t[o+40>>2];A=o- -64|0;t[y+48>>2]=t[o+60>>2];if(!t[y+48>>2]){t[y+76>>2]=0;break a}z=y,B=D(x(t[y+48>>2],20)),t[z+44>>2]=B;if(!t[y+44>>2]){t[y+76>>2]=3;break a}t[y+40>>2]=t[y+44>>2];t[y+36>>2]=t[y+72>>2];t[y+32>>2]=t[y+68>>2]-t[t[y+52>>2]>>2];t[y+28>>2]=0;while(1){if(w[y+28>>2]<w[y+48>>2]){if(w[y+32>>2]<1){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=1;break a}q[y+27|0]=u[t[y+36>>2]];t[y+36>>2]=t[y+36>>2]+1;t[y+32>>2]=t[y+32>>2]-1;e:{if(!u[y+27|0]|u[y+27|0]==1|(u[y+27|0]==2|u[y+27|0]==3)|(u[y+27|0]==4|u[y+27|0]==9|u[y+27|0]==10))break e;if(V(u[y+27|0])&1)break e;O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=6;break a}o=t[y+40>>2];t[o>>2]=u[y+27|0]&15|t[o>>2]&-16;f:{if(u[y+27|0]!=10?u[y+27|0]==2|u[y+27|0]==4|u[y+27|0]==9:1){o=t[y+40>>2];t[o>>2]=t[o>>2]&-268435441;t[y+40>>2]=t[y+40>>2]+20;break f}if(V(u[y+27|0])&1){o=A-48|0;A=o;t[o+40>>2]=t[y+40>>2];t[o+36>>2]=y+36;t[o+32>>2]=y+32;g:{if(!(V(t[t[o+40>>2]>>2]&15)&1)){t[o+44>>2]=1;break g}z=o,B=X(t[t[o+40>>2]>>2]&15)&1,q[z+31|0]=B;t[o+24>>2]=q[o+31|0]&1?1:2;if(w[t[o+32>>2]>>2]<w[o+24>>2]){t[o+44>>2]=1;break g}ba(t[o+40>>2]+4|0,t[t[o+36>>2]>>2],t[o+24>>2]);p=t[o+36>>2];t[p>>2]=t[o+24>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+24>>2];if((t[t[o+40>>2]>>2]&15)==8){p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==14){p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441;t[o+44>>2]=0;break g}if(w[t[o+32>>2]>>2]<3){t[o+44>>2]=11;break g}t[o+20>>2]=0;p=t[t[o+36>>2]>>2];l=u[p|0]|u[p+1|0]<<8;q[o+20|0]=l;q[o+21|0]=l>>>8;q[o+22|0]=u[p+2|0];p=t[o+36>>2];t[p>>2]=t[p>>2]+3;p=t[o+32>>2];t[p>>2]=t[p>>2]-3;p=t[o+40>>2];t[p>>2]=t[p>>2]&-268435441|(t[o+20>>2]&16777215)<<4;if(w[t[o+32>>2]>>2]<w[o+20>>2]){t[o+44>>2]=11;break g}if((t[t[o+40>>2]>>2]&15)==15){t[t[o+40>>2]+12>>2]=t[o+20>>2];p=D(t[o+20>>2]);t[t[o+40>>2]+8>>2]=p;if(!t[t[o+40>>2]+8>>2]){t[o+44>>2]=3;break g}ba(t[t[o+40>>2]+8>>2],t[t[o+36>>2]>>2],t[o+20>>2]);p=t[o+36>>2];t[p>>2]=t[o+20>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+20>>2];t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==5){t[t[o+40>>2]+12>>2]=t[o+20>>2];p=D(t[o+20>>2]);t[t[o+40>>2]+8>>2]=p;if(!t[t[o+40>>2]+8>>2]){t[o+44>>2]=3;break g}ba(t[t[o+40>>2]+8>>2],t[t[o+36>>2]>>2],t[o+20>>2]);p=t[o+36>>2];t[p>>2]=t[o+20>>2]+t[p>>2];p=t[o+32>>2];t[p>>2]=t[p>>2]-t[o+20>>2];t[o+44>>2]=0;break g}h:{if(!((t[t[o+40>>2]>>2]&15)!=6?(t[t[o+40>>2]>>2]&15)!=7:0)){z=o,B=Q(t[o+36>>2],t[o+32>>2],o+19|0,o+18|0),t[z+12>>2]=B;if(t[o+12>>2]){t[o+44>>2]=t[o+12>>2];break g}break h}if(!((t[t[o+40>>2]>>2]&15)!=13?(t[t[o+40>>2]>>2]&15)!=12:0)){l=t[o+32>>2];p=A-32|0;t[p+24>>2]=t[o+36>>2];t[p+20>>2]=l;t[p+16>>2]=o+19;t[p+12>>2]=o+16;s[p+10>>1]=0;i:{if(w[t[p+20>>2]>>2]<2){t[p+28>>2]=1;break i}l=t[t[p+24>>2]>>2];l=u[l|0]|u[l+1|0]<<8;q[p+10|0]=l;q[p+11|0]=l>>>8;l=t[p+24>>2];t[l>>2]=t[l>>2]+2;l=t[p+20>>2];t[l>>2]=t[l>>2]-2;q[t[p+16>>2]]=(v[p+10>>1]&32768)==32768;s[t[p+12>>2]>>1]=v[p+10>>1]&32767;t[p+28>>2]=0}t[o+12>>2]=t[p+28>>2];if(t[o+12>>2]){t[o+44>>2]=t[o+12>>2];break g}}}if((t[t[o+40>>2]>>2]&15)==12){p=t[o+40>>2];s[p+8>>1]=s[p+8>>1]&1|v[o+16>>1]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==7){p=t[o+40>>2];q[p+8|0]=q[p+8|0]&1|u[o+18|0]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==13){l=t[o+32>>2];r=t[o+20>>2];m=t[o+40>>2]+12|0;n=t[o+40>>2];p=A-32|0;A=p;t[p+24>>2]=t[o+36>>2];t[p+20>>2]=l;t[p+16>>2]=r;t[p+12>>2]=m;t[p+8>>2]=n+16;j:{if(w[p+16>>2]<2){t[p+28>>2]=9;break j}t[t[p+8>>2]>>2]=t[p+16>>2]-2;if(w[t[p+20>>2]>>2]<w[t[p+8>>2]>>2]){t[p+28>>2]=1;break j}l=D(t[t[p+8>>2]>>2]);t[t[p+12>>2]>>2]=l;if(!t[t[p+12>>2]>>2]){t[p+28>>2]=3;break j}ba(t[t[p+12>>2]>>2],t[t[p+24>>2]>>2],t[t[p+8>>2]>>2]);l=t[p+24>>2];t[l>>2]=t[t[p+8>>2]>>2]+t[l>>2];l=t[p+20>>2];t[l>>2]=t[l>>2]-t[t[p+8>>2]>>2];t[p+28>>2]=0}A=p+32|0;t[o+8>>2]=t[p+28>>2];if(t[o+8>>2]){t[o+44>>2]=t[o+8>>2];break g}p=t[o+40>>2];s[p+8>>1]=q[o+19|0]&1|v[p+8>>1]&65534;p=t[o+40>>2];s[p+8>>1]=s[p+8>>1]&1|v[o+16>>1]<<1;t[o+44>>2]=0;break g}if((t[t[o+40>>2]>>2]&15)==6){z=o,B=M(t[o+36>>2],t[o+32>>2],t[o+20>>2],t[o+40>>2]+12|0,t[o+40>>2]+16|0),t[z+4>>2]=B;if(t[o+4>>2]){t[o+44>>2]=t[o+4>>2];break g}p=t[o+40>>2];q[p+8|0]=q[o+19|0]&1|u[p+8|0]&254;p=t[o+40>>2];q[p+8|0]=q[p+8|0]&1|u[o+18|0]<<1;t[o+44>>2]=0;break g}t[o+44>>2]=1}A=o+48|0;t[y+20>>2]=t[o+44>>2];if(!t[y+20>>2]){t[y+40>>2]=t[y+40>>2]+20;break f}O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+20>>2];break a}t[y+16>>2]=0;if(w[y+32>>2]<3){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=1;break a}o=t[y+36>>2];p=u[o|0]|u[o+1|0]<<8;q[y+16|0]=p;q[y+17|0]=p>>>8;q[y+18|0]=u[o+2|0];t[y+36>>2]=t[y+36>>2]+3;t[y+32>>2]=t[y+32>>2]-3;if(!(t[y+16>>2]==1|u[y+27|0]!=1)){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=7;break a}o=t[y+40>>2];t[o>>2]=t[o>>2]&-268435441|(t[y+16>>2]&16777215)<<4;if(u[y+27|0]==3){if(t[y+16>>2]!=1){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=10;break a}q[y+15|0]=0;if(w[y+32>>2]<1){J(t[y+44>>2]);t[y+76>>2]=1;break a}q[y+15|0]=u[t[y+36>>2]];t[y+36>>2]=t[y+36>>2]+1;t[y+32>>2]=t[y+32>>2]-1;k:{if(u[y+15|0]<=4){q[t[y+40>>2]+4|0]=u[y+15|0];break k}q[t[y+40>>2]+4|0]=4}t[y+40>>2]=t[y+40>>2]+20;break f}z=y,B=Q(y+36|0,y+32|0,y+14|0,y+13|0),t[z+8>>2]=B;if(t[y+8>>2]){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+8>>2];break a}if(u[y+27|0]==1){o=t[y+40>>2];q[o+4|0]=q[o+4|0]&1|u[y+13|0]<<1;t[y+40>>2]=t[y+40>>2]+20;break f}if(!u[y+27|0]){z=y,B=M(y+36|0,y+32|0,t[y+16>>2],t[y+40>>2]+8|0,t[y+40>>2]+12|0),t[z+4>>2]=B;if(t[y+4>>2]){O(t[y+44>>2],t[y+28>>2]);t[y+76>>2]=t[y+4>>2];break a}o=t[y+40>>2];q[o+4|0]=q[y+14|0]&1|u[o+4|0]&254;o=t[y+40>>2];q[o+4|0]=q[o+4|0]&1|u[y+13|0]<<1;t[y+40>>2]=t[y+40>>2]+20}}t[y+28>>2]=t[y+28>>2]+1;continue}break}if(t[y+32>>2]){O(t[y+44>>2],t[y+48>>2]);t[y+76>>2]=1;break a}t[t[y+64>>2]>>2]=t[y+44>>2];t[t[y+60>>2]>>2]=t[y+48>>2];t[y+76>>2]=0}A=y+80|0;return t[y+76>>2]}function D(o){var q=0,l=0,r=0,m=0,n=0,s=0,u=0,v,w=0,x,p;w=8;a:{b:{if(o>>>0>4294967239)break b;while(1){w=w>>>0>8?w:8;l=t[603];n=l;m=t[602];u=m;o=o>>>0>8?o+3&-4:8;c:{if(o>>>0<=127){s=(o>>>3|0)-1|0;break c}r=y(o);s=((o>>>29-r^4)-(r<<2)|0)+110|0;if(o>>>0<=4095)break c;r=((o>>>30-r^2)-(r<<1)|0)+71|0;s=r>>>0<63?r:63}q=s;r=q&31;(q&63)>>>0>=32?(q=0,l=l>>>r|0):(q=l>>>r|0,l=((1<<r)-1&l)<<32-r|u>>>r);r=q;if(l|q){while(1){n=l;q=r;d:{if(q|l){m=q-1|0;v=m+1|0;u=m;m=l-1|0;u=(m|0)!=-1?v:u;m=y(l^m)+32|0;l=y(q^u);l=(l|0)==32?m:l;q=63-l|0;0-(l>>>0>63)|0;break d}q=64}m=q;q=m;l=q&31;(q&63)>>>0>=32?(q=0,u=r>>>l|0):(q=r>>>l|0,u=((1<<l)-1&r)<<32-l|n>>>l);r=q;s=m+s|0;n=s<<4;q=t[n+1384>>2];m=n+1376|0;e:{if((q|0)!=(m|0)){l=I(q,w,o);if(l)break b;l=t[q+4>>2];t[l+8>>2]=t[q+8>>2];t[t[q+8>>2]+4>>2]=l;t[q+8>>2]=m;l=n+1380|0;t[q+4>>2]=t[l>>2];t[l>>2]=q;t[t[q+4>>2]+8>>2]=q;s=s+1|0;l=(r&1)<<31|u>>>1;r=r>>>1|0;break e}x=t[603];q=s;v=q&63;l=v;n=l&31;l>>>0>=32?(l=0,m=-1>>>n|0):(l=-1>>>n|0,m=(1<<n)-1<<32-n|-1>>>n);m=m&-2;n=v&31;v>>>0>=32?(l=m<<n,v=0):(l=(1<<n)-1&m>>>32-n|l<<n,v=m<<n);n=l;m=0-q&63;l=m;q=l&31;l>>>0>=32?(l=-1<<q,q=0):(l=(1<<q)-1&-1>>>32-q|-1<<q,q=-1<<q);p=q&-2;q=m&31;m>>>0>=32?(m=0,q=l>>>q|0):(m=l>>>q|0,q=((1<<q)-1&l)<<32-q|p>>>q);l=q|v;B=n|m;t[602]=t[602]&l;t[603]=B&x;l=u^1}if(l|r)continue;break}m=t[602];n=t[603]}f:{if(n|m){r=y(n);r=63-((r|0)==32?y(m)+32|0:r)<<4;q=r+1376|0;r=t[r+1384>>2];g:{if(!n&m>>>0<1073741824)break g;s=98;if((q|0)==(r|0))break g;while(1){l=I(r,w,o);if(l)break b;r=t[r+8>>2];if(!s)break g;s=s-1|0;if((q|0)!=(r|0))continue;break}}if(G(o+48|0))break f;if(!r|(q|0)==(r|0))break a;while(1){l=I(r,w,o);if(l)break b;r=t[r+8>>2];if((q|0)!=(r|0))continue;break}break a}if(!G(o+48|0))break a}l=0;if(o>>>0>4294967239)break b;r=w;q=0;while(1){s=q;if(r){r=r-1&r;q=q+1|0;continue}break}if(s>>>0<=1)continue;break}}return l}return 0}function E(o,p,l,r,m,n,x){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;n=n|0;x=x|0;var y=0,z=0;y=A-32|0;A=y;s[y+26>>1]=o;t[y+20>>2]=p;t[y+16>>2]=l;q[y+15|0]=r;s[y+12>>1]=m;t[y+8>>2]=n;t[y+4>>2]=x;a:{if(!(!(q[y+15|0]&1)|v[y+12>>1]<=32767)){t[y+28>>2]=4;break a}p=t[y+20>>2];l=t[y+16>>2];r=t[y+8>>2];m=t[y+4>>2];n=q[y+15|0]&1;o=A+-64|0;A=o;t[o+56>>2]=y+26;t[o+52>>2]=p;t[o+48>>2]=l;t[o+44>>2]=r;t[o+40>>2]=m;q[o+39|0]=2;q[o+38|0]=13;t[o+32>>2]=y+12;q[o+31|0]=n;q[o+30|0]=2;b:{c:{if(!(!t[o+52>>2]|(!t[o+44>>2]|!t[o+40>>2]))&&w[o+48>>2]<=16777215)break c;t[o+60>>2]=5;break b}t[o+24>>2]=t[o+48>>2]+(u[o+39|0]+(u[o+30|0]+4|0)|0);z=o,x=D(t[o+24>>2]),t[z+20>>2]=x;if(!t[o+20>>2]){t[o+60>>2]=3;break b}t[o+16>>2]=t[o+20>>2];q[t[o+16>>2]]=u[o+38|0];t[o+16>>2]=t[o+16>>2]+1;ba(t[o+16>>2],t[o+56>>2],u[o+30|0]);t[o+16>>2]=u[o+30|0]+t[o+16>>2];t[o+12>>2]=u[o+39|0]+t[o+48>>2];if(w[o+12>>2]<w[o+48>>2]){J(t[o+20>>2]);t[o+60>>2]=9;break b}p=t[o+16>>2];l=u[o+12|0]|u[o+13|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+14|0];t[o+16>>2]=t[o+16>>2]+3;if(q[o+31|0]&1)d:{if(u[o+38|0]==6){p=t[o+32>>2];q[p|0]=u[p|0]|128;break d}e:{if(u[o+38|0]==13){p=t[o+32>>2];s[p>>1]=v[p>>1]|32768;break e}J(t[o+20>>2]);t[o+60>>2]=1;break b}}ba(t[o+16>>2],t[o+32>>2],u[o+39|0]);t[o+16>>2]=u[o+39|0]+t[o+16>>2];ba(t[o+16>>2],t[o+52>>2],t[o+48>>2]);t[t[o+44>>2]>>2]=t[o+20>>2];t[t[o+40>>2]>>2]=t[o+24>>2];t[o+60>>2]=0}A=o- -64|0;t[y+28>>2]=t[o+60>>2]}A=y+32|0;return t[y+28>>2]}function F(o,p,l,r,m){o=o|0;p=p|0;l=l|0;r=r|0;m=m|0;var n=0,v=0;n=A-32|0;A=n;s[n+30>>1]=o;t[n+24>>2]=p;t[n+20>>2]=l;t[n+16>>2]=r;t[n+12>>2]=m;p=t[n+24>>2];l=t[n+20>>2];r=t[n+16>>2];m=t[n+12>>2];o=A-48|0;A=o;t[o+40>>2]=n+30;t[o+36>>2]=p;t[o+32>>2]=l;t[o+28>>2]=r;t[o+24>>2]=m;q[o+23|0]=2;q[o+22|0]=15;a:{if(!(t[o+24>>2]?t[o+28>>2]:0)){t[o+44>>2]=5;break a}t[t[o+28>>2]>>2]=0;t[t[o+24>>2]>>2]=0;if(!(w[o+32>>2]<=16777215?t[o+36>>2]:0)){t[o+44>>2]=5;break a}t[o+16>>2]=t[o+32>>2]+(u[o+23|0]+4|0);v=o,r=D(t[o+16>>2]),t[v+12>>2]=r;if(!t[o+12>>2]){t[o+44>>2]=3;break a}t[o+8>>2]=t[o+12>>2];q[t[o+8>>2]]=u[o+22|0];t[o+8>>2]=t[o+8>>2]+1;ba(t[o+8>>2],t[o+40>>2],u[o+23|0]);t[o+8>>2]=u[o+23|0]+t[o+8>>2];p=t[o+8>>2];l=u[o+32|0]|u[o+33|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+34|0];t[o+8>>2]=t[o+8>>2]+3;ba(t[o+8>>2],t[o+36>>2],t[o+32>>2]);t[o+8>>2]=t[o+32>>2]+t[o+8>>2];t[t[o+28>>2]>>2]=t[o+12>>2];t[t[o+24>>2]>>2]=t[o+16>>2];t[o+44>>2]=0}A=o+48|0;A=n+32|0;return t[o+44>>2]}function G(o){var p=0,l,r=0,m=0,n,s=0;r=t[343];l=o+3&-4;p=r+l|0;a:{b:{if(p>>>0<=r>>>0?l:0)break b;if(p>>>0>wa()<<16>>>0&&!(z(p|0)|0))break b;t[343]=p;break a}t[604]=48;r=-1}if((r|0)!=-1){l=o+r|0;p=l-16|0;t[p+12>>2]=16;t[p>>2]=16;o=t[600];o?s=t[o+8>>2]:s=0;c:{d:{if((s|0)==(r|0)){m=r-(t[r-4>>2]&-2)|0;n=t[m-4>>2];t[o+8>>2]=l;o=m-(n&-2)|0;l=-16;if(!(q[(o+t[o>>2]|0)-4|0]&1))break d;l=t[o+4>>2];t[l+8>>2]=t[o+8>>2];t[t[o+8>>2]+4>>2]=l;p=p-o|0;t[o>>2]=p;break c}t[r+12>>2]=16;t[r>>2]=16;t[r+8>>2]=l;t[r+4>>2]=o;t[600]=r;l=16}o=r+l|0;p=p-o|0;t[o>>2]=p}t[((p&-4)+o|0)-4>>2]=p|1;s=o;m=t[o>>2]-8|0;e:{if(m>>>0<=127){p=(m>>>3|0)-1|0;break e}n=y(m);p=((m>>>29-n^4)-(n<<2)|0)+110|0;if(m>>>0<=4095)break e;p=((m>>>30-n^2)-(n<<1)|0)+71|0;p=p>>>0<63?p:63}l=p<<4;t[s+4>>2]=l+1376;l=l+1384|0;t[o+8>>2]=t[l>>2];t[l>>2]=o;t[t[o+8>>2]+4>>2]=o;l=t[603];o=p&31;(p&63)>>>0>=32?(p=1<<o,o=0):(p=(1<<o)-1&1>>>32-o,o=1<<o);t[602]=o|t[602];t[603]=p|l}return(r|0)!=-1}function la(o,p,l,r){o=o|0;p=p|0;l=l|0;r=r|0;var m=0,n=0;m=A-16|0;A=m;s[m+10>>1]=o;s[m+8>>1]=p;t[m+4>>2]=l;t[m>>2]=r;a:{if(v[m+8>>1]>32767){t[m+12>>2]=4;break a}p=t[m+4>>2];l=t[m>>2];o=A-48|0;A=o;t[o+40>>2]=m+10;t[o+36>>2]=p;t[o+32>>2]=l;q[o+31|0]=2;q[o+30|0]=12;t[o+24>>2]=m+8;q[o+23|0]=2;b:{if(!(t[o+32>>2]?t[o+36>>2]:0)){t[o+44>>2]=5;break b}t[o+16>>2]=u[o+31|0]+(u[o+23|0]+4|0);n=o,r=D(t[o+16>>2]),t[n+12>>2]=r;if(!t[o+12>>2]){t[o+44>>2]=3;break b}t[o+8>>2]=t[o+12>>2];q[t[o+8>>2]]=u[o+30|0];t[o+8>>2]=t[o+8>>2]+1;ba(t[o+8>>2],t[o+40>>2],u[o+23|0]);t[o+8>>2]=u[o+23|0]+t[o+8>>2];t[o+4>>2]=u[o+31|0];p=t[o+8>>2];l=u[o+4|0]|u[o+5|0]<<8;q[p|0]=l;q[p+1|0]=l>>>8;q[p+2|0]=u[o+6|0];t[o+8>>2]=t[o+8>>2]+3;ba(t[o+8>>2],t[o+24>>2],u[o+31|0]);t[t[o+32>>2]>>2]=t[o+16>>2];t[t[o+36>>2]>>2]=t[o+12>>2];t[o+44>>2]=0}A=o+48|0;t[m+12>>2]=t[o+44>>2]}A=m+16|0;return t[m+12>>2]}function H(o,p,l){o=o|0;p=p|0;l=l|0;var q=0,m=0,n=0,r=0,s=0;n=A+-64|0;A=n;m=1;a:{if(R(o,p,0))break a;m=0;if(!p)break a;q=A+-64|0;A=q;m=t[p>>2];r=t[m-4>>2];s=t[m-8>>2];t[q+20>>2]=0;t[q+16>>2]=1084;t[q+12>>2]=p;t[q+8>>2]=1132;m=0;ca(q+24|0,39);p=p+s|0;b:{if(R(r,1132,0)){t[q+56>>2]=1;ka[t[t[r>>2]+20>>2]](r,q+8|0,p,p,1,0);m=t[q+32>>2]==1?p:0;break b}ka[t[t[r>>2]+24>>2]](r,q+8|0,p,1,0);c:switch(t[q+44>>2]){case 0:m=t[q+48>>2]==1?t[q+36>>2]==1?t[q+40>>2]==1?t[q+28>>2]:0:0:0;break b;case 1:break c;default:break b}if(t[q+48>>2]|t[q+36>>2]!=1|t[q+40>>2]!=1?t[q+32>>2]!=1:0)break b;m=t[q+24>>2]}A=q- -64|0;p=m;m=0;if(!p)break a;ca(n+8|4,52);t[n+56>>2]=1;t[n+20>>2]=-1;t[n+16>>2]=o;t[n+8>>2]=p;ka[t[t[p>>2]+28>>2]](p,n+8|0,t[l>>2],1);o=t[n+32>>2];(o|0)==1&&(t[l>>2]=t[n+24>>2]);m=(o|0)==1}o=m;A=n- -64|0;return o|0}function I(o,p,l){var q=0,m,n=0,r=0;q=o+4|0;m=(q+p|0)-1&0-p;p=t[o>>2];if(m+l>>>0<=(p+o|0)-4>>>0){n=t[o+4>>2];t[n+8>>2]=t[o+8>>2];t[t[o+8>>2]+4>>2]=n;(q|0)!=(m|0)&&(m=m-q|0,n=o-(t[o-4>>2]&-2)|0,q=m+t[n>>2]|0,t[n>>2]=q,t[(n+(q&-4)|0)-4>>2]=q,o=o+m|0,p=p-m|0,t[o>>2]=p);a:{if(l+24>>>0<=p>>>0){q=(o+l|0)+8|0;p=(p-l|0)-8|0;t[q>>2]=p;t[(q+(p&-4)|0)-4>>2]=p|1;r=q;n=t[q>>2]-8|0;b:{if(n>>>0<=127){m=(n>>>3|0)-1|0;break b}p=y(n);m=((n>>>29-p^4)-(p<<2)|0)+110|0;if(n>>>0<=4095)break b;p=((n>>>30-p^2)-(p<<1)|0)+71|0;m=p>>>0<63?p:63}p=m;m=p<<4;t[r+4>>2]=m+1376;m=m+1384|0;t[q+8>>2]=t[m>>2];t[m>>2]=q;t[t[q+8>>2]+4>>2]=q;m=t[603];q=p&31;(p&63)>>>0>=32?(p=1<<q,r=0):(p=(1<<q)-1&1>>>32-q,r=1<<q);t[602]=r|t[602];t[603]=p|m;p=l+8|0;t[o>>2]=p;t[((p&-4)+o|0)-4>>2]=p;break a}t[(o+p|0)-4>>2]=p}o=o+4|0}else o=0;return o}function J(o){var p=0,l,q=0,m,n=0;if(o){l=o-4|0;m=t[l>>2];q=m;p=l;n=t[o-8>>2];o=n&-2;(o|0)!=(n|0)&&(p=l-o|0,q=t[p+4>>2],t[q+8>>2]=t[p+8>>2],t[t[p+8>>2]+4>>2]=q,q=o+m|0);o=l+m|0;l=t[o>>2];(l|0)!=t[(o+l|0)-4>>2]&&(m=t[o+4>>2],t[m+8>>2]=t[o+8>>2],t[t[o+8>>2]+4>>2]=m,q=q+l|0);t[p>>2]=q;t[((q&-4)+p|0)-4>>2]=q|1;n=p;q=t[p>>2]-8|0;a:{if(q>>>0<=127){o=(q>>>3|0)-1|0;break a}m=y(q);o=((q>>>29-m^4)-(m<<2)|0)+110|0;if(q>>>0<=4095)break a;o=((q>>>30-m^2)-(m<<1)|0)+71|0;o=o>>>0<63?o:63}l=o<<4;t[n+4>>2]=l+1376;l=l+1384|0;t[p+8>>2]=t[l>>2];t[l>>2]=p;t[t[p+8>>2]+4>>2]=p;l=t[603];p=o&31;(o&63)>>>0>=32?(o=1<<p,p=0):(o=(1<<p)-1&1>>>32-p,p=1<<p);t[602]=p|t[602];t[603]=o|l}}function K(n,o,l){n=n|0;o=o|0;l=l|0;var p=0,m=0;p=A-48|0;A=p;t[p+40>>2]=n;t[p+36>>2]=o;t[p+32>>2]=l;a:{if(!(t[p+32>>2]?t[p+36>>2]:0)){t[p+44>>2]=5;break a}if(w[p+40>>2]>4){t[p+44>>2]=8;break a}t[p+28>>2]=5;m=p,l=D(t[p+28>>2]),t[m+24>>2]=l;if(!t[p+24>>2]){t[p+44>>2]=3;break a}t[p+20>>2]=t[p+24>>2];q[p+19|0]=3;q[t[p+20>>2]]=u[p+19|0];t[p+20>>2]=t[p+20>>2]+1;t[p+12>>2]=1;n=t[p+20>>2];o=u[p+12|0]|u[p+13|0]<<8;q[n|0]=o;q[n+1|0]=o>>>8;q[n+2|0]=u[p+14|0];t[p+20>>2]=t[p+20>>2]+3;q[p+11|0]=t[p+40>>2];q[t[p+20>>2]]=u[p+11|0];t[t[p+36>>2]>>2]=t[p+24>>2];t[t[p+32>>2]>>2]=t[p+28>>2];t[p+44>>2]=0}A=p+48|0;return t[p+44>>2]}function L(n,o,l,p,m){n=n|0;o=o|0;l=l|0;p=p|0;m=m|0;if(R(n,t[o+8>>2],m)){da(o,l,p);return}a:{if(R(n,t[o>>2],m)){if(!(t[o+20>>2]!=(l|0)?t[o+16>>2]!=(l|0):0)){if((p|0)!=1)break a;t[o+32>>2]=1;return}t[o+32>>2]=p;b:{if(t[o+44>>2]==4)break b;s[o+52>>1]=0;n=t[n+8>>2];ka[t[t[n>>2]+20>>2]](n,o,l,l,1,m);if(u[o+53|0]){t[o+44>>2]=3;if(!u[o+52|0])break b;break a}t[o+44>>2]=4}t[o+20>>2]=l;t[o+40>>2]=t[o+40>>2]+1;if(t[o+36>>2]!=1|t[o+24>>2]!=2)break a;q[o+54|0]=1;return}n=t[n+8>>2];ka[t[t[n>>2]+24>>2]](n,o,l,p,m)}}function M(o,p,l,q,m){var n=0;n=A-32|0;A=n;t[n+24>>2]=o;t[n+20>>2]=p;t[n+16>>2]=l;t[n+12>>2]=q;t[n+8>>2]=m;a:{if(w[n+16>>2]<1){t[n+28>>2]=9;break a}t[t[n+8>>2]>>2]=t[n+16>>2]-1;if(w[t[n+20>>2]>>2]<w[t[n+8>>2]>>2]){t[n+28>>2]=1;break a}o=D(t[t[n+8>>2]>>2]);t[t[n+12>>2]>>2]=o;if(!t[t[n+12>>2]>>2]){t[n+28>>2]=3;break a}ba(t[t[n+12>>2]>>2],t[t[n+24>>2]>>2],t[t[n+8>>2]>>2]);o=t[n+24>>2];t[o>>2]=t[t[n+8>>2]>>2]+t[o>>2];o=t[n+20>>2];t[o>>2]=t[o>>2]-t[t[n+8>>2]>>2];t[n+28>>2]=0}A=n+32|0;return t[n+28>>2]}function N(n,o,l){n=n|0;o=o|0;l=l|0;var p=0,m=0;p=A-32|0;A=p;s[p+26>>1]=n;t[p+20>>2]=o;t[p+16>>2]=l;t[t[p+16>>2]>>2]=3;m=p,l=D(t[t[p+16>>2]>>2]),t[m+12>>2]=l;a:{if(!t[p+12>>2]){t[p+28>>2]=3;break a}t[t[p+20>>2]>>2]=t[p+12>>2];q[p+11|0]=14;q[t[p+12>>2]]=u[p+11|0];t[p+12>>2]=t[p+12>>2]+1;n=t[p+12>>2];o=u[p+26|0]|u[p+27|0]<<8;q[n|0]=o;q[n+1|0]=o>>>8;t[p+28>>2]=0}A=p+32|0;return t[p+28>>2]}function O(m,n){var l=0;l=A-16|0;A=l;t[l+12>>2]=m;t[l+8>>2]=n;t[l+4>>2]=0;while(1){if(w[l+4>>2]<w[l+8>>2]){t[l>>2]=t[l+12>>2]+x(t[l+4>>2],20);a:{if(!(t[t[l>>2]>>2]&15)){J(t[t[l>>2]+8>>2]);break a}b:{if((t[t[l>>2]>>2]&15)==5){J(t[t[l>>2]+8>>2]);break b}(t[t[l>>2]>>2]&15)==6&&J(t[t[l>>2]+12>>2])}}t[l+4>>2]=t[l+4>>2]+1;continue}break}J(t[l+12>>2]);A=l+16|0}function P(m,n,l,o){q[m+53|0]=1;a:{if(t[m+4>>2]!=(l|0))break a;q[m+52|0]=1;l=t[m+16>>2];if(!l){t[m+36>>2]=1;t[m+24>>2]=o;t[m+16>>2]=n;if((o|0)!=1|t[m+48>>2]!=1)break a;q[m+54|0]=1;return}if((n|0)==(l|0)){l=t[m+24>>2];(l|0)==2&&(t[m+24>>2]=o,l=o);if(t[m+48>>2]!=1|(l|0)!=1)break a;q[m+54|0]=1;return}q[m+54|0]=1;t[m+36>>2]=t[m+36>>2]+1}}function Q(n,o,l,p){var m;m=A-32|0;t[m+24>>2]=n;t[m+20>>2]=o;t[m+16>>2]=l;t[m+12>>2]=p;q[m+11|0]=0;a:{if(w[t[m+20>>2]>>2]<1){t[m+28>>2]=1;break a}q[m+11|0]=u[t[t[m+24>>2]>>2]];n=t[m+24>>2];t[n>>2]=t[n>>2]+1;n=t[m+20>>2];t[n>>2]=t[n>>2]-1;q[t[m+16>>2]]=(u[m+11|0]&128)==128;q[t[m+12>>2]]=u[m+11|0]&127;t[m+28>>2]=0}return t[m+28>>2]}function ma(n,o,l,p,m){n=n|0;o=o|0;l=l|0;p=p|0;m=m|0;if(R(n,t[o+8>>2],m)){da(o,l,p);return}a:{if(!R(n,t[o>>2],m))break a;if(!(t[o+20>>2]!=(l|0)?t[o+16>>2]!=(l|0):0)){if((p|0)!=1)break a;t[o+32>>2]=1;return}t[o+20>>2]=l;t[o+32>>2]=p;t[o+40>>2]=t[o+40>>2]+1;t[o+36>>2]!=1|t[o+24>>2]!=2||(q[o+54|0]=1);t[o+44>>2]=4}}function R(m,n,l){var o;if(!l)return t[m+4>>2]==t[n+4>>2];if((m|0)==(n|0))return 1;l=t[m+4>>2];m=u[l|0];n=t[n+4>>2];o=u[n|0];a:{if(!m|(o|0)!=(m|0))break a;while(1){o=u[n+1|0];m=u[l+1|0];if(!m)break a;n=n+1|0;l=l+1|0;if((m|0)==(o|0))continue;break}}return(m|0)==(o|0)}function na(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=9;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function S(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=10;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function T(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=2;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function U(m,n){m=m|0;n=n|0;var l=0,o=0;l=A-32|0;A=l;t[l+24>>2]=m;t[l+20>>2]=n;o=l,m=D(1),t[o+16>>2]=m;a:{if(!t[l+16>>2]){t[l+28>>2]=3;break a}q[l+15|0]=4;q[t[l+16>>2]]=u[l+15|0];t[t[l+24>>2]>>2]=t[l+16>>2];t[t[l+20>>2]>>2]=1;t[l+28>>2]=0}A=l+32|0;return t[l+28>>2]}function V(l){var m=0;m=A-16|0;A=m;t[m+12>>2]=l;l=1;a:{if(X(t[m+12>>2])&1)break a;l=1;if(t[m+12>>2]==15)break a;l=1;if(t[m+12>>2]==13)break a;l=1;if(t[m+12>>2]==12)break a;l=t[m+12>>2]==14}A=m+16|0;return l}function W(m,n,l){var o;o=t[m+16>>2];if(!o){t[m+36>>2]=1;t[m+24>>2]=l;t[m+16>>2]=n;return}a:{if((n|0)==(o|0)){if(t[m+24>>2]!=2)break a;t[m+24>>2]=l;return}q[m+54|0]=1;t[m+24>>2]=2;t[m+36>>2]=t[m+36>>2]+1}}function X(l){var m;m=A-16|0;t[m+12>>2]=l;l=1;a:{if(t[m+12>>2]==5)break a;l=1;if(t[m+12>>2]==6)break a;l=1;if(t[m+12>>2]==7)break a;l=t[m+12>>2]==8}return l}function Y(o,p,l,q,m,n){o=o|0;p=p|0;l=l|0;q=q|0;m=m|0;n=n|0;if(R(o,t[p+8>>2],n)){P(p,l,q,m);return}o=t[o+8>>2];ka[t[t[o>>2]+20>>2]](o,p,l,q,m,n)}function Z(){var m=0,n,l;while(1){n=m<<4;l=n+1376|0;t[n+1380>>2]=l;t[n+1384>>2]=l;m=m+1|0;if((m|0)!=64)continue;break}G(48)}function $(m,n,l,o){m=m|0;n=n|0;l=l|0;o=o|0;if(R(m,t[n+8>>2],0)){W(n,l,o);return}m=t[m+8>>2];ka[t[t[m>>2]+28>>2]](m,n,l,o)}function aa(o,p,l,q,m,n){o=o|0,p=p|0,l=l|0,q=q|0,m=m|0,n=n|0,R(o,t[p+8>>2],n)&&P(p,l,q,m)}function ba(m,n,l){if(l)while(1){q[m|0]=u[n|0];m=m+1|0;n=n+1|0;l=l-1|0;if(l)continue;break}}function ca(l,m){if(m)while(1){q[l|0]=0;l=l+1|0;m=m-1|0;if(m)continue;break}}function oa(m,n,l,o){m=m|0,n=n|0,l=l|0,o=o|0,R(m,t[n+8>>2],0)&&W(n,l,o)}function da(m,n,l){t[m+28>>2]==1|t[m+4>>2]!=(n|0)||(t[m+28>>2]=l)}function pa(l,m){l=l|0;m=m|0;return x(m,20)+l|0}function ea(l){l=l|0;return v[l+8>>1]>>>1|0}function qa(l){l=l|0;return s[l+8>>1]&1}function fa(l){l=l|0;return t[l+12>>2]}function ra(l){l=l|0;return t[l>>2]&15}function sa(l){l=l|0;return t[l+16>>2]}function ga(l){l=l|0;return v[l+4>>1]}function ha(l){l=l|0;return t[l+8>>2]}function ia(l){l=l|0;return u[l+4|0]}function ja(l){l=l|0;return l|0}function ta(l){return D(l)}function ua(l){l=l|0,J(l)}function va(l){l|0}n=u;r(l);var ka=m([null,ja,ua,va,va,H,aa,ma,oa,ua,Y,L,$]);function wa(){return p.byteLength/65536|0}function xa(l){l=l|0;var m=wa()|0;l=m+l|0;if(m<l&&l<65536){l=new ArrayBuffer(x(l,65536));var r=new Int8Array(l);r.set(q);q=new Int8Array(l);s=new Int16Array(l);t=new Int32Array(l);u=new Uint8Array(l);v=new Uint16Array(l);w=new Uint32Array(l);new Float32Array(l);new Float64Array(l);p=l;o.buffer=p;n=u}return m}return{c:Z,d:ta,e:ua,f:T,g:U,h:K,i:F,j:N,k:E,l:la,m:na,n:S,o:C,p:ra,q:ia,r:pa,s:ga,t:ha,u:fa,v:fa,w:sa,x:ea,y:qa,z:ea,A:ka}}return s(l)}(ha)},instantiate:function(l,m){return{then:function(n){var m=new D.Module(l);n({instance:new D.Instance(m)})}}},RuntimeError:Error};C=[];typeof D!=="object"&&Y("no native wasm support detected");var E,F=!1;function G(l,m){l||Y("Assertion failed: "+m)}function la(l,m){l%m>0&&(l+=m-l%m);return l}var H,I;function J(l){H=l,m.HEAP8=new Int8Array(l),m.HEAP16=new Int16Array(l),m.HEAP32=new Int32Array(l),m.HEAPU8=I=new Uint8Array(l),m.HEAPU16=new Uint16Array(l),m.HEAPU32=new Uint32Array(l),m.HEAPF32=new Float32Array(l),m.HEAPF64=new Float64Array(l)}u=m.INITIAL_MEMORY||2097152;m.wasmMemory?E=m.wasmMemory:E=new D.Memory({initial:u/65536,maximum:2147483648/65536});E&&(H=E.buffer);H.byteLength;J(H);var K,L=[],M=[],N=[];function O(){if(m.preRun){typeof m.preRun=="function"&&(m.preRun=[m.preRun]);while(m.preRun.length)ma(m.preRun.shift())}da(L)}function P(){da(M)}function Q(){if(m.postRun){typeof m.postRun=="function"&&(m.postRun=[m.postRun]);while(m.postRun.length)na(m.postRun.shift())}da(N)}function ma(l){L.unshift(l)}function R(l){M.unshift(l)}function na(l){N.unshift(l)}(!Math.imul||Math.imul(4294967295,5)!==-5)&&(Math.imul=function(l,m){var n=l>>>16;l=l&65535;var o=m>>>16;m=m&65535;return l*m+(n*m+l*o<<16)|0});if(!Math.fround){var S=new Float32Array(1);Math.fround=function(l){S[0]=l;return S[0]}}Math.clz32||(Math.clz32=function(l){var m=32,n=l>>16;n&&(m-=16,l=n);n=l>>8;n&&(m-=8,l=n);n=l>>4;n&&(m-=4,l=n);n=l>>2;n&&(m-=2,l=n);n=l>>1;return n?m-2:m-l});Math.trunc||(Math.trunc=function(l){return l<0?Math.ceil(l):Math.floor(l)});var T=0,U=null,V=null;function W(l){T++,m.monitorRunDependencies&&m.monitorRunDependencies(T)}function X(l){T--;m.monitorRunDependencies&&m.monitorRunDependencies(T);if(T==0){U!==null&&(clearInterval(U),U=null);if(V){l=V;V=null;l()}}}m.preloadedImages={};m.preloadedAudios={};function Y(l){m.onAbort&&m.onAbort(l);l+="";B(l);F=!0;l="abort("+l+"). Build with -s ASSERTIONS=1 for more info.";l=new D.RuntimeError(l);s(l);throw l}var Z="data:application/octet-stream;base64,";function $(l){return l.startsWith(Z)}var aa="dgwcppbridge.wasm";$(aa)||(aa=z(aa));function ba(l){try{if(l==aa&&C)return new Uint8Array(C);var m=ga(l);if(m)return m;if(A)return A(l);else throw"both async and sync fetching of the wasm failed"}catch(l){Y(l)}}function ca(){return!C&&(w||x)&&typeof fetch==="function"?fetch(aa,{credentials:"same-origin"}).then(function(l){if(!l.ok)throw"failed to load wasm binary file at '"+aa+"'";return l.arrayBuffer()})["catch"](function(){return ba(aa)}):n.resolve().then(function(){return ba(aa)})}function oa(){var n={a:ha};function o(n,l){l=n.exports;m.asm=l;K=m.asm.A;R(m.asm.c);X("wasm-instantiate")}W("wasm-instantiate");function r(l){o(l.instance)}function t(l){return ca().then(function(l){l=D.instantiate(l,n);return l}).then(l,function(l){B("failed to asynchronously prepare wasm: "+l),Y(l)})}function u(){if(!C&&typeof D.instantiateStreaming==="function"&&!$(aa)&&typeof fetch==="function")return fetch(aa,{credentials:"same-origin"}).then(function(l){l=D.instantiateStreaming(l,n);return l.then(r,function(l){B("wasm streaming compile failed: "+l);B("falling back to ArrayBuffer instantiation");return t(r)})});else return t(r)}if(m.instantiateWasm)try{var l=m.instantiateWasm(n,o);return l}catch(l){B("Module.instantiateWasm callback failed with error: "+l);return!1}u()["catch"](s);return{}}function da(l){while(l.length>0){var n=l.shift();if(typeof n=="function"){n(m);continue}var o=n.func;typeof o==="number"?n.arg===void 0?K.get(o)():K.get(o)(n.arg):o(n.arg===void 0?null:n.arg)}}function pa(l){try{E.grow(l-H.byteLength+65535>>>16);J(E.buffer);return 1}catch(l){}}function ea(l){var m=I.length;l=l>>>0;var n=2147483648;if(l>n)return!1;for(var o=1;o<=4;o*=2){var p=m*(1+.2/o);p=Math.min(p,l+100663296);p=Math.min(n,la(Math.max(l,p),65536));p=pa(p);if(p)return!0}return!1}var qa=!1;function fa(l){var m=[];for(var n=0;n<l.length;n++){var o=l[n];o>255&&(qa&&G(!1,"Character code "+o+" ("+String.fromCharCode(o)+")  at offset "+n+" not in 0x00-0xFF."),o&=255);m.push(String.fromCharCode(o))}return m.join("")}var ra=typeof atob==="function"?atob:function(l){var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="",o,p,q,r,s,t=0;l=l.replace(/[^A-Za-z0-9\+\/\=]/g,"");do p=m.indexOf(l.charAt(t++)),q=m.indexOf(l.charAt(t++)),r=m.indexOf(l.charAt(t++)),s=m.indexOf(l.charAt(t++)),p=p<<2|q>>4,q=(q&15)<<4|r>>2,o=(r&3)<<6|s,n=n+String.fromCharCode(p),r!==64&&(n=n+String.fromCharCode(q)),s!==64&&(n=n+String.fromCharCode(o));while(t<l.length);return n};function sa(l){try{l=ra(l);var m=new Uint8Array(l.length);for(var n=0;n<l.length;++n)m[n]=l.charCodeAt(n);return m}catch(l){throw new Error("Converting base64 string to bytes failed.")}}function ga(l){if(!$(l))return;return sa(l.slice(Z.length))}var ha={b:ea,a:E};oa();m.___wasm_call_ctors=function(){return(m.___wasm_call_ctors=m.asm.c).apply(null,arguments)};m.__malloc=function(){return(m.__malloc=m.asm.d).apply(null,arguments)};m.__free=function(){return(m.__free=m.asm.e).apply(null,arguments)};m.__DgwCodecEncodeEmpty=function(){return(m.__DgwCodecEncodeEmpty=m.asm.f).apply(null,arguments)};m.__DgwCodecEncodeDeauth=function(){return(m.__DgwCodecEncodeDeauth=m.asm.g).apply(null,arguments)};m.__DgwCodecEncodeDrain=function(){return(m.__DgwCodecEncodeDrain=m.asm.h).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_EstabStream=function(){return(m.__DgwCodecEncodeStreamGroup_EstabStream=m.asm.i).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_EndOfData=function(){return(m.__DgwCodecEncodeStreamGroup_EndOfData=m.asm.j).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_Data=function(){return(m.__DgwCodecEncodeStreamGroup_Data=m.asm.k).apply(null,arguments)};m.__DgwCodecEncodeStreamGroup_Ack=function(){return(m.__DgwCodecEncodeStreamGroup_Ack=m.asm.l).apply(null,arguments)};m.__DgwCodecEncodePing=function(){return(m.__DgwCodecEncodePing=m.asm.m).apply(null,arguments)};m.__DgwCodecEncodePong=function(){return(m.__DgwCodecEncodePong=m.asm.n).apply(null,arguments)};m.__DgwCodecDecode=function(){return(m.__DgwCodecDecode=m.asm.o).apply(null,arguments)};m.__getFrameType=function(){return(m.__getFrameType=m.asm.p).apply(null,arguments)};m.__getDrainReasonFromDrainFrame=function(){return(m.__getDrainReasonFromDrainFrame=m.asm.q).apply(null,arguments)};m.__getDGWFramePtr=function(){return(m.__getDGWFramePtr=m.asm.r).apply(null,arguments)};m.__getStreamIdFromStreamGroupFrame=function(){return(m.__getStreamIdFromStreamGroupFrame=m.asm.s).apply(null,arguments)};m.__getEncodedParamsFromEstablishStreamFrame=function(){return(m.__getEncodedParamsFromEstablishStreamFrame=m.asm.t).apply(null,arguments)};m.__getEncodedParamsSizeFromEstablishStreamFrame=function(){return(m.__getEncodedParamsSizeFromEstablishStreamFrame=m.asm.u).apply(null,arguments)};m.__getDataFromGroupedStreamDataFrame=function(){return(m.__getDataFromGroupedStreamDataFrame=m.asm.v).apply(null,arguments)};m.__getDataSizeFromGroupedStreamDataFrame=function(){return(m.__getDataSizeFromGroupedStreamDataFrame=m.asm.w).apply(null,arguments)};m.__getAckIdFromGroupedStreamDataFrame=function(){return(m.__getAckIdFromGroupedStreamDataFrame=m.asm.x).apply(null,arguments)};m.__getRequiresAckFromGroupedStreamDataFrame=function(){return(m.__getRequiresAckFromGroupedStreamDataFrame=m.asm.y).apply(null,arguments)};m.__getAckIdFromGroupedStreamAckFrame=function(){return(m.__getAckIdFromGroupedStreamAckFrame=m.asm.z).apply(null,arguments)};var ia;V=function l(){ia||ja(),ia||(V=l)};function ja(l){l||v;if(T>0)return;O();if(T>0)return;function n(){if(ia)return;ia=!0;m.calledRun=!0;if(F)return;P();o(m);m.onRuntimeInitialized&&m.onRuntimeInitialized();Q()}m.setStatus?(m.setStatus("Running..."),setTimeout(function(){setTimeout(function(){m.setStatus("")},1),n()},1)):n()}m.run=ja;if(m.preInit){typeof m.preInit=="function"&&(m.preInit=[m.preInit]);while(m.preInit.length>0)m.preInit.pop()()}ja();return m.ready}}();typeof q==="object"&&typeof p==="object"?p.exports=r:typeof define==="function"&&define.amd?define([],function(){return r}):typeof q==="object"&&(q.Module=r)}),null);
__d("DGWUtils",["Base64","DGWConstants","DGWCppBridge","DGWLoggingContext","Promise","Random","URI","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=4;function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=d("Random").random()*16|0;a=a==="x"?b:b&3|8;return a.toString(16)})}function k(a){var b=new TextDecoder();b=b.decode(a);a=c("Base64").encode(b);b=a.replace(/\+/gi,"-").replace(/\//gi,"_").replace(/=/gi,"");return b}var l=null,m=null;function n(){m==null&&(m=(i||(i=b("Promise"))).resolve().then(function(){return c("DGWCppBridge")()}).then(function(a){l=a}));return m}e=function(){function a(){}a.initialize=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return n()});function c(){return a.apply(this,arguments)}return c}();a.constructConnectUrl=function(a){var b,e,f=a.appId,g=a.appVersion,i=a.authType,j=a.deviceId,l=a.dgwVersion,m=a.fbId,n=a.tier,o=a.loggingId,p=a.headers,q=a.endpoint,r=a.serviceId,s=a.regionHint,t=a.establishStreamFrame;a=a.trafficTracing;var u=(b={},b[(e=d("DGWConstants")).HEADER_CONSTANTS.HEADER_APPID]=f,b[e.HEADER_CONSTANTS.HEADER_APPVERSION]=g,b[e.HEADER_CONSTANTS.HEADER_AUTHTYPE]=i,b[e.HEADER_CONSTANTS.HEADER_DGW_VERSION]=""+l,b[e.HEADER_CONSTANTS.HEADER_UUID]=m,b[e.HEADER_CONSTANTS.HEADER_TARGET_TIER]=n,b);t!==void 0&&(u[d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64]=k(t));o!==void 0&&(u[d("DGWConstants").HEADER_CONSTANTS.HEADER_LOGGING_ID]=o);s!==void 0&&(u[d("DGWConstants").HEADER_CONSTANTS.HEADER_REGIONHINT]=s);j!==void 0&&(u[d("DGWConstants").HEADER_CONSTANTS.HEADER_DEVICE_ID]=j);a!==void 0&&(u[d("DGWConstants").HEADER_CONSTANTS.TRAFFIC_TRACING]="debug:"+a);Object.keys(p).forEach(function(a){var b=d("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+a;Object.prototype.hasOwnProperty.call(u,b)||(u[b]=p[a])});f=new(h||(h=c("URI")))(q);f.setQueryData(u);f.setPath(f.getPath()+"/"+r);f.toString().length>2e3&&(delete u[d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64],f.setQueryData(u));return f.toStringRawQuery()};return a}();f=function(){function a(a,b,c){this.$1=null,this.$2=a,this.$3=b,this.$4=c}a.initialize=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return n()});function c(){return a.apply(this,arguments)}return c}();var c=a.prototype;c.malloc=function(a){try{a=l.__malloc(a);if(a===0){var b;(b=this.$2)==null?void 0:b.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"wasm malloc failure","malloc returned 0");return-1}return a}catch(a){(b=this.$2)==null?void 0:b.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"wasm malloc failure","exception during malloc",a.toString());return-1}};c.free=function(a){l.__free(a)};c.append=function(a){if(this.$1==null){this.$1=a;return}var b=this.$1.length,c=new Uint8Array(b+a.length);c.set(this.$1,0);c.set(a,b);this.$1=c};c.processData=function(){var a=this;if(this.$1==null)return;var b=this.$1.length,c=this.malloc(b);if(c===-1)return;var e=l.HEAPU8.subarray(c,c+b);if(this.$1)for(var f=0;f<e.length;++f)e[f]=this.$1[f];f=this.malloc(j*4);if(f===-1)return;e=f;var g=e+j,h=g+j,i=h+j;b=l.__DgwCodecDecode(c,b,e,g,h,i);this.free(c);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){this.free(f);(h=this.$2)==null?void 0:h.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Codec Decode Failure","Failed to decode Frame(s). Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b));return}c=l.HEAPU32.subarray(i/j,i/j+1)[0];if(this.$1==null){this.free(f);return}h=this.$1.length-c;if(this.$1&&this.$1.length>h){this.$1=new Uint8Array(((b=this.$1)==null?void 0:b.subarray(h))||[])}else this.$1=null;i=l.HEAPU32.subarray(g/j,g/j+1)[0];c=l.HEAPU32.subarray(e/j,e/j+1)[0];var k=[];for(b=0;b<i;++b){var m=l.__getDGWFramePtr(c,b);h=l.__getFrameType(m);switch(h){case d("DGWConstants").DgwFrameType.DgwFrameType_Drain:g=function(){var b=l.__getDrainReasonFromDrainFrame(m),c=d("DGWConstants").drainReasonToDrainReasonString(b);(b=a.$2)==null?void 0:b.logEvent(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Received Drain Frame from server","DrainReason: "+c);k.push(function(){var b;return(b=a.$3)==null?void 0:b.receivedDrainSignal(c)});return"break"}();if(g==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EstabStream:e=function(){var b=l.__getStreamIdFromStreamGroupFrame(m),c=l.__getEncodedParamsFromEstablishStreamFrame(m),d=new Uint8Array(l.HEAPU8.subarray(c,c+l.__getEncodedParamsSizeFromEstablishStreamFrame(m)));a.free(c);k.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamEstablishStreamReceived(b,d)});return"break"}();if(e==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Data:h=function(){var b=l.__getStreamIdFromStreamGroupFrame(m),c=l.__getDataFromGroupedStreamDataFrame(m),d=new Uint8Array(l.HEAPU8.subarray(c,c+l.__getDataSizeFromGroupedStreamDataFrame(m)));a.free(c);var e=l.__getRequiresAckFromGroupedStreamDataFrame(m)?l.__getAckIdFromGroupedStreamDataFrame(m):null;k.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamDataReceived(b,d,e)});return"break"}();if(h==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_Ack:g=function(){var b=l.__getStreamIdFromStreamGroupFrame(m),c=l.__getAckIdFromGroupedStreamAckFrame(m);k.push(function(){var d;return(d=a.$3)==null?void 0:d.onGroupedStreamAckReceived(b,c)});return"break"}();if(g==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_StreamGroup_EndOfData:e=function(){var b=l.__getStreamIdFromStreamGroupFrame(m);k.push(function(){var c;return(c=a.$3)==null?void 0:c.onGroupedStreamEndOfDataReceived(b)});return"break"}();if(e==="break")break;case d("DGWConstants").DgwFrameType.DgwFrameType_Ping:k.push(function(){var b;return(b=a.$3)==null?void 0:b.onPingReceived()});break;case d("DGWConstants").DgwFrameType.DgwFrameType_Pong:k.push(function(){var b;return(b=a.$3)==null?void 0:b.onPongReceived()});break;default:break}this.free(m)}this.free(f);for(h=0;h<k.length;h++)k[h]()};c.encodeData=function(a,b,c,e){var f=this.malloc(a.length);if(f===-1)return null;var g=l.HEAPU8.subarray(f,f+a.length);for(var h=0;h<g.length;++h)g[h]=a[h];a=this.malloc(j*2);h=a;var i=a+j;e=l.__DgwCodecEncodeStreamGroup_Data(e,f,g.length,b,c,h,i);this.free(f);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(g=this.$2)==null?void 0:g.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Data Frame encode failure","Failed to decode DGW Data Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}b=l.HEAPU32.subarray(h/j,h/j+1)[0];c=l.HEAPU32.subarray(i/j,i/j+1)[0];f=new Uint8Array(l.HEAPU8.subarray(b,b+c));this.free(b);this.free(a);return f};c.encodeAck=function(a,b){var c=this.malloc(j*2);if(c===-1)return null;var e=c,f=c+j;b=l.__DgwCodecEncodeStreamGroup_Ack(b,a,e,f);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(a=this.$2)==null?void 0:a.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"ACK Frame encode failure","Failed to encode ACK Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b));return null}a=l.HEAPU32.subarray(e/j,e/j+1)[0];b=l.HEAPU32.subarray(f/j,f/j+1)[0];e=new Uint8Array(l.HEAPU8.subarray(a,a+b));this.free(a);this.free(c);return e};c.encodeDrain=function(a){var b=this.malloc(j*2);if(b===-1)return null;var c=b,e=b+j;a=l.__DgwCodecEncodeDrain(a,c,e);if(a!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Drain Frame encode failure","Failed to encode Drain Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=l.HEAPU32.subarray(c/j,c/j+1)[0];a=l.HEAPU32.subarray(e/j,e/j+1)[0];c=new Uint8Array(l.HEAPU8.subarray(f,f+a));this.free(f);this.free(b);return c};c.encodeEstablishStream=function(a,b){var c=this.malloc(b.length);if(c===-1)return null;var e=l.HEAPU8.subarray(c,c+b.length);for(var f=0;f<b.length;++f)e[f]=b[f];e=this.malloc(j*2);f=e;var g=e+j;b=l.__DgwCodecEncodeStreamGroup_EstabStream(a,c,b.length,f,g);this.free(c);if(b!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){(c=this.$2)==null?void 0:c.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EstablishStream Frame encode failure","Failed to encode EstablishStream Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(b)+" for StreamId "+a);return null}c=l.HEAPU32.subarray(f/j,f/j+1)[0];b=l.HEAPU32.subarray(g/j,g/j+1)[0];a=new Uint8Array(l.HEAPU8.subarray(c,c+b));this.free(c);this.free(e);return a};c.encodeEndOfData=function(a){var b=this.malloc(j*2);if(b===-1)return null;var c=b,e=b+j;a=l.__DgwCodecEncodeStreamGroup_EndOfData(a,c,e);if(a!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"EndOfData Frame encode failure","Failed to encode EndOfData Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(a));return null}f=l.HEAPU32.subarray(c/j,c/j+1)[0];a=l.HEAPU32.subarray(e/j,e/j+1)[0];c=new Uint8Array(l.HEAPU8.subarray(f,f+a));this.free(f);this.free(b);return c};c.encodePing=function(){var a=this.malloc(j*2);if(a===-1)return null;var b=a,c=a+j,e=l.__DgwCodecEncodePing(b,c);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Ping Frame encode failure","Failed to encode Ping Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=l.HEAPU32.subarray(b/j,b/j+1)[0];e=l.HEAPU32.subarray(c/j,c/j+1)[0];b=new Uint8Array(l.HEAPU8.subarray(f,f+e));this.free(f);this.free(a);return b};c.encodePong=function(){if(this.$5!=null)return this.$5;var a=this.malloc(j*2);if(a===-1)return null;var b=a,c=a+j,e=l.__DgwCodecEncodePong(b,c);if(e!==d("DGWConstants").DgwCodecReturnCode.DgwCodecReturnCode_Success){var f;(f=this.$2)==null?void 0:f.logError(d("DGWLoggingContext").DGWLoggingComponent.CODEC_COMPONENT,"Pong Frame encode failure","Failed to encode Pong Frame. Received error code "+d("DGWConstants").DgwCodecReturnCodeToString(e));return null}f=l.HEAPU32.subarray(b/j,b/j+1)[0];e=l.HEAPU32.subarray(c/j,c/j+1)[0];b=new Uint8Array(l.HEAPU8.subarray(f,f+e));this.free(f);this.free(a);this.$5=b;return b};return a}();g.uuidv4=a;g.Uint8ArrayToBase64UrlStr=k;g.DGWUtils=e;g.DGWCodec=f}),98);
__d("DGWExponentialBackoff",["Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";var g,h={maxRetries:5,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)},i=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.errors=c;return a}return a}(babelHelpers.wrapNativeSuper(Error));function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=h);try{return yield k(a,b)}catch(a){throw a.errors[a.errors.length-1]}});return j.apply(this,arguments)}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=0,d=[],e=b.baseRetryInterval,f=b.backoffFactor;while(c<=b.maxRetries){try{var g=(yield a());return g}catch(a){d.push(a)}yield m(e*Math.pow(f,c));++c}throw new i("Max call count exceeded",d)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield new(g||(g=b("Promise")))(function(b){return window.setTimeout(b,a)})});return n.apply(this,arguments)}f.callWithExponentialBackoff=a}),66);
__d("DGWPinger",["DGWLoggingContext"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$4=b,this.$5=c,this.$3=!1}var b=a.prototype;b.$6=function(){var a=this;if(this.$3){var b;(b=d("DGWLoggingContext")).DGWLoggingContext.bumpODSKey(b.DGWLoggingComponent.PINGER,"timeout_fired.reset");this.$3=!1;this.$4();b.DGWLoggingContext.bumpODSKey(b.DGWLoggingComponent.PINGER,"timeout.newtimeout");this.$2=window.setTimeout(function(){a.$6()},this.$1)}else d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"timeout_fired.disconnect"),this.$5()};b.reset=function(){var a=this;this.$3=!0;this.$2&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"reset"),window.clearTimeout(this.$2),this.$2=null);this.$1>0&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"reset.newtimeout"),this.$2=window.setTimeout(function(){a.$6()},this.$1))};b.cancel=function(){this.$2&&(d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.PINGER,"canceled"),window.clearTimeout(this.$2),this.$2=null)};return a}();g.DGWPinger=a}),98);
__d("DGWStreamGroupCallbacks",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";var g=b("$InternalEnum")({TRANSPORT_SERVER_INTERNAL_ERROR:0,TRANSPORT_ABNORMAL_CLOSURE:1,TRANSPORT_GOING_AWAY:2,TRANSPORT_UNKNOWN_ERROR:3,TRANSPORT_KEEPALIVE_TIMEOUT:4,TRANSPORT_UNAUTHORIZED:5,TRANSPORT_REJECTED:6,TRANSPORT_BAD_REQUEST:7,TRANSPORT_DGW_SERVER_ERROR:8,TRANSPORT_NORMAL_CLOSURE:9});function a(a){switch(a){case g.TRANSPORT_UNAUTHORIZED:return!1;default:return!0}}c=function(){function a(){}var b=a.prototype;b.onStreamGroupError=function(){};b.onStreamGroupMustDrain=function(){};b.onStreamGroupTransportClose=function(){};return a}();f.DGWStreamGroupError=g;f.isRetryableError=a;f.NoOpDGWStreamGroupCallbacks=c}),66);
__d("DGWTransportEvents",["DGWLoggingContext","NetworkStatus"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$3=a}var b=a.prototype;b.transportEstablished=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"open",a),this.$2=Date.now(),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_success")};b.transportPingSent=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Ping Frame Sent",a,!0)};b.transportPongReceived=function(a){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Pong Frame Received",a,!0)};b.transportEstablishmentPending=function(){this.$1=Date.now(),this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transportPending",null,!0),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_pending")};b.transportClosed=function(a,b,c){this.$4=Date.now(),a?(this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_graceful"),this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed gracefully",null,!0)):(this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"transport_close_with_error"),this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Transport closed abnormally",b,c))};b.transportEstablishmentFailure=function(a){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"WebSocket transport establishment failure","WebSocket close code: "+a.code+" reason: "+a.reason+" wasClean: "+String(a.wasClean)),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_group_establishment_failure")};b.streamEstablishmentTimeout=function(a,b,e){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment timeout",a,"streamId:"+b+", onLine:"+String(c("NetworkStatus").isOnline()),!1,e),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_timeout")};b.streamEstablishmentPending=function(a,b){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment pending","streamId:"+a,!0,b),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_pending")};b.streamEstablishmentSuccess=function(a,b){this.$3.logEvent(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Grouped Stream establishment success","streamId:"+a,!0,b),this.$3.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"stream_establishment_success")};b.transportError=function(a,b,c){this.$3.logError(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,a,b,c)};b.receivedFrameForInactiveStream=function(a,b,c){this.$3.logWarn(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Frame received for inactive stream","frameType: "+a+", streamID: "+b,c)};b.ranOutOfStreamIds=function(a){this.$3.logWarn(d("DGWLoggingContext").DGWLoggingComponent.WEBSOCKET_TRANSPORT_COMPONENT,"Hit max StreamId limit","Hit max StreamId limit",a)};return a}();g.DGWTransportEvents=a}),98);
__d("DGWWebSocketTransport",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=new WebSocket(a);a.binaryType="arraybuffer";a.onopen=function(){};a.onclose=function(){};a.onerror=function(){};return a}f.getWebSocketConnection=a}),66);
__d("DGWStreamEvents",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$4=new Map(),this.$5=new Map(),this.$6=a,this.$1=b,c!=null&&(this.$8="streamId:"+c+"::")}var b=a.prototype;b.dataSent=function(a,b,c){var d=b?"sendWithAckRequested":"sendWithoutAckRequested";this.$6.logEvent(this.$1,d,((d=this.$8)!=null?d:"")+"sendId:"+c+", payloadSize:"+a,!0);this.$4.set(c,{ackRequested:b,payloadSize:a,sendTimestamp:Date.now()})};b.ackReceived=function(a){var b;this.$6.logEvent(this.$1,"AckReceived",((b=this.$8)!=null?b:"")+"sendId:"+a,!0);this.$6.bumpODSKey(this.$1,"ack_received");b=this.$4.get(a);b!=null&&(b.ackReceivedTimestamp=Date.now())};b.ackSent=function(a){var b;this.$6.bumpODSKey(this.$1,"ack_sent");this.$6.logEvent(this.$1,"ACK sent",((b=this.$8)!=null?b:"")+"ackId:"+a,!0)};b.drainSent=function(a){var b;this.$6.logEvent(this.$1,"Drain sent",((b=this.$8)!=null?b:"")+"drainReason: "+a)};b.dataReceived=function(a,b,c){var d;this.$6.bumpODSKey(this.$1,"data_received");this.$6.logEvent(this.$1,"Data received",((d=this.$8)!=null?d:"")+"sendId:"+(c!=null?c:"null")+", ackRequested:"+b.toString()+", payloadSize:"+a,!0);c!=null&&this.$5.set(c,{ackRequested:b,payloadSize:a,receiveTimestamp:Date.now()})};b.endOfDataReceived=function(){this.$6.bumpODSKey(this.$1,"end_of_data_received"),this.$6.logEvent(this.$1,"EndOfDataReceived",this.$8,!0)};b.endOfDataSent=function(){this.$6.bumpODSKey(this.$1,"end_of_data_sent"),this.$6.logEvent(this.$1,"EndOfDataSent",this.$8,!0)};b.streamClosed=function(a,b){this.$7=Date.now();var c=this.$9();if(a){this.$6.bumpODSKey(this.$1,"stream_closed_gracefully");this.$6.logEvent(this.$1,"Stream closed gracefully",""+((a=this.$8)!=null?a:"")+c)}else{this.$6.bumpODSKey(this.$1,"stream_closed_with_error");this.$6.logError(this.$1,"Stream closed abnormally",b,""+((a=this.$8)!=null?a:"")+c)}};b.connectionEstablishmentFailure=function(a){this.$6.logEvent(this.$1,"WebSocket connection establishment failure","WebSocket close code: "+a)};b.streamEstablishmentFailure=function(a,b){this.$6.logError(this.$1,"Failed to establish DGW Stream","Last seen error: "+a.toString(),""+((a=this.$8)!=null?a:"")+b);this.$6.bumpODSKey(this.$1,"stream_establishment_failure")};b.error=function(a,b){b={msg:b,state:this.$9()};this.$6.logError(this.$1,a,JSON.stringify(b),this.$8)};b.$9=function(){var a={currentNetworkCondition:window.navigator&&window.navigator.onLine===!0,establishRequestTimestamp:this.$2,establishedTimestamp:this.$3,streamClosedTimestamp:this.$7,sendHistory:JSON.stringify(Array.from(this.$4.entries())),receiveHistory:JSON.stringify(Array.from(this.$5.entries()))};return JSON.stringify(a)};return a}();f.DGWStreamEvents=a}),66);
__d("GroupedStream",["DGWAckManager","DGWConstants","DGWLoggingContext","DGWStream","DGWStreamEvents","QuickPerformanceLogger","Random","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(701242292,"2919");a=function(){function a(a,b,e,f,g,j,k){this.$1=a,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=b,this.$7=e,this.$8=f,this.$2=j,this.$9=g,this.$10=new(d("DGWAckManager").DGWAckManager)(this.$9),this.$12=new(d("DGWStreamEvents").DGWStreamEvents)(this.$9,d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,this.$1),this.$11=0,this.$13=k,this.$14=Date.now()+(Math.round(d("Random").random()*1e4)+1e4),(h||(h=c("QuickPerformanceLogger"))).markerStart(i,this.$14)}var e=a.prototype;e.send=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=this.$11++%d("DGWConstants").MAX_ACK_ID;a=this.$15(a,!0,c);if(!this.$16(a,!0,c))return!1;a=(yield this.$10.waitForAck(c,b!=null?b:d("DGWConstants").DEFAULT_ACK_TIMEOUT_MS));return a});function c(b,c){return a.apply(this,arguments)}return c}();e.sendFrame=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=this.$11++%d("DGWConstants").MAX_ACK_ID;b=this.$15(b,!0,e);if(b==null)return!1;var f=new Uint8Array(a.length+b.length);f.set(a);f.set(b,a.length);if(!this.$16(f,!0,e))return!1;b=(yield this.$10.waitForAck(e,c!=null?c:d("DGWConstants").DEFAULT_ACK_TIMEOUT_MS));return b});function c(b,c,d){return a.apply(this,arguments)}return c}();e.sendAndForget=function(a){a=this.$15(a,!1,0);return this.$16(a,!1,0)};e.sendFrameAndForget=function(a,b){b=this.$15(b,!1,0);if(b==null)return!1;var c=new Uint8Array(a.length+b.length);c.set(a);c.set(b,a.length);return this.$16(c,!1,0)};e.close=function(){var a=this.$2.encodeEndOfData(this.$1);if(a==null){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode EndOfData","streamId: "+this.$1);return}a=this.$8.send(a);if(!a){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send EndOfData","streamId: "+this.$1+". StreamGroupTransport not open during send");return}this.$12.endOfDataSent();this.$5=!0;this.$4&&this.$17()};e.loggingContext=function(){return this.$9};e.__sendDrain=function(a){var b=d("DGWConstants").drainReasonToDrainReasonString(a);if(this.$5)return!1;a=this.$2.encodeDrain(a);if(a==null)return!1;this.$12.drainSent(b);b=this.$8.send(a);return b};e.__transportCloseHook=function(a){this.$13(),this.$10.clearPendingAcks(),a?(this.$12.error("Received StreamError","StreamErrorType: "+a),this.$6.onError(a)):this.$5&&this.$4?this.$17():(this.$12.streamClosed(!1,"Stream closed: ClosedLocally: "+this.$5.toString()+", EndOfDataReceived: "+this.$4.toString()),this.$6.onError(d("DGWStream").StreamError.PREMATURE_CLOSE))};e.$17=function(){this.$13(),this.$12.streamClosed(!0,"Graceful close"),this.$6.onClose(this)};e.__dataReceivedHook=function(a,b){this.$12.dataReceived(a.length,b!=null,b),b!=null&&this.$18(b),this.$6.onDataReceived(a)};e.__ackReceivedHook=function(a){this.$12.ackReceived(a),this.$10.handleAckReceived(a)};e.__drainReceivedHook=function(a){this.$3===!1&&(this.$6.onStreamMustDrain(this,a),this.$3=!0)};e.__endOfDataHook=function(){this.$12.endOfDataReceived(),this.$4=!0,this.$5?this.$17():this.$6.onServerHasFinishedSendingData(this)};e.__markerPoint=function(a){var b=this.$14;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,a,{instanceKey:b})};e.__markerAnnotate=function(a){var b=this.$14;(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,a,{instanceKey:b})};e.__endMarker=function(a){(h||(h=c("QuickPerformanceLogger"))).markerEnd(i,a,this.$14)};e.$15=function(a,b,c){return this.$2.encodeData(a,b,c,this.$1)};e.$16=function(a,b,c){this.__markerPoint("send_data_start");if(this.$5){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","Stream closed locally");return!1}if(a==null)return!1;var e=this.$8.send(a);if(!e){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send data","ClosedLocally: "+this.$5.toString());return!1}this.__markerPoint("send_data_end");this.$12.dataSent(a.length,b,c);return!0};e.$18=function(a){var b=this.$2.encodeAck(a,this.$1);if(b==null){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to encode ACK","ackId: "+a);return!1}b=this.$8.send(b);if(!b){this.$9.logError(d("DGWLoggingContext").DGWLoggingComponent.GROUPED_STREAM_COMPONENT,"Failed to send ACK","ackId: "+a);return!1}this.$12.ackSent(a);return!0};return a}();g.GroupedStream=a}),98);
__d("StreamIdGenerator",["err"],(function(a,b,c,d,e,f,g){"use strict";var h=65535;a=function(){function a(){this.$1=new Set(),this.$2=0}var b=a.prototype;b.getNextStreamId=function(){var a;if(!this.streamIdAvailable())throw c("err")("Max number of stream IDs reached");if(this.$2<=h)return this.$2++;a=(a=this.$1.values().next().value)!=null?a:0;this.$1["delete"](a);return a};b.putBackStreamId=function(a){this.$1.add(a)};b.streamIdAvailable=function(){return this.$1.size>0||this.$2<=h};return a}();g.MAX_STREAM_ID=h;g.StreamIdGeneratorImpl=a}),98);
__d("StreamGroupWebSocketTransport",["DGWConstants","DGWExponentialBackoff","DGWLoggingContext","DGWPinger","DGWStream","DGWStreamGroupCallbacks","DGWTransportEvents","DGWUtils","DGWWebSocketTransport","GroupedStream","Promise","QuickPerformanceLogger","Random","StreamIdGenerator","asyncToGeneratorRuntime","err","gkx","qex","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("qpl")._(701238781,"3037"),k=c("gkx")("12124"),l=(a=c("qex")._("4494"))!=null?a:20,m=(e=c("qex")._("4495"))!=null?e:!1,n=(f=c("qex")._("4807"))!=null?f:!1,o=function(a,b,c,e,f){var g=this;this.groupedStream=a;this.$1=window.setTimeout(function(){c(d("DGWStream").StreamError.ESTABLISHMENT_TIMEOUT)},e);this.handleEstablishFrameReceived=function(){window.clearTimeout(g.$1),b(g.groupedStream)};this.abortStream=function(a){f(),c(a)}};a=function(){function a(b,e,f,g,h,k,l,m){var n=this;this.$18=-1;this.$15=h;this.$17=this.__getStreamIdGenerator();this.$5=new Map();this.$6=new Map();this.$7=g.keepAliveMs;this.$8=!1;this.$9=!1;this.$3=!0;this.$4=!1;this.$21=!1;this.$22=!1;this.$13=f;this.$11=new TextEncoder();this.$12=new TextDecoder();this.$14=g;h={onDataReceived:function(){},handleAckReceived:function(){},receivedDrainSignal:function(a){n.$9||(n.$9=!0,n.$15(),n.$13.transportClosed(!0,""),n.$14.streamGroupCallbacks.onStreamGroupMustDrain(a),n.$5.forEach(function(b){b.__drainReceivedHook(a)}),n.onClose(d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE))},onGroupedStreamDataReceived:function(a,b,c){if(n.$5.has(a)){var d=n.$5.get(a);d==null?void 0:d.__dataReceivedHook(b,c)}else n.$13.receivedFrameForInactiveStream("Data",a,"sendAckID: "+(c!=null?c:"null"))},onGroupedStreamAckReceived:function(a,b){if(n.$5.has(a)){var c=n.$5.get(a);c==null?void 0:c.__ackReceivedHook(b)}else n.$13.receivedFrameForInactiveStream("ACK",a,"ackId: "+(b!=null?b:"null"))},onGroupedStreamEndOfDataReceived:function(a){if(n.$5.has(a)){var b=n.$5.get(a);b==null?void 0:b.__endOfDataHook()}else n.$13.receivedFrameForInactiveStream("EndOfData",a)},onGroupedStreamEstablishStreamReceived:function(a,b){if(n.$6.has(a)){var c=n.$6.get(a);n.$6["delete"](a);b=JSON.parse(n.$12.decode(b));(b.code===void 0||b.code!==200)&&(c==null?void 0:c.abortStream(d("DGWStream").StreamError.ABNORMAL_CLOSURE));c==null?void 0:c.handleEstablishFrameReceived()}else n.$13.receivedFrameForInactiveStream("EstablishStream",a,"EstablishStream received for non-inflight stream")},onPingReceived:function(){var a=n.$2.encodePing();if(a==null)return;n.send(a)},onPongReceived:function(){n.$3=!1,n.$22||(n.$22=!0,n.__markerPoint("auth_success")),n.$13.transportPongReceived("readyState:"+n.$1.readyState+", bufferedAmount:"+n.$1.bufferedAmount)}};this.$2=new(d("DGWUtils").DGWCodec)(k,h,g.dgwVersion);this.$20=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);if(g.enableFirstStreamOnWsHandshake){if(l===void 0)throw c("err")("Missing grouped stream options");if(m===void 0)throw c("err")("Missing grouped stream callbacks");var o=this.$17.getNextStreamId();f=this.createEstablishStreamFrame(o,l);h=d("DGWUtils").DGWUtils.constructConnectUrl({appId:g.appId,appVersion:g.appVersion,authType:g.authType,deviceId:(k=g.deviceId)!=null?k:void 0,dgwVersion:g.dgwVersion,fbId:g.fbId,tier:g.tier,loggingId:(h=g.loggingId)!=null?h:void 0,headers:a.__prefixAppHeaders(g.headers),endpoint:g.connectEndpoint,serviceId:g.serviceId,regionHint:(k=g.regionHint)!=null?k:void 0,establishStreamFrame:f});this.$1=e(h);if(!h.includes(d("DGWConstants").HEADER_CONSTANTS.HEADER_ESTABLISH_STREAM_FRAME_BASE64))return;g=new(d("DGWLoggingContext").DGWLoggingContext)(this.$14.dgwVersion,l.loggingId,this.$14.serviceId,this.$14.fbId,this.$14.loggingId,l.disableFalcoLogging);k=this.__createGroupedStream(o,m,l,g);this.$16=this.waitForEstablishStream(o,k,l,function(a){n.$5.set(o,a)},function(){n.$17.putBackStreamId(o)})}else this.$1=e(b);(i||(i=c("QuickPerformanceLogger"))).markerStart(j,this.$20);this.__markerAnnotate({string:{serviceId:this.$14.serviceId,streamGroupId:this.$14.loggingId}})}var e=a.prototype;e.send=function(a){try{this.$1.send(a);return!0}catch(a){this.$13.transportError("Failed to send over transport","readyState: "+this.$1.readyState,a.toString());return!1}};e.close=function(){this.onClose()};e.onClose=function(a){var b;this.__markerPoint("abort");this.__markerAnnotate({"int":{abort_code:a!=null?a:0}});this.$8=!0;(b=this.$10)==null?void 0:b.cancel();this.$1.close(a)};e.abort=function(a,b,c,d,e){if(this.$8)return;this.$8=!0;this.$13.transportClosed(!1,d,e);this.$5.forEach(function(a){a.__transportCloseHook(b)});this.$6.forEach(function(a){a.abortStream(b)});this.$14.streamGroupCallbacks.onStreamGroupError(a);this.$5.clear();this.$6.clear();this.$15();this.onClose(c)};a.getTransportWithInitialStream=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c,e,f,g,h){yield d("DGWUtils").DGWCodec.initialize();var i=new(d("DGWTransportEvents").DGWTransportEvents)(f);i.transportEstablishmentPending();var j=function(){return a.$23("",e,i,g,f,b,c)};try{j=(yield d("DGWExponentialBackoff").callWithExponentialBackoff(j,h));h=j.$16!=null?j.$16:j.establishGroupedStream(c,b,new(d("DGWLoggingContext").DGWLoggingContext)(e.dgwVersion,b.loggingId,e.serviceId,e.fbId,e.loggingId,b.disableFalcoLogging));return{transport:j,streamPromise:h}}catch(a){throw a}});function e(a,b,d,e,f,g){return c.apply(this,arguments)}return e}();a.getTransport_DEPRECATED=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c,e,f,g){yield d("DGWUtils").DGWCodec.initialize();var h=new(d("DGWTransportEvents").DGWTransportEvents)(e);h.transportEstablishmentPending();var i=function(){return a.$23(b,c,h,f,e)};try{return yield d("DGWExponentialBackoff").callWithExponentialBackoff(i,g)}catch(a){throw a}});function e(a,b,d,e,f){return c.apply(this,arguments)}return e}();e.establishGroupedStream=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d,e,f,g,i){var j=this;g===void 0&&(g=!0);var k=this.getStreamId(),l=this.createEstablishStreamFrame(k,d);a=this.__createGroupedStream(k,a,d,e);a.__markerAnnotate({string:{serviceId:this.$14.serviceId,streamGroupId:this.$14.loggingId,streamId:d.streamTraceId}});i!=null&&a.__markerAnnotate(i);e=this.waitForEstablishStream(k,a,d,function(a){j.$5.set(k,a)},function(){j.$17.putBackStreamId(k)});if(f!=null){a.__markerPoint("send_payload_start");a.__markerAnnotate({"int":{establishStreamPayloadSize:f.byteLength}});i=g?yield a.sendFrame(l,f):a.sendFrameAndForget(l,f);if(!i){a.__endMarker(3);return(h||(h=b("Promise"))).reject("Failed to send data when establishing stream")}a.__markerPoint("send_payload_end");a.__endMarker(2);return(h||(h=b("Promise"))).resolve(a)}a.__markerPoint("send_establish_stream_start");if(!this.send(l)){a.__endMarker(3);throw c("err")("Websocket connection closed before stream established")}a.__markerPoint("send_establish_stream_end");d=(yield e);a.__endMarker(2);return d});function d(b,c,d,e,f,g){return a.apply(this,arguments)}return d}();a.__prefixAppHeaders=function(a){return Object.keys(a).reduce(function(b,c){b[""+d("DGWConstants").HEADER_CONSTANTS.APPHEADER_PREFIX+c]=a[c];return b},{})};e.waitForEstablishStream=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d,e,f){var g=this;this.$13.streamEstablishmentPending(a,d.loggingId);try{var i=(yield new(h||(h=b("Promise")))(function(b,d){g.$6.set(a,new o(c,b,d,3e4,function(){g.streamEndCallback(a)}))}));e(c);this.$13.streamEstablishmentSuccess(a,d.loggingId);return i}catch(b){f();this.$13.streamEstablishmentTimeout("Stream establishment timeout. readyState: "+this.$1.readyState,a,d.loggingId);throw b}});function c(b,c,d,e,f){return a.apply(this,arguments)}return c}();a.$23=function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c,e,f,g,h,i){var j=new a(b,d("DGWWebSocketTransport").getWebSocketConnection,e,c,f,g,h,i);j.$1.onmessage=a.$24(j);j.$1.onopen=function(){j.__markerPoint("onopen"),e.transportEstablished(b),j.$10!=null&&j.$10.cancel(),j.$7!=null&&(j.$10=new(d("DGWPinger").DGWPinger)(j.$7,function(){j.$25()},function(){if(n)j.abort(d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_KEEPALIVE_TIMEOUT,d("DGWStream").StreamError.KEEPALIVE_TIMEOUT,d("DGWConstants").WebsocketCloseCodes.KEEPALIVE_TIMEOUT,"Aborting transport because of keepalive timeout","readyState:"+j.$1.readyState+", bufferedAmount:"+j.$1.bufferedAmount);else if(j.$18===0&&k){var a;(a=j.$10)==null?void 0:a.reset()}else j.abort(d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_KEEPALIVE_TIMEOUT,d("DGWStream").StreamError.KEEPALIVE_TIMEOUT,d("DGWConstants").WebsocketCloseCodes.KEEPALIVE_TIMEOUT,"Aborting transport because of keepalive timeout","readyState:"+j.$1.readyState+", bufferedAmount:"+j.$1.bufferedAmount)}))};j.$1.onerror=function(){j.__markerPoint("onerror"),j.$13.transportError("onerror","readyState: "+j.$1.readyState)};j.$1.onclose=a.$26(j);c=(yield a.getTransportPromise(j));return c});function e(a,b,d,e,f,g,h){return c.apply(this,arguments)}return e}();a.getTransportPromise=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield new(h||(h=b("Promise")))(function(b,c){var e=a.$1.onerror,f=a.$1.onmessage,g=a.$1.onclose;a.$19=window.setTimeout(function(){a.$15(),a.$13.transportClosed(!1,"TIMEOUT"),a.__markerPoint("connect_timeout"),a.close(),c(d("DGWStream").StreamError.TRANSPORT_ESTABLISHMENT_TIMEOUT)},l*1e3);a.$1.onerror=function(){a.$19!=null&&(window.clearTimeout(a.$19),a.$19=null),e(),m||c(d("DGWStream").StreamError.TRANSPORT_ESTABLISHMENT_ERROR)};a.$1.onclose=function(b){a.$19!=null&&(window.clearTimeout(a.$19),a.$19=null),g(b),b.code===d("DGWConstants").WebsocketCloseCodes.UNAUTHORIZED?c(d("DGWStream").StreamError.UNAUTHORIZED):c(b.code+":"+b.reason)};a.$1.onmessage=function(c){f(c),a.$19!=null&&!a.$3&&(window.clearTimeout(a.$19),a.$19=null,a.__markerPoint("connect_success"),b(a))}}));return c});function c(b){return a.apply(this,arguments)}return c}();a.$24=function(a){return function(b){var c;a.$21||(a.$21=!0,a.__markerPoint("onmessage"));(c=a.$10)==null?void 0:c.reset();if(!(b.data instanceof ArrayBuffer)){a.$13.transportError("Incorrect Data Protocol","Received "+typeof b.data+" instead of ArrayBuffer");return}a.$2.append(new Uint8Array(b.data));a.$2.processData()}};a.$26=function(a){return function(b){var c;a.__markerPoint("onclose");a.__markerAnnotate({string:{reason:b.reason},"int":{code:b.code}});a.__endMarker(b.code===d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE?2:3);(c=a.$10)==null?void 0:c.cancel();if(a.$8===!0||a.$4)return;a.$8=!0;if(a.$3===!0){a.$13.transportEstablishmentFailure(b);a.$5.clear();a.$15();return}a.$15();a.$3=!0;if(b.code!==d("DGWConstants").WebsocketCloseCodes.GRACEFUL_CLOSE){a.$13.transportClosed(!1,"Websocket connection failure with code: "+b.code+" reason: "+b.reason+" wasClean: "+String(b.wasClean));c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;var e=d("DGWStream").StreamError.UNKNOWN_ERROR;switch(b.code){case d("DGWConstants").WebsocketCloseCodes.NORMAL_CLOSURE:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_NORMAL_CLOSURE;e=d("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case d("DGWConstants").WebsocketCloseCodes.ABNORMAL_CLOSURE:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_ABNORMAL_CLOSURE;e=d("DGWStream").StreamError.ABNORMAL_CLOSURE;break;case d("DGWConstants").WebsocketCloseCodes.SERVER_INTERNAL_ERROR:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=d("DGWStream").StreamError.SERVER_INTERNAL_ERROR;break;case d("DGWConstants").WebsocketCloseCodes.GOING_AWAY:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_GOING_AWAY;e=d("DGWStream").StreamError.GOING_AWAY;break;case d("DGWConstants").WebsocketCloseCodes.UNAUTHORIZED:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNAUTHORIZED;e=d("DGWStream").StreamError.UNAUTHORIZED;break;case d("DGWConstants").WebsocketCloseCodes.REJECTED:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_REJECTED;e=d("DGWStream").StreamError.REJECTED;break;case d("DGWConstants").WebsocketCloseCodes.BAD_REQUEST:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_BAD_REQUEST;e=d("DGWStream").StreamError.BAD_REQUEST;break;case d("DGWConstants").WebsocketCloseCodes.DGW_SERVER_ERROR:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_SERVER_INTERNAL_ERROR;e=d("DGWStream").StreamError.DGW_SERVER_ERROR;c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_DGW_SERVER_ERROR;break;default:c=d("DGWStreamGroupCallbacks").DGWStreamGroupError.TRANSPORT_UNKNOWN_ERROR;e=d("DGWStream").StreamError.UNKNOWN_ERROR;break}a.$14.streamGroupCallbacks.onStreamGroupError(c);a.$5.forEach(function(a){a.__transportCloseHook(e)});a.$6.forEach(function(a){a.abortStream(e)})}else a.$13.transportClosed(!0,""),a.$14.streamGroupCallbacks.onStreamGroupTransportClose(),a.$5.forEach(function(a){a.__transportCloseHook()}),a.$6.forEach(function(a){a.abortStream(d("DGWStream").StreamError.TRANSPORT_CLOSED_BEFORE_STREAM_INIT)});a.$5.clear();a.$6.clear()}};e.$25=function(){var a=this.$2.encodePing();if(a==null)throw c("err")("Failed to encode Ping Frame");var b=this.send(a);this.$18=this.$1.bufferedAmount;this.$13.transportPingSent("readyState:"+this.$1.readyState+", bufferedAmount:"+this.$18+", payloadSize:"+(a==null?void 0:a.byteLength)+", sent:"+String(b))};e.isClosedLocally=function(){return this.$3||this.$8||this.$4};e.streamEndCallback=function(a){this.$5["delete"](a),this.$6["delete"](a),this.$17.putBackStreamId(a)};e.canCreateGroupedStream=function(){return this.$17.streamIdAvailable()};e.createEstablishStreamFrame=function(b,e){var f=a.__prefixAppHeaders(e.groupedStreamHeaders);e.streamTraceId!=null&&(f[d("DGWConstants").HEADER_CONSTANTS.HEADER_STREAM_TRACE_ID]=e.streamTraceId);e=this.$2.encodeEstablishStream(b,new Uint8Array(this.$11.encode(JSON.stringify(f))));if(e==null){this.$17.putBackStreamId(b);throw c("err")("Failed to encode EstablishStreamFrame")}return e};e.getStreamId=function(){try{return this.$17.getNextStreamId()}catch(a){this.$13.ranOutOfStreamIds("inFlightGroupedStreamSize: "+this.$6.size+" groupedStreamSize: "+this.$5.size);throw a}};e.__createGroupedStream=function(a,b,c,e){var f=this;return new(d("GroupedStream").GroupedStream)(a,b,c,this,e,this.$2,function(){f.streamEndCallback(a)})};e.__getStreamIdGenerator=function(){return new(d("StreamIdGenerator").StreamIdGeneratorImpl)()};e.__markerPoint=function(a){var b=this.$20;(i||(i=c("QuickPerformanceLogger"))).markerPoint(j,a,{instanceKey:b})};e.__markerAnnotate=function(a){var b=this.$20;(i||(i=c("QuickPerformanceLogger"))).markerAnnotate(j,a,{instanceKey:b})};e.__endMarker=function(a){(i||(i=c("QuickPerformanceLogger"))).markerEnd(j,a,this.$20)};return a}();g.StreamGroupWebSocketTransport=a}),98);
__d("StreamGroup",["DGWConstants","DGWLoggingContext","DGWUtils","StreamGroupWebSocketTransport","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h={maxRetries:c("justknobx")._("2595"),baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)};a=function(){function a(a,b,c,e,f,g,h,i,j){this.$2=j;this.$1=j.getNewStreamGroupId();j=(j=h.overrideUrl)!=null?j:f;this.$5=null;this.$3={appId:a,appVersion:b,authType:c,deviceId:h.deviceId,dgwVersion:e,headers:h.streamGroupAppHeaders,tier:(f=h.serviceTier)!=null?f:d("DGWConstants").DEFAULT_SERVICE_TIER,connectEndpoint:j,fbId:g,loggingId:h.loggingId,serviceId:h.serviceId,streamGroupCallbacks:i,keepAliveMs:h.keepAliveMs,regionHint:h.regionHint,enableFirstStreamOnWsHandshake:!1};this.$4=h;this.streamGroupLoggingContext=new(d("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,null,this.$3.serviceId,this.$3.fbId,this.$4.loggingId,!1,(a=h.verboseLoggingEnabled)!=null?a:!1);this.$6=d("DGWUtils").DGWUtils.constructConnectUrl({appId:this.$3.appId,appVersion:this.$3.appVersion,authType:this.$3.authType,deviceId:(b=this.$3.deviceId)!=null?b:void 0,dgwVersion:this.$3.dgwVersion,fbId:this.$3.fbId,headers:babelHelpers["extends"]({},this.$3.headers),loggingId:(c=this.$3.loggingId)!=null?c:void 0,tier:this.$3.tier,serviceId:this.$3.serviceId,endpoint:this.$3.connectEndpoint,regionHint:(e=this.$3.regionHint)!=null?e:void 0,trafficTracing:(f=this.$4.trafficTracing)!=null?f:void 0})}var c=a.prototype;c.initTransport=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=this,a={maxRetries:0,baseRetryInterval:1e3,backoffFactor:Math.sqrt(2)};this.$5=this.$5||d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport_DEPRECATED(this.$6,this.$3,this.streamGroupLoggingContext,function(){b.$2.removeStreamGroupAndTransport(b.$1)},a);var c;try{c=(yield this.$5),this.$5=null}catch(a){this.$5=null;throw a}this.$2.containsStreamGroup(this.$1)||this.$2.setStreamGroupAndTransport(this.$1,c);return c});function c(){return a.apply(this,arguments)}return c}();c.establishStream=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g=this;if(this.$2.containsStreamGroup(this.$1)===!1){this.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"createTransportWhenEstablishStream");if(!this.$3.enableFirstStreamOnWsHandshake){this.$5=this.$5||d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransport_DEPRECATED(this.$6,this.$3,this.streamGroupLoggingContext,function(){g.$2.removeStreamGroupAndTransport(g.$1)},h);var i;try{i=(yield this.$5),this.$5=null}catch(a){this.$5=null;throw a}this.$2.containsStreamGroup(this.$1)||this.$2.setStreamGroupAndTransport(this.$1,i)}else{var j=(yield d("StreamGroupWebSocketTransport").StreamGroupWebSocketTransport.getTransportWithInitialStream(a,b,this.$3,this.streamGroupLoggingContext,function(){g.$2.removeStreamGroupAndTransport(g.$1)},h));this.$2.setStreamGroupAndTransport(this.$1,j.transport);return j.streamPromise}}return this.establishStreamWithTransport(a,b,c,e,f)});function c(b,c,d,e,f){return a.apply(this,arguments)}return c}();c.establishStreamWithTransport=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){var g=a.loggingId;this.streamGroupLoggingContext.logEvent(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,"Establishing Grouped Stream","initialData:"+String(c!=null),!0,g);g=(yield this.$2.getStreamGroupTransport(this.$1).establishGroupedStream(b,a,new(d("DGWLoggingContext").DGWLoggingContext)(this.$3.dgwVersion,g,this.$3.serviceId,this.$3.fbId,this.$3.loggingId,a.disableFalcoLogging,(b=a.verboseLoggingEnabled)!=null?b:!1),c,e,f));return g});function c(b,c,d,e,f){return a.apply(this,arguments)}return c}();c.canCreateGroupedStream=function(){var a=!0;if(this.$2.containsStreamGroup(this.$1)!==!1){var b=this.$2.getStreamGroupTransport(this.$1);a=b.canCreateGroupedStream()}d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.STREAM_GROUP_COMPONENT,a?"can_create":"cannot_create");return a};c.close=function(){var a=this.$2.getStreamGroupTransport(this.$1);a.close()};return a}();g.StreamGroup=a}),98);
__d("StreamGroupRegistry",["Random","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=new Map(),this.$2=new Set()}var b=a.prototype;b.setStreamGroupAndTransport=function(a,b){this.$1.set(a,b)};b.containsStreamGroup=function(a){return this.$1.has(a)};b.removeStreamGroupAndTransport=function(a){this.$1["delete"](a)};b.getStreamGroupTransport=function(a){a=this.$1.get(a);if(a==null)throw c("err")("No stream group transport");return a};b.getNewStreamGroupId=function(){var a=d("Random").uint32();while(this.$2.has(a))a=d("Random").uint32();this.$2.add(a);return a};return a}();g.StreamGroupRegistry=a}),98);
__d("RawDGWClient",["CurrentUser","DGWLoggingContext","DGWStream","StreamGroup","StreamGroupRegistry","isFastRefreshEnabledForCurrentDomain"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=a.appId,c=a.appVersion,e=a.authType,f=a.dgwVersion,g=a.endpoint;a=a.fbId;this.$1=b;this.$2=c;this.$3=e;this.$4=f;this.$5=g;this.$6=a;this.$7=new(d("StreamGroupRegistry").StreamGroupRegistry)()}var b=a.prototype;b.createStreamGroup=function(a,b){this.handleUserChecks();return new(d("StreamGroup").StreamGroup)(this.$1,this.$2,this.$3,this.$4,this.$5,this.$6,b,a,this.$7)};b.handleUserChecks=function(){if(!c("CurrentUser").isLoggedInNow()&&!c("isFastRefreshEnabledForCurrentDomain")()){d("DGWLoggingContext").DGWLoggingContext.bumpODSKey(d("DGWLoggingContext").DGWLoggingComponent.RAW_CLIENT,"unauthenticated");throw d("DGWStream").StreamError.UNAUTHENTICATED}};return a}();g.RawDGWClient=a}),98);
__d("DGWClient",["DGWAuth","DGWEnvUtil","DGWWebConfig","RawDGWClient","err"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("RawDGWClient").RawDGWClient)({appId:c("DGWWebConfig").appId,appVersion:c("DGWWebConfig").appVersion,authType:d("DGWAuth").fromStringToDGWAuth(c("DGWEnvUtil").getDGWAuthType()),dgwVersion:c("DGWEnvUtil").getDGWVersion(),endpoint:c("DGWEnvUtil").getDGWEndpoint(),fbId:c("DGWWebConfig").fbId});function a(){if(c("DGWEnvUtil").isDGWEnvCompatible())return h;else throw c("err")("unsupported_environment_retry_with_mqtt")}g["default"]=a}),98);
__d("DGWRequestStreamUtils",["Base64","WebDriverConfig","cr:3024","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a,d,e,f){var g={};for(a of Object.entries(a)){var h=a[0],i=a[1];typeof i=="string"?g["XRSS-"+h]=i:typeof i=="number"?g["XRSN-"+h]=i.toString():typeof i=="boolean"?g["XRSB-"+h]=i.toString():typeof i=="object"&&i!=null&&(g["XRSO-"+h]=c("Base64").encode(JSON.stringify(i)))}d&&(g["xrs-body"]="true");e!=null&&e.length>0&&(g["xrs-instrumentation"]=c("Base64").encode(e));g["XRS-Accept-Ack"]="RSAck";f!=null&&f.ackTimeoutSec!=null&&(g["XRS-SRAck-Timeout"]=f.ackTimeoutSec.toString());g["XRSS-http_referer"]=window.location.href;if(c("WebDriverConfig").isTestRunning&&c("gkx")("20919")){h=b("cr:3024")==null?void 0:b("cr:3024").get();h!=null&&(g["XRSB-is_test"]="true",g["XRSS-original_request_id"]=h)}return g}function h(a){return Object.keys(a).reduce(function(b,c){(typeof a[c]==="string"||typeof a[c]==="boolean"||typeof a[c]==="number"||typeof a[c]==="object")&&(b[c]=a[c]);return b},{})}function d(a){if(a.response&&a.response.instrumentation_data!=null&&a.response.instrumentation_data.length>0)try{a=JSON.parse(new TextDecoder("utf-8").decode(a.response.instrumentation_data));return{auxId:a.auxId,dfTraceId:(a=a.dataFlowTracingData)==null?void 0:a.traceId}}catch(a){}return null}function e(a,b){var c=a.headers;a=a.body;b.kill_body===!0&&(a=null);b.new_body!=null&&(a=b.new_body);if(b.new_headers!=null)try{c=h(JSON.parse(b.new_headers))}catch(a){}if(b.patch_headers!=null)try{c=babelHelpers["extends"]({},c,{},h(JSON.parse(b.patch_headers)))}catch(a){}return{headers:c,body:a}}g.convertHeaders=a;g.cleanHeaders=h;g.getInstrumentationDataFieldsFromPayload=d;g.transformContextWithRewriteDelta=e}),98);
__d("DGWStreamHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c,d,e){this.$2=a,this.$3=b,this.$4=c,this.$5=d,this.$6=e,this.$1=!0}var b=a.prototype;b.onClose=function(a){if(!this.$1)return;this.$2(a)};b.onDataReceived=function(a){if(!this.$1)return;this.$3(a)};b.onError=function(a){if(!this.$1)return;this.$4(a)};b.onStreamMustDrain=function(a,b){if(!this.$1)return;this.$5(a,b)};b.onServerHasFinishedSendingData=function(a){if(!this.$1)return;this.$6(a)};b.stop=function(){this.$1=!1};b.isStopped=function(){return!this.$1};return a}();f["default"]=a}),66);
__d("InflightAmends",["Deferred","err"],(function(a,b,c,d,e,f,g){"use strict";var h="inflight_amends_timeout",i="inflight_amends_duplicate_id";a=function(){function a(a,b,c){this.$1=a,this.$3=b,this.$4=c,this.$2=new Map()}var b=a.prototype;b.add=function(a){var b=this;if(this.$2.has(a))throw c("err")(i);var d=new(c("Deferred"))(),e=Date.now(),f=setTimeout(function(){b.$2.has(a)&&b.reject(a,c("err")(h))},this.$1);this.$2.set(a,{id:a,deferred:d,createdTimestampMs:e,timeoutId:f});return d.getPromise()};b.getPromise=function(a){return(a=this.$5(a))==null?void 0:a.deferred.getPromise()};b.resolve=function(a,b){a=this.$5(a);a&&(a.deferred.resolve==null?void 0:a.deferred.resolve(b),this.$3(a.id,Date.now()-a.createdTimestampMs),this.$6(a))};b.reject=function(a,b){a=this.$5(a);a&&(a.deferred.reject==null?void 0:a.deferred.reject(b),this.$4(a.id,b),this.$6(a))};b.rejectAll=function(a){for(var b of this.$2.entries()){var c=b[0];b[1];this.reject(c,a)}};b.getSize=function(){return this.$2.size};b.getAllPromises=function(){var a=[];for(var b of this.$2.values())a.push(b.deferred.getPromise());return a};b.$6=function(a){clearTimeout(a.timeoutId),this.$2["delete"](a.id)};b.$5=function(a){return this.$2.get(a)};return a}();g["default"]=a}),98);
__d("RequestStreamCloseReason",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UserIntention","StartStreamFailure","StreamError","RemoteTermination","ServerDataEnd","ServerDrain","ReestablishError","ClientError"]);f.RequestStreamCloseReason=a}),66);
__d("RequestStreamCommonRequestStreamCommonSerializers",["RequestStreamCommonRequestStreamCommonTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{}}function b(){return{expected_existing_headers:"",patch_headers_if_match:""}}function e(){return{bytes:Uint8Array.of()}}function f(){return{message:""}}function i(){return{reason:d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0)}}function j(){return{}}function k(){return{stream_id:"0",last_sequencer:0,amendment_count:0,last_status:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0)}}function l(){return{caller_timestamp_ms:"0"}}function m(){return{original_ping_timestamp_ms:"0"}}function n(){return{}}function o(a,b){b.writeStructBegin("ResponseRewriteRequest"),a.new_headers!=null&&(b.writeFieldBegin({fname:"new_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1}),b.writeString(a.new_headers),b.writeFieldEnd()),a.new_body!=null&&(b.writeFieldBegin({fname:"new_body",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.new_body),b.writeFieldEnd()),a.patch_headers!=null&&(b.writeFieldBegin({fname:"patch_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeString(a.patch_headers),b.writeFieldEnd()),a.kill_body!=null&&(b.writeFieldBegin({fname:"kill_body",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:4}),b.writeBool(a.kill_body),b.writeFieldEnd()),a.temporary!=null&&(b.writeFieldBegin({fname:"temporary",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:5}),b.writeBool(a.temporary),b.writeFieldEnd()),a.conditional_patch_headers!=null&&(b.writeFieldBegin({fname:"conditional_patch_headers",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6}),p(a.conditional_patch_headers,b),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function p(a,b){b.writeStructBegin("ResponseRewriteConditionalPatchHeaders");b.writeFieldBegin({fname:"expected_existing_headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.expected_existing_headers!=null)b.writeString(a.expected_existing_headers);else{var d="";b.writeString(d)}b.writeFieldEnd();b.writeFieldBegin({fname:"patch_headers_if_match",ftype:h.STRING,fid:2});if(a.patch_headers_if_match!=null)b.writeString(a.patch_headers_if_match);else{d="";b.writeString(d)}b.writeFieldEnd();a.patch_headers_otherwise!=null&&(b.writeFieldBegin({fname:"patch_headers_otherwise",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeString(a.patch_headers_otherwise),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function q(a,b){b.writeStructBegin("ResponseData");b.writeFieldBegin({fname:"bytes",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.bytes!=null)b.writeBinary(a.bytes);else{var d=Uint8Array.of();b.writeBinary(d)}b.writeFieldEnd();a.metadata!=null&&(b.writeFieldBegin({fname:"metadata",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeString(a.metadata),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function r(a,b){b.writeStructBegin("LogMessage");b.writeFieldBegin({fname:"message",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.message!=null)b.writeString(a.message);else{a="";b.writeString(a)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function s(a,b){b.writeStructBegin("Termination");b.writeFieldBegin({fname:"reason",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});if(a.reason!=null){var e;b.writeI32((e=a.reason)!=null?e:0)}else{e=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0);b.writeI32(e!=null?e:0)}b.writeFieldEnd();a.message!=null&&(b.writeFieldBegin({fname:"message",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeString(a.message),b.writeFieldEnd());a.retry_delay_ms!=null&&(b.writeFieldBegin({fname:"retry_delay_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:3}),b.writeI64(c("jsbi").BigInt(a.retry_delay_ms)),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function t(a,b){b.writeStructBegin("AmendStreamAck"),a.amendment_id!=null&&(b.writeFieldBegin({fname:"amendment_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.amendment_id)),b.writeFieldEnd()),a.accepted!=null&&(b.writeFieldBegin({fname:"accepted",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:2}),b.writeBool(a.accepted),b.writeFieldEnd()),a.result!=null&&(b.writeFieldBegin({fname:"result",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeBinary(a.result),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function u(a,b){b.writeStructBegin("StreamCheck");b.writeFieldBegin({fname:"stream_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.stream_id!=null)b.writeI64(c("jsbi").BigInt(a.stream_id));else{var e="0";b.writeI64(c("jsbi").BigInt(e))}b.writeFieldEnd();b.writeFieldBegin({fname:"last_sequencer",ftype:h.I32,fid:2});if(a.last_sequencer!=null)b.writeI32(a.last_sequencer);else{e=0;b.writeI32(e)}b.writeFieldEnd();b.writeFieldBegin({fname:"amendment_count",ftype:h.I32,fid:4});if(a.amendment_count!=null)b.writeI32(a.amendment_count);else{e=0;b.writeI32(e)}b.writeFieldEnd();b.writeFieldBegin({fname:"last_status",ftype:h.I32,fid:3});if(a.last_status!=null){b.writeI32((e=a.last_status)!=null?e:0)}else{a=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0);b.writeI32(a!=null?a:0)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function v(a,b){b.writeStructBegin("Ping");b.writeFieldBegin({fname:"caller_timestamp_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.caller_timestamp_ms!=null)b.writeI64(c("jsbi").BigInt(a.caller_timestamp_ms));else{var d="0";b.writeI64(c("jsbi").BigInt(d))}b.writeFieldEnd();if(a.streams_to_check!=null){b.writeFieldBegin({fname:"streams_to_check",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});b.writeListBegin({etype:h.STRUCT,size:a.streams_to_check.length});for(d of a.streams_to_check)u(d,b);b.writeListEnd();b.writeFieldEnd()}b.writeFieldStop();b.writeStructEnd()}function w(a,b){b.writeStructBegin("Pong");b.writeFieldBegin({fname:"original_ping_timestamp_ms",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1});if(a.original_ping_timestamp_ms!=null)b.writeI64(c("jsbi").BigInt(a.original_ping_timestamp_ms));else{var d="0";b.writeI64(c("jsbi").BigInt(d))}b.writeFieldEnd();if(a.stream_ids_missing!=null){b.writeFieldBegin({fname:"stream_ids_missing",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});b.writeListBegin({etype:h.I64,size:a.stream_ids_missing.length});for(d of a.stream_ids_missing)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_behind!=null){b.writeFieldBegin({fname:"stream_ids_behind",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:3});b.writeListBegin({etype:h.I64,size:a.stream_ids_behind.length});for(d of a.stream_ids_behind)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_with_lost_amendments!=null){b.writeFieldBegin({fname:"stream_ids_with_lost_amendments",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:4});b.writeListBegin({etype:h.I64,size:a.stream_ids_with_lost_amendments.length});for(d of a.stream_ids_with_lost_amendments)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}if(a.stream_ids_with_wrong_status!=null){b.writeFieldBegin({fname:"stream_ids_with_wrong_status",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:5});b.writeListBegin({etype:h.I64,size:a.stream_ids_with_wrong_status.length});for(d of a.stream_ids_with_wrong_status)b.writeI64(c("jsbi").BigInt(d));b.writeListEnd();b.writeFieldEnd()}b.writeFieldStop();b.writeStructEnd()}function x(a,b){b.writeStructBegin("StreamResponseDelta");if(a.flow_status!=null){var d;b.writeFieldBegin({fname:"flow_status",ftype:(h||(h=c("ThriftTypes"))).I32,fid:1});b.writeI32((d=a.flow_status)!=null?d:0);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.log!=null){b.writeFieldBegin({fname:"log",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:2});r(a.log,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.rewrite!=null){b.writeFieldBegin({fname:"rewrite",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:3});o(a.rewrite,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.data!=null){b.writeFieldBegin({fname:"data",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:4});q(a.data,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.termination!=null){b.writeFieldBegin({fname:"termination",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:5});s(a.termination,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.amend_ack!=null){b.writeFieldBegin({fname:"amend_ack",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6});t(a.amend_ack,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}b.writeFieldStop();b.writeStructEnd()}function y(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.new_headers=a.readString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.new_body=a.readBinary():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers=a.readString():a.skip(e);break;case 4:e===(h||(h=c("ThriftTypes"))).BOOL?b.kill_body=a.readBool():a.skip(e);break;case 5:e===(h||(h=c("ThriftTypes"))).BOOL?b.temporary=a.readBool():a.skip(e);break;case 6:e===(h||(h=c("ThriftTypes"))).STRUCT?b.conditional_patch_headers=z(a):a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function z(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.expected_existing_headers=a.readString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers_if_match=a.readString():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.patch_headers_otherwise=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.expected_existing_headers===void 0&&(b.expected_existing_headers="");b.patch_headers_if_match===void 0&&(b.patch_headers_if_match="");return b}function A(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.bytes=a.readBinary():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.metadata=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.bytes===void 0&&(b.bytes=Uint8Array.of());return b}function B(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.message=a.readString():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.message===void 0&&(b.message="");return b}function C(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I32?b.reason=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(a.readI32()):a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).STRING?b.message=a.readString():a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I64?b.retry_delay_ms=a.readI64().toString():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.reason===void 0&&(b.reason=d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.cast(0));return b}function D(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).BOOL?b.accepted=a.readBool():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).STRING?b.result=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function E(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.stream_id=a.readI64().toString():a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).I32?b.last_sequencer=a.readI32():a.skip(f);break;case 4:f===(h||(h=c("ThriftTypes"))).I32?b.amendment_count=a.readI32():a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I32?b.last_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()):a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.stream_id===void 0&&(b.stream_id="0");b.last_sequencer===void 0&&(b.last_sequencer=0);b.amendment_count===void 0&&(b.amendment_count=0);b.last_status===void 0&&(b.last_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(0));return b}function F(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.caller_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===(h||(h=c("ThriftTypes"))).LIST){b.streams_to_check=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=E(a);b.streams_to_check.push(g)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.caller_timestamp_ms===void 0&&(b.caller_timestamp_ms="0");return b}function G(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.original_ping_timestamp_ms=a.readI64().toString():a.skip(e);break;case 2:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_missing=[];d=a.readListBegin();for(var f=0;f<d.size;f++){var g=a.readI64().toString();b.stream_ids_missing.push(g)}}else a.skip(e);break;case 3:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_behind=[];g=a.readListBegin();for(f=0;f<g.size;f++){d=a.readI64().toString();b.stream_ids_behind.push(d)}}else a.skip(e);break;case 4:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_with_lost_amendments=[];d=a.readListBegin();for(f=0;f<d.size;f++){g=a.readI64().toString();b.stream_ids_with_lost_amendments.push(g)}}else a.skip(e);break;case 5:if(e===(h||(h=c("ThriftTypes"))).LIST){b.stream_ids_with_wrong_status=[];g=a.readListBegin();for(f=0;f<g.size;f++){d=a.readI64().toString();b.stream_ids_with_wrong_status.push(d)}}else a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.original_ping_timestamp_ms===void 0&&(b.original_ping_timestamp_ms="0");return b}function H(a){var b,e={};a.readStructBegin();while(!0){var f=a.readFieldBegin(),g=f.ftype;f=f.fid;if(g===(h||(h=c("ThriftTypes"))).STOP)break;switch(f){case 1:if(g===(h||(h=c("ThriftTypes"))).I32)if(b==null)e.flow_status=d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.cast(a.readI32()),b="flow_status";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: flow_status, previous deserialized field: "+b);else a.skip(g);break;case 2:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.log=B(a),b="log";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: log, previous deserialized field: "+b);else a.skip(g);break;case 3:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.rewrite=y(a),b="rewrite";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: rewrite, previous deserialized field: "+b);else a.skip(g);break;case 4:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.data=A(a),b="data";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: data, previous deserialized field: "+b);else a.skip(g);break;case 5:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.termination=C(a),b="termination";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: termination, previous deserialized field: "+b);else a.skip(g);break;case 6:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.amend_ack=D(a),b="amend_ack";else throw new Error("more than one field have been deserialized in union type: StreamResponseDelta; current field: amend_ack, previous deserialized field: "+b);else a.skip(g);break;default:a.skip(g)}a.readFieldEnd()}a.readStructEnd();return e}g.ResponseRewriteRequest$DefaultConstructor=a;g.ResponseRewriteConditionalPatchHeaders$DefaultConstructor=b;g.ResponseData$DefaultConstructor=e;g.LogMessage$DefaultConstructor=f;g.Termination$DefaultConstructor=i;g.AmendStreamAck$DefaultConstructor=j;g.StreamCheck$DefaultConstructor=k;g.Ping$DefaultConstructor=l;g.Pong$DefaultConstructor=m;g.StreamResponseDelta$DefaultConstructor=n;g.serializeResponseRewriteRequest=o;g.serializeResponseRewriteConditionalPatchHeaders=p;g.serializeResponseData=q;g.serializeLogMessage=r;g.serializeTermination=s;g.serializeAmendStreamAck=t;g.serializeStreamCheck=u;g.serializePing=v;g.serializePong=w;g.serializeStreamResponseDelta=x;g.deserializeResponseRewriteRequest=y;g.deserializeResponseRewriteConditionalPatchHeaders=z;g.deserializeResponseData=A;g.deserializeLogMessage=B;g.deserializeTermination=C;g.deserializeAmendStreamAck=D;g.deserializeStreamCheck=E;g.deserializePing=F;g.deserializePong=G;g.deserializeStreamResponseDelta=H}),98);
__d("RequestStreamSingleChannelSingleChannelRequestStreamTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Ignored:100,Success:200,Queued:250,UnknownStream:400,HandledUnknownResult:450,Failure:500});c=b("$InternalEnum")({Request_headers:"request_headers",Request_body:"request_body",Amend:"amend",Ack:"ack",Response:"response",Ping:"ping",Pong:"pong"});e.exports={Ack:a,Payload$Types:c}}),null);
__d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers",["RequestStreamCommonRequestStreamCommonSerializers","RequestStreamCommonRequestStreamCommonTypes","RequestStreamSingleChannelSingleChannelRequestStreamTypes","ThriftTypes","jsbi"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return{}}function b(){return{body:Uint8Array.of()}}function e(){return{amendment:Uint8Array.of()}}function f(){return{ack:d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0)}}function i(){return{delta:[]}}function j(){return{}}function k(a,b){b.writeStructBegin("RequestStreamHeaders"),a.headers!=null&&(b.writeFieldBegin({fname:"headers",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1}),b.writeBinary(a.headers),b.writeFieldEnd()),a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd()),b.writeFieldStop(),b.writeStructEnd()}function l(a,b){b.writeStructBegin("RequestStreamBody");b.writeFieldBegin({fname:"body",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:1});if(a.body!=null)b.writeBinary(a.body);else{a=Uint8Array.of();b.writeBinary(a)}b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd()}function m(a,b){b.writeStructBegin("AmendStream");a.amendment_id!=null&&(b.writeFieldBegin({fname:"amendment_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.amendment_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"amendment",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:2});if(a.amendment!=null)b.writeBinary(a.amendment);else{var d=Uint8Array.of();b.writeBinary(d)}b.writeFieldEnd();a.is_query!=null&&(b.writeFieldBegin({fname:"is_query",ftype:(h||(h=c("ThriftTypes"))).BOOL,fid:3}),b.writeBool(a.is_query),b.writeFieldEnd());a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:4}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function n(a,b){b.writeStructBegin("StreamResponseAck");a.response_id!=null&&(b.writeFieldBegin({fname:"response_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.response_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"ack",ftype:(h||(h=c("ThriftTypes"))).I32,fid:2});if(a.ack!=null){var e;b.writeI32((e=a.ack)!=null?e:0)}else{e=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0);b.writeI32(e!=null?e:0)}b.writeFieldEnd();a.query_result!=null&&(b.writeFieldBegin({fname:"query_result",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:3}),b.writeBinary(a.query_result),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function o(a,b){b.writeStructBegin("StreamResponse");a.response_id!=null&&(b.writeFieldBegin({fname:"response_id",ftype:(h||(h=c("ThriftTypes"))).I64,fid:1}),b.writeI64(c("jsbi").BigInt(a.response_id)),b.writeFieldEnd());b.writeFieldBegin({fname:"delta",ftype:(h||(h=c("ThriftTypes"))).LIST,fid:2});if(a.delta!=null){b.writeListBegin({etype:(h||(h=c("ThriftTypes"))).STRUCT,size:a.delta.length});for(var e of a.delta)d("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(e,b);b.writeListEnd()}else{e=[];b.writeListBegin({etype:(h||(h=c("ThriftTypes"))).STRUCT,size:e.length});for(e of e)d("RequestStreamCommonRequestStreamCommonSerializers").serializeStreamResponseDelta(e,b);b.writeListEnd()}b.writeFieldEnd();if(a.ack_level!=null){b.writeFieldBegin({fname:"ack_level",ftype:(h||(h=c("ThriftTypes"))).I32,fid:3});b.writeI32((e=a.ack_level)!=null?e:0);b.writeFieldEnd()}a.query_request!=null&&(b.writeFieldBegin({fname:"query_request",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:4}),b.writeBinary(a.query_request),b.writeFieldEnd());a.instrumentation_data!=null&&(b.writeFieldBegin({fname:"instrumentation_data",ftype:(h||(h=c("ThriftTypes"))).STRING,fid:5}),b.writeBinary(a.instrumentation_data),b.writeFieldEnd());b.writeFieldStop();b.writeStructEnd()}function p(a,b){b.writeStructBegin("Payload");if(a.request_headers!=null){b.writeFieldBegin({fname:"request_headers",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:1});k(a.request_headers,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.request_body!=null){b.writeFieldBegin({fname:"request_body",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:2});l(a.request_body,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.amend!=null){b.writeFieldBegin({fname:"amend",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:3});m(a.amend,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.ack!=null){b.writeFieldBegin({fname:"ack",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:4});n(a.ack,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.response!=null){b.writeFieldBegin({fname:"response",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:5});o(a.response,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.ping!=null){b.writeFieldBegin({fname:"ping",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:6});d("RequestStreamCommonRequestStreamCommonSerializers").serializePing(a.ping,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}if(a.pong!=null){b.writeFieldBegin({fname:"pong",ftype:(h||(h=c("ThriftTypes"))).STRUCT,fid:7});d("RequestStreamCommonRequestStreamCommonSerializers").serializePong(a.pong,b);b.writeFieldEnd();b.writeFieldStop();b.writeStructEnd();return}b.writeFieldStop();b.writeStructEnd()}function q(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.headers=a.readBinary():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();return b}function r(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).STRING?b.body=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.body===void 0&&(b.body=Uint8Array.of());return b}function s(a){var b={};a.readStructBegin();while(!0){var d=a.readFieldBegin(),e=d.ftype;d=d.fid;if(e===(h||(h=c("ThriftTypes"))).STOP)break;switch(d){case 1:e===(h||(h=c("ThriftTypes"))).I64?b.amendment_id=a.readI64().toString():a.skip(e);break;case 2:e===(h||(h=c("ThriftTypes"))).STRING?b.amendment=a.readBinary():a.skip(e);break;case 3:e===(h||(h=c("ThriftTypes"))).BOOL?b.is_query=a.readBool():a.skip(e);break;case 4:e===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(e);break;default:a.skip(e)}a.readFieldEnd()}a.readStructEnd();b.amendment===void 0&&(b.amendment=Uint8Array.of());return b}function t(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.response_id=a.readI64().toString():a.skip(f);break;case 2:f===(h||(h=c("ThriftTypes"))).I32?b.ack=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(a.readI32()):a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).STRING?b.query_result=a.readBinary():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.ack===void 0&&(b.ack=d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.cast(0));return b}function u(a){var b={};a.readStructBegin();while(!0){var e=a.readFieldBegin(),f=e.ftype;e=e.fid;if(f===(h||(h=c("ThriftTypes"))).STOP)break;switch(e){case 1:f===(h||(h=c("ThriftTypes"))).I64?b.response_id=a.readI64().toString():a.skip(f);break;case 2:if(f===(h||(h=c("ThriftTypes"))).LIST){b.delta=[];e=a.readListBegin();for(var g=0;g<e.size;g++){var i=d("RequestStreamCommonRequestStreamCommonSerializers").deserializeStreamResponseDelta(a);b.delta.push(i)}}else a.skip(f);break;case 3:f===(h||(h=c("ThriftTypes"))).I32?b.ack_level=d("RequestStreamCommonRequestStreamCommonTypes").AckLevel.cast(a.readI32()):a.skip(f);break;case 4:f===(h||(h=c("ThriftTypes"))).STRING?b.query_request=a.readBinary():a.skip(f);break;case 5:f===(h||(h=c("ThriftTypes"))).STRING?b.instrumentation_data=a.readBinary():a.skip(f);break;default:a.skip(f)}a.readFieldEnd()}a.readStructEnd();b.delta===void 0&&(b.delta=[]);return b}function v(a){var b,e={};a.readStructBegin();while(!0){var f=a.readFieldBegin(),g=f.ftype;f=f.fid;if(g===(h||(h=c("ThriftTypes"))).STOP)break;switch(f){case 1:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.request_headers=q(a),b="request_headers";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_headers, previous deserialized field: "+b);else a.skip(g);break;case 2:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.request_body=r(a),b="request_body";else throw new Error("more than one field have been deserialized in union type: Payload; current field: request_body, previous deserialized field: "+b);else a.skip(g);break;case 3:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.amend=s(a),b="amend";else throw new Error("more than one field have been deserialized in union type: Payload; current field: amend, previous deserialized field: "+b);else a.skip(g);break;case 4:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.ack=t(a),b="ack";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ack, previous deserialized field: "+b);else a.skip(g);break;case 5:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.response=u(a),b="response";else throw new Error("more than one field have been deserialized in union type: Payload; current field: response, previous deserialized field: "+b);else a.skip(g);break;case 6:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.ping=d("RequestStreamCommonRequestStreamCommonSerializers").deserializePing(a),b="ping";else throw new Error("more than one field have been deserialized in union type: Payload; current field: ping, previous deserialized field: "+b);else a.skip(g);break;case 7:if(g===(h||(h=c("ThriftTypes"))).STRUCT)if(b==null)e.pong=d("RequestStreamCommonRequestStreamCommonSerializers").deserializePong(a),b="pong";else throw new Error("more than one field have been deserialized in union type: Payload; current field: pong, previous deserialized field: "+b);else a.skip(g);break;default:a.skip(g)}a.readFieldEnd()}a.readStructEnd();return e}g.RequestStreamHeaders$DefaultConstructor=a;g.RequestStreamBody$DefaultConstructor=b;g.AmendStream$DefaultConstructor=e;g.StreamResponseAck$DefaultConstructor=f;g.StreamResponse$DefaultConstructor=i;g.Payload$DefaultConstructor=j;g.serializeRequestStreamHeaders=k;g.serializeRequestStreamBody=l;g.serializeAmendStream=m;g.serializeStreamResponseAck=n;g.serializeStreamResponse=o;g.serializePayload=p;g.deserializeRequestStreamHeaders=q;g.deserializeRequestStreamBody=r;g.deserializeAmendStream=s;g.deserializeStreamResponseAck=t;g.deserializeStreamResponse=u;g.deserializePayload=v}),98);
__d("RequestStreamState",["RequestStreamCommonRequestStreamCommonTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(b){case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:if(a.seenAccepted)return a;return a.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started?a:{flowStatus:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted,seenAccepted:!0};default:if(!a.seenAccepted||a.flowStatus===b)return a;else return{flowStatus:b,seenAccepted:!0}}}g.getNextState=a}),98);
__d("StreamRetryState",[],(function(a,b,c,d,e,f){"use strict";var g=1e3,h=2*60*1e3;a=function(){function a(){this.$1=0}var b=a.prototype;b.resetErrorAndRetryCount=function(){this.$1=0};b.onRetry=function(){this.$1+=1};b.getRetryCount=function(){return this.$1};b.getBackoffDelayMs=function(){if(this.$1<=1)return 0;if(this.$1===2)return g*Math.random();var a=g*Math.pow(2,this.$1-3),b=a*Math.random();a=a+b;return Math.min(a,h)};return a}();f["default"]=a}),66);
__d("DGWRequestStreamRef",["CompactSerializerPolyfill","DGWRequestStreamUtils","DGWStream","DGWStreamHandler","InflightAmends","ODS","Promise","RequestStreamCloseReason","RequestStreamCommonRequestStreamCommonTypes","RequestStreamE2EClientLoggerEvent","RequestStreamE2EClientLoggerMessageType","RequestStreamE2ELogger","RequestStreamE2ESampling","RequestStreamSingleChannelSingleChannelRequestStreamSerializers","RequestStreamSingleChannelSingleChannelRequestStreamTypes","RequestStreamState","RequestStreamTransport","RtiWebRequestStreamClient","StreamRetryState","asyncToGeneratorRuntime","err","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=4,k=0,l=1e3,m=2,n=c("gkx")("20915")?3e4:5e3,o="dgw_stream_send_ack_failure",p=(a=c("qex")._("1382"))!=null?a:!1,q=(e=c("qex")._("2067"))!=null?e:!1;function r(a){if(!a){a=c("err")(o);a.stack;throw a}}function s(a,b){if(a==null||a.length===0)return null;a=JSON.parse(a);a.auxId=b;return new TextEncoder().encode(JSON.stringify(a))}function t(a){var b={};a=a.delta;a.forEach(function(a){if(a.flow_status){b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Flow_status;switch(a.flow_status){case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted:b.flow_status="Accepted";break;case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started:b.flow_status="Started";break;case d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped:b.flow_status="Stopped";break}}else a.log?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Log:a.rewrite?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Rewrite:a.data?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Data:a.termination?b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Termination:a.amend_ack&&(b.type=d("RequestStreamCommonRequestStreamCommonTypes").StreamResponseDelta$Types.Amend_ack)});return b}f=function(){function a(a,b,e,f,g,h){var i=this;this.$6=null;this.$7={};this.$10=!1;this.$15=new(c("StreamRetryState"))();this.$16=0;this.$17=0;this.$18=0;this.$21=0;var k=null;typeof b==="string"?k=new TextEncoder().encode(b):typeof b==="object"&&(k=b);this.$1={headers:a,body:k};this.$3=e;this.$4=f;this.$12=j;this.$9=!1;this.$14=!1;this.$20=h;k=f==null?void 0:f.serviceId;g!=null&&(this.$22()||(g.dgwStreamGroupLoggingId=this.$20.getStreamGroupLoggingId(k)),g.dgwCountPriorStreamsInGroup=this.$20.guessStreamGroupPriorStreamCount(k),g.transport="WEB_RS_STARGATE");this.$5=d("RequestStreamE2ESampling").validateInstrumentationData(a,g,f==null?void 0:f.requestLogContext,f==null?void 0:f.upsampleMultiplier);!this.$22()?this.$6=d("RequestStreamE2ELogger").createStreamLogger(a,this.$5,d("RequestStreamTransport").RequestStreamTransport.WEB_RS_STARGATE):this.$7.disableFalcoLogging=!0;(f==null?void 0:f.deviceId)!=null&&(this.$7.deviceId=f.deviceId);this.$6&&(this.$7.loggingId=this.$6.getRequestId());f&&f.overrideUrl!=null&&(this.$7.overrideUrl=f.overrideUrl);k!=null&&(this.$7.serviceId=k);this.$8={flowStatus:d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped,seenAccepted:!1};this.$19=new(c("InflightAmends"))(n,function(a,b){var d;(d=i.$6)==null?void 0:d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,c("RequestStreamE2EClientLoggerEvent").RECEIVED,babelHelpers["extends"]({},i.$23(),{latency:b.toString()}),a)},function(a,b){if(b.message!==o){var d;(d=i.$6)==null?void 0:d.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT_ACK,c("RequestStreamE2EClientLoggerEvent").FAILURE,babelHelpers["extends"]({},i.$23(),{reason:b.message}),a)}});(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{data_size:(g=b==null?void 0:(h=b.length)==null?void 0:h.toString())!=null?g:"0"},"0","0")}var e=a.prototype;e.getInstrumentationData=function(){return this.$5};e.getE2EClientLogger=function(){return this.$6};e.amendWithAck=function(a){a=this.$24(a,!0);return a==null?(i||(i=b("Promise"))).resolve(!1):this.$19.getPromise(a)||(i||(i=b("Promise"))).resolve(!1)};e.amendWithoutAck=function(a){this.$24(a,!1)};e.cancel=function(){var a;(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").CANCEL,c("RequestStreamE2EClientLoggerEvent").RECEIVED);this.$9=!0;this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)};e.start=function(a){var e=this;a===void 0&&(a=!1);var f=String(this.$16++),g=Date.now();return this.$26(f).then(function(){var a;e.$14=!1;e.$21=0;var b=(Date.now()-g).toString();(a=e.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:b},f,String(e.$18))})["catch"](function(g){g.stack;if(g.message===o&&e.$10)return;e.$14=!1;if(g!==d("DGWStream").StreamError.ESTABLISHMENT_ERROR){var h,j=g.message;g===d("DGWStream").StreamError.UNAUTHENTICATED?j="UNAUTHENTICATED":g===d("DGWStream").StreamError.UNAUTHORIZED&&(j="UNAUTHORIZED");(h=e.$6)==null?void 0:h.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:j},f,String(e.$18));e.$25(a?d("RequestStreamCloseReason").RequestStreamCloseReason.ReestablishError:d("RequestStreamCloseReason").RequestStreamCloseReason.StartStreamFailure,j,!0);if(g===d("DGWStream").StreamError.UNAUTHENTICATED||g===d("DGWStream").StreamError.UNAUTHORIZED)return;throw g}else{(h=e.$6)==null?void 0:h.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:(j=g.message)!=null?j:g},f,String(e.$18));e.$15.onRetry();var k=c("gkx")("20916")?e.$15.getBackoffDelayMs():l*Math.pow(m,e.$21);return new(i||(i=b("Promise")))(function(a){return window.setTimeout(a,k)}).then(function(){e.$21++;e.$18++;return e.start()})}})};e.getFlowStatus=function(){return this.$8.flowStatus};e.shouldTerminateOrRetry=function(a,e,f,g){var h=this;if(this.$14)return;var j=e;this.$12||(j="cannot retry for error: "+e+" because of hit max retry limitation");if(a!==d("RequestStreamCloseReason").RequestStreamCloseReason.ClientError){(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:j},null,String(this.$18))}e=f&&(c("gkx")("20916")||this.$12);this.$25(a,j,!e);if(e){var l=c("gkx")("20916")?Math.max(g!=null?g:0,this.$15.getBackoffDelayMs()):g!=null?g:k;this.$14=!0;return new(i||(i=b("Promise")))(function(a){return window.setTimeout(a,l)}).then(function(){return h.$27()})["catch"](function(a){})}};e.$28=function(){return this.$11!=null};e.$24=function(a,b){var e,f=this,g=typeof a==="string"?new TextEncoder().encode(a):a,h=String(this.$17++);(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").RECEIVED,{},h);e=s(this.$5,h);g={amend:{amendment:g,instrumentation_data:e}};b&&g.amend&&(g.amend.amendment_id=h);e=d("CompactSerializerPolyfill").serialize(g,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);var i=Date.now();if(this.$29()&&this.$11!=null){b&&this.$19.add(h);this.$11.send(e).then(function(a){var b;r(a);a=(Date.now()-i).toString();(b=f.$6)==null?void 0:b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").PUBACK,{latency:a},h)})["catch"](function(a){var b;(b=f.$6)==null?void 0:b.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:a.message},h);f.$19.reject(h,a)});(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").SENT,{data_size:(e=a==null?void 0:(b=a.length)==null?void 0:b.toString())!=null?e:"0"},h);return h}else{(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").AMENDMENT,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},h)}};e.$26=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this;if(!this.$9){var e=this.$2||this.$1;try{var f=this.$30();this.$13=f;var g=e.headers.graphiql_sandbox,h=babelHelpers["extends"]({},e.headers,{},this.$31());g!=null&&(h=babelHelpers["extends"]({},h,{www_sandbox:g,distillery_sandbox:g+":8086"}));g=d("DGWRequestStreamUtils").convertHeaders(h,e.body!=null,this.$5);this.$11=(yield this.$20.establishStream(g,f,this.$7))}catch(a){if(a===d("DGWStream").StreamError.ESTABLISHMENT_ERROR)throw a;if(d("DGWStream").StreamError.isValid(a)&&!d("DGWStream").isRetryableError(a))throw a;else if(d("DGWStream").StreamError.isValid(a)&&d("DGWStream").isRetryableError(a)){this.$32(a);return}throw a}if(this.$9){this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0);return}h=new Uint8Array([]);if(e.body!=null){g={request_body:{body:e.body}};h=d("CompactSerializerPolyfill").serialize(g,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload)}if(!this.$11)throw new Error("dgwstream_is_null");f=this.$11.send(h).then(function(a){r(a),b.$9&&b.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.UserIntention,"user cancel the stream",!0)});(e=this.$6)==null?void 0:e.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").SENT,{},a,String(this.$18));this.$12=j;return f}else throw new Error("stream_already_canceled")});function e(b){return a.apply(this,arguments)}return e}();e.$29=function(){return this.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started||this.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Accepted};e.$25=function(a,b,c){var e;this.$11&&a!==d("RequestStreamCloseReason").RequestStreamCloseReason.StreamError&&a!==d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination&&this.$11.close();(e=this.$13)==null?void 0:e.stop();this.$11=null;this.$10=!0;this.$33(d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped)&&this.$3.onFlowStatus(d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Stopped);c&&!this.$9&&this.$3.onTermination("terminate stream because "+a+" with msg : "+b)};e.$33=function(a){var b=this.$8;this.$8=d("RequestStreamState").getNextState(b,a);return b!==this.$8};e.$27=function(){this.$12--;this.$18++;this.$15.onRetry();return this.start(!0)};e.$34=function(a){var b=this;a=d("CompactSerializerPolyfill").deserialize(a,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").deserializePayload);if(a.response){var e=d("DGWRequestStreamUtils").getInstrumentationDataFieldsFromPayload(a),f=e==null?void 0:e.auxId;e=e==null?void 0:e.dfTraceId;if(!this.$28()){var g;(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"response_received_after_close"},f,String(this.$18),e);return}(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").RECEIVED,t(a.response),f,String(this.$18),e);g=a.response.delta;g.forEach(function(a){if(a.data)b.$15.resetErrorAndRetryCount(),c("justknobx")._("4109")?b.$3.onData(new TextDecoder("utf-8").decode(a.data.bytes)):b.$8.flowStatus===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started?b.$3.onData(new TextDecoder("utf-8").decode(a.data.bytes)):(h||(h=d("ODS"))).bumpEntityKey(110,"RequestStream","data_before_started_"+(b.$22()?"falco":"graphql"));else if(a.flow_status){var e=a.flow_status;e===d("RequestStreamCommonRequestStreamCommonTypes").FlowStatus.Started&&b.$15.resetErrorAndRetryCount();b.$33(e)&&b.$3.onFlowStatus(e)}else if(a.termination){e=(e=a.termination.message)!=null?e:"unknown termination msg";b.$2=null;b.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,e,a.termination.reason===d("RequestStreamCommonRequestStreamCommonTypes").TerminationReason.TryAgain,a.termination.retry_delay_ms!=null?parseInt(a.termination.retry_delay_ms,10):null)}else if(a.log)b.$3.onLog(a.log.message);else if(a.amend_ack){e=a.amend_ack.amendment_id;if(e!=null){var f=a.amend_ack.accepted||!1;b.$19.resolve(e,f)}}else if(a.rewrite){e=d("DGWRequestStreamUtils").transformContextWithRewriteDelta(b.$1,a.rewrite);a.rewrite.temporary===!0?b.$2=e:b.$1=e}});(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").SENT,t(a.response),f,String(this.$18),e);a.response.ack_level===d("RequestStreamCommonRequestStreamCommonTypes").AckLevel.Device&&a.response.response_id!=null&&this.$35(a.response.response_id,f)}else{(g=this.$6)==null?void 0:g.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"unexpected_payload_type"},null,String(this.$18))}};e.$35=function(a,b){a={ack:{response_id:a,ack:d("RequestStreamSingleChannelSingleChannelRequestStreamTypes").Ack.Success}};a=d("CompactSerializerPolyfill").serialize(a,d("RequestStreamSingleChannelSingleChannelRequestStreamSerializers").serializePayload);if(this.$11!=null){this.$11.send(a);(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,c("RequestStreamE2EClientLoggerEvent").SENT,{},b,String(this.$18))}else{(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE_ACK,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"not_started"},b,String(this.$18))}};e.$22=function(){return this.$1.headers.method==="Falco"};e.$30=function(){return new(c("DGWStreamHandler"))(this.$36.bind(this),this.$37.bind(this),this.$32.bind(this),this.$38.bind(this),this.$39.bind(this))};e.$39=function(a){(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"OnClose: Server Has FinishedSendingData"},null,String(this.$18));this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.ServerDataEnd,"Client receive OnServerHasFinishedSendingData and Server will not send more data",!0)};e.$36=function(a){(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").REQUEST_STREAM,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:"OnClose: Server Close Connection"},null,String(this.$18));this.$25(d("RequestStreamCloseReason").RequestStreamCloseReason.RemoteTermination,"Client receive OnClose and Server will not send more data",!0)};e.$37=function(a){try{this.$34(a)}catch(b){(a=this.$6)==null?void 0:a.logE2EEvent(c("RequestStreamE2EClientLoggerMessageType").RESPONSE,c("RequestStreamE2EClientLoggerEvent").FAILURE,{reason:b.message},null,String(this.$18));this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.ClientError,b.message,!1)}};e.$32=function(a){var b="",c=d("DGWStream").isRetryableError(a);b="StreamError: Received "+a;a=p?this.$12>0:c;c=q?l*m:void 0;this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.StreamError,b,a,c)};e.$38=function(a,b){this.shouldTerminateOrRetry(d("RequestStreamCloseReason").RequestStreamCloseReason.ServerDrain,b,!0)};e.$31=function(){return c("RtiWebRequestStreamClient").overrideHeaders};e.$23=function(){var a={};c("gkx")("20918")&&(a.pending_amendments_size=this.$19.getSize().toString());return a};return a}();g["default"]=f}),98);
__d("DGWStreamGroupHandler",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b,c){this.$1=a,this.$2=b,this.$3=c}var b=a.prototype;b.onStreamGroupError=function(a){this.$1(a)};b.onStreamGroupMustDrain=function(a){this.$2(a)};b.onStreamGroupTransportClose=function(){this.$3()};return a}();f["default"]=a}),66);
__d("DGWStreamFactory",["DGWClient","DGWStreamGroupHandler","Promise","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i="realtime",j=1e4,k=null;a=function(){function a(){this.$1={}}a.get=function(){k==null&&(k=new a());return k};var d=a.prototype;d.$2=function(a){var b;this.$1=(b={},b[a]={dgwStreamGroup:null,multiStreamGroupLoggingId:null,multiStreamGroupPriorStreamCountGuess:0},b)};d.getStreamGroupLoggingId=function(a){a===void 0&&(a=null);return(a=this.$1[(a=a)!=null?a:i])==null?void 0:a.multiStreamGroupLoggingId};d.guessStreamGroupPriorStreamCount=function(a){a===void 0&&(a=null);return((a=this.$1[(a=a)!=null?a:i])==null?void 0:a.multiStreamGroupPriorStreamCountGuess)||0};d.establishStream=function(a,d,e){var f,g=this,k=e.serviceId==null?i:e.serviceId;f=(f=this.$1[k])==null?void 0:f.dgwStreamGroup;if(f==null||!f.canCreateGroupedStream()){var l={deviceId:e.deviceId,serviceId:k,disableFalcoLogging:e.disableFalcoLogging,streamGroupAppHeaders:{"stream-group":"group1"}};e.overrideUrl!=null&&(l.overrideUrl=e.overrideUrl);l.keepAliveMs=j;c("gkx")("20920")&&(l.loggingId=c("uuidv4")());try{f=c("DGWClient")().createStreamGroup(new(c("DGWStreamGroupHandler"))(function(){g.$2(k)},function(){g.$2(k)},function(){g.$2(k)}),l),this.$1[k]={dgwStreamGroup:f,multiStreamGroupLoggingId:l.loggingId,multiStreamGroupPriorStreamCountGuess:0}}catch(a){return(h||(h=b("Promise"))).reject(a)}}this.$1[k].multiStreamGroupPriorStreamCountGuess++;return f.establishStream({loggingId:e.loggingId,disableFalcoLogging:e.disableFalcoLogging,groupedStreamHeaders:a},d)};return a}();g["default"]=a}),98);
__d("DGWRequestStreamClient",["DGWRequestStreamRef","DGWStreamFactory","Promise","cr:2046346"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a){this.$1=a!=null?a:c("DGWStreamFactory").get()}var d=a.prototype;d.createStream=function(a,d,e,f,g){b("cr:2046346")!=null&&b("cr:2046346").startPulsarTest();return(h||(h=b("Promise"))).resolve(new(c("DGWRequestStreamRef"))(a,d,f,g,e,this.$1))};return a}();g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("699");b=d("FalcoLoggerInternal").create("armadillo_cutover_client",a);e=b;g["default"]=e}),98);
__d("EBMinosWasmVerifySingleEpoch",["EBGetMinosWasm","EBMinosLogger","EBMinosWasm.pb","WACreateWasmFunction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var c=a.getWasmModule;a=a.logger;var e=a.TAGS(["minos-verify-single-epoch"]);function f(a){a=a.valid;return d("WAResultOrError").makeResult({valid:a})}return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.epochPublicData;a=a.signature;var g=d("WACreateWasmFunction").createWasmFunction({InputSpec:d("EBMinosWasm.pb").MinosVerifySingleEpochInputSpec,ResultSpec:d("EBMinosWasm.pb").MinosVerifySingleEpochResultSpec,cli:"minos_cli",command:"minos-verify-single-epoch",getWasmModule:c,logger:e,validateResult:f});g=(yield g({epochPublicData:b,signature:a}));return g});function g(b){return a.apply(this,arguments)}return g}()}c=a({getWasmModule:d("EBGetMinosWasm").getMinosWasm,logger:d("EBMinosLogger").minosLogger});g.verifySingleEpoch=c}),98);
__d("EBAPIMinosVerifySingleEpoch",["EBMinosLogger","EBMinosQplFlow","EBMinosTypes","EBMinosWasmVerifySingleEpoch","WAGetSafeQPLError","WALongInt","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unable to verify epoch - WASM error ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["minosVerifySingleEpoch start"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("EBMinosLogger").minosLogger.DEV(i());var b=d("EBMinosQplFlow").startMinosVerifySingleEpochQpl();try{var c,e=(c=d("EBMinosTypes")).unsafeCastToEpochNumber(d("WALongInt").decimalStringToLongInt(new TextDecoder().decode(a.minosEpochAnonId))),f=c.unsafeCastToMailboxAuthPK(a.minosMailboxAuthPublicKey),g=c.unsafeCastToMailboxEncryptionPK(a.minosMailboxEncryptionPublicKey),j=c.unsafeCastToMailboxSigningPK(a.minosMailboxSigningPublicKey),k=c.unsafeCastToUserFbId(a.userId);c=c.unsafeCastToEpochSignature(a.selfEpochSignature);e={epochNumber:e,mailboxAuthPk:f,mailboxEncryptionPk:g,mailboxSigningPk:j,previousEpochHead:a.previousEpochHead!=null?d("EBMinosTypes").unsafeCastToEpochHead(a.previousEpochHead):void 0,userFbid:k};b.addPoint("verify_single_epoch_start");f=(yield d("EBMinosWasmVerifySingleEpoch").verifySingleEpoch({epochPublicData:e,signature:c}));b.addPoint("verify_single_epoch_end");if(f.success){b.endSuccess();return f.value.valid}d("EBMinosLogger").minosLogger.ERROR(h(),f.error);b.endFailWithError("invalid-result",f.error);return!1}catch(a){b.endFailWithError("runtime-error",d("WAGetSafeQPLError").getSafeQPLErrorMessage(a));return!1}});return j.apply(this,arguments)}g.minosVerifySingleEpoch=a}),98);
__d("EBMinosSaveNewMailboxKey",["EBMinosDBDev","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h,i,j,k){var l=(yield d("EBMinosDBDev").getEBMinosDevDb());yield l.runInTransaction(["secure_minos_mailbox_keys"],"readwrite",function(d){return d.stores.secure_minos_mailbox_keys.bulkPut([{contact_id:a,encryption_public_key:b,epoch_anon_id:c,epoch_head:e,epoch_head_creation_time:f,epoch_signature_self:g,mailbox_auth_pub_key:h,mailbox_signing_pub_key:i,previous_epoch_head:j,public_key_fbid:k}])},"SaveNewMailboxKey")});return function(b,c,d,e,f,g,h,i,j,k){return a.apply(this,arguments)}}();g.saveNewMailboxKey=a}),98);
__d("EBMinosSecureMailboxKeysForContact",["EBMinosLoadMailboxKeys","EBMinosTypes"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("EBMinosLoadMailboxKeys").loadMailboxKeys(d("EBMinosTypes").unsafeCastToUserFbId(a))}g.getSecureMailboxKeysForContact=a}),98);
__d("EBMinosWriteKeyChangeAdminMessage",["EBMinosTypes","FBLogger","MAWAdminWriteUserDeviceMsgTxn","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","Promise","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid userJid generated in writeKeyChangeAdminMessage"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=d("EBMinosTypes").userFbidToUserJid(a);if(f==null){c("FBLogger")("wmi_minos").MUSTFIX(i());return(h||(h=b("Promise"))).resolve()}a=(yield d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"writeKeyChangeAdminMessage",function(a){return function(){return d("MAWDbThreadTxns").getAllThreadsForUsers(a,[f])}})());a=a.get(f);if(a==null||(a==null?void 0:a.length)===0)return(h||(h=b("Promise"))).resolve();var g=a.filter(function(a){a=d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(){return"group"},user:function(){return"one_to_one"}});return a==="one_to_one"});return d("MAWIndexedDb").makeMsgrTransactor({ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"writeKeyChangeAdminMessage",function(a){return function(){return d("MAWDexieTable").dexieAll(g.map(function(b){return d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,f,b,"update",e)}))}})()});return j.apply(this,arguments)}g.writeKeyChangeAdminMessage=a}),98);
__d("EBMinosWriteSecureStorageAlert",["EBMinosTypes","FBLogger","MAWDbAddDeviceChangeAlertsTxn","MAWDbDeviceChangeAlerts","MAWIndexedDb","MAWTransactionMode","MAWUnsafeCoerce","Promise","WAJids","WASignalOther"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Invalid deviceJid generated in writeMinosSecureStorageAlert"]);i=function(){return a};return a}function a(a,e,f){var g=d("WAJids").validateDeviceJid(d("EBMinosTypes").userFbidToUserJid(d("EBMinosTypes").unsafeCastToUserFbId(a)));if(g==null){c("FBLogger")("wmi_minos").MUSTFIX(i());return(h||(h=b("Promise"))).resolve()}return d("MAWIndexedDb").makeMsgrTransactor({deviceChangeAlerts:d("MAWTransactionMode").READWRITE},"writeMinosSecureStorageAlert",function(a){return function(){return d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:g,epochHead:e,identity:d("MAWUnsafeCoerce").unsafeCoerce(d("WASignalOther").toBytes(e,32)),isArchived:!1,model:"secure_storage",platform:"Meta",ts:f})}})()}g.writeMinosSecureStorageAlert=a}),98);
__d("EBAPIWriteMinosPublicKeysForRecipient",["EBMinosQplFlow","EBMinosSaveNewMailboxKey","EBMinosSecureMailboxKeysForContact","EBMinosTypes","EBMinosWriteKeyChangeAdminMessage","EBMinosWriteSecureStorageAlert","WAGetSafeQPLError","WALongInt","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.id,c=a.minosEncryptionPublicKey,e=a.minosEpochAnonId,f=a.minosEpochHead,g=a.minosEpochHeadCreationTime,h=a.minosEpochSignatureSelf,j=a.minosMailboxAuthPubKey,k=a.minosMailboxSigningPubKey,l=a.minosPreviousEpochHead;a=a.minosPublicKeyFBID;var m=d("EBMinosQplFlow").startMinosWritePublicKeysQpl();try{b=d("EBMinosTypes").unsafeCastToUserFbId(b);c=c!=null?d("EBMinosTypes").unsafeCastToMailboxEncryptionPK(c):void 0;e=e!=null?d("EBMinosTypes").unsafeCastToEpochNumber(d("WALongInt").decimalStringToLongInt(new TextDecoder().decode(e))):void 0;f=f!=null?d("EBMinosTypes").unsafeCastToEpochHead(f):void 0;g=g!=null?d("EBMinosTypes").unsafeCastToEpochCreationTime(g):void 0;h=h!=null?d("EBMinosTypes").unsafeCastToEpochSignature(h):void 0;j=j!=null?d("EBMinosTypes").unsafeCastToMailboxAuthPK(j):void 0;k=k!=null?d("EBMinosTypes").unsafeCastToMailboxSigningPK(k):void 0;l=l!=null?d("EBMinosTypes").unsafeCastToEpochHead(l):void 0;a=a!=null?d("EBMinosTypes").unsafeCastToMailboxFbId(d("WALongInt").decimalStringToLongInt(a)):void 0;m.addPoint("get_secure_mailbox_keys_for_contact_start");var n=(yield d("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(b));m.addPoint("get_secure_mailbox_keys_for_contact_end");if(!i(n,f,g)){m.addPoint("skip_write_mailbox_key");m.endSuccess();return d("WAResultOrError").makeResult()}m.addPoint("save_new_mailbox_key_start");yield d("EBMinosSaveNewMailboxKey").saveNewMailboxKey(b,c,e,f,g,h,j,k,l,a);m.addPoint("save_new_mailbox_key_end");f!=null&&g!=null&&(yield d("EBMinosWriteSecureStorageAlert").writeMinosSecureStorageAlert(b,f,g),yield d("EBMinosWriteKeyChangeAdminMessage").writeKeyChangeAdminMessage(b,g));m.endSuccess();return d("WAResultOrError").makeResult()}catch(a){m.endFailWithError("runtime-error",d("WAGetSafeQPLError").getSafeQPLErrorMessage(a));return d("WAResultOrError").makeError("runtime-error")}});return h.apply(this,arguments)}function i(a,b,c){if((a==null?void 0:a.epoch_head)==null||(a==null?void 0:a.epoch_head_creation_time)==null)return!0;return b==null||c==null?!1:a.epoch_head_creation_time!==c&&c>a.epoch_head_creation_time}g.writeMinosMailboxKeysForRecipient=a}),98);
__d("EBGetContactEpochHead",["EBMinosSecureMailboxKeysForContact","Promise","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.rawContactId;if(a==null)return(h||(h=b("Promise"))).reject(d("WAResultOrError").makeError("invalid-arguments"));a=(yield d("EBMinosSecureMailboxKeysForContact").getSecureMailboxKeysForContact(a));return d("WAResultOrError").makeResult({epochHead:a==null?void 0:a.epoch_head,epochHeadCreationTime:a==null?void 0:a.epoch_head_creation_time})});return i.apply(this,arguments)}g.getContactEpochHead=a}),98);
__d("EBGetMessageKeys",["EBMinosFakeData","FBLogger","MAWMpsGating","WAResultOrError","WebMps","asyncToGeneratorRuntime","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Runtime error in EBGetMessageKeys"]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.messageId;a=a.threadId;try{if(b==null||a==null)return d("WAResultOrError").makeError("invalid-arguments");if(!d("MAWMpsGating").isMpsM3OrLater())return d("WAResultOrError").makeError("not-supported");b=(yield d("WebMps").mps().loadMessage({config:{shouldFetchSupplementals:!0,strategy:"local-only"},debug:{purpose:"get-message-keys"},messageId:b,threadId:a}));if(b.success===!1)return d("WAResultOrError").makeError(b.error);a=b.value;if(a==null)return d("WAResultOrError").makeError("no-message");var e=new Map();a.supplementalProtobufs.forEach(function(a,b){e.set(b,babelHelpers["extends"]({},a,{transportMessageSignature:d("EBMinosFakeData").FAKE_TRANSPORT_SIGNING_PUBLIC_KEY}))});b=babelHelpers["extends"]({},a.toplevelProtobuf,{transportMessageSignature:d("EBMinosFakeData").FAKE_TRANSPORT_SIGNING_PUBLIC_KEY});return d("WAResultOrError").makeResult(babelHelpers["extends"]({},a,{supplementalProtobufs:e,toplevelProtobuf:b}))}catch(a){c("FBLogger")("wmi_minos").catching(c("getErrorSafe")(a)).MUSTFIX(h());throw a}});return i.apply(this,arguments)}g.getMessageKeys=a}),98);
__d("EBgenerateMPSMessageQuery",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return{__typename:"MPSMessageQuery",ctx:{__typename:"MPSQueryContext",caller:"HISTORY_RESTORE"},query:{__typename:"MPSMessagePointQuery",include_deleted:!1,otids:b,thread_id:a}}}f.generateMPSMessageQuery=a}),66);
__d("EBMessageBulkPointQuery",["Base64Utils","EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBIsEbEnabled","EBMessagePointQueryWithPersistence","EBgenerateMPSMessageQuery","I64","LSMEBTaskCreationSource","LSVec","MAWCurrentUser","QPLUserFlow","WAHashStringToNumber","WALogger","WAPushSafeTypes","WAResultOrError","WorkerRelay","asyncToGeneratorRuntime","cr:9437","handleRestoreMessagesGraphQLResponse","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphQL bulk point restore error ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] mandatory params of client state are null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] No client state found - unable to restore"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling EBLS without EBLS being available for message bulk point query"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] GQL bulk point query called from non-worker context"]);m=function(){return a};return a}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!d("EBAPIWorkerCheck").runningInWorker()){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("called-from-main-thread")}d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql");a=d("WAPushSafeTypes").unsafeNotNullable(a);var e=a.chatJid,f=a.messageIds,g=a.sortOrderMsList,n=a.source,o=a.threadId;a=a.traceId;var p=a!=null?d("WAHashStringToNumber").hashStringToNumber(a):void 0,q=c("qpl")._(521482281,"2703");try{c("QPLUserFlow").start(q,{annotations:{bool:{bulkPointQuery:!0,mainThreadRestore:!1,workerThreadRestore:!0},"int":{source:n!=null?n:c("LSMEBTaskCreationSource").UNKNOWN}},instanceKey:p});if(b("cr:9437")==null){d("WALogger").ERROR(l());c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{instanceKey:p});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("ebls-not-initialized")}yield b("cr:9437").init();var r=(yield b("cr:9437").getLSStorage());if(!(yield d("EBIsEbEnabled").isEbEnabledLS(r.tables))){c("QPLUserFlow").addPoint(q,"eb_not_enabled",{instanceKey:p});c("QPLUserFlow").endSuccess(q,{instanceKey:p});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("eb-not-enabled")}var s=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(r));if(s==null){d("WALogger").ERROR(k());c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{instanceKey:p});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("no-client-state")}var t=s.backupId,u=s.device_id,v=s.locally_available_epochs,w=s.mailboxRootKey;s=s.ocmfClientStateBlob;if(t==null||u==null||w==null||s==null){d("WALogger").ERROR(j());c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{instanceKey:p});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var x=d("MAWCurrentUser").getAppID();v={restore_context:{act_thread_id:o,site:"www",tam_thread_subtype:0},success:{device_context:{device_id:(h||(h=d("I64"))).to_string(u),locally_available_epochs:v,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(w),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(s)}},mps_message_query:JSON.stringify(d("EBgenerateMPSMessageQuery").generateMPSMessageQuery(o,f))}};if(g!=null){w=c("LSVec").ofArray(g.map(function(a){return(h||(h=d("I64"))).of_string(""+a)}));v=babelHelpers["extends"]({},v,{sort_order_ms_list:w})}c("QPLUserFlow").addPoint(q,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START,{instanceKey:p});s=(yield d("WorkerRelay").createWorkerQuery(d("EBMessagePointQueryWithPersistence").pointRestoreQuery,{app_id:String(x!=null?x:"0"),restore_payload_string:JSON.stringify(v),restore_type:"MESSAGE_QUERY_RESTORE"}));f=(yield d("EBAPISharedUtils").constructEBRestoreResponse(s,!0,q,r,p,u,o,e,n,a,void 0,t));if(f.success){d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.success");return d("WAResultOrError").makeResult(f.response)}else{d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").makeError(f.response)}}catch(a){d("WALogger").ERROR(i(),a);c("QPLUserFlow").endFailure(q,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{error:a,instanceKey:p});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.bulkpoint.search.gql.error");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}});return n.apply(this,arguments)}g.messageBulkPointQuery=a}),98);
__d("EBMessageRangeQueryForIndexing",["EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBMessageRangeQueryForThreads","I64","LSDatabaseSingleton","LSMEBTaskCreationSource","LSVec","MAWEncryptedBackupUtils","MAWJobDefinitions","Promise","QPLUserFlow","WAHashStringToNumber","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","ifRequireable","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["graphQL range restore error ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Calling EBLS without EBLS being available for message range query"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["labyrinth_web","EBMessageRangeQueryForIndexing"]);function n(a,b,e){var f=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(a.protobuf),g=c("LSVec").toArray(a.echo).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)});return{echoMessages:g,hasMoreAfter:a.messageRangeInfo.has_more_before,hasMoreBefore:a.messageRangeInfo.has_more_after,isPointQuery:!1,mpsMessageQuery:void 0,nextMessageTimestampMsAfter:(j||(j=d("I64"))).of_string(a.messageRangeInfo.next_message_timestamp_ms_after),nextMessageTimestampMsBefore:j.of_string(a.messageRangeInfo.next_message_timestamp_ms_before),protobufMessages:f,referenceTimestamp:a.args.from[0],requestId:e,taskSource:b}}function a(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e,f=a.traceId!=null?a.traceId:c("uuidv4")(),g=d("WAHashStringToNumber").hashStringToNumber(f);e=(e=a.source)!=null?e:c("LSMEBTaskCreationSource").UNKNOWN;var j=c("qpl")._(521476367,"2704");c("QPLUserFlow").start(j,{annotations:{bool:{mainThreadRestore:!1,rangeQueryForIndexing:!0,workerThreadRestore:!0},"int":{source:e}},instanceKey:g});var o=a.chatJid;if(o==null){c("QPLUserFlow").endFailure(j,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_CHAT_JID,{instanceKey:g});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("null-chat-jid")}try{var p;if(d("EBAPIWorkerCheck").runningInWorker()){var q=new(h||(h=b("Promise")))(function(a,b){return c("ifRequireable")("EBLS",function(b){b=b.getLSStorage;return a(b())},function(){return a(null)})});q=(yield q);if(q==null){m.ERROR(l());c("QPLUserFlow").endFailure(j,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.EBLS_NOT_INITIALIZED,{instanceKey:g});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("ebls-not-initialized")}}else q=(yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton);p=(p=a.sortOrderMs)!=null?p:""+(Date.now()+6e4);a=(yield d("EBMessageRangeQueryForThreads").messageRangeQueryForThreads({instanceKey:f,qplEventObject:j,restoreType:"range",source:(a=a.source)!=null?a:c("LSMEBTaskCreationSource").UNKNOWN,storage:q,threads:[{chatJid:o,direction:"before",from:[p,void 0]}]}));if(a.success&&a.value.length>0&&a.value[0].success){q=a.value[0].value;o=n(q,e,f);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.success");return d("WAResultOrError").makeResult(o)}else{d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");p=a.success===!1?a.error:a.value[0].error;return d("WAResultOrError").makeError(p!=null?p:"runtime-error")}}catch(a){m.ERROR(k(),a);c("QPLUserFlow").endFailure(j,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{error:a,instanceKey:g});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.range.search.gql.error");return d("WAResultOrError").makeError("runtime-error")}});return o.apply(this,arguments)}g.messageRangeQueryForIndexing=a}),98);
__d("EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23891425050463617"}),null);
__d("EBMessageRangeQueryWithPersistenceQuery.graphql",["EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessageRangeQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessageRangeQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessageRangeQueryWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBMessageRangeQueryWithPersistence",["Base64Utils","EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBMessageRangeQueryUtils","EBMessageRangeQueryWithPersistenceQuery.graphql","I64","LSDatabaseSingleton","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSDeleteAndReenrollDeviceStateStoredProcedure","LSEncryptedBackupsMessagesRangeQueryDirection","LSFactory","LSIntEnum","LSMEBDeviceReenrollmentReason","LSMEBTaskCreationSource","LSShape","LSVec","MAWCurrentUser","MAWEBRestoreTrackingUtils","MAWJids","MAWJobDefinitions","MAWMiActGetThreadLifecycleState","MAWMiActThreadLifecycleState","QPLFlow","WAHashStringToNumber","WAJids","WAResultOrError","WATagsLogger","WorkerRelay","WorkerRelayNetwork","asyncToGeneratorRuntime","getErrorSafe","handleRestoreMessagesGraphQLResponse","justknobx","promiseDone","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with an error"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with an error."]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mixed][protobuf] decryptMessageProtobufs failed with error: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mixed][protobuf] decryptMessageProtobufs failed with an error."]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mixed][echo] decryptMessageEcho failed with error: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["[mixed][echo] decryptMessageEcho failed with an error."]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] messageRangeQuery echo: "," protobuf: "," nonLsEcho: "," nonLSProtobuf: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["message range info is not complete - cannot proceed with graphQL restore"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["message range info is null - cannot proceed with graphQL restore"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["No messages to restore"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["graphQL range restore error ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["backup_id is null during graphQL restore"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["server side exception during graphql restore - ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["GQL worker range restore query returned null for message response"]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["mandatory params of client state are null"]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["No client state found - unable to restore"]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["[","] Issuing messageRangeQuery with args: ",""]);D=function(){return a};return a}var E=c("requireDeferred")("LSEBUnifiedRestoreUtils").__setRef("EBMessageRangeQueryWithPersistence"),F=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("EBMessageRangeQueryWithPersistence"),G=c("requireDeferred")("LSRestoreProtobufs.nop").__setRef("EBMessageRangeQueryWithPersistence"),H=d("WATagsLogger").TAGS(["labyrinth_web","EBMessageRangeQueryWithPersistence"]),I=h!==void 0?h:h=b("EBMessageRangeQueryWithPersistenceQuery.graphql");function a(a){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,g=a.direction,h=a.includeOffset;h=h===void 0?!1:h;var l=a.numMessages,m=a.sortOrderMs,n=a.source,o=a.traceId;if(d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql");var p=d("WAHashStringToNumber").hashStringToNumber(o),q=c("qpl")._(521471755,"2586"),r=d("QPLFlow").startQPLFlow(q,{annotations:{bool:{mainThreadRestore:!0,workerThreadRestore:!1},"int":{num_messages_requested:l,source:n!=null?n:c("LSMEBTaskCreationSource").UNKNOWN},string:{request_args:JSON.stringify(a)}},instanceKey:p,timeoutInMs:c("justknobx")._("2950")});try{H.LOG(D(),o,JSON.stringify(a));d("MAWEBRestoreTrackingUtils").markEBRestorePaginated(n,o,"GQL_MAIN_THREAD");var s=(yield (i||(i=d("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue()),t;yield s.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;r.addPoint("get_client_state_start");t=(yield d("handleRestoreMessagesGraphQLResponse").getClientState(s,a));d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{device_id:(j||(j=d("I64"))).to_string((b=(b=t)==null?void 0:b.device_id)!=null?b:(j||(j=d("I64"))).zero)}},pointName:"client_state_retrieved",traceId:o});r.addPoint("get_client_state_end",{string:{device_id:j.to_string((b=(b=t)==null?void 0:b.device_id)!=null?b:(j||(j=d("I64"))).zero)}});b=(yield d("MAWMiActGetThreadLifecycleState").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(e),"GQL_range_restore_eb_api_call"));if(b.type===d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW||b.type===d("MAWMiActThreadLifecycleState").MiActThreadStatesEnum.JID_MISSING_MI_THREAD){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{thread_state_by_jid:b.type}},pointName:"chat_jid_not_found_in_act_mapping_table",traceId:o});r.addPoint("chat_jid_not_found_in_act_mapping_table");d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(o,!1);r.endSuccess();d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.thread.missing.error");return d("WAResultOrError").makeError("thread-not-found-in-mi-act-mapping-table")}else d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{thread_state_by_jid:b.type}},pointName:"chat_jid_exists_in_act_mapping_table",traceId:o}),r.addPoint("chat_jid_exists_in_act_mapping_table")});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":187");if(t==null){H.ERROR(C());r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("no-client-state")}q=t;p=q.backupId;var u=q.device_id;a=q.locally_available_epochs;var v=q.mailboxRootKey;q=q.ocmfClientStateBlob;if(p==null||u==null||v==null||q==null){H.ERROR(B());r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,"client_state_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var w=d("MAWCurrentUser").getAppID();d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"app_id_retrieved",traceId:o});r.addPoint("app_id_retrieved");var E=d("WAJids").threadIdForChatJid(e);d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"converted_chatjid_to_threadid",traceId:o});r.addPoint("converted_chatjid_to_threadid");g=g==="before"?c("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:c("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER;a={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(E),site:"www",tam_thread_subtype:0},success:babelHelpers["extends"]({device_context:{device_id:(j||(j=d("I64"))).to_string(u),locally_available_epochs:a,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(v),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(q)}},direction:g,include_offset:h,query_num_messages:l,server_thread_key:E},m!=null?{reference_timestamp:d("EBMessageRangeQueryUtils").safeTimestampMsString(m)}:{})};r.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START);d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"graphql_query_start",traceId:o});var F;try{yield d("WorkerRelayNetwork").createWorkerNetworkExecute(),F=(yield d("WorkerRelay").createWorkerQuery(I,{app_id:String(w!=null?w:"0"),restore_payload_string:JSON.stringify(a),restore_type:"RANGE_QUERY_RESTORE"})),r.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"graphql_query_end",traceId:o})}catch(a){v=c("getErrorSafe")(a);r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_EXCEPTION,errorStackTrace:v.stack}});return d("WAResultOrError").makeError("invalid-graphql-response")}if(F==null||((q=F)==null?void 0:(g=q.viewer)==null?void 0:(h=g.encrypted_backup)==null?void 0:h.mailbox)==null){r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}v=(l=F)==null?void 0:(E=l.viewer)==null?void 0:(w=E.encrypted_backup)==null?void 0:(a=w.mailbox)==null?void 0:a.messages;if(v==null){H.ERROR(A());r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}q=v;if((q==null?void 0:q.encrypted_messages)==null){r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,"null_messages");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}g=q.backup_id;h=q.encrypted_messages;l=q.epoch_derivation_set;E=q.exception_string;w=q.message_range_info;a=q.should_delete_mailbox;v=q.thread_not_found;r.addAnnotations({bool:{should_delete_mailbox:a!=null?a:!1},"int":{response_messages:h.length},string:{message_range_info:JSON.stringify(w)}});if(E!=null){H.ERROR(z(),E);if(v!=null&&v){r.addPoint("thread_not_found_on_server");d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"thread_not_found_on_server",traceId:o});r.endSuccess();d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(o,!1);return d("WAResultOrError").makeError("thread-not-found-on-server")}a===!0&&(r.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX),yield s.runInTransaction(function(a){return c("LSDeleteAndReenrollDeviceStateStoredProcedure")(c("LSFactory")(a),{reenrollmentReason:(k||(k=d("LSIntEnum"))).ofNumber(c("LSMEBDeviceReenrollmentReason").RESTORE_FAILED_WITH_NO_DEVICE_FOUND),targetDeviceId:u})},"readwrite",void 0,void 0,f.id+":465"),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"delete_mailbox",traceId:o}));r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:E}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{exception:E}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("server-side-exception")}r.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START);yield d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(l,s,u,o);r.addAnnotations({bool:{hasEpochs:l!=null&&l.epoch_edges.length>0}});r.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END);g==null&&(H.WARN(y()),r.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"backup_id_null",traceId:o}));q=(yield K(s,e,h,g!=null?g:(j||(j=d("I64"))).to_string(p),w,o,r));if(q.success===!1)return q;M(s,e,q.value,m,n,o);return d("WAResultOrError").makeResult()}catch(b){v=c("getErrorSafe")(b);H.ERROR(x(),v);r.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(a=v.stack)!=null?a:""}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(o,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",v)}});return J.apply(this,arguments)}function K(a,b,c,d,e,f,g){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,h,i,j,k){var x=d("WAJids").threadIdForChatJid(e);e=d("WAHashStringToNumber").hashStringToNumber(j);var y=c("qpl")._(521471755,"2586");g.length===0&&(H.LOG(w()),k.addAnnotations({bool:{hasMessagesToRestore:!1}}),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"no_messages",traceId:j}));if(i==null){H.ERROR(v());k.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}var z=i.has_more_after,A=i.has_more_before,B=i.next_message_timestamp_ms_after;i=i.next_message_timestamp_ms_before;if(A==null||z==null||B==null||i==null){H.ERROR(u());k.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,"message_range_info_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}if(g.length===0){k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_MESSAGES_TO_RESTORE);k.endSuccess();d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.success");return d("WAResultOrError").makeResult({echo:[],messageRangeInfo:{has_more_after:z,has_more_before:A,next_message_timestamp_ms_after:B,next_message_timestamp_ms_before:i},protobuf:[]})}h=d("handleRestoreMessagesGraphQLResponse").processMessageArray(g,h,y,e);var C=h.encryptedLSEchoMessages,D=h.encryptedMessagesWithProtobufs;y=h.encryptedNonLSEchoMessages;e=h.encryptedNonLSProtobufs;k.addAnnotations({bool:{hasEchoMessages:C.length>0,hasProtobufMessages:D.length>0}});g.length!==C.length+D.length&&k.addAnnotations({bool:{hasEchoProtobufCountMismatch:!0}});H.LOG(t(),j,C.length,D.length,y.length,e.length);var E,F;if(C.length>0&&D.length>0){k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RESTORING_MIXED_ECHO_PROTOBUF_PAYLOAD);k.addAnnotations({"int":{echoMessagesPayloadSize:C.length,protobufMessagesPayloadSize:D.length,totalRestorePayloadSize:C.length+D.length}});k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_START);h=(yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:x,encryptedMessages:c("LSVec").ofArray(C)})),e=b[0];b=b[1];if(b!=null){var f=d("LSShape").toRecord(b);H.ERROR(s());H.WARN(r(),f.error_message);k.addAnnotations({string:{echo_decryption_error:f.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,"ECHO_DECRYPTION_FAILURE",{string:{error_description:f.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error")}f=(yield c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:x,encryptedMessagesWithProtobufs:c("LSVec").ofArray(D)}));a=f[0];f=f[1];if(f!=null){f=d("LSShape").toRecord(f);H.ERROR(q());H.WARN(p(),f.error_message);k.endFail("PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:f.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,"PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:f.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("protobuf-decryption-failure")}f=a==null?0:c("LSVec").toArray(a).length;b!=null&&f>0&&k.addAnnotations({bool:{continuedAfterEchoDecryptFailure:!0}});return{decryptedEchoMsgs:e,decryptedProtobufMsgs:a}});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":731"));g=h.decryptedEchoMsgs;y=h.decryptedProtobufMsgs;k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_END);var G;g!=null&&(G=c("LSVec").toArray(g).map(function(a){return d("LSShape").toRecord(a).value}));E=G;F=y==null?[]:c("LSVec").toArray(y)}else if(D.length===0){k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START);e=(yield a.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:x,encryptedMessages:c("LSVec").ofArray(C)})},"readwrite",void 0,void 0,f.id+":835"));h=e[0];g=e[1];if(g!=null){y=d("LSShape").toRecord(g);H.ERROR(o());H.WARN(n(),y.error_message);k.endFail("ECHO_DECRYPTION_FAILURE",{string:{error_description:y.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,"ECHO_DECRYPTION_FAILURE",{string:{error_description:y.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("echo-decryption-failure")}k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END);if(h!=null){e=c("LSVec").toArray(h).map(function(a){return d("LSShape").toRecord(a).value});E=e}}else{k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START);g=(yield a.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:x,encryptedMessagesWithProtobufs:c("LSVec").ofArray(D)})},"readwrite",void 0,void 0,f.id+":884"));y=g[0];h=g[1];if(h!=null){e=d("LSShape").toRecord(h);H.ERROR(m());H.WARN(l(),e.error_message);k.endFail("PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:e.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(j,!1,"PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:e.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("protobuf-decryption-failure")}k.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END);F=y==null?[]:c("LSVec").toArray(y)}k.endSuccess();d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.success");return d("WAResultOrError").makeResult({echo:(a=E)!=null?a:[],messageRangeInfo:{has_more_after:z,has_more_before:A,next_message_timestamp_ms_after:B,next_message_timestamp_ms_before:i},protobuf:(g=F)!=null?g:[]})});return L.apply(this,arguments)}function M(a,b,e,g,h,i){var l=e.echo,m=e.messageRangeInfo,n=e.protobuf,o=d("WAJids").threadIdForChatJid(b);l.length>0&&n.length>0?c("promiseDone")(E.load().then(function(a){return a.echoProtobufConsolidatedRestoreHelper(o,c("LSVec").ofArray(n),m.has_more_before,(j||(j=d("I64"))).of_string(m.next_message_timestamp_ms_before),m.has_more_after,j.of_string(m.next_message_timestamp_ms_after),!1,i,g,void 0,c("LSVec").ofArray(l),(k||(k=d("LSIntEnum"))).ofNumber(h!=null?h:c("LSMEBTaskCreationSource").UNKNOWN),b)})):l.length>0?c("promiseDone")(F.load().then(function(e){return a.runInTransaction(function(a){return e(a,0,(j||(j=d("I64"))).zero,c("LSVec").ofArray(l),m.has_more_before,j.of_string(m.next_message_timestamp_ms_before),m.has_more_after,j.of_string(m.next_message_timestamp_ms_after),!1,o,i,g,(k||(k=d("LSIntEnum"))).ofNumber(h!=null?h:c("LSMEBTaskCreationSource").UNKNOWN),b)},"readwrite",void 0,void 0,f.id+":973")})):c("promiseDone")(G.load().then(function(e){return a.runInTransaction(function(a){return e(a,0,o,c("LSVec").ofArray(n),m.has_more_before,(j||(j=d("I64"))).of_string(m.next_message_timestamp_ms_before),m.has_more_after,j.of_string(m.next_message_timestamp_ms_after),!1,i,g,void 0,c("LSVec").ofArray([]),(k||(k=d("LSIntEnum"))).ofNumber(h!=null?h:c("LSMEBTaskCreationSource").UNKNOWN),b)},"readwrite",void 0,void 0,f.id+":996")}))}g.query=I;g.messageRangeQueryWithPersistence=a}),98);
__d("EBParseUploadSerializationPayload",["EBLogger","MAWEBFrontendQPLLogger","WAErrorMessage","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB upload "," serializer error: "," in ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["parseUploadSerializationResponse: ",""]);i=function(){return a};return a}var j=d("EBLogger").EBLogger.tags(["parseUploadSerializationResponse"]);function a(a){try{a=JSON.parse(a);return d("WAResultOrError").makeResult(a)}catch(b){a=d("WAErrorMessage").maybeGetMessageFromError(b);j.MUSTFIX(i(),a);return d("WAResultOrError").makeError("parse_exception")}}function b(a,b,c,e){var f=[],g=[];a.forEach(function(a){var d=a.error_code+": "+a.error_message;j.MUSTFIX(h(),b,d,c);f.push(a.error_code);g.push(a.error_message)});if(e!=null){d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e,b+"_upload_task_serialization_failure",{int_array:(a={},a[b+"_serialization_error_codes"]=f,a),string_array:(e={},e[b+"_serialization_errors"]=g,e)})}}g.parseUploadSerializationResponse=a;g.logUploadSerializationErrors=b}),98);
__d("EBSMDBCleanupAPI",["EBMainThreadEBDBApiDeferred","EBSMDBAPI","MAWIndexedDbMetadata","Promise","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a==null&&c("promiseDone")(d("EBMainThreadEBDBApiDeferred").clearWorkerState());a=(h||(h=b("Promise"))).all([d("EBSMDBAPI").deleteEBIDB(),d("EBSMDBAPI").deleteEBIDB(d("MAWIndexedDbMetadata").EBSM_WORKER_DB_PREFIX)]).then(function(){});return a}g.cleanupStateTables=a}),98);
__d("EBUploadDeletedMessage",["EncryptedBackupsUploadQueue","I64","MAWUserJidWrapper","WAAsMessageApplication","WAJids","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.instanceKey,c=a.msgId,e=a.sender,f=a.serverTs;a=a.sortOrderMs;try{yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload([{backupDirective:{actionType:3,originalMsgProtocolId:c},instanceKey:b,messageApplication:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(0)),msgId:c,originalMsgProtocolId:c,reportingMeta:null,senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(e,d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid()))),serverTs:f,sortOrderMs:a,triggerSource:"upload-deleted-message"}])}catch(a){return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}return d("WAResultOrError").makeResult()});return i.apply(this,arguments)}g.uploadDeletedMessage=a}),98);
__d("EBUploadMessagesFromWorkerMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9723960407697513"}),null);
__d("EBUploadMessagesFromWorkerMutation.graphql",["EBUploadMessagesFromWorkerMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"XFBTUploadMessageGQLResponse",kind:"LinkedField",name:"xfb_upload_encrypted_msg_to_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"device_epoch_status",storageKey:null},{alias:null,args:null,concreteType:"XFBTUploadMessageHandlerResponse",kind:"LinkedField",name:"backup_write_result_response",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"delete_mailbox",storageKey:null},{alias:null,args:null,concreteType:"XFBTProtobufParams",kind:"LinkedField",name:"protobuf_params",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"delete_on_success",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"EBUploadMessagesFromWorkerMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"EBUploadMessagesFromWorkerMutation",selections:c},params:{id:b("EBUploadMessagesFromWorkerMutation_facebookRelayOperation"),metadata:{},name:"EBUploadMessagesFromWorkerMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("LSHandleBackupWriteCompletion",["EBEnableUnifiedAttachment","LSVec","MAWEBFrontendQPLLogger","Promise","asyncToGeneratorRuntime","cr:847"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){if(g!=null){e=c("LSVec").toArray(g);d("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()&&e.forEach(function(a){return d("MAWEBFrontendQPLLogger").endFlowUploadAttachmentBackup(a,f,"unified")})}if(b("cr:847")!=null){e=g!=null?c("LSVec").toArray(g):[];e.length>0&&(yield b("cr:847")(a,e))}return(h||(h=b("Promise"))).resolve()});return i.apply(this,arguments)}g.call=a}),98);
__d("LSHandleBackupWriteCompletion.nop",["LSHandleBackupWriteCompletion"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c,e){return d("LSHandleBackupWriteCompletion").call(a,b,c,e)};a.__nop_name__="LSHandleBackupWriteCompletion";g["default"]=a}),98);
__d("LSMarkBackupAsCompleted.nop",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(a,c,d,e,f,h,i){return(g||(g=b("Promise"))).resolve()};a.__nop_name__="LSMarkBackupAsCompleted";f["default"]=a}),66);
__d("LSHandleProtobufWriteResult",["LSArrayGetObjectAt","LSMarkBackupAsCompleted.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return a[3]?d[0]=!1:d[0]=!0,d[0]?c.resolve():(d[1]=a[3].get("delete_on_success"),d[1]&&a[0]&&!a[1]?(a[2]?d[2]=!1:d[2]=!0,d[2]?c.resolve():c.sequence([function(e){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.of_int32(a[2].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.nativeOperation(b("LSMarkBackupAsCompleted.nop"),d.actThreadId,d.toplevelOfflineThreadingId,d.supplementalKey,d.messageTimestampMs,d.backupAction))})}])}):c.resolve()},function(e){return d[5]=c.i64.of_int32(a[2].length),c.i64.gt(d[5],c.i64.cast([0,0]))?c.loopAsync(d[5],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,b){var e=a.done;a=a.value;return e?0:(b=a.item,d[12]=b.actThreadId,d[13]=b.toplevelOfflineThreadingId,d[11]=b.supplementalKey,d[14]=b.messageTimestampMs,d[11]!==void 0?c.forEach(c.filter(c.db.table(302).fetch(),function(a){return a.threadId===d[12]&&a.toplevelOfflineThreadingId===d[13]&&a.supplementalKey===d[11]&&c.i64.le(a.messageTimestampMs,d[14])}),function(a){return a["delete"]()}):c.forEach(c.filter(c.db.table(301).fetch(),function(a){return a.threadId===d[12]&&a.offlineThreadingId===d[13]&&c.i64.le(a.messageTimestampMs,d[14])}),function(a){return a["delete"]()}))})}])}):c.resolve()},function(e){return d[6]=c.i64.of_int32(a[2].length),c.i64.gt(d[6],c.i64.cast([0,0]))?c.loopAsync(d[6],function(e){return d[7]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[8])}).next().then(function(a,b){var d=a.done;a=a.value;return d?0:(b=a.item,c.forEach(c.db.table(304).fetch([[[b.toplevelOfflineThreadingId,b.actThreadId]],"offlineThreadingId"]),function(a){return a["delete"]()}))})}])}):c.resolve()}])):c.resolve())},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleProtobufWriteResultStoredProcedure";a.__tables__=["pending_protobuf_backups_context","local_message_persistence_store_supplemental","local_message_persistence_store","local_message_persistence_store_tag_index"];e.exports=a}),null);
__d("LSHandleBackupWriteResultV2",["LSArrayGetObjectAt","LSDeleteBackupOnClient","LSHandleBackupWriteCompletion.nop","LSHandleProtobufWriteResult","LSLogMEBUploadSuccessEvent.nop","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] Beginning execution."),d[1]=c.createArray(),d[2]=c.createArray(),a[3]?d[3]=!1:d[3]=!0,d[3]?c.resolve():(d[12]=c.i64.of_int32(a[3].length),c.i64.gt(d[12],c.i64.cast([0,0]))?c.loopAsync(d[12],function(e){return d[13]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.db.table(177).fetch([[[d[14]]],"fk_pending_tasks"]).next().then(function(e,f){var g=e.done;e=e.value;return g?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] Pending backup task id not found!"),d[18]="Pending backup task id not found!",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] ","",d[18]].join("")),d[17]=c.createArray(),void 0!==void 0?d[19]=(d[17].push(void 0),d[17]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",d[18],d[17],c.i64.cast([0,3]))):(f=e.item,c.sequence([function(d){return c.i64.eq(f.contentType,c.i64.cast([0,1]))?c.nativeOperation(b("LSLogMEBUploadSuccessEvent.nop"),f.uniqueKey,f.lsTraceId,a[1]):c.resolve()},function(a){return d[17]=(d[2].push(f.persistentId),d[2])}]))})}])}):c.resolve())},function(d){return c.storedProcedure(b("LSHandleProtobufWriteResult"),a[1],a[2],a[3],a[4],!1)},function(e){return d[4]=c.i64.of_float(Date.now()),a[3]?d[5]=!1:d[5]=!0,d[5]?c.resolve():(d[12]=c.i64.of_int32(a[3].length),c.i64.gt(d[12],c.i64.cast([0,0]))?c.loopAsync(d[12],function(e){return d[13]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[13]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return c.forEach(c.filter(c.db.table(305).fetch(),function(a){return c.i64.eq(a.pendingBackupTaskId,d[14])}),function(a){return a["delete"]()})}])}):c.resolve())},function(e){return a[2]?c.sequence([function(e){return d[12]=c.i64.of_int32(a[0].length),c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],c.i64.cast([0,0])).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(a){return d[13]=d[14]}])},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!0,d[13],void 0,!0)}]):c.resolve()},function(e){return c.nativeOperation(b("LSHandleBackupWriteCompletion.nop"),a[1],a[0],d[2])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsHandleBackupWriteResultV2StoredProcedure";a.__tables__=["pending_backups_context_v2","pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSHandleBackupWriteResultV2StoredProcedure",["LSHandleBackupWriteResultV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSHandleBackupWriteResultV2"),e.traceIds,e.isSuccess,e.deleteMailbox,e.taskIds,e.protobufParams);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSPrepareOpenEpochV2",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Beginning execution."),c.filter(c.db.table(2).fetch(),function(a){return a.context==="50005"}).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return c.filter(c.db.table(2).fetch(),function(a){return a.context==="320"}).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(a){return d[1]||d[3]?c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] Skipping openEpoch start because there is already an openEpoch flow in progress."),d[5]=c.i64.cast([0,1]))):c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1441]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[19]=!0:d[19]=!1,d[19]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[21]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[21]].join("")),d[20]=c.createArray(),void 0!==void 0?d[22]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[21],d[20],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[18]=new c.Map(),d[18].set("error_msg","Expected a nonempty query result"),d[18].set("code",c.i64.cast([0,3])),d[18].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[19]=c.createArray(),d[20]=(d[19].push(d[18]),d[19]),e=[void 0,d[19]],d[12]=e[0],d[13]=e[1],e):(b=a.item,d[18]=new c.Map(),d[18].set("backup_id",b.backupId),d[18].set("device_public_key_blob",b.devicePublicKeyBlob),d[18].set("device_private_key_blob",b.devicePrivateKeyBlob),d[18].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[18].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[18].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[18].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[18].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[18].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[18].set("orf_client_state_v2_blob",void 0),d[18].set("orf_v2_authority_level",void 0),d[18].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[18].set("device_id",b.deviceId),d[18].set("backup_tenancy",b.backupTenancy),d[18].set("encryption_version",b.encryptionVersion),d[18].set("revision_version",b.revisionVersion),d[18].set("initialize_restore_result",void 0),d[18].set("device_creation_timestamp_sec",void 0),d[18].set("authority_level",b.authorityLevel),e=[d[18],void 0],d[12]=e[0],d[13]=e[1],e)})},function(a){return d[15]=new c.Map(),d[15].set("value",d[12]),d[15].set("errors",d[13]),d[16]=d[15].get("value"),d[16]!==void 0?c.sequence([function(a){return d[18]=d[16].get("backup_id"),d[19]=d[16].get("device_public_key_blob"),d[20]=d[16].get("device_private_key_blob"),d[21]=d[16].get("epoch_storage_public_key_blob"),d[22]=d[16].get("epoch_storage_private_key_blob"),d[23]=d[16].get("epoch_auth_public_key_blob"),d[24]=d[16].get("epoch_auth_private_key_blob"),d[25]=d[16].get("mailbox_root_key_blob"),d[26]=d[16].get("ocmf_client_state_blob"),d[27]=d[16].get("orf_client_state_v2_blob"),d[28]=d[16].get("orf_v2_authority_level"),d[29]=d[16].get("oblivious_validation_token_blob"),d[30]=d[16].get("device_id"),d[31]=d[16].get("backup_tenancy"),d[32]=d[16].get("encryption_version"),d[33]=d[16].get("revision_version"),d[34]=d[16].get("initialize_restore_result"),d[35]=d[16].get("device_creation_timestamp_sec"),d[36]=d[16].get("authority_level"),c.i64.neq(d[30],void 0)?c.sequence([function(a){return d[38]=void 0,c.i64.neq(d[38],void 0)?c.resolve(d[39]=d[38]):c.sequence([function(a){return d[50]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[60]=(d[50].push(c.i64.cast([0,0])),d[50]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[52]=a[0],a})},function(a){return d[52]?d[60]=(d[50].push(c.i64.cast([0,2])),d[50]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[60]=(d[50].push(c.i64.cast([0,3])),d[50]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[60]=(d[50].push(c.i64.cast([0,4])),d[50]):0,d[55]=c.createArray(),d[56]=c.i64.of_int32(d[50].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.loopAsync(d[56],function(a){return d[60]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[50],d[60]).then(function(a){return a=a,d[61]=a[0],d[62]=a[1],a})},function(a){return d[63]=(d[55].push(d[61]),d[55])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[60]=c.createArray(),d[61]=c.i64.of_int32(d[55].length),c.i64.gt(d[61],c.i64.cast([0,0]))?c.loopAsync(d[61],function(a){return d[63]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[55],d[63]).then(function(a){return a=a,d[64]=a[0],d[65]=a[1],a})},function(a){return d[66]=(d[60].push(c.i64.to_string(d[64])),d[60])}])}):c.resolve()},function(a){return d[62]=d[60].join(","),d[57]=d[62]}])},function(a){return d[55].some(function(a){return c.i64.eq(d[32],a)})?d[58]=d[32]:d[58]=void 0,c.i64.neq(d[58],void 0)?d[59]=d[58]:d[59]=void 0,d[39]=d[59]}])},function(a){return c.i64.neq(d[39],void 0)?d[40]=d[39]:d[40]=c.i64.cast([0,0]),c.i64.neq(d[31],void 0)?d[41]=d[31]:d[41]=c.i64.cast([0,1]),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2821]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[51]=!0:d[51]=!1,d[51]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[53]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[53]].join("")),d[52]=c.createArray(),void 0!==void 0?d[54]=(d[52].push(void 0),d[52]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[53],d[52],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[42]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[50]=(d[42].push(a.epochId),d[42])})},function(a){return d[48]="Queried locally available epochs. Count: ",d[43]=c.i64.of_int32(d[42].length),d[49]=c.i64.to_string(d[43]),d[44]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[44],d[48],d[44],d[49]].join("")),c.resolve()},function(a){return d[45]=new c.Map(),d[45].set("backup_id",d[18]),d[45].set("locally_available_epochs",d[42]),d[45].set("device_id",d[30]),d[45].set("trace_id",void 0),d[46]=c.toJSON(d[45]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_request_for_asssoc_devices",c.i64.cast([0,50005]),d[46],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1442]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[50]=a[0],a})},function(a){return d[50]?d[51]=!0:d[51]=!1,d[51]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[53]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[53]].join("")),d[52]=c.createArray(),void 0!==void 0?d[54]=(d[52].push(void 0),d[52]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[53],d[52],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[37]=c.i64.cast([0,0])}]):c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2822]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[40]=!0:d[40]=!1,d[40]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[42]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[42],d[41],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[38]="No backup found.",d[38]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",d[38]].join("")),d[39]=c.createArray(),void 0!==void 0?d[40]=(d[39].push(void 0),d[39]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",d[38],d[39],c.i64.cast([0,3]))):c.resolve()},function(a){return d[37]=c.i64.cast([0,1])}])},function(a){return d[17]=d[37]}]):c.sequence([function(a){return d[18]=d[15].get("errors"),d[19]=d[15].get("errors"),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2822]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!0:d[22]=!1,d[22]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[24]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[24]].join("")),d[23]=c.createArray(),void 0!==void 0?d[25]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[24],d[23],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[20]="No backup found.",d[20]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ","",d[20]].join("")),d[21]=c.createArray(),void 0!==void 0?d[22]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",d[20],d[21],c.i64.cast([0,3]))):c.resolve()},function(a){return d[17]=c.i64.cast([0,1])}])},function(a){return d[5]=d[17]}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[5]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsPrepareOpenEpochV2StoredProcedure";a.__tables__=["pending_tasks","secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSPrepareOpenEpochV2StoredProcedure",["LSPrepareOpenEpochV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSPrepareOpenEpochV2"),e.backupId,e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSyncEpochs",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] Beginning execution."),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1436]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[13]=a[0],a})},function(a){return d[13]?d[14]=!0:d[14]=!1,d[14]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[16]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[16]].join("")),d[15]=c.createArray(),void 0!==void 0?d[17]=(d[15].push(void 0),d[15]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[16],d[15],c.i64.cast([0,3]))):c.resolve()}])},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[13]=new c.Map(),d[13].set("error_msg","Expected a nonempty query result"),d[13].set("code",c.i64.cast([0,3])),d[13].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[14]=c.createArray(),d[15]=(d[14].push(d[13]),d[14]),e=[void 0,d[14]],d[1]=e[0],d[2]=e[1],e):(b=a.item,d[13]=new c.Map(),d[13].set("backup_id",b.backupId),d[13].set("device_public_key_blob",b.devicePublicKeyBlob),d[13].set("device_private_key_blob",b.devicePrivateKeyBlob),d[13].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[13].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[13].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[13].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[13].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[13].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[13].set("orf_client_state_v2_blob",void 0),d[13].set("orf_v2_authority_level",void 0),d[13].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[13].set("device_id",b.deviceId),d[13].set("backup_tenancy",b.backupTenancy),d[13].set("encryption_version",b.encryptionVersion),d[13].set("revision_version",b.revisionVersion),d[13].set("initialize_restore_result",void 0),d[13].set("device_creation_timestamp_sec",void 0),d[13].set("authority_level",b.authorityLevel),e=[d[13],void 0],d[1]=e[0],d[2]=e[1],e)})},function(a){return d[4]=new c.Map(),d[4].set("value",d[1]),d[4].set("errors",d[2]),d[5]=d[4].get("value"),d[5]!==void 0?c.sequence([function(a){return d[13]=d[5].get("backup_id"),d[14]=d[5].get("device_public_key_blob"),d[15]=d[5].get("device_private_key_blob"),d[16]=d[5].get("epoch_storage_public_key_blob"),d[17]=d[5].get("epoch_storage_private_key_blob"),d[18]=d[5].get("epoch_auth_public_key_blob"),d[19]=d[5].get("epoch_auth_private_key_blob"),d[20]=d[5].get("mailbox_root_key_blob"),d[21]=d[5].get("ocmf_client_state_blob"),d[22]=d[5].get("orf_client_state_v2_blob"),d[23]=d[5].get("orf_v2_authority_level"),d[24]=d[5].get("oblivious_validation_token_blob"),d[25]=d[5].get("device_id"),d[26]=d[5].get("backup_tenancy"),d[27]=d[5].get("encryption_version"),d[28]=d[5].get("revision_version"),d[29]=d[5].get("initialize_restore_result"),d[30]=d[5].get("device_creation_timestamp_sec"),d[31]=d[5].get("authority_level"),c.i64.neq(d[25],void 0)?c.sequence([function(a){return d[33]=void 0,c.i64.neq(d[33],void 0)?c.resolve(d[34]=d[33]):c.sequence([function(a){return d[41]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[51]=(d[41].push(c.i64.cast([0,0])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[51]=(d[41].push(c.i64.cast([0,2])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[51]=(d[41].push(c.i64.cast([0,3])),d[41]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[51]=(d[41].push(c.i64.cast([0,4])),d[41]):0,d[46]=c.createArray(),d[47]=c.i64.of_int32(d[41].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[41],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[46].push(d[52]),d[46])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[51]=c.createArray(),d[52]=c.i64.of_int32(d[46].length),c.i64.gt(d[52],c.i64.cast([0,0]))?c.loopAsync(d[52],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[51].push(c.i64.to_string(d[55])),d[51])}])}):c.resolve()},function(a){return d[53]=d[51].join(","),d[48]=d[53]}])},function(a){return d[46].some(function(a){return c.i64.eq(d[27],a)})?d[49]=d[27]:d[49]=void 0,c.i64.neq(d[49],void 0)?d[50]=d[49]:d[50]=void 0,d[34]=d[50]}])},function(a){return c.i64.neq(d[34],void 0)?d[35]=d[34]:d[35]=c.i64.cast([0,0]),c.i64.neq(d[26],void 0)?d[36]=d[26]:d[36]=c.i64.cast([0,1]),c.filter(c.db.table(2).fetch(),function(a){return a.context==="50013"}).next().then(function(a,b){b=a.done;a=a.value;return b?d[37]=!1:(a.item,d[37]=!0)})},function(a){return c.filter(c.db.table(2).fetch(),function(a){return a.context==="50025"}).next().then(function(a,b){b=a.done;a=a.value;return b?d[39]=!1:(a.item,d[39]=!0)})},function(a){return d[37]||d[39]?(d[41]="Another sync job is already in progress. Terminating this.",d[41]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",d[41]].join("")),d[42]=c.createArray(),void 0!==void 0?d[43]=(d[42].push(void 0),d[42]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",d[41],d[42],c.i64.cast([0,3]))):c.resolve()):c.sequence([function(a){return c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,2849]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]?d[50]=!0:d[50]=!1,d[50]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[52]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[53]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[52],d[51],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[41]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[49]=(d[41].push(a.epochId),d[41])})},function(a){return d[47]="Queried locally available epochs. Count: ",d[42]=c.i64.of_int32(d[41].length),d[48]=c.i64.to_string(d[42]),d[43]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[43],d[47],d[43],d[48]].join("")),c.resolve()},function(a){return d[44]=new c.Map(),d[44].set("backup_id",d[13]),d[44].set("device_id",d[25]),d[44].set("locally_available_epochs",d[41]),d[44].set("trace_id",void 0),d[45]=c.toJSON(d[44]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"messenger_encrypted_backups",c.i64.cast([0,50025]),d[45],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[46]=a[0],a})}])},function(a){return d[32]=!0}]):c.sequence([function(a){return d[33]=["Failed to load client state: ","","NULL_DEVICE_ID"].join(""),d[33]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",d[33]].join("")),d[34]=c.createArray(),void 0!==void 0?d[35]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",d[33],d[34],c.i64.cast([0,3]))):c.resolve()},function(a){return d[32]=!1}])},function(a){return d[6]=d[32]}]):c.sequence([function(a){return d[13]=d[4].get("errors"),d[14]=d[4].get("errors"),d[15]=["Failed to load client state: ","","BACKUP_NOT_FOUND"].join(""),d[15]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ","",d[15]].join("")),d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",d[15],d[16],c.i64.cast([0,3]))):c.resolve()},function(a){return d[6]=!1}])},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsSyncEpochsStoredProcedure",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsSyncEpochsStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_tasks","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSSyncEpochsStoredProcedure",["LSSyncEpochs","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a){a=a.storedProcedure(c("LSSyncEpochs"));return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWEBFalcoLoggerUtils",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=(f=c("requireDeferred"))("EncryptedBackupTaskFailureFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),i=f("EncryptedBackupTaskIssuedFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),j=f("EncryptedBackupTaskSkippedFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),k=f("EncryptedBackupUploadSuccessFalcoEvent").__setRef("MAWEBFalcoLoggerUtils"),l={0:"unknown",1:"upsert_top_level",2:"upsert_supplemental",3:"delete_top_level",4:"delete_top_level_with_placeholder"};function a(a,b){m(a,b)}function b(a,b,c){m(a,b,c)}function d(a,b,c){m(a,b,void 0,c)}function m(a,b,c,d){c!=null?void h.onReady(function(d){d.log(function(){var d;return{backup_action:(d=l[(d=(d=a.protoMsg)==null?void 0:d.backupActionType)!=null?d:0])!=null?d:"unknown",backup_protocol:b,failure_reason:c,labyrinth_version:0,message_id:(d=(d=a.protoMsg)==null?void 0:(d=d.msgId)==null?void 0:d.externalId)!=null?d:a.messageId,thread_id:a.threadId,trace_id:a.traceId}})}):d!=null?void j.onReady(function(c){c.log(function(){var c;return{backup_action:(c=l[(c=(c=a.protoMsg)==null?void 0:c.backupActionType)!=null?c:0])!=null?c:"unknown",backup_protocol:b,labyrinth_version:0,message_id:(c=(c=a.protoMsg)==null?void 0:(c=c.msgId)==null?void 0:c.externalId)!=null?c:a.messageId,skipped_reason:d,thread_id:a.threadId,trace_id:a.traceId}})}):void i.onReady(function(c){c.log(function(){var c;return{backup_action:(c=l[(c=(c=a.protoMsg)==null?void 0:c.backupActionType)!=null?c:0])!=null?c:"unknown",backup_protocol:b,labyrinth_version:0,message_id:(c=(c=a.protoMsg)==null?void 0:(c=c.msgId)==null?void 0:c.externalId)!=null?c:a.messageId,thread_id:a.threadId,trace_id:a.traceId}})})}function e(a){void k.onReady(function(b){b.log(function(){var b;return{labyrinth_version:0,message_id:(b=(b=a.protoMsg)==null?void 0:(b=b.msgId)==null?void 0:b.externalId)!=null?b:a.messageId,thread_id:a.threadId,trace_id:a.traceId}})})}g.BackupActionMap=l;g.logEBFalcoTaskIssued=a;g.logEBFalcoTaskFailure=b;g.logEBFalcoTaskSkipped=d;g.logEBFalcoEncryptedBackupUploadSuccess=e}),98);
__d("LSBackupContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({MESSAGE:1,THREAD:2});f["default"]=a}),66);
__d("LSPendingBackupStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({NEEDS_BACKUP:1,BACKUP_IN_PROGRESS:2,BLOCKED:3});f["default"]=a}),66);
__d("LSSerializeAttachmentBackupPayloadStoredProcedure",["LSSerializeAttachmentBackupPayload","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSerializeAttachmentBackupPayload"),e.attachmentInfos,e.messageId,e.threadId,e.productType,e.error,e.errorMessage);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MAWUploadPayloadGenerator",["EBLogger","EBParseUploadSerializationPayload","I64","LSBackupContentType","LSEncryptedBackupsAttachmentErrorCode","LSFactory","LSIntEnum","LSPendingBackupStatus","LSSerializeAttachmentBackupPayloadStoredProcedure","LSShape","LSTaskSerializerEncryptedBackupsUpload","LSVec","MAWBridgeUploadMessageHandler","MAWEBFrontendQPLLogger","MWEBODSUtils","Promise","Random","ReQL","WAErrorMessage","WAGetSafeQPLError","WAResultOrError","asyncToGeneratorRuntime","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["upload message is missing echo document msgType: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB upload serializer error: "," in ",""]);l=function(){return a};return a}var m=d("EBLogger").EBLogger.tags(["MAWUploadPayloadGenerator"]),n="0",o=new Set();function p(){for(var a=0;a<1e8;a++){var b=d("Random").uint32();if(!o.has(b))return b}throw m.mustfixThrow("Unable to generate a unique task ID after 100 million attempts")}function a(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g="unknown";c("justknobx")._("4439")&&(g=(yield x(a))?"available":"unavailable");e=e.map(function(b){try{var c=p();o.add(c);return d("WAResultOrError").makeResult({msg:b,taskMetadata:r(a,b,c)})}catch(a){c=d("WAErrorMessage").maybeGetMessageFromError(a);return d("WAResultOrError").makeError({error:c,instanceKey:b.uploadTrackingInstanceKey})}});e=(yield (j||(j=b("Promise"))).all(e.map(function(a){return a.success?a.value:null}).filter(Boolean)));e=(yield j.all(e.map(function(e){var i=e.taskMetadata;return i.then(function(i){var k;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking((k=i.uploadTrackingInstanceKey)!=null?k:null,"upload_task_serialization_start",{string:{base_epoch_availability:g,execution_environment:f}});return c("LSTaskSerializerEncryptedBackupsUpload")((h||(h=d("I64"))).of_int32(i.task),c("LSFactory")(a)).then(function(g){if(g.length>0&&g[0]!=null){var h=d("EBParseUploadSerializationPayload").parseUploadSerializationResponse(g[0]);if(h.success){h=h.value;var k=!1;h.failure!=null&&(k=!0,d("EBParseUploadSerializationPayload").logUploadSerializationErrors([h.failure],"echo",f,i.uploadTrackingInstanceKey));if(h.protobuf_failures!=null){h=c("LSVec").toArray(h.protobuf_failures).filter(Boolean);h.length>0&&(k=!0,d("EBParseUploadSerializationPayload").logUploadSerializationErrors(h,"protobuf",f,i.uploadTrackingInstanceKey))}if(!k){d("MAWEBFrontendQPLLogger").addPointEBUploadTracking((h=i.uploadTrackingInstanceKey)!=null?h:null,"upload_task_serialization_success",{string:{execution_environment:f}})}}}k=i.pending_protobuf_backups_context_pk;return(j||(j=b("Promise"))).all([a.pending_backups_context_v2["delete"](i.pending_backups_context_v2_pk),k!=null?a.pending_protobuf_backups_context["delete"](k):(j||(j=b("Promise"))).resolve(null)]).then(function(){o["delete"](i.task);return d("WAResultOrError").makeResult({msg:e.msg,payload:g[0]})})})["catch"](function(a){var b,c=d("WAErrorMessage").maybeGetMessageFromError(a);d("MAWEBFrontendQPLLogger").addPointEBUploadTracking((b=i.uploadTrackingInstanceKey)!=null?b:null,"upload_task_serialization_failure",{string:{serialization_error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}});m.MUSTFIX(l(),d("WAGetSafeQPLError").getSafeQPLErrorMessage(a),f);return d("WAResultOrError").makeError({error:c,instanceKey:e.msg.uploadTrackingInstanceKey})})})})));return e});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=b.sortOrderMs.toString(),g=(h||(h=d("I64"))).of_int32(e),j=h.of_float(b.actionType),l=(yield u(a,b)),n=b.protoMsg,o=n!=null&&c("gkx")("8488");if(!o&&(b.echoDocument==null||b.echoDocument.length===0)){var p;m.MUSTFIX(k(),(p=b.messageType)!=null?p:"unknown");d("MWEBODSUtils").markODSForEB("upload","missing_echo_document."+((p=b.messageType)!=null?p:"unknown"))}j=(yield a.pending_backups_context_v2.add({actionType:j,attachmentErrorCode:w(b),attachmentPayload:l,backupStatus:(i||(i=d("LSIntEnum"))).ofNumber(c("LSPendingBackupStatus").BACKUP_IN_PROGRESS),contentType:i.ofNumber(c("LSBackupContentType").MESSAGE),echoContent:o?"":(p=b.echoDocument)!=null?p:"",listKey:b.threadId,pendingBackupTaskId:h.of_int32(e),persistentId:"",pk:g,sortKey:f,uniqueKey:b.messageId}));if(n==null)return{pending_backups_context_v2_pk:j[0],task:e,uploadTrackingInstanceKey:b.uploadTrackingInstanceKey};g=(yield a.pending_protobuf_backups_context.add({actThreadId:b.threadId,attachmentPayload:l,backupAction:h.of_float(n.backupActionType),messageTimestampMs:h.of_float(b.sortOrderMs),pendingBackupTaskId:h.of_float(e),supplementalKey:n.supplementalKey,toplevelOfflineThreadingId:n.backupActionType===4?n.msgId.externalId:(p=(o=n.originalMsgProtocolId)==null?void 0:o.externalId)!=null?p:n.msgId.externalId}));return{pending_backups_context_v2_pk:j[0],pending_protobuf_backups_context_pk:g[0],task:e,uploadTrackingInstanceKey:b.uploadTrackingInstanceKey}});return s.apply(this,arguments)}function t(a){if(a.attachmentInfos.length!==1)return[];a=a.attachmentInfos[0];return[{attachment_trace_id:a.attachmentTraceId,media_type:a.mediaType,zippy_object_id:a.zippyObjectId}]}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!c("gkx")("6956"))return void 0;var e,f,g=b.attachmentBackupContext;if(g!=null){f=d("MAWBridgeUploadMessageHandler").getMessageUploadAttachmentBackupContext({bridgeUploadAttachmentBackupContext:g,messageId:b.messageId,serverThreadKey:null,threadId:b.threadId,traceId:b.traceId});if(f!=null){a=(yield c("LSSerializeAttachmentBackupPayloadStoredProcedure")(c("LSFactory")(a),{attachmentInfos:f.attachment_infos,error:f.error,errorMessage:f.error_message,messageId:b.messageId,productType:f.product_type,threadId:b.threadId}));f=a[0];b=a[1];if(f!=null){a=d("LSShape").toRecord(f);e=JSON.stringify({success:a.payload,upload_context:t(g)})}else if(b!=null){f=d("LSShape").toRecord(b);a=f.error_code;e=JSON.stringify({failure:{error_code:(h||(h=d("I64"))).to_float(a),error_message:f.error_message,stored_procedure:f.stored_procedure},upload_context:t(g)})}}}return e});return v.apply(this,arguments)}function w(a){return!c("gkx")("6956")?void 0:(h||(h=d("I64"))).of_float(((a=a.attachmentBackupContext)==null?void 0:a.error)!=null?c("LSEncryptedBackupsAttachmentErrorCode").UNKNOWN_ERROR:c("LSEncryptedBackupsAttachmentErrorCode").NO_ERROR)}function x(a){var b=new TextDecoder();return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.secure_encrypted_backups_epochs).filter(function(a){return b.decode(a.epochAnonIdBlob)===n})).then(function(a){if(a!=null)return!0;else return!1})}g.genUploadPayload=a}),98);
__d("XFBEBDeviceEpochStatus.facebook",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum").Mirrored(["INELIGIBLE_FOR_LABYRINTH_11","NO_OPEN_EPOCH","OK","OUTDATED","RATE_LIMITED"]);c=a;f["default"]=c}),66);
__d("EBUploadMessagesFromWorkerMutation",["EBIsEbEnabled","EBLS","EBUploadMessagesFromWorkerMutation.graphql","EncryptedBackupsWriteToMPSTables","FBLogger","I64","LSEBPayloadSerializerError","LSFactory","LSHandleBackupWriteResultV2StoredProcedure","LSPrepareOpenEpochV2StoredProcedure","LSShape","LSSyncEpochsStoredProcedure","LSVec","MAWCurrentUser","MAWEBFalcoLoggerUtils","MAWEBUploadTrackingUtils","MAWUploadPayloadGenerator","MWEBODSEntityName.enum","ODS","Promise","WAErrorMessage","WALogger","WAResultOrError","asyncToGeneratorRuntime","createWorkerMutation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to upload with EBLS: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] graphqlResponse is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to generate payload: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] backupWriteResult is null"]);o=function(){return a};return a}var p=h!==void 0?h:h=b("EBUploadMessagesFromWorkerMutation.graphql");function q(a,b){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBUploadTrackingUtils").addPointWorkerOnly(a.uploadTrackingInstanceKey,b)})}function r(a,b,c){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBUploadTrackingUtils").endFailWorkerOnly(a.uploadTrackingInstanceKey,b,c)})}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.backupWriteResult,e=a.deviceEpochStatus,g=a.exception_string,h=a.inputMessages;if(b==null){r(h,"ebls_upload_failed_backup_write_result_null",{string:{error:"backupWriteResult is null"}});d("WALogger").ERROR(o());return d("WAResultOrError").makeError("backup_write_result_null")}a=(yield d("EBLS").getLSStorage());var i=b.is_success,j=b.delete_mailbox,k=(b=b.protobuf_params)==null?void 0:b.delete_on_success;if(i!=null&&j!=null){if(!i){r(h,"ebls_upload_failed",{string:{error:g}});return d("WAResultOrError").makeError("gql_upload_failed")}else c("FBLogger")("labyrinth_web").info("Worker successfully completed GQL upload batch of size %s",h.length),q(h,"ebls_upload_success");yield a.runInTransaction(function(a){return c("LSHandleBackupWriteResultV2StoredProcedure")(c("LSFactory")(a),{deleteMailbox:j,isSuccess:i,protobufParams:k!=null?d("LSShape").ofRecord({delete_on_success:k}):void 0,traceIds:c("LSVec").ofArray(h.map(function(a){return a.traceId}))})},"readwrite",void 0,void 0,f.id+":161")}if(e==null)return d("WAResultOrError").makeError("device_epoch_status_null");switch(e){case"NO_OPEN_EPOCH":q(h,"prepare_open_epoch_v2_start");yield a.runInTransaction(function(a){return c("LSPrepareOpenEpochV2StoredProcedure")(c("LSFactory")(a),{backupId:void 0})},"readwrite",void 0,void 0,f.id+":185");q(h,"prepare_open_epoch_v2_end");break;case"OUTDATED":q(h,"sync_epochs_start");yield a.runInTransaction(function(a){return c("LSSyncEpochsStoredProcedure")(c("LSFactory")(a))},"readonly",void 0,void 0,f.id+":196");q(h,"sync_epochs_start");break;case"OK":break;default:}return d("WAResultOrError").makeResult()});return t.apply(this,arguments)}function a(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{(k||(k=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"worker_thread");q(a,"ebls_init_start");yield d("EBLS").init();var e=(yield d("EBLS").getLSStorage());q(a,"ebls_backup_tenancy_start");if(!(yield d("EBIsEbEnabled").isEbEnabledLS(e.tables))){for(var g of a)if(g.uploadTrackingInstanceKey!=null){var h=g.uploadTrackingInstanceKey;d("MAWEBUploadTrackingUtils").addPointWorkerOnly(h,"user_device_not_enrolled_invalid_gql_request");var o=g.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskSkipped(g,o,"user_device_not_enrolled");d("MAWEBUploadTrackingUtils").endSuccessWorkerOnly(h,"upload_tracking_completed")}return d("WAResultOrError").makeError("ebls_not_initialized")}q(a,"ebls_upload_start");var t;try{t=(yield e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(e){q(a,"ebls_lsdb_write_start");var f=(yield (i||(i=b("Promise"))).all(a.map(function(a){var f=a.protoMsg,g=a.threadId,h=a.uploadTrackingInstanceKey;if(f==null)return null;h=h!=null?d("MAWEBUploadTrackingUtils").makeEBWorkerQplFlowFromInstanceKey(h):null;f=f.backupActionType===1?(i||(i=b("Promise"))).all([d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(e,f,g,!1,h),d("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(e,f,g)]).then(function(a){var b=a[0];a[1];return b}):d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(e,f,g,!1,h);return f.then(function(b){if(!b.success){var e=a.uploadTrackingInstanceKey;b=b.error;var f=b.errorCode;b=b.errorMsg;e!=null&&(v(f)?d("MAWEBUploadTrackingUtils").endCancelWorkerOnly(e,{"int":{errorCode:f!=null?(j||(j=d("I64"))).to_float(f):c("LSEBPayloadSerializerError").UNKNOWN},string:{error:b}}):d("MAWEBUploadTrackingUtils").endFailWorkerOnly(e,"mps_write_failed",{string:{error:b}}));return null}return a})}).filter(Boolean)).then(function(a){return a.filter(Boolean)}));q(a,"ebls_mps_write_complete");return d("MAWUploadPayloadGenerator").genUploadPayload(e,f,"worker").then(function(a){return a.map(function(a){if(!a.success){var b=a.error,c=b.error;b=b.instanceKey;b!=null&&d("MAWEBUploadTrackingUtils").endFailWorkerOnly(b,"ebls_payload_generation_failed",{string:{error:c}});return null}return a.value}).filter(Boolean)})});return function(a){return e.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":249")),q(a,"ebls_upload_payload_generated")}catch(b){o=d("WAErrorMessage").maybeGetMessageFromError(b);r(a,"ebls_upload_failed_payload",{string:{error:o}});d("WALogger").ERROR(n(),o);return d("WAResultOrError").makeError("upload_serialization_failure")}if(t.length===0){r(a,"ebls_upload_payload_empty");return d("WAResultOrError").makeResult()}h=t.map(function(a){return a.msg});h.forEach(function(b){var a=b.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskIssued(b,a)});g=c("createWorkerMutation")(p);e=g[0];o=(yield e({input:{app_id_str:d("MAWCurrentUser").getAppID(),payload:{msg_payloads:t.map(function(a){return a.payload}).filter(Boolean)}}}));q(h,"ebls_received_gql_upload_response");if(o==null){r(h,"ebls_upload_failed_response_null");d("WALogger").ERROR(m());h.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,"ebls_not_initialized")});return d("WAResultOrError").makeError("gql_upload_null_response")}e=(g=o.xfb_upload_encrypted_msg_to_backup)!=null?g:{};o=e.backup_write_result_response;g=e.device_epoch_status;e=e.exception_string;var u=(yield s({backupWriteResult:o,deviceEpochStatus:g,exception_string:e,inputMessages:h}));!u.success?h.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,u.error)}):h.forEach(function(a){d("MAWEBFalcoLoggerUtils").logEBFalcoEncryptedBackupUploadSuccess(a)});return u}catch(b){o=d("WAErrorMessage").maybeGetMessageFromError(b);r(a,"ebls_upload_failed_response",{string:{error:o}});a.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,"ebls_not_initialized")});d("WALogger").ERROR(l(),b);return d("WAResultOrError").makeError("gql_upload_runtime_error")}});return u.apply(this,arguments)}function v(a){switch(a){case c("LSEBPayloadSerializerError").SKIP_MPS_WRITE_DUE_TO_HIGHER_TIMESTAMP_AVAILABILITY:case c("LSEBPayloadSerializerError").MESSAGE_ALREADY_DELETED:return!0;default:return!1}return!1}g.uploadMessagesFromWorker=a}),98);
__d("EncryptedBackupsCastToAttachmentContextMediaType",["EncryptedBackupsUploadEntity","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Not a valid AttachmentContextMediaType: ",""]);h=function(){return a};return a}function a(a){switch(a){case d("MAWDbMedia").MEDIA_TYPE.IMAGE:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE;case d("MAWDbMedia").MEDIA_TYPE.VIDEO:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO;case d("MAWDbMedia").MEDIA_TYPE.PTT:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT;case d("MAWDbMedia").MEDIA_TYPE.GIF:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF;case d("MAWDbMedia").MEDIA_TYPE.STICKER:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER;case d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE:return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT;default:a;d("WALogger").ERROR(h(),a);return d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.INVALID}}g["default"]=a}),98);
__d("EncryptedBackupsGetAttachmentContextForReceivedMsg",["EncryptedBackupsCastToAttachmentContextMediaType","EncryptedBackupsUploadEntity","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=new Map();if(((b=a.decodedMsg)==null?void 0:b.unstoredDbMedia)!=null){b=(b=a.decodedMsg)==null?void 0:b.unstoredDbMedia;var f=b.mediaType;b=d("WAMediaUtils").decodeMediaEntryData(b.mediaEntry);var g=b.downloadableThumbnail;b=b.objectId;g=g==null?void 0:g.objectId;f=c("EncryptedBackupsCastToAttachmentContextMediaType")(f);b!=null&&f!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(b),f);g!=null&&g!==b&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(g),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW)}if(((f=a.decodedMsg)==null?void 0:f.unstoredXMA)!=null){g=(b=a.decodedMsg)==null?void 0:b.unstoredXMA;if(g.unstoredFavicon!=null){f=d("WAMediaUtils").decodeMediaEntryData(g.unstoredFavicon.mediaEntry);a=f.objectId;a!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(a),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}if(g.unstoredHeaderMedia!=null){b=d("WAMediaUtils").decodeMediaEntryData(g.unstoredHeaderMedia.mediaEntry);f=b.objectId;f!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(f),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}if(g.unstoredAssociatedMedia!=null){a=d("WAMediaUtils").decodeMediaEntryData(g.unstoredAssociatedMedia.mediaEntry);b=a.objectId;b!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(b),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}g.unstoredPreviews!=null&&g.unstoredPreviews.length>0&&g.unstoredPreviews.forEach(function(a){a=a.mediaEntry;a=d("WAMediaUtils").decodeMediaEntryData(a);a=a.objectId;a!=null&&e.set(d("WAMediaUtils").stringToDeliveryObjectId(a),d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)})}return Array.from(e.entries()).map(function(a){var b=a[0];a=a[1];return{mediaObjectId:b,mediaType:a}})}g["default"]=a}),98);
__d("MessageBackupDirectiveGenerator",["FBLogger","I64","MAWJids","MAWMsgType","MessageBackupSupplementalKeyGenerator","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){a=d("MessageBackupSupplementalKeyGenerator").createReactionSupplementalKey(a);if(a!=null)return a;throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to create reaction supplemental key")}function j(a,b){a=d("MessageBackupSupplementalKeyGenerator").createEditSupplementalKey(a,b);if(a!=null)return a;throw c("FBLogger")("labyrinth_web").mustfixThrow("Failed to create edit supplemental key")}function k(a,b){b=d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b).toString());return{actionType:2,originalMsgProtocolId:a,supplementalKey:i(b)}}function l(a,b,c){b=d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b).toString());return{actionType:2,originalMsgProtocolId:a,supplementalKey:j(b,c)}}function m(a){if(d("WAJids").isAuthorSystem(a.author))return null;if(a.reactToExternalId!=null)return{author:a.reactToAuthor===d("WAGlobals").getMyUserJid()?"@me":a.reactToAuthor,chat:a.threadJid,externalId:a.reactToExternalId};else if(a.originalMsgExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.originalMsgExternalId};else if(a.revokedExternalId!=null)return{author:a.author,chat:a.threadJid,externalId:a.revokedExternalId};return a.externalId==null?null:{author:a.author,chat:a.threadJid,externalId:a.externalId}}function a(a){var b=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(a.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),e=m(a);if(e==null)return null;if(a.originalMsgExternalId!=null){if(a.editTs==null){c("FBLogger")("labyrinth_web").mustfix("editTs is null for edit message during createMessageBackupDirectiveFromDbMsg");return null}return l(e,b,d("WATimeUtils").castUnixTimeToMillisTime(a.editTs))}return a.reactToExternalId!=null?k(e,b):n(e,b,a.type,null)}function n(a,b,e,f){switch(e){case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.XMA:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:return{actionType:1,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.REACTION:return k(a,b);case d("MAWMsgType").MSG_TYPE.EDIT_ACTION:if(f==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("editTs is null for edit message during createMessageBackupDirective");return l(a,b,f);case d("MAWMsgType").MSG_TYPE.REVOKED:return{actionType:4,originalMsgProtocolId:a};case d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME:return{actionType:3,originalMsgProtocolId:a};default:c("FBLogger")("labyrinth_web").mustfix("Unsupported message type %s",e);return{actionType:0,originalMsgProtocolId:a}}}g.createMessageBackupDirectiveFromDbMsg=a;g.createMessageBackupDirective=n}),98);
__d("MessageBackupDirectiveTypes",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.actionType,c=a.messageId;a=a.supplementalKey;return{actionType:b,originalMsgProtocolId:{externalId:c},supplementalKey:a!=null?a:void 0}}f.getMessageBackupDirectiveFromMessageTransportBackupDirective=a}),66);
__d("EncryptedBackupsCreateUploadMessage",["EBAPIQPLPoints","EBGenerateMessageTags","EncryptedBackupsConvertToLegacyAttachmentContext","EncryptedBackupsGetAttachmentContextForReceivedMsg","I64","LSRequestId","MAWEBSwitch","MAWMessageSortOrderUtils","MAWMsgType","MessageBackupDirectiveGenerator","MessageBackupDirectiveTypes","QPLUserFlow","WAAsMessageApplication","WAByteArray","WAConsumerApplication.pb","WAGlobals","WAJids","WALogger","WAMsgApplication.pb","WATimeUtils","decodeProtobuf","encodeProtobuf","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] no result or failed for incoming stanza ",""]);i=function(){return a};return a}function j(a){if(a==null)return null;var b;if(a.unstoredDbReaction!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.unstoredDbEditActionMsg!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.unstoredDbMedia!=null){var e;b=a.unstoredDbMedia.mediaType;e=(e=a.unstoredDbMsg)==null?void 0:e.ephemeralSetting}else if(a.unstoredXMA!=null){var f;b=d("MAWMsgType").MSG_TYPE.XMA;e=(f=(f=a.unstoredDbMsg)==null?void 0:f.ephemeralSetting)!=null?f:(f=a.unstoredXMA.unstoredAssociatedMsg)==null?void 0:f.ephemeralSetting}else if(a.unstoredDbMsg!=null)b=a.unstoredDbMsg.type,e=a.unstoredDbMsg.ephemeralSetting;else return null;f=c("gkx")("11820");a=f?d("MAWMsgType").isProtobufUploadSupportedMsgType(b):d("MAWMsgType").isEBSupportedMsgType(b);return a&&!(e!=null&&e.ephemeralExpirationInSec>0)?b:null}function k(a){var b,c=a.stanza.message.decrypted.id;if(((b=a.decodedMsg)==null?void 0:b.unstoredDbReaction)!=null)return{author:a.decodedMsg.unstoredDbReaction.reactToAuthor,chat:c.chat,externalId:a.decodedMsg.unstoredDbReaction.reactToExternalId};else if(((b=a.decodedMsg)==null?void 0:b.unstoredDbEditActionMsg)!=null)return{author:c.author,chat:c.chat,externalId:a.decodedMsg.unstoredDbEditActionMsg.originalMsgExternalId};return c}function l(a){var b;return d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,{metadata:a.metadata,payload:{subProtocol:(b={},b[a.subprotocolType]={payload:d("WAByteArray").uint8ArrayToBuffer(a.subprotocol),version:1},b)}}).readByteArrayView())}function m(a){if(a.subprotocolType!=="consumerMessage")return null;a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a.subprotocol);if(a==null)return null;a=(a=a.payload)==null?void 0:a.content;if(a==null)return null;a=a.editMessage;return a==null||a.timestampMs==null?null:d("WATimeUtils").castLongIntToMillisTime(a.timestampMs)}function n(a){var b=a.stanza.message.decrypted.id,e=a.stanza.message.details.ts;a=c("EncryptedBackupsGetAttachmentContextForReceivedMsg")(a);var f=c("EncryptedBackupsConvertToLegacyAttachmentContext")(a),g=[];f.length>0&&f.forEach(function(a){var f=a.mediaObjectId;a=a.mediaType;g.push({deliveryObjectId:f,mediaType:a,messageId:b.externalId,productType:"msgr",threadId:d("WAJids").threadIdForChatJid(b.chat),threadJid:b.chat,traceId:c("LSRequestId").generate(),ts:e})});return{attachmentContext:a,legacyUploadAttachmentArray:g}}function a(a,b,e,f){var g,o=c("qpl")._(521477113,"2698"),p=j(a.decodedMsg);if(p==null){d("WALogger").WARN(i(),a.stanza.message.decrypted.id);c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UNKNOWN_MESSAGE_TYPE,{instanceKey:f});return null}var q=a.stanza.message.decrypted.msg;if((q==null?void 0:q.version)!=="v3"||q.type!=="subprotocol"){c("QPLUserFlow").addPoint(o,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UKNOWN_MESSAGE_VERSION_OR_PROTOCOL,{instanceKey:f});return null}var r=a.stanza.message.decrypted.id,s=r.author,t=r.externalId,u=k(a),v=l(q);s=(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(s,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid())));var w=a.stanza.message.details.reportingMeta,x=a.stanza.message.details.ts;c("QPLUserFlow").addPoint(o,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GENERATE_BACKUP_DIRECTIVE_START,{instanceKey:f});var y=q.backupDirective!=null?d("MessageBackupDirectiveTypes").getMessageBackupDirectiveFromMessageTransportBackupDirective(q.backupDirective):null;q=d("MessageBackupDirectiveGenerator").createMessageBackupDirective(u,s,p,p===d("MAWMsgType").MSG_TYPE.EDIT_ACTION?m(q):null);var z=c("gkx")("11820");z&&y!=null&&p===d("MAWMsgType").MSG_TYPE.FUTUREPROOF?z=y:z=q;c("QPLUserFlow").addPoint(o,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GENERATE_BACKUP_DIRECTIVE_END,{instanceKey:f});c("QPLUserFlow").addPoint(o,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GET_ATTACHMENT_CONTEXT_START,{instanceKey:f});a=n(a);var A=a.attachmentContext;a=a.legacyUploadAttachmentArray;A.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT,{data:{"int":{attachmentCount:A.length}},instanceKey:f});a.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT_LEGACY,{data:{"int":{legacyAttachmentCount:a.length}},instanceKey:f});c("QPLUserFlow").addPoint(o,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GET_ATTACHMENT_CONTEXT_END,{instanceKey:f});o=A.map(function(a){return d("EBGenerateMessageTags").generateEBMessageTags(a.mediaType)}).filter(Boolean);var B=!c("MAWEBSwitch").isEnabled();c("QPLUserFlow").addAnnotations(c("qpl")._(521477113,"2698"),{bool:{isRetroactiveUpload:B},"int":{attachmentCount:A.length,backupDirectiveType:z.actionType,generatedDirective_actionType:q.actionType,legacyAttachmentCount:a.length,protobufDirective_actionType:(g=y==null?void 0:y.actionType)!=null?g:-1},string:{generatedDirective_supplementalKey:(g=q.supplementalKey)!=null?g:"no_supplemental_key",protobufDirective_supplementalKey:(q=y==null?void 0:y.supplementalKey)!=null?q:"no_supplemental_key"}},{instanceKey:f});return{attachmentContext:A,backupDirective:z,dbMsgType:p,instanceKey:f,isRetroactiveUpload:B,legacyAttachmentContext:a,messageApplication:v,msgId:r,originalMsgProtocolId:u,reportingMeta:w,senderId:s,serverTs:x,sortOrderMs:e!=null?e:d("WATimeUtils").castToMillisTime(d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder({externalId:t,serverTs:x,ts:x})),tags:o,triggerSource:b!=null?b:"unknown"}}g.createUploadMessage=a}),98);
__d("EBUploadReceivedMessages",["EBAPIQPLPoints","EncryptedBackupsCreateUploadMessage","EncryptedBackupsUploadQueue","MAWEBSwitch","MWEBODSEntityName.enum","MWEBODSUtils","QPLUserFlow","WAHashStringToNumber","WALogger","WAResultOrError","asyncToGeneratorRuntime","justknobx","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] error generating backup directive for received message, ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] no result or failed for incoming stanza ",""]);i=function(){return a};return a}var j=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("EBUploadReceivedMessages"),k=c("justknobx")._("3874");function a(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.incomingMessages,e=a.msgResults;try{if(b.length===0)return d("WAResultOrError").makeResult();d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.process",b.length);a=b.map(function(a){var b=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());c("QPLUserFlow").start(c("qpl")._(521477113,"2698"),{annotations:{bool:{received:!0}},instanceKey:b,timeoutInMs:c("justknobx")._("308")});try{var f=a.stanza.message.decrypted.id;f=e.get(f);if(f==null||!f.success){d("WALogger").EXPECTED_ERROR(i(),a.stanza.message.decrypted.id);c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.MESSAGE_RESULT_FAILURE_OR_NULL,{instanceKey:b});return null}var g=d("EncryptedBackupsCreateUploadMessage").createUploadMessage(a,"upload-received-messages",void 0,b);g==null?c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{instanceKey:b}):c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATED,{instanceKey:b});k&&(g==null?void 0:g.msgId)!=null&&j.onReady(function(a){var b,d={is_protobuf_only:!1,is_supplemental_upload:g.msgId.externalId!==g.originalMsgProtocolId.externalId,msg_type:(b=g.dbMsgType)!=null?b:"unknown",trigger_source:"receive"};a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),labyrinth_version:0,message_id:g.msgId.externalId,process_context:JSON.stringify(d)}})});return g}catch(a){d("WALogger").ERROR(h(),a);c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.RUNTIME_ERROR,{annotations:{string:{error:a.toString()}},instanceKey:b});return null}}).filter(Boolean);if(a.length===0)return d("WAResultOrError").makeResult();d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.enqueue",a.length);yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload(a);return d("WAResultOrError").makeResult()}catch(a){return d("WAResultOrError").DEPRECATED_makeError("runtime-exception",a)}});return l.apply(this,arguments)}g.uploadReceivedMessages=a}),98);
__d("EBUploadReceivedMessagesRevokeUtils",["EBAPIQPLPoints","EncryptedBackupsCreateUploadMessage","MAWGetMsgForProtocolMsgIdTxn","MAWMessageSortOrderUtils","QPLUserFlow","WALogger","WATimeUtils","asyncToGeneratorRuntime","gkx","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] EBUploadReceivedMessagesProtobufOnly not uploading placeholder message - Original message not found for revoked message ",""]);h=function(){return a};return a}var i=c("requireDeferred")("EBAPI").__setRef("EBUploadReceivedMessagesRevokeUtils");function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e;if(((e=a.decodedMsg)==null?void 0:(e=e.unstoredDbMsg)==null?void 0:e.type)!=="Revoked"||!c("gkx")("8488"))return null;var f=a.stanza.message.decrypted.id,g=(yield d("MAWGetMsgForProtocolMsgIdTxn").getMsgForProtocolMsgIdTxn({author:f.author,chat:f.chat,externalId:a.decodedMsg.unstoredDbMsg.revokedExternalId}));if(!g.success){d("WALogger").WARN(h(),f.externalId);c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.MESSAGE_RESULT_FAILURE_OR_NULL,{instanceKey:b});return null}var j=d("WATimeUtils").castToMillisTime((e=g.value.sortOrderMs)!=null?e:d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder({externalId:g.value.externalId,serverTs:g.value.serverTs,ts:g.value.ts}));c("gkx")("11710")&&(yield i.load().then(function(a){return a.uploadDeletedMessage({instanceKey:b,msgId:{author:f.author,chat:f.chat,externalId:g.value.externalId},sender:f.author,serverTs:(a=g.value.serverTs)!=null?a:g.value.ts,sortOrderMs:j})}));return d("EncryptedBackupsCreateUploadMessage").createUploadMessage(a,"upload-received-messages",j,b)});return j.apply(this,arguments)}g.createRevokeUploadMsg=a}),98);
__d("EBUploadReceivedMessagesProtobufOnly",["EBAPIQPLPoints","EBUploadReceivedMessagesRevokeUtils","EncryptedBackupsCreateUploadMessage","EncryptedBackupsUploadQueue","MAWEBSwitch","Promise","QPLUserFlow","WAHashStringToNumber","WAResultOrError","asyncToGeneratorRuntime","justknobx","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("EBUploadReceivedMessagesProtobufOnly"),j=c("justknobx")._("3874");function a(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.uploadArray;try{if(a.length===0)return d("WAResultOrError").makeResult();a=a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")());c("QPLUserFlow").start(c("qpl")._(521477113,"2698"),{annotations:{bool:{protobufOnly:!0,received:!0}},instanceKey:b,timeoutInMs:c("justknobx")._("308")});try{var e,f=((e=a.decodedMsg)==null?void 0:(e=e.unstoredDbMsg)==null?void 0:e.type)==="Revoked"?yield d("EBUploadReceivedMessagesRevokeUtils").createRevokeUploadMsg(a,b):d("EncryptedBackupsCreateUploadMessage").createUploadMessage(a,"upload-received-messages",void 0,b);f==null?c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{instanceKey:b}):c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATED,{instanceKey:b});j&&(f==null?void 0:f.msgId)!=null&&i.onReady(function(a){var b,d={is_protobuf_only:!0,is_supplemental_upload:f.msgId.externalId!==f.originalMsgProtocolId.externalId,msg_type:(b=f.dbMsgType)!=null?b:"unknown",trigger_source:"receive"};a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),labyrinth_version:0,message_id:f.msgId.externalId,process_context:JSON.stringify(d)}})});return f}catch(a){c("QPLUserFlow").endFailure(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_PAYLOAD_CREATION_FAILURE,{annotations:{string:{error:a.message}},instanceKey:b});return null}});return function(b){return a.apply(this,arguments)}}());a=(yield (h||(h=b("Promise"))).all(a));a=a.filter(Boolean);if(a.length===0)return d("WAResultOrError").makeResult();yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload(a);return d("WAResultOrError").makeResult()}catch(a){return d("WAResultOrError").DEPRECATED_makeError("runtime-exception",a)}});return k.apply(this,arguments)}g.uploadReceivedMessagesProtobufOnly=a}),98);
__d("MAWGetAllMediaIdsForXMAMsgApi",["MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({xma:d("MAWTransactionMode").READONLY},"getAllMediaIdsForXMAMsg",function(a){return function(b){var c=new Map();b=b.map(function(b){return d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId(a,b).then(function(a){var d,e=(d=c.get(b))!=null?d:new Set();a!=null&&(a.faviconMediaId!=null&&e.add(a.faviconMediaId),a.headerMediaId!=null&&e.add(a.headerMediaId),a.previewMediaIds!=null&&a.previewMediaIds.forEach(function(a){return e.add(a)}));c.set(b,e)})});return d("MAWDexieTable").dexieAll(b).then(function(a){return c})}});g.getAllMediaIdsForXMAMsg=a}),98);
__d("EncryptedBackupsGetAttachmentContextForSentMsgXMA",["EncryptedBackupsUploadEntity","MAWDbMediaTxns","MAWGetAllMediaIdsForXMAMsgApi","MAWIndexedDb","MAWTransactionMode","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY},"bulkGetRetroactiveMedia",function(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWDbMediaTxns").bulkGetMedias.apply(void 0,[a].concat(c))}});function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWGetAllMediaIdsForXMAMsgApi").getAllMediaIdsForXMAMsg([a]).then(function(b){b=b.get(a);return b!=null?h(Array.from(b)):[]}));return c.filter(Boolean).flatMap(function(a){var c=b.msgId!=null?a==null?void 0:a.mediaEntries.get(b.msgId):null;c=c!=null?d("WAMediaUtils").decodeMediaEntryData(c):null;var e=[];(c==null?void 0:c.objectId)!=null&&a.mediaType!=null&&e.push({mediaObjectId:c.objectId,mediaType:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA});c=c==null?void 0:(a=c.downloadableThumbnail)==null?void 0:a.objectId;c!=null&&e.push({isPreview:!0,mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(c),mediaType:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW});return e})});return i.apply(this,arguments)}g["default"]=a}),98);
__d("EncryptedBackupsGetAttachmentContextForSentMsg",["EncryptedBackupsCastToAttachmentContextMediaType","EncryptedBackupsGetAttachmentContextForSentMsgXMA","EncryptedBackupsUploadEntity","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.dbMsg,e=a.isXMAMsg,f=a.media;a=a.protocolMsgIdFromArgs;if(e===!0){e=(yield c("EncryptedBackupsGetAttachmentContextForSentMsgXMA")(a,b));return e.filter(Boolean)}a=[];e=b.msgId!=null?f==null?void 0:f.mediaEntries.get(b.msgId):null;b=e!=null?d("WAMediaUtils").decodeMediaEntryData(e):null;if(f==null||b==null)return[];if(b.objectId!=null&&f.mediaType!=null){a.push({mediaObjectId:b.objectId,mediaType:c("EncryptedBackupsCastToAttachmentContextMediaType")(f.mediaType)});f=(e=b.downloadableThumbnail)==null?void 0:e.objectId;f!=null&&a.push({mediaObjectId:d("WAMediaUtils").stringToDeliveryObjectId(f),mediaType:d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW})}return a});return h.apply(this,arguments)}g["default"]=a}),98);
__d("EncryptedBackupsGetAttachmentContextForSentMsgV2",["EncryptedBackupsCastToAttachmentContextMediaType","EncryptedBackupsUploadEntity","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=new Map(),g=[],h=a.msgId;if(b!=null){a=h!=null?b.mediaEntries.get(h):null;a=a!=null?d("WAMediaUtils").decodeMediaEntryData(a):null;b=c("EncryptedBackupsCastToAttachmentContextMediaType")(b.mediaType);if((a==null?void 0:a.objectId)!=null&&b!=null){var i=a.objectId;f.set(i,b)}b=a==null?void 0:(i=a.downloadableThumbnail)==null?void 0:i.objectId;b!=null&&f.set(b,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW)}if(e!=null){if(e.favicon!=null){a=e.favicon.objectId;a!=null&&f.set(a,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}if(e.header!=null){i=e.header.objectId;i!=null&&f.set(i,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}e.previews!=null&&e.previews.length>0&&e.previews.forEach(function(a){a=a.mediaEntries;a=h!=null?a.get(h):null;a=a!=null?d("WAMediaUtils").decodeMediaEntryData(a):null;if((a==null?void 0:a.objectId)!=null){a=a.objectId;f.set(a,d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA)}})}f.forEach(function(a,b){g.push({mediaObjectId:b,mediaType:a})});return g}g["default"]=a}),98);
__d("EBUploadSentMessage",["EBAPIQPLPoints","EBEnableUnifiedAttachment","EBGenerateMessageTags","EBUnifyLegacyMediaUpload","EncryptedBackupsConvertToLegacyAttachmentContext","EncryptedBackupsGetAttachmentContextForSentMsg","EncryptedBackupsGetAttachmentContextForSentMsgV2","EncryptedBackupsUploadQueue","I64","LSRequestId","MAWEBSwitch","MAWMessageSortOrderUtils","MAWMsgType","MWEBODSEntityName.enum","MWEBODSUtils","MessageBackupDirectiveGenerator","QPLUserFlow","WAFrankingTypes","WAGenReportingMeta","WAGetSafeQPLError","WAGlobals","WAHashStringToNumber","WAJids","WALogger","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","gkx","justknobx","qpl","requireDeferred","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg adding message "," attachments to EB upload queue"]);i=function(){return a};return a}var j=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("EBUploadSentMessage"),k=c("requireDeferred")("EBAPI").__setRef("EBUploadSentMessage"),l=c("justknobx")._("3874");function m(a){if(a.reactToExternalId!=null)return d("MAWMsgType").MSG_TYPE.REACTION;else if(a.editMsgHistoryId!=null)return d("MAWMsgType").MSG_TYPE.EDIT_ACTION;else if(a.type==null)return null;else return d("MAWMsgType").isProtobufUploadSupportedMsgType(a.type)&&!(a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0)?a.type:null}function a(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.dbMsg,e=a.isXMAMsg;e=e===void 0?!1:e;var f=a.media,g=a.messageApplication,n=a.messageApplicationBytes,o=a.protocolMsgId,p=a.serverTs,q=a.triggerSource;q=q===void 0?"upload-sent-message":q;a=a.xmaPayload;var r=d("WAHashStringToNumber").hashStringToNumber(c("uuidv4")()),s=c("qpl")._(521477113,"2698");d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.sent.process",1);try{if(d("WAJids").isAuthorSystem(b.author))return d("WAResultOrError").makeResult();c("QPLUserFlow").start(s,{annotations:{bool:{received:!1}},instanceKey:r,timeoutInMs:c("justknobx")._("308")});var t=m(b);if(t==null){c("QPLUserFlow").endFailure(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UNSUPPORTED_MESSAGE_TYPE,{instanceKey:r});return d("WAResultOrError").makeError("Unsupported EB upload message type")}c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GENERATE_BACKUP_DIRECTIVE_START,{instanceKey:r});var u=d("MessageBackupDirectiveGenerator").createMessageBackupDirectiveFromDbMsg(b);c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GENERATE_BACKUP_DIRECTIVE_END,{instanceKey:r});if(u==null){c("QPLUserFlow").endFailure(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UNABLE_TO_CREATE_BACKUP_DIRECTIVE,{instanceKey:r});return d("WAResultOrError").makeError("Unable to create backup directive")}c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GET_ATTACHMENT_CONTEXT_START,{instanceKey:r});var v=[];d("EBUnifyLegacyMediaUpload").getEnableUnifyLegacyMediaUpload()||d("EBEnableUnifiedAttachment").getEbEnableUnifiedAttachment()?v=c("EncryptedBackupsGetAttachmentContextForSentMsgV2")(b,f,a):v=(yield c("EncryptedBackupsGetAttachmentContextForSentMsg")({dbMsg:b,isXMAMsg:e,media:f,protocolMsgIdFromArgs:o}));c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GET_ATTACHMENT_CONTEXT_END,{instanceKey:r});a=c("EncryptedBackupsConvertToLegacyAttachmentContext")(v);var w=[];a.length>0&&a.forEach(function(a){var e=a.mediaObjectId;a=a.mediaType;w.push({deliveryObjectId:e,mediaType:a,messageId:o.externalId,productType:"msgr",threadId:d("WAJids").threadIdForChatJid(o.chat),threadJid:b.threadJid,traceId:c("LSRequestId").generate(),ts:p})});v.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT,{instanceKey:r});w.length>0&&c("QPLUserFlow").addPoint(c("qpl")._(521477113,"2698"),d("EBAPIQPLPoints").EBUploadQueueQPLPoints.ADDED_ATTACHMENT_CONTEXT_LEGACY,{instanceKey:r});e=v.map(function(a){return d("EBGenerateMessageTags").generateEBMessageTags(a.mediaType)}).filter(Boolean);d("WALogger").LOG(i(),(f=v)==null?void 0:f.length);c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GENERATE_REPORTING_META_START,{instanceKey:r});a=g==null?void 0:g.metadata;f=(yield d("WAGenReportingMeta").genReportingMeta(n,(a==null?void 0:a.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array(a==null?void 0:a.frankingKey)):null,a==null?void 0:a.frankingVersion));c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.GENERATE_REPORTING_META_END,{instanceKey:r});g=!c("MAWEBSwitch").isEnabled();c("QPLUserFlow").addAnnotations(c("qpl")._(521477113,"2698"),{bool:{isRetroactiveUpload:g},"int":{attachmentCount:v.length,backupDirectiveType:u.actionType,legacyAttachmentCount:w.length}},{instanceKey:r});d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.sent.enqueue",1);var x=d("WATimeUtils").castToMillisTime(d("MAWMessageSortOrderUtils").generateAuthoritativeMessageSortOrder({externalId:o.externalId,originalTs:b.originalTs,revokedExternalId:b.revokedExternalId,serverTs:p,ts:p})),y={backupDirective:u,dbMsgType:t,instanceKey:r,isRetroactiveUpload:g,messageApplication:n,msgId:o,originalMsgProtocolId:u.originalMsgProtocolId.externalId!==o.externalId?u.originalMsgProtocolId:o,reportingMeta:f,senderId:(h||(h=d("I64"))).of_string(d("WAJids").authorToUserId(o.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()))),serverTs:p,sortOrderMs:x,tags:e,triggerSource:q};(v.length>0||w.length>0)&&(y=babelHelpers["extends"]({},y,{attachmentContext:v,legacyAttachmentContext:w}));l&&((a=y)==null?void 0:a.msgId)!=null&&j.onReady(function(a){var b,d={is_protobuf_only:!1,is_supplemental_upload:y.msgId.externalId!==y.originalMsgProtocolId.externalId,msg_type:(b=y.dbMsgType)!=null?b:"unknown",trigger_source:"send"};a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),labyrinth_version:0,message_id:y.msgId.externalId,process_context:JSON.stringify(d)}})});yield d("EncryptedBackupsUploadQueue").putMsgsToEbUpload([y]);c("gkx")("11710")&&b.type===d("MAWMsgType").MSG_TYPE.REVOKED&&b.originalMsgExternalId==null&&b.reactToExternalId==null&&(c("QPLUserFlow").addPoint(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.UPLOAD_DELETED_MESSAGE,{instanceKey:r}),yield k.load().then(function(a){return a.uploadDeletedMessage({instanceKey:r,msgId:{author:o.author,chat:b.threadJid,externalId:b.revokedExternalId},sender:b.author,serverTs:(a=(a=b.originalTs)!=null?a:b.serverTs)!=null?a:b.ts,sortOrderMs:x})}));return d("WAResultOrError").makeResult()}catch(a){c("QPLUserFlow").endFailure(s,d("EBAPIQPLPoints").EBUploadQueueQPLPoints.RUNTIME_ERROR,{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:r});return d("WAResultOrError").DEPRECATED_makeError("runtime-error",a)}});return n.apply(this,arguments)}g.uploadSentMessage=a}),98);
__d("EBWorkerEBDBApi",["EBDB","EBDBConsistencyApi","EBLS","WALogger","WAResolvable","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error on EBDB init in Worker: ",""]);h=function(){return a};return a}var i=new(d("WAResolvable").Resolvable)();function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("EBLS").genLSClient());try{yield d("EBDBConsistencyApi").startListeningDeviceRegistrations(a.db,d("EBDB").EBDBEnvironment.Worker)}catch(a){d("WALogger").ERROR(h(),a)}finally{i.resolve(a.db)}});return j.apply(this,arguments)}function c(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i.promise);yield d("EBDBConsistencyApi").addNewDevice(b,d("EBDB").EBDBEnvironment.Worker,a)});return k.apply(this,arguments)}function e(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield i.promise);void d("EBDBConsistencyApi").trackConsistency(b,d("EBDB").EBDBEnvironment.Worker,a);return d("EBDBConsistencyApi").getDeviceId()});return l.apply(this,arguments)}g.startListeningEBDeviceRegistrations=a;g.addNewDevice=c;g.trackConsistency=e}),98);
__d("EchoSerializationFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5722");b=d("FalcoLoggerInternal").create("echo_serialization_failure",a);e=b;g["default"]=e}),98);
__d("EchoSerializationSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5723");b=d("FalcoLoggerInternal").create("echo_serialization_success",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupTaskSkippedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5727");b=d("FalcoLoggerInternal").create("encrypted_backup_task_skipped",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupUploadFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5728");b=d("FalcoLoggerInternal").create("encrypted_backup_upload_failure",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupdDYIFileSaver",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("file-saver").__setRef("EncryptedBackupdDYIFileSaver");function a(a,b){h.onReadyImmediately(function(c){c=c.saveAs;c(b,a)})}g.saveFile=a}),98);
__d("EncryptedBackupsDYIHandleMessageRestore",["EncryptedBackupsDYISingleton","I64","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Issuing next range query for thread with thread key ",", server generated next reference timestamp: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["nextTimestampMs was not supplied for thread with thread key ","."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handling message range query for thread with thread key ",", hasMoreBefore: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find thread key for thread id: ",""]);l=function(){return a};return a}function a(a,b,c,d,e,f,g){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,m){var o=d("EncryptedBackupsDYISingleton").getSingleton(),p=o.getLogger();o=o.getThreadKeyForThreadId(b);if(o==null){p.WARN(l(),b);return}void p.LOG(k(),b,e);c.length>0&&(yield g(o,b,c));if(!e||f==null){e&&f==null&&void p.ERROR(j(),b);n(o);return}g=(h||(h=d("I64"))).to_string(f);void p.LOG(i(),b,g);void m(a,g,b)});return m.apply(this,arguments)}function n(a){var b=d("EncryptedBackupsDYISingleton").getSingleton();b.deleteThreadKeyFromThreadsRestoreInProgress(a)}g.handleMessageRangeQueryRestore=a}),98);
__d("PolarisDirectGQLAPICDNRestorationQuery_instagramRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9537377159694697"}),null);
__d("PolarisDirectGQLAPICDNRestorationQuery.graphql",["PolarisDirectGQLAPICDNRestorationQuery_instagramRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"payload"}],c=[{alias:null,args:[{kind:"Variable",name:"payload",variableName:"payload"}],concreteType:"XIGIGDirectInstamadilloRestoreCDNUrlResponse",kind:"LinkedField",name:"xig_fetch_ig_direct_restore_cdn_url",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"restoration_cdn_url",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"PolarisDirectGQLAPICDNRestorationQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"PolarisDirectGQLAPICDNRestorationQuery",selections:c},params:{id:b("PolarisDirectGQLAPICDNRestorationQuery_instagramRelayOperation"),metadata:{},name:"PolarisDirectGQLAPICDNRestorationQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("PolarisDirectGQLAPIEBUploadMessagesMutation_instagramRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9574801429307425"}),null);
__d("PolarisDirectGQLAPIEBUploadMessagesMutation.graphql",["PolarisDirectGQLAPIEBUploadMessagesMutation_instagramRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"XIGTIGUploadMessageHandlerResponse",kind:"LinkedField",name:"xig_ig_open_upload_msg_to_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"delete_mailbox",storageKey:null},{alias:null,args:null,concreteType:"XIGTIGProtobufParams",kind:"LinkedField",name:"protobuf_params",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"delete_on_success",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"rtu_protocol",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"PolarisDirectGQLAPIEBUploadMessagesMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"PolarisDirectGQLAPIEBUploadMessagesMutation",selections:c},params:{id:b("PolarisDirectGQLAPIEBUploadMessagesMutation_instagramRelayOperation"),metadata:{},name:"PolarisDirectGQLAPIEBUploadMessagesMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("PolarisDirectGQLAPI",["CometRelay","CurrentUser","PolarisDirectGQLAPICDNRestorationQuery.graphql","PolarisDirectGQLAPIEBUploadMessagesMutation.graphql","PolarisRelayEnvironment","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,c){return new(j||(j=b("Promise")))(function(e,f){var g=function(a){f(a)},i=d("CurrentUser").getAppID(),j;i!=null&&(j=Number(i));d("CometRelay").commitMutation(a,{mutation:h!==void 0?h:h=b("PolarisDirectGQLAPIEBUploadMessagesMutation.graphql"),onCompleted:e,onError:g,variables:{input:{app_id:j,payload:{msg_payloads:c}}}})})}function e(a){return d("CometRelay").fetchQuery(c("PolarisRelayEnvironment"),i!==void 0?i:i=b("PolarisDirectGQLAPICDNRestorationQuery.graphql"),{payload:a}).toPromise().then(function(a){return(a=a==null?void 0:(a=a.xig_fetch_ig_direct_restore_cdn_url)==null?void 0:a.restoration_cdn_url)!=null?a:""})}g.ebUploadMessages=a;g.fetchCDNUrlWithRestoration=e}),98);
__d("IGDBridgeResignCdnUrlHandler",["MAWBridgeSendAndReceive","PolarisDirectGQLAPI","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("PolarisDirectGQLAPI").fetchCDNUrlWithRestoration(a));yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","continueMediaDownload",{cdnUrl:a,deliveryObjectId:b})});return h.apply(this,arguments)}g.call=a}),98);
__d("MebMIMediaDownloader",["FBLogger","WADirectPath","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,c){this.mediaDownloadMetadata=a;this.callbacks={onResignCdnUrlFailure:(a=c==null?void 0:c.onResignCdnUrlFailure)!=null?a:b("asyncToGeneratorRuntime").asyncToGenerator(function*(){}),onResignCdnUrlSuccess:(a=c==null?void 0:c.onResignCdnUrlSuccess)!=null?a:b("asyncToGeneratorRuntime").asyncToGenerator(function*(){})}}var e=a.prototype;e.getDownloadMetadata=function(){return this.mediaDownloadMetadata};e.handle=function(){throw c("FBLogger")("labyrinth_web").mustfixThrow("[MebMIMediaDownloader] Please don't use the base class. Instead use either MAWMIMediaDownloader or IGDMIMediaDownloader, depending on the platform.")};e["continue"]=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;yield this.callbacks.onResignCdnUrlSuccess();b=(b=this.waMediaDownloader)==null?void 0:b.getDownloadMetadata();if(b!=null){var c=b.mediaEntry;c.directPath=d("WADirectPath").unsafeCastToDirectPath(a);b.isUrlRenewed=!0;yield (c=this.waMediaDownloader)==null?void 0:c.handle()}});function a(b){return a.apply(this,arguments)}return a}();e.handleError=function(a){return this.callbacks.onResignCdnUrlFailure(a)};e.setNextHandler=function(a){this.waMediaDownloader=a};return a}();g["default"]=a}),98);
__d("MAWMIMediaDownloader",["FBLogger","I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueAttachmentRestoreTaskStoredProcedure","LSMEBTaskCreationSource","MAWCastToMsgrServerMediaType","MAWLoggerUtils","MAWThreadKeyUtils","MebMIMediaDownloader","MediaDownloadMediator","Promise","WALogger","WAMediaUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);l=function(){return a};return a}a=function(a){babelHelpers.inheritsLoose(e,a);function e(){return a.apply(this,arguments)||this}var g=e.prototype;g.handle=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,e=(yield (k||(k=d("LSDatabaseSingleton"))).LSDatabaseSingleton);d("MediaDownloadMediator").mapDeliveryObjectIdToMediaDownloader(d("WAMediaUtils").stringToDeliveryObjectId(this.mediaDownloadMetadata.deliveryObjectId),this);var g=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(this.mediaDownloadMetadata.mediaType);if(g==null)throw c("FBLogger")("labyrinth_web").mustfixThrow("Unsupported media type");var m=d("MAWThreadKeyUtils").stringThreadKeyToString(this.mediaDownloadMetadata.threadKey),n=new(h||(h=b("Promise")))(function(a,b){window.setTimeout(function(){b(c("err")("[labyrinth_web][MIMediaDownloader] MI Media download timed out"))},2*60*1e3)}),o=d("MAWLoggerUtils").getInstanceKey();return h.race([e.runInTransaction(function(b){return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(b),{backupEntFbid:(i||(i=d("I64"))).of_string(a.mediaDownloadMetadata.backupEntFbid),deliveryObjectId:a.mediaDownloadMetadata.deliveryObjectId,mediaType:g,messageId:a.mediaDownloadMetadata.messageId,productType:a.mediaDownloadMetadata.productType,serverThreadKey:m,sortOrder:i.of_float(a.mediaDownloadMetadata.sortOrder),source:(j||(j=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").MSGR_DYI),threadId:a.mediaDownloadMetadata.threadId,traceId:o.toString()})},"readwrite",void 0,void 0,f.id+":68"),n])["catch"](function(b){d("WALogger").ERROR(l(),b.message);return a.handleError(b)})});function e(){return a.apply(this,arguments)}return e}();return e}(c("MebMIMediaDownloader"));g.MAWMIMediaDownloader=a}),98);
__d("MAWEncryptedBackupsDYIProcessProtobufMessages",["CurrentUser","EncryptedBackupsDYIMessageProcessingUtils","EncryptedBackupsDYISingleton","MAWGroupPollsDualEncryptionUtils","MAWHandleEchoProtobufsRestoreApi","MAWJids","MAWMIMediaDownloader","MAWMsgType","MebWAMediaDownloader","Promise","WAHashUtils","WAJids","WALongInt","WAMediaUtils","WAStanzaUtils","WATimeUtils","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Polls] Decryption failure when trying to decrypt poll vote update: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Polls] senderTimestampMs is null. Cannot determine the latest poll vote"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Polls] Decryption failure when trying to decrypt poll add option update: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Polls] Poll creation message key is incomplete. Skipping"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Group poll creation message is missing group poll info"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Explicitly dropping "," message type"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bump message is not supported in DYI"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] XMA message doesn't have xmaData"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Documents are not supported in DYI"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf: ts or messageId or senderId is null"]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf: metadata or message type is null"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error processing protobuf. Dropping the message: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error converting protobuf to DYI format. Dropping the message"]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error converting protobuf to DYI format. Dropping the message"]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decoded protobuf is empty"]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," protobuf messages for thread ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Media message is missing media entry data"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Starting DYI media download for attachemnt with hash ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Protobuf] Media message is missing media data"]);A=function(){return a};return a}function a(a,b,c){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=d("EncryptedBackupsDYISingleton").getSingleton(),g=f.getLogger();void g.LOG(x(),e.length,b);var h=d("MAWJids").toUserJid(c("CurrentUser").getAccountID()),i=!0,j=!1,k;try{for(var l=babelHelpers.asyncIterator(e),e,e;e=(yield l.next()),i=e.done,e=(yield e.value),!i;i=!0){e=e;try{e=d("MAWHandleEchoProtobufsRestoreApi").decodeDecryptedMessageProtobuf(e,h,void 0,new Set(),new Set(),new Map(),new Map(),new Map(),!0);if(e==null){void g.WARN(w());return}if(e!=null&&e.metadata!=null&&e.metadata.messageId!=null){var m=d("WAStanzaUtils").toStanzaId(e.metadata.messageId);e=(yield C(a,b,e));if(e==null){void g.WARN(v());return}f.setMessagesByThreadKey(a,m,e)}else{void g.WARN(u());return}}catch(a){void g.ERROR(t(),a);return}}}catch(a){j=!0,k=a}finally{try{!i&&l["return"]!=null&&(yield l["return"]())}finally{if(j)throw k}}});return B.apply(this,arguments)}function C(a,b,c){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=d("EncryptedBackupsDYISingleton").getSingleton(),f=e.getLogger(),g=c.metadata,h=c.msgType,i=c.sortOrderMs;if(g==null||h==null){void f.WARN(s());return}h=g.messageId;var j=g.senderId;g=g.timestampMs;if(g==null||typeof g!=="number"||h==null||j==null){void f.WARN(r());return}h=d("WATimeUtils").castMilliSecondsToUnixTime(g);g=d("EncryptedBackupsDYIMessageProcessingUtils").buildBaseDyiMessage(j,i);j=(j=c.decodedPayload)==null?void 0:j.text;if(c.editMsgData.length>0){var k=h;c.editMsgData.forEach(function(a){var b;if(a.ts>k&&((b=a.editMsgContent.message)==null?void 0:b.text)!=null){k=a.ts;j=(b=a.editMsgContent.message)==null?void 0:b.text}})}c.reactionData.length>0&&(g.reactions=c.reactionData.map(function(a){var b=a.reaction;a=a.senderId;return{actor:(a=e.getContactNameForContactId(a))!=null?a:"unknown",reaction:(a=b.text)!=null?a:"unknown"}}));switch(c.msgType){case d("MAWMsgType").MSG_TYPE.TEXT:g.type="text";g.text=j||"";break;case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.PTT:g.type="media";g.text=j||"";g=G(a,b,c,i,g);break;case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:void f.WARN(q());return;case d("MAWMsgType").MSG_TYPE.XMA:g.type="link";if(c.xmaData==null){void f.WARN(p());return}g.text=((h=c.xmaData)==null?void 0:h.ctas.map(function(a){return a.nativeUrl}).filter(Boolean).join("\n"))||"";break;case d("MAWMsgType").MSG_TYPE.REVOKED:g.type="placeholder";g.isUnsent=!0;g.text="User unsent a message";break;case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:g.type="poll";g.text=(yield E(c));break;case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:void f.WARN(o());return;default:void f.LOG(n(),c.msgType);return}return g});return D.apply(this,arguments)}function E(a){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=d("EncryptedBackupsDYISingleton").getSingleton().getLogger(),e=a.groupPollInfo;if(e==null){void c.WARN(m());return""}var f=new Map(),g=new Map();yield (h||(h=b("Promise"))).all(e.options.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWGroupPollsDualEncryptionUtils").getHashForOptionName(a));f.set(b,{optionName:a,voterUserJids:[]})});return function(b){return a.apply(this,arguments)}}()));if(a.groupPollUpdateData!=null){var n=!0,o=!1,p;try{for(var q=babelHelpers.asyncIterator(a.groupPollUpdateData),r,r;r=(yield q.next()),n=r.done,r=(yield r.value),!n;n=!0){var s,t;r=r;if(((s=r.pollCreationMessageKey)==null?void 0:s.id)==null||((s=r.pollCreationMessageKey)==null?void 0:s.remoteJid)==null){c.ERROR(l());continue}s=r.pollCreationMessageKey;var u=s.id;s=s.remoteJid;s=d("WAJids").unsafeCoerceToUserJid(s);t={pollCreationMessageKey:e.encKey,pollCreationSenderJid:d("WAJids").toMsgrUserJid(((t=a.metadata)==null?void 0:t.senderId)||""),pollCreationStanzaId:d("WAStanzaUtils").toStanzaId(u),pollUpdateSenderJid:s,pollUpdateStanzaId:r.externalId};if(r.addOption!=null){u=(yield d("MAWGroupPollsDualEncryptionUtils").decryptGroupPollAddOption(r.addOption,t));if(u.success){var v=u.value,w=!0,x=!1,y;try{for(var z=babelHelpers.asyncIterator(v.pollOption),v,v;v=(yield z.next()),w=v.done,v=(yield v.value),!w;w=!0){v=v;if(v.optionName==null)continue;v=v.optionName;var A=(yield d("MAWGroupPollsDualEncryptionUtils").getHashForOptionName(v));f.has(A)||f.set(A,{optionName:v,voterUserJids:[]})}}catch(a){x=!0,y=a}finally{try{!w&&z["return"]!=null&&(yield z["return"]())}finally{if(x)throw y}}}else c.ERROR(k(),u.error)}if(r.vote!=null){A=(yield d("MAWGroupPollsDualEncryptionUtils").decryptGroupPollVote(r.vote,t));if(A.success){v=A.value;if(v.senderTimestampMs==null){c.WARN(j());continue}w=v.selectedOptions;x=v.senderTimestampMs;u=g.get(s);(u==null||u.senderTimestampMs<d("WALongInt").numberOrThrowIfTooLarge(x))&&g.set(s,{senderTimestampMs:d("WALongInt").numberOrThrowIfTooLarge(x),votes:w.map(d("MAWGroupPollsDualEncryptionUtils").getBase64EncodedHash)})}else c.ERROR(i(),A.error)}}}catch(a){o=!0,p=a}finally{try{!n&&q["return"]!=null&&(yield q["return"]())}finally{if(o)throw p}}}for(r of g){t=r[0];v=r[1];for(u of v.votes){s=f.get(u);s==null?f.set(u,{optionName:"Unknown",voterUserJids:[t]}):f.set(u,babelHelpers["extends"]({},s,{voterUserJids:[].concat(s.voterUserJids,[t])}))}}return"Question: "+e.name+"; Options: "+Array.from(f).map(function(a){a[0];a=a[1];var b=a.optionName;a=a.voterUserJids;return b+" ("+a.length+" votes"+(a.length>0?": "+a.map(function(a){return d("EncryptedBackupsDYIMessageProcessingUtils").getSenderName(d("WAJids").userIdFromJid(d("WAJids").unsafeCoerceToUserJid(a)))}).join(", "):"")+")"}).join("; ")});return F.apply(this,arguments)}function G(a,b,e,f,g){var h,i=d("EncryptedBackupsDYISingleton").getSingleton(),j=i.getLogger();if(e.mediaMetadata==null){void j.WARN(A());return g}var k=e.mediaMetadata,l=k.mediaEntryData;k=k.plaintextHash;h=(h=(h=e.metadata)==null?void 0:h.senderId)!=null?h:"0";e=d("WAStanzaUtils").toStanzaId(e.externalId);k=d("WAHashUtils").stringToPlaintextHash(k);g.media.add(k);if(!i.isAttachmentDownloadInProgressForPlaintextHash(k)&&!i.isAttachmentDownloadCompleteForPlaintextHash(k)){void j.LOG(z(),d("WAHashUtils").sanitisePlaintextHash(k));i.addPlaintextHashToAttachmentDownloadsInProgress(k);if(l==null){j.ERROR(y());i.deletePlaintextHashFromAttachmentDownloadsInProgress(k);return g}j={author:d("WAJids").toMsgrUserJid(h),chat:d("WAJids").toMsgrUserJid(b),externalId:e};if(c("gkx")("5850"))void d("EncryptedBackupsDYIMessageProcessingUtils").downloadMediaWithMediaManager(k,j,f,l);else{i=d("WAMediaUtils").decodeMediaEntryData(l);void d("EncryptedBackupsDYIMessageProcessingUtils").startMediaDownloadChain(d("MebWAMediaDownloader").MebWADownloadMediaThroughTheBridge,"-8","msgr",i,b,a,h,e,k,f,function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return babelHelpers.construct(d("MAWMIMediaDownloader").MAWMIMediaDownloader,b)})}}return g}g.processEBProtobufMessagesForDYI=a}),98);
__d("MAWEncryptedBackupsDYIHandleMessageRestore",["EncryptedBackupsDYIHandleMessageRestore","I64","LSDatabaseSingleton","LSFactory","LSIntEnum","LSIssueMessageRangeQueryTaskStoredProcedure","LSMEBTaskCreationSource","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsDYIProcessProtobufMessages","asyncToGeneratorRuntime","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=(h||d("LSIntEnum")).ofNumber(c("LSMEBTaskCreationSource").MSGR_DYI),l=c("justknobx")._("467"),m=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("MAWEBRestoreTrackingUtils").markEBRestoreDYI(c("LSMEBTaskCreationSource").MSGR_DYI),yield a.runInTransaction(function(a){return c("LSIssueMessageRangeQueryTaskStoredProcedure")(c("LSFactory")(a),{isPointQuery:!1,newerNumMessages:(i||(i=d("I64"))).zero,numMessages:i.of_int32(l),source:k,startSortKey:b,threadId:e})},"readwrite",void 0,void 0,f.id+":39")});return function(b,c,d){return a.apply(this,arguments)}}();function a(a,b,c,d){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield (j||(j=d("LSDatabaseSingleton"))).LSDatabaseSingleton);yield d("EncryptedBackupsDYIHandleMessageRestore").handleMessageRangeQueryRestore(f,a,b,c,e,d("MAWEncryptedBackupsDYIProcessProtobufMessages").processEBProtobufMessagesForDYI,m)});return n.apply(this,arguments)}g.taskCreationSource=k;g.MESSENGER_DYI_BATCH_SIZE=l;g.handleMAWProtobufMessageRangeQueryRestore=a}),98);
__d("MAWRestoreProtobufsFromEncryptedBackupsDeferred",["ExecutionEnvironment","I64","WAJobOrchestratorTypes","asyncToGeneratorRuntime","cr:10036","cr:21318","cr:21319","gkx","justknobx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("MAWRestoreProtobufsFromEncryptedBackupsNOP").__setRef("MAWRestoreProtobufsFromEncryptedBackupsDeferred");function a(a,e,g,k,l,m,n,o,p,q,r,s,t,u,v){u===void 0&&(u=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);return j.load().then(function(){var j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(j){var w;(i||(i=c("ExecutionEnvironment"))).isInWorker&&b("cr:10036")!=null?(yield b("cr:10036").init(),w=(yield b("cr:10036").getLSStorage())):w=b("cr:21318")!=null?yield b("cr:21318").LSDatabaseSingleton:null;var x=function(b){return j.call(b,a,e,g,k,l!=null?(h||(h=d("I64"))).to_float(l):0,m,n!=null?(h||(h=d("I64"))).to_float(n):(h||(h=d("I64"))).to_float((h||(h=d("I64"))).max_int),o,p,q,r,s,t,u,v)};if(w!=null&&!c("gkx")("15400"))return w.runInTransaction(function(a){return x(a)},"readwrite",void 0,void 0,f.id+":100");return b("cr:21319")!=null&&c("justknobx")._("4404")?b("cr:21319").queueWork(function(){return x(null)}):x(null)});return function(a){return j.apply(this,arguments)}}())}g.call=a}),98);
__d("LSProtobufRestoreHandler",["CurrentUser","LSIntEnum","LSMEBTaskCreationSource","LSVec","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWEBUnstoredDbMsgUtils","MAWEncryptedBackupUtils","MAWEncryptedBackupsDYIHandleMessageRestore","MAWJids","MAWJobDefinitions","MAWRestoreProtobufsFromEncryptedBackupsDeferred","Promise","WAErrorMessage","WATagsLogger","asyncToGeneratorRuntime","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - Failed to restore protobufs, with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - Failed to restore protobufs, with error: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring Messenger DYI batch"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - no messages but hasMoreBefore is true"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - no messages but hasMoreBefore is true"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - Failed to decode protobufs, with error: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - Failed to decode protobufs, with error: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - no decoded messages but hasMoreBefore is true, messages count after decryption: ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop - no decoded messages but hasMoreBefore is true, messages count after decryption: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["restoreProtobufs nativeop"]);s=function(){return a};return a}var t=d("WATagsLogger").TAGS(["labyrinth_web","protobuf_restore"]);function a(a,b,c,d,e,f,g,h,i,j,k,l,m){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,u,w,x,y,z,A,B,C,D){var E=t.TAGS([y!=null?y:"no_request_id"]);E.ERROR;E=babelHelpers.objectWithoutPropertiesLoose(E,["ERROR"]);var F=E;E=null;B!=null&&(E=v(B));F.LOG(s());d("MAWEBRestoreTrackingUtils").markEBRestoreProtobuf(C);e.type==="convertedProtobufs"?B=e.convertedProtobufs:(e.type,B=d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(e.decryptedMessagesProtobufs));d("MAWEncryptedBackupUtils").logIfDuplicateMessagesFoundInRestore(B,"protobuf_restore");if(y!=null)try{d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_start",traceId:y});e=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());e=d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromProtobuf(B,a,void 0,e);if(f===!0&&e.length===0){d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_decodedMessages_inconsistency",traceId:y});var G=B.length;F.WARN(r(),G);t.ERROR(q(),G)}d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryIfPresent(y,{echoMessages:E,hasMoreAfter:u,hasMoreBefore:f,isPointQuery:x,messages:e,nextMessageTimestampMsBefore:g,protobufMessages:B,referenceTimestamp:z,requestId:y,restoreType:"protobuf",threadId:a})}catch(a){G=d("WAErrorMessage").maybeGetMessageFromError(a);F.WARN(p(),G);t.ERROR(o(),G);d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(y,a instanceof Error?a:c("err")(G))}f===!0&&B.length===0&&(y!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_messages_inconsistency",traceId:y}),F.WARN(n()),t.ERROR(m()));e=C!=null&&(i||(i=d("LSIntEnum"))).unwrapIntEnum(C)===c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB;if(e){y!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"search_restore_end",traceId:y});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(y);return(h||(h=b("Promise"))).resolve()}G=C!=null&&(i||(i=d("LSIntEnum"))).unwrapIntEnum(C)===c("LSMEBTaskCreationSource").MSGR_DYI;if(G){F.LOG(l());yield d("MAWEncryptedBackupsDYIHandleMessageRestore").handleMAWProtobufMessageRangeQueryRestore(a,B,f,g);y!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"dyi_restore_end",traceId:y});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(y);return(h||(h=b("Promise"))).resolve()}c("promiseDone")(d("MAWRestoreProtobufsFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(a),B,f,g,u,w,x,y,z,A,E,C,void 0,D!=null?D:void 0),function(){y!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:y})},function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);F.WARN(k(),a);t.ERROR(j(),a);a={string:{error:a}};y!=null&&d("MAWEBRestoreTrackingUtils").markEBRestoreFail(y,!1,"native_op_reject",a)});return(h||(h=b("Promise"))).resolve()});return u.apply(this,arguments)}function v(a){return c("LSVec").toArray(a).map(function(a){return d("MAWJobDefinitions").toEncodedEchoMessage(a)})}g.handleProtobufRestoreHelper=a;g.convertLSEchoMessageVecToArray=v}),98);
__d("LSEBUnifiedRestoreUtils",["CurrentUser","LSIntEnum","LSMEBTaskCreationSource","LSProtobufRestoreHandler","LSVec","MAWAsyncEBPendingQueryPromise","MAWBridgeSafeActionsWorkerAndUI","MAWEBRestoreTrackingUtils","MAWEBUnstoredDbMsgUtils","MAWEncryptedBackupUtils","MAWEncryptedBackupsDYIHandleMessageRestore","MAWJids","MAWJobDefinitions","MAWRestoreProtobufsFromEncryptedBackupsDeferred","MWEBODSEntityName.enum","MWEBODSUtils","Promise","WATagsLogger","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore nativeop - Failed to restore protobufs, with error: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Restoring Messenger DYI batch"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore nativeop - no messages but hasMoreBefore is true"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore native op - Failed to decode protobufs, with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["eb restore nativeop - no decoded messages but hasMoreBefore is true, messages count after decryption: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting eb restore - ",""]);o=function(){return a};return a}function a(a,b,c,d,e,f,g,h,i,j,k,l,m){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,p,q,r,s,t,u,v,w,x){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",s!=null?s:"no_request_id"]).LOG(o(),s!=null?s:"no_request_id");d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"unified_restore");var y=[].concat(d("MAWEncryptedBackupUtils").convertLSTypesToJSTypesForRestoreJob(e));v=d("LSProtobufRestoreHandler").convertLSEchoMessageVecToArray(v);v=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:x,encodedEchoMessages:v}));y.push.apply(y,v);d("MAWEncryptedBackupUtils").logIfDuplicateMessagesFoundInRestore(y,"protobuf_restore");if(s!=null)try{d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_start_unified",traceId:s});v=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());v=d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromProtobuf(y,a,void 0,v);if(f===!0&&v.length===0){d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_decodedMessages_inconsistency",traceId:s});e=e!=null?c("LSVec").toArray(e).length:0;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",s!=null?s:"no_request_id"]).ERROR(n(),e)}d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryIfPresent(s,{echoMessages:void 0,hasMoreAfter:p,hasMoreBefore:f,isPointQuery:r,messages:v,nextMessageTimestampMsBefore:g,protobufMessages:y,referenceTimestamp:t,requestId:s,restoreType:"protobuf",threadId:a})}catch(a){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",s!=null?s:"no_request_id"]).ERROR(m(),a.message)}f===!0&&y.length===0&&(s!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"hasMoreBefore_messages_inconsistency",traceId:s}),d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",s!=null?s:"no_request_id"]).ERROR(l()));e=w!=null&&(i||(i=d("LSIntEnum"))).unwrapIntEnum(w)===c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB;if(e){s!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"search_restore_end",traceId:s});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(s);return(h||(h=b("Promise"))).resolve()}v=w!=null&&(i||(i=d("LSIntEnum"))).unwrapIntEnum(w)===c("LSMEBTaskCreationSource").MSGR_DYI;if(v){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",s!=null?s:"no_request_id"]).LOG(k());yield d("MAWEncryptedBackupsDYIHandleMessageRestore").handleMAWProtobufMessageRangeQueryRestore(a,y,f,g);s!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"dyi_restore_end",traceId:s});d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(s);return(h||(h=b("Promise"))).resolve()}c("promiseDone")(d("MAWRestoreProtobufsFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(a),y,f,g,p,q,r,s,t,u,void 0,w,void 0,x),function(){s!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end_unified",traceId:s})},function(a){d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",s!=null?s:"no_request_id"]).ERROR(j(),a.message);a={string:{error:a.message}};s!=null&&d("MAWEBRestoreTrackingUtils").markEBRestoreFail(s,!1,"native_op_reject_unified",a)});return(h||(h=b("Promise"))).resolve()});return p.apply(this,arguments)}g.echoProtobufConsolidatedRestoreHelper=a}),98);
__d("MAWThreadIdToChatJidMapping",["I64","MAWAsyncEBPendingQueryPromise","MAWJidUtils","ReQL","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot generate ChatJid from threadKey, called from ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find thread with serverThreadKey ",", called from ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Cannot find MI ACT mapping table entry for threadId ",", called from ",""]);k=function(){return a};return a}var l=new Map();function a(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(l.has(b))return l.get(b);var e=d("MAWAsyncEBPendingQueryPromise").getJidFromThreadId(b);if(e!=null){l.set(b,e);return e}e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table.index("jid")).getKeyRange((h||(h=d("I64"))).of_string(b))));if(e==null){d("WALogger").ERROR(k(),b,c);return null}var f=e.serverThreadKey;e=e.jid;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(f)));if(a==null){d("WALogger").ERROR(j(),(h||(h=d("I64"))).to_string(f),c);return null}f=d("MAWJidUtils").LSJidtoChatJid(e,a.threadType);if(f!=null){l.set(b,f);return f}else{d("WALogger").ERROR(i(),c);return null}});return m.apply(this,arguments)}g.genChatJidFromThreadId=a}),98);
__d("LSRestoreEchoBlobs.nop",["LSVec","MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","MAWThreadIdToChatJidMapping","MWEBODSEntityName.enum","MWEBODSUtils","Promise","WAJids","asyncToGeneratorRuntime","err","gkx","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("LSRestoreEchoBlobsHandler").__setRef("LSRestoreEchoBlobs.nop");a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j,k,l,m,n,o,p,q,r,s){var t;d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_echo_blobs");s!=null?t=d("WAJids").validateChatJid(s):d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_echo_blobs.no_chat_jid_provided");t==null&&(t=(yield d("MAWThreadIdToChatJidMapping").genChatJidFromThreadId(a,o,"LSRestoreEchoBlobs.nop")));if(t==null){d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_echo_blobs.no_chat_jid");p!=null&&d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(p,c("err")("Cannot generate ChatJid from threadKey: "+o));d("MAWEBRestoreTrackingUtils").markEBRestoreFail(p,!1,"no_chat_jid");return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])}return i.load().then(function(a){if(t!=null)if(c("gkx")("14213")){c("promiseDone")(a.handleEchoBlobsRestore(g,j,k,l,m,n,o,p,q,r,t));return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])}else return a.handleEchoBlobsRestore(g,j,k,l,m,n,o,p,q,r,t);return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])})});function e(b,c,d,e,f,g,h,i,j,k,l,m,n,o){return a.apply(this,arguments)}return e}();a.__nop_name__="LSRestoreEchoBlobs";g["default"]=a}),98);
__d("LSRestoreEchoBlobsHandler",["LSProtobufRestoreHandler","LSVec","MAWBridgeSafeActionsWorkerAndUI","MAWEBRestoreTrackingUtils","MAWEncryptedBackupUtils","MAWJobDefinitions","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c,d,e,f,g,h,j,k,l){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,j,k,l,m,n,o){var p=c("LSVec").toArray(a).map(d("MAWJobDefinitions").toEncodedEchoMessage);l!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"echo_to_protobuf_conversion_start",traceId:l});p=(yield d("MAWBridgeSafeActionsWorkerAndUI").sendAndReceiveBackendWorkerAndUIShared("convertEchoMessagesToEBProtobufs",{chatJid:o,encodedEchoMessages:p}));l!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"echo_to_protobuf_conversion_success",traceId:l});p=d("MAWEncryptedBackupUtils").convertJSTypesToLSTypesForRestoreJob(p);yield d("LSProtobufRestoreHandler").handleProtobufRestoreHelper(k,{decryptedMessagesProtobufs:p,type:"decryptedMessagesProtobufs"},e,f,g,i,j,l,m,"",a,n,o);return(h||(h=b("Promise"))).resolve([!0,c("LSVec").ofArray([]),c("LSVec").ofArray([])])});return i.apply(this,arguments)}g.handleEchoBlobsRestore=a}),98);
__d("LSRestoreProtobufs.nop",["LSProtobufRestoreHandler","MAWMpsGating","MAWThreadIdToChatJidMapping","MWEBODSEntityName.enum","MWEBODSUtils","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j,k,l,m,n,o,p,q){d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_protobufs");if(d("MAWMpsGating").isFullMpsEnabled())return;b=null;q!=null?b=d("WAJids").validateChatJid(q):d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_protobufs.no_chat_jid_provided");b==null&&(b=(yield d("MAWThreadIdToChatJidMapping").genChatJidFromThreadId(a,e,"LSRestoreProtobufs.nop")));b==null&&d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_protobufs.no_chat_jid");return d("LSProtobufRestoreHandler").handleProtobufRestoreHelper(e,{decryptedMessagesProtobufs:f,type:"decryptedMessagesProtobufs"},g,h,i,j,k,l,m,n,o,p,b)});function e(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return a.apply(this,arguments)}return e}();a.__nop_name__="LSRestoreProtobufs";g["default"]=a}),98);
__d("MAWBridgeUpdateDYIStatusV2",["EncryptedBackupdDYIFileSaver","EncryptedBackupsDYIFileUtils","EncryptedBackupsDYITypes","FBLogger","QPLUserFlow","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("EncryptedBackupdDYIFileSaver").saveFile(a,b),window.setTimeout(function(){c("promiseDone")(e())},1e3)});return i.apply(this,arguments)}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.qplEvent,f=a.qplInstanceKeyE2E;a=a.status;var g=c("FBLogger")("[labyrinth_web][dyi]");if(a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed)try{if(navigator.storage==null)throw g.mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.");var i=d("EncryptedBackupsDYIFileUtils").DyiArchiveFilename,j=(yield d("EncryptedBackupsDYIFileUtils").getRootFolderHandle()),k=(yield d("EncryptedBackupsDYIFileUtils").readFile(j,i));yield h(i,k,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield j.removeEntry(i)}));g.info("Saving file with filename ",i);e!=null&&f!=null&&c("QPLUserFlow").endSuccess(e,{instanceKey:f});g.info("DYI Complete")}catch(a){g.mustfix("Failed to download the DYI archive: %s",a);e!=null&&f!=null&&c("QPLUserFlow").endFailure(e,a.message,{instanceKey:f});return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed}a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed&&(e!=null&&f!=null&&c("QPLUserFlow").endFailure(e,"Unknown error",{instanceKey:f}));return a});return j.apply(this,arguments)}g.call=a}),98);
__d("MAWRestoreProtobufsFromEncryptedBackupsNOP",["ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWBridgeTraceRecordCheckpointHandler","MAWJobDefinitions","MAWJobManager","MAWMediaGalleryM2Utils","Promise","WAJobOrchestratorTypes","asyncToGeneratorRuntime","err","ifRequireable","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function a(a,b,c,d,e,f,g,h,i,j,k,m,n,o,p,q){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h,i,l,n,o,p,q,r,s,t,u,v){u===void 0&&(u=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);try{return m(e,f,s,g,h,l,o,p,q,t==null?void 0:t,void 0,u,v)}catch(e){if(p!=null){i={checkPointId:(k||(k=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:p,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0};if(a!=null)return d("MAWBridgeTraceRecordCheckpointHandler").call(a,i).then(function(){return(j||(j=b("Promise"))).reject(e)});void d("MAWBridgeTraceRecordCheckpointHandler").callWithoutTxn(i);return(j||(j=b("Promise"))).reject(e)}}return(j||(j=b("Promise"))).resolve()});return l.apply(this,arguments)}function m(a,e,f,g,l,m,n,o,p,q,r,s,t){s===void 0&&(s=d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION);var u;if((h||(h=c("ExecutionEnvironment"))).isInWorker)u=d("MAWJobManager").getJobManager();else{var v;c("ifRequireable")("MAWTimedJob",function(a){a=a.TimedUIJobStarters;v=a},function(){throw c("err")("MAWTimedJob is not requireable in MAWRestoreProtobufsFromEncryptedBackupsNOP")});u=c("nullthrows")(v,"ifRequireable is not sync")}if(o!=null&&q!=null&&(k||(k=d("LSIntEnum"))).unwrapIntEnum(q)===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION&&!(h||(h=c("ExecutionEnvironment"))).isInWorker)return u.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreProtobufsFromEncryptedBackups(f,a,e,g,l,m,n,void 0,o!=null?o:void 0,p!=null?p:void 0,void 0,{priority:s},q,r,void 0,t!=null?t:void 0));return(k||(k=d("LSIntEnum"))).unwrapIntEnum(q||(i||(i=d("I64"))).zero)===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE&&d("MAWMediaGalleryM2Utils").shouldSkipSyncToLSDB()&&!(h||(h=c("ExecutionEnvironment"))).isInWorker?u.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreProtobufsFromEncryptedBackups(f,a,e,g,l,m,n,void 0,o!=null?o:void 0,p!=null?p:void 0,void 0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},q,r,void 0,t!=null?t:void 0)):(j||(j=b("Promise"))).resolve(u.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreProtobufsFromEncryptedBackups(f,a,e,g,l,m,n,void 0,o!=null?o:void 0,p!=null?p:void 0,void 0,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},q,r,void 0,t!=null?t:void 0)))}g.call=a}),98);
__d("MAWSetupBridgeOfflineConsumer",["InteractionTracingMetrics","MAWBridgeInitOfflineQueueSyncCompleteHandler","MAWMIC","MAWOfflineQueueStatus","MAWSharedProtocolQueueConst","MWChatInteraction","MWFBLogger","WAMediaWasmWorkerClient","asyncToGeneratorRuntime","cr:17068","gkx","interaction-tracing","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats failed: expected: ",", processed: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats end: expected: ",", processed: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats: expected: ",", processed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Stats start: ",""]);k=function(){return a};return a}var l=d("MWFBLogger").MWLogger.tags(["ServerRPC","OfflineConsumer"]),m="has_pending_or_inprogress_oq_threads";function n(a){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a;d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("mp4RepairMux");c("gkx")("12220")&&d("WAMediaWasmWorkerClient").prewarmMediaWasmWorker("progressiveJpegEncode");return d("MAWBridgeInitOfflineQueueSyncCompleteHandler").call()});return o.apply(this,arguments)}function p(a){d("MAWMIC").addIntAnnotation("offlineQueueSize",a);var b=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);b!=null&&c("InteractionTracingMetrics").addAnnotationInt(b,"offlineQueueSize",a)}function q(a,b){var e=d("MWChatInteraction").get(d("MWChatInteraction").MW_AUTO_CHAT_TAB_OPEN);e!=null&&c("InteractionTracingMetrics").addSubspan(e,"offline_queue","LONGTASK",a,b,{})}function r(){c("justknobx")._("3496")&&c("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(a){a.addMarkerPoint("offline_queue_start","AppTiming"),a.addAnnotationBoolean(m,!0)})}function s(){c("justknobx")._("3496")&&c("interaction-tracing").InteractionTracingCore.getPendingInteractions().forEach(function(a){a.addMarkerPoint("offline_queue_end","AppTiming"),a.addAnnotationBoolean(m,!1)})}function a(a,e){return function(f){var g=f.chatJidStatus,m=f.status,o=f.timestamp,t=f.totalExpectedCount,u=f.totalProcessedCount;switch(m){case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing:r();l.DEBUG(k(),t);p(t);b("cr:17068")&&b("cr:17068").setEstimatedOQSize(t);e({tag:"InitOfflineQueueSyncStart",value:t});d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing);d("MAWMIC").addPoint("process_offline_queue_start",o);d("MAWOfflineQueueStatus").resetOfflineQueueState();return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing:l.DEBUG(j(),t,u);e({tag:"InitOfflineQueueConsumerSyncProgress",value:{chatJidStatus:g,processed:u}});d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing);return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete:l.DEBUG(i(),t,u);f.startTime!=null&&q(f.startTime,o);s();e({tag:"InitOfflineQueueSyncComplete",value:g});c("promiseDone")(n(a));d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete);d("MAWMIC").addPoint("process_offline_queue_end",o);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return;case d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed:l.DEBUG(h(),t,u);d("MAWMIC").addPoint("process_offline_queue_failed",o);e({tag:"InitOfflineQueueSyncComplete",value:void 0});c("promiseDone")(n(a));d("MAWOfflineQueueStatus").markThreadWithOfflineQueueStatus(g,d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed);d("MAWOfflineQueueStatus").markOfflineQueueComplete();return}}}g["default"]=a}),98);
__d("MWSimpleWorkQueue",["FBLogger","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i={first:null,last:null};function a(a){return new(h||(h=b("Promise")))(function(d,e){var f=function(){var f=new(h||(h=b("Promise")))(function(a,b){window.setTimeout(function(){b(c("err")("Work item timed out after 30 seconds"))},3e4)});return h.race([a(),f]).then(d,e)};if(i.first===null||i.last==null)i.first=i.last={next:null,value:f},j();else{var g=i.last;g.next={next:null,value:f};i.last=g.next}})}function j(){if(i.first===null)return;var a=i.first;if(a==null)return;var b=function(){i.first=a.next;if(i.first==null){i.last=null;return}j()};a.value().then(function(){b()})["catch"](function(a){c("FBLogger")("messenger_web").catching(a).mustfix("Error in MWSimpleWorkQueue"),b()})}g.queueWork=a}),98);
__d("X25519",["$InternalEnum","Promise","WACryptoCurve25519Dependencies","WASignalKeys","WASignalOther","WASignalSignatures"],(function(a,b,c,d,e,f,g){"use strict";var h,i=b("$InternalEnum").Mirrored(["Encryption","Signing"]),j=b("$InternalEnum")({PublicKey:0,PrivateKey:1,Signature:2});function k(a,b){if(b===i.Encryption)return[];b=1;switch(a){case j.PublicKey:b=1;break;case j.PrivateKey:b=2;break;case j.Signature:b=3;break}return[255,b]}function l(a,b,c){b=k(b,c);c=b.length;if(c<=0)return a;var d=new Uint8Array(c+a.byteLength);d.set(Array.from(b));d.set(a,c);return d}function m(a,b,c){b=k(b,c).length;return a.slice(b)}function n(a,b){return{privateKey:l(a.privateKey,j.PrivateKey,b),publicKey:l(a.publicKey,j.PublicKey,b)}}function a(a){a=n(d("WASignalKeys").makeKeyPair(),a);return{pk:a.publicKey,sk:a.privateKey}}function o(a,b){if(b===i.Encryption)return 32;switch(a){case j.PublicKey:case j.PrivateKey:return 32;case j.Signature:return 64}}function p(a,b,c){var d=k(b,c),e=d.length;b=o(b,c);c=b!=null?e+b:0;if(a.length!==c)return!1;var f=a.subarray(0,e);b=new Uint8Array(d);return b.length===f.length&&b.every(function(a,b){return a===f[b]})}function q(a,b){if(p(a,j.PublicKey,b))return a;return}function r(a,b){if(p(a,j.PrivateKey,b))return a;return}function c(a,b){var c=q(a.pkBytes,b);a=r(a.skBytes,b);if(c!=null&&a!=null)return{pk:c,sk:a}}function e(a,c){a=m(a,j.PrivateKey,i.Signing);return d("WASignalSignatures").signMsg(d("WASignalKeys").makeKeyPairFrom(d("WASignalOther").ensureSize(a,32)),c).then(function(a){a=l(a,j.Signature,i.Signing);return(h||(h=b("Promise"))).resolve(a)})}function f(a){if(p(a,j.Signature,i.Signing))return a}function s(a,b,c){b=m(b,j.PublicKey,i.Signing);return d("WASignalSignatures").verifyMsgSignalVariant(d("WASignalKeys").serializeIdentity(b),c,d("WASignalOther").ensureSize(m(a,j.Signature,i.Signing),64))}function t(a,c){c=c;a=a;return!p(a,j.PublicKey,i.Encryption)||!p(c,j.PrivateKey,i.Encryption)?(h||(h=b("Promise"))).resolve():d("WACryptoCurve25519Dependencies").calculateAgreement(a,c).then(function(a){return(h||(h=b("Promise"))).resolve(new Uint8Array(a))})}g.KeyPurpose=i;g.generateKeys=a;g.publicKeyFromBytes=q;g.secretKeyFromBytes=r;g.keysFromBytes=c;g.sign=e;g.signatureFromBytes=f;g.verify=s;g.exchangeKeys=t}),98);
__d("PublicKeyCrypto",["Promise","UInt8Array","X25519"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c){return(h||(h=b("Promise"))).all([a,c]).then(function(a){return(h||(h=b("Promise"))).resolve(a[0]!=null&&a[1]!=null?d("UInt8Array").concatBytes([a[0],a[1]]):void 0)})}function a(a,b,c){return i(d("X25519").exchangeKeys(c,a),d("X25519").exchangeKeys(c,b))}function c(a,b,c){return i(d("X25519").exchangeKeys(c,a),d("X25519").exchangeKeys(b,a))}g.senderDeriveSharedSecret=a;g.receiverDeriveSharedSecret=c}),98);
__d("ReverbWriteFailureFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5829");b=d("FalcoLoggerInternal").create("reverb_write_failure",a);e=b;g["default"]=e}),98);
__d("ReverbWriteSuccessFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5831");b=d("FalcoLoggerInternal").create("reverb_write_success",a);e=b;g["default"]=e}),98);
__d("WASmaxInAbPropsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInAbPropsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","feature-not-implemented");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",501);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFeatureNotImplementedMixin=a}),98);
__d("WASmaxInAbPropsNoRetryErrors",["WAResultOrError","WASmaxInAbPropsIQErrorBadRequestMixin","WASmaxInAbPropsIQErrorFeatureNotImplementedMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInAbPropsIQErrorFeatureNotImplementedMixin").parseIQErrorFeatureNotImplementedMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorFeatureNotImplemented",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorFeatureNotImplemented"],[b,c])}g.parseNoRetryErrors=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry",["WAResultOrError","WASmaxInAbPropsIQErrorResponseMixin","WASmaxInAbPropsNoRetryErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInAbPropsNoRetryErrors").parseNoRetryErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorNoRetryErrors:b.value}))}g.parseGetExperimentConfigResponseErrorNoRetry=a}),98);
__d("WASmaxInAbPropsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry",["WAResultOrError","WASmaxInAbPropsIQErrorInternalServerErrorMixin","WASmaxInAbPropsIQErrorResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;c=d("WASmaxInAbPropsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(c.value);if(!c.success)return c;a=d("WASmaxInAbPropsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({errorIQErrorInternalServerErrorMixin:c.value},a.value))}g.parseGetExperimentConfigResponseErrorRetry=a}),98);
__d("WASmaxInAbPropsExperimentConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"config_code",1,void 0);if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"config_value");if(!c.success)return c;a=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,a,"config_expo_key",0,void 0);return!a.success?a:d("WAResultOrError").makeResult({configCode:b.value,configValue:c.value,configExpoKey:a.value})}g.parseExperimentConfigMixin=a}),98);
__d("WASmaxInAbPropsSamplingConfigMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxParseUtils").attrIntRange(a,"event_code",1,void 0);if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"sampling_weight",-1e4,1e4);return!a.success?a:d("WAResultOrError").makeResult({eventCode:b.value,samplingWeight:a.value})}g.parseSamplingConfigMixin=a}),98);
__d("WASmaxInAbPropsConfigs",["WAResultOrError","WASmaxInAbPropsExperimentConfigMixin","WASmaxInAbPropsSamplingConfigMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInAbPropsExperimentConfigMixin").parseExperimentConfigMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"ExperimentConfig",value:b.value});var c=d("WASmaxInAbPropsSamplingConfigMixin").parseSamplingConfigMixin(a);return c.success?d("WAResultOrError").makeResult({name:"SamplingConfig",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["ExperimentConfig","SamplingConfig"],[b,c])}g.parseConfigs=a}),98);
__d("WASmaxInAbPropsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInAbPropsGetExperimentConfigResponseSuccess",["WAResultOrError","WASmaxInAbPropsConfigs","WASmaxInAbPropsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"prop");if(!b.success)return b;b=d("WASmaxInAbPropsConfigs").parseConfigs(a);return!b.success?b:d("WAResultOrError").makeResult({configs:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"erid");if(!b.success)return b;b=d("WASmaxParseUtils").contentBytesRange(a,1,100);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"props");if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"erid",i);if(!e.success)return e;var f=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,c.value,"protocol","1");if(!f.success)return f;var g=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"ab_key");if(!g.success)return g;var j=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrString,c.value,"hash");if(!j.success)return j;var k=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh",0,void 0);if(!k.success)return k;var l=d("WASmaxParseUtils").optional(d("WASmaxParseUtils").attrIntRange,c.value,"refresh_id",0,void 0);if(!l.success)return l;a=d("WASmaxInAbPropsIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"prop",0,Infinity,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({propsProtocol:f.value,propsAbKey:g.value,propsHash:j.value,propsRefresh:k.value,propsRefreshId:l.value},a.value,{erid:e.value,propsProp:b.value}))}g.parseGetExperimentConfigResponseSuccessPropsProp=h;g.parseGetExperimentConfigResponseSuccessErid=i;g.parseGetExperimentConfigResponseSuccess=a}),98);
__d("WASmaxOutAbPropsBaseIQGetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"get"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQGetRequestMixin=a}),98);
__d("WASmaxOutAbPropsGetExperimentConfigRequest",["WASmaxAttrs","WASmaxJsx","WASmaxOutAbPropsBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){a=a.propsHash;a=d("WASmaxOutAbPropsBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{xmlns:"abt",to:d("WAWap").S_WHATSAPP_NET},d("WASmaxJsx").smax("props",{protocol:"1",hash:d("WASmaxAttrs").OPTIONAL(d("WAWap").CUSTOM_STRING,a)})));return a}g.makeGetExperimentConfigRequest=a}),98);
__d("WASmaxAbPropsGetExperimentConfigRPC",["WAComms","WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry","WASmaxInAbPropsGetExperimentConfigResponseErrorRetry","WASmaxInAbPropsGetExperimentConfigResponseSuccess","WASmaxOutAbPropsGetExperimentConfigRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutAbPropsGetExperimentConfigRequest").makeGetExperimentConfigRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInAbPropsGetExperimentConfigResponseSuccess").parseGetExperimentConfigResponseSuccess(b,a);if(c.success)return{name:"GetExperimentConfigResponseSuccess",value:c.value};var e=d("WASmaxInAbPropsGetExperimentConfigResponseErrorNoRetry").parseGetExperimentConfigResponseErrorNoRetry(b,a);if(e.success)return{name:"GetExperimentConfigResponseErrorNoRetry",value:e.value};b=d("WASmaxInAbPropsGetExperimentConfigResponseErrorRetry").parseGetExperimentConfigResponseErrorRetry(b,a);if(b.success)return{name:"GetExperimentConfigResponseErrorRetry",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("GetExperimentConfig",{Success:c,ErrorNoRetry:e,ErrorRetry:b}))});return h.apply(this,arguments)}g.sendGetExperimentConfigRPC=a}),98);
__d("WAGetAbPropsProtocol",["WALogger","WAResultOrError","WASmaxAbPropsGetExperimentConfigRPC","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["getAbPropsProtocol failed ",""]);h=function(){return a};return a}function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxAbPropsGetExperimentConfigRPC").sendGetExperimentConfigRPC({propsHash:a}));if(a.name==="GetExperimentConfigResponseSuccess"){var b=a.value,c=b.propsAbKey,e=b.propsHash,f=b.propsRefresh,g=b.propsRefreshId,i=b.propsProp;b=b.erid;i=j(i);var k=i.newProps;i=i.samplingConfigs;return d("WAResultOrError").makeResult({abKey:c,hash:e,refresh:f,refreshId:g,props:k,samplingConfigs:i,erid:b==null?void 0:b.elementValue})}d("WALogger").WARN(h(),a.value);return d("WAResultOrError").makeError()});return i.apply(this,arguments)}function j(a){var b=[],c=[];a.forEach(function(a){a=a.configs;if(a.name==="ExperimentConfig"){var d;b.push({configCode:a.value.configCode,configValue:a.value.configValue,configExpoKey:(d=a.value.configExpoKey)==null?void 0:d.toString()})}else a.name==="SamplingConfig"&&c.push({eventCode:a.value.eventCode,samplingWeight:a.value.samplingWeight})});return{newProps:b,samplingConfigs:c}}g.getAbPropsProtocol=a}),98);
__d("WAAbPropsSync",["WAAbProps","WAAbPropsHelpers","WAGetAbPropsProtocol","WALogger","WAPromiseManagement","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: updating ab configs"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAAbProps.update: detected no hash"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["syncAbProps: detected no hash"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["fetchAbProps failed"]);k=function(){return a};return a}c=d("WAPromiseManagement").cacheWhilePending(function(){return"abProps"},a);function a(a){var b=a.sendHash;b=b===void 0?!0:b;var c=a.eventFlow;c==null?void 0:c.addPoint("sync_ab_props",{bool:{sendHash:b}});return b==null||b===!1?l(null,c):d("WAAbProps").getHash().then(function(a){return l(a,c)})}e=a;function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b==null?void 0:b.addPoint("fetch_ab_props");a=(yield d("WAGetAbPropsProtocol").getAbPropsProtocol(a));if(!a.success)d("WALogger").ERROR(k());else{a=a.value;var c=a.abKey,e=a.hash,f=a.refresh;a=a.props;a=d("WAAbPropsHelpers").parseAbProps(d("WAAbProps").getConfig(),a);b==null?void 0:b.addPoint("save_ab_props");b=(yield n(c,e,f,a));b.success===!1&&(b.error,d("WALogger").LOG(j()))}c=(yield d("WAAbProps").getRefreshSecs());return{seconds:c}});return m.apply(this,arguments)}function n(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f=(yield d("WAAbProps").getAbProps());a={abKey:a!=null?a:f.abKey,hash:b!=null?b:f.hash,refresh:d("WAAbPropsHelpers").maybeUpdateRefresh(c),lastSyncTime:d("WATimeUtils").unixTime(),propValues:f.propValues,propExpoKeys:f.propExpoKeys,internalExpoKeys:f.internalExpoKeys,expoKeyStr:f.expoKeyStr};if(b==null){yield d("WAAbProps").setAbProps(a);d("WALogger").LOG(i());return d("WAResultOrError").makeError("noHash")}d("WALogger").LOG(h());c=e.values;b=e.expoKeys;e=d("WAAbPropsHelpers").maybeUpdatePropValues(c,f.propValues,d("WAAbProps").getConfig());c=d("WAAbPropsHelpers").maybeUpdateExpoKeys(b,f.propExpoKeys,d("WAAbProps").getConfig());b=c.propExpoKeys;c=c.expoKeysToDelete;var g,j;c=d("WAAbPropsHelpers").maybeUpdateInternalExpoKeys(c,f.internalExpoKeys);c!=null&&(g=c.internalExpoKeys,j=c.expoKeyStr);yield d("WAAbProps").setAbProps(babelHelpers["extends"]({},a,{propValues:e,propExpoKeys:b,internalExpoKeys:g,expoKeyStr:j}));return d("WAResultOrError").makeResult()});return o.apply(this,arguments)}g.syncAbProps=c;g.syncAbPropsDebug=e}),98);
__d("WABulkSetRotateSenderKeyToTrueApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"bulkSetRotateSenderKeyToTrue",function(a){return function(b,c){return d("WADbPersonalSenderKeyStatusTxns").bulkSetRotateSenderKeyToTrueTxn(a,c).then(function(){})}});g.bulkSetRotateSenderKeyToTrue=a}),98);
__d("WACheckCiphertextInServer",["WAHttpResumeCheck","WAMediaUrl","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,c,e,f){return f.run(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,f){b=d("WAMediaUrl").buildUploadUrl(a,e,c,b.domain,f,!0);f=(yield d("WAHttpResumeCheck").httpResumeCheck(b));if(f.success)return d("WAResultOrError").makeResult(f);else{b=f.error;switch(b){case"server-timeout":case"unspecified-http-error":return d("WAResultOrError").makeError({progressMade:!0});default:return d("WAResultOrError").makeResult(d("WAResultOrError").makeError(b))}}});return function(a,b){return f.apply(this,arguments)}}()).then(function(a){return a!=null?a:d("WAResultOrError").makeError("max-attempts-exceeded")})}g.checkCiphertextInServer=a}),98);
__d("WAIsMediaKeyReusable",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=2*d("WATimeUtils").DAY_SECONDS;function a(a){var b=Math.floor(Math.random()*d("WATimeUtils").DAY_SECONDS);return a!=null&&d("WATimeUtils").happenedWithin(a,h+b)}g.MMS_MEDIA_KEY_TTL=h;g.isMediaKeyReusable=a}),98);
__d("WAFindReusableMediaEntry",["WAIsMediaKeyReusable","WAMediaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==null)return null;b=b.get(a);if(b==null)return null;a=d("WAMediaUtils").decodeMediaEntryData(b);b=a.fileEncSha256;var c=a.mediaKey,e=a.mediaKeyTimestamp,f=a.uploadToken;a=babelHelpers.objectWithoutPropertiesLoose(a,["fileEncSha256","mediaKey","mediaKeyTimestamp","uploadToken"]);return c!=null&&f!=null&&b!=null&&e!=null&&d("WAIsMediaKeyReusable").isMediaKeyReusable(e)?babelHelpers["extends"]({},a,{fileEncSha256:b,mediaKey:c,mediaKeyTimestamp:e,uploadToken:f}):null}g.findReusableMediaEntryForArmadillo=a}),98);
__d("WASmaxInDevicesFetchSelfResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup").parseRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup:b.value}))}g.parseFetchSelfResponseError=a}),98);
__d("WASmaxInDevicesDeviceInfoMixin",["WAResultOrError","WASmaxInDevicesIdentityKeyMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"platform");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function i(a){var b=d("WASmaxParseUtils").assertTag(a,"manufacturer");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function j(a){var b=d("WASmaxParseUtils").assertTag(a,"model");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function k(a){var b=d("WASmaxParseUtils").assertTag(a,"seen");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function l(a){var b=d("WASmaxParseUtils").assertTag(a,"creation");if(!b.success)return b;b=d("WASmaxParseUtils").contentInt(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function m(a){var b=d("WASmaxParseUtils").assertTag(a,"ip");if(!b.success)return b;b=d("WASmaxParseUtils").contentString(a);return!b.success?b:d("WAResultOrError").makeResult({elementValue:b.value})}function n(a){var b=d("WASmaxParseUtils").assertTag(a,"location");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"latitude");if(!b.success)return b;var c=d("WASmaxParseUtils").attrString(a,"longitude");if(!c.success)return c;a=d("WASmaxParseUtils").contentString(a);return!a.success?a:d("WAResultOrError").makeResult({latitude:b.value,longitude:c.value,elementValue:a.value})}function a(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxParseUtils").optionalChildWithTag(a,"platform",h);if(!b.success)return b;var c=d("WASmaxParseUtils").optionalChildWithTag(a,"manufacturer",i);if(!c.success)return c;var e=d("WASmaxParseUtils").optionalChildWithTag(a,"model",j);if(!e.success)return e;var f=d("WASmaxParseUtils").optionalChildWithTag(a,"seen",k);if(!f.success)return f;var g=d("WASmaxParseUtils").optionalChildWithTag(a,"creation",l);if(!g.success)return g;var o=d("WASmaxParseUtils").optionalChildWithTag(a,"ip",m);if(!o.success)return o;var p=d("WASmaxParseUtils").optionalChildWithTag(a,"location",n);if(!p.success)return p;var q=d("WASmaxParseUtils").attrIntRange(a,"id",1,999);if(!q.success)return q;a=d("WASmaxInDevicesIdentityKeyMixin").parseIdentityKeyMixin(a);return!a.success?a:d("WAResultOrError").makeResult(babelHelpers["extends"]({id:q.value},a.value,{platform:b.value,manufacturer:c.value,model:e.value,seen:f.value,creation:g.value,ip:o.value,location:p.value}))}g.parseDeviceInfoPlatform=h;g.parseDeviceInfoManufacturer=i;g.parseDeviceInfoModel=j;g.parseDeviceInfoSeen=k;g.parseDeviceInfoCreation=l;g.parseDeviceInfoIp=m;g.parseDeviceInfoLocation=n;g.parseDeviceInfoMixin=a}),98);
__d("WASmaxInDevicesFetchSelfResponseSuccess",["WAResultOrError","WASmaxInDevicesDeviceInfoMixin","WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function h(a){var b=d("WASmaxParseUtils").assertTag(a,"device");if(!b.success)return b;b=d("WASmaxInDevicesDeviceInfoMixin").parseDeviceInfoMixin(a);return!b.success?b:b}function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"self");if(!c.success)return c;a=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxParseUtils").mapChildrenWithTag(c.value,"device",1,25,h);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{selfDevice:b.value}))}g.parseFetchSelfResponseSuccessSelfDevice=h;g.parseFetchSelfResponseSuccess=a}),98);
__d("WASmaxOutDevicesFetchSelfRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQGetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(){var a=d("WASmaxOutDevicesBaseIQGetRequestMixin").mergeBaseIQGetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxJsx").smax("self",null)));return a}g.makeFetchSelfRequest=a}),98);
__d("WASmaxDevicesFetchSelfRPC",["WAComms","WASmaxInDevicesFetchSelfResponseError","WASmaxInDevicesFetchSelfResponseSuccess","WASmaxOutDevicesFetchSelfRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WASmaxOutDevicesFetchSelfRequest").makeFetchSelfRequest();a=(yield d("WAComms").sendSmaxStanza(b,a));var c=d("WASmaxInDevicesFetchSelfResponseSuccess").parseFetchSelfResponseSuccess(a,b);if(c.success)return{name:"FetchSelfResponseSuccess",value:c.value};a=d("WASmaxInDevicesFetchSelfResponseError").parseFetchSelfResponseError(a,b);if(a.success)return{name:"FetchSelfResponseError",value:a.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("FetchSelf",{Success:c,Error:a}))});return h.apply(this,arguments)}g.sendFetchSelfRPC=a}),98);
__d("WAGetCurrentUserDeviceList",["WAAssertUnreachable","WAGlobals","WAJids","WALogger","WAPersistedJobManager","WASignalKeys","WASmaxDevicesFetchSelfRPC","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Two devices were detected as isCurrentDevice in getCurrentUserDeviceList"]);h=function(){return a};return a}function i(a,b){if(a.isCurrentDevice&&b.isCurrentDevice){d("WALogger").ERROR(h());return 0}if(a.isCurrentDevice)return-1;if(b.isCurrentDevice)return 1;if(a.lastSeen!=null&&b.lastSeen==null)return-1;if(a.lastSeen==null&&b.lastSeen!=null)return 1;if(a.lastSeen!=null&&b.lastSeen!=null){a=a.lastSeen;b=b.lastSeen;return b.getTime()-a.getTime()}return 0}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield d("WASmaxDevicesFetchSelfRPC").sendFetchSelfRPC());switch(a.name){case"FetchSelfResponseError":var b=a.value.errorRetryableIQErrorOrNonRetryableIQErrorRetryableIQErrorMixinGroup;switch(b.name){case"RetryableIQError":var e=b.value.backoff;if(e!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{delay:e,type:"constant"},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{first:d("WATimeUtils").HOUR_MILLISECONDS/60,type:"exponential"},jitter:.1});default:b.name;e=b.value.code;throw c("err")("Failed with an error code "+e)}case"FetchSelfResponseSuccess":var f=d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid());return a.value.selfDevice.map(function(a){var b=a.creation,c=a.elementValue,e=a.id,g=a.ip,h=a.location,i=a.manufacturer,j=a.model,k=a.platform;a=a.seen;return{creationTime:b==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(b.elementValue)),id:d("WAJids").interpretAsDeviceId(e),identityKey:d("WASignalKeys").serializeIdentity(c),ipAddress:(b=g==null?void 0:g.elementValue)!=null?b:null,isCurrentDevice:e===f,lastSeen:a==null?null:d("WATimeUtils").toDate(d("WATimeUtils").castToUnixTime(a.elementValue)),latitude:h==null?null:parseFloat(h.latitude),location:(c=h==null?void 0:h.elementValue)!=null?c:null,longitude:h==null?null:parseFloat(h.longitude),manufacturer:(g=i==null?void 0:i.elementValue)!=null?g:null,model:(b=j==null?void 0:j.elementValue)!=null?b:null,platform:(e=k==null?void 0:k.elementValue)!=null?e:null}}).sort(i);default:return c("WAAssertUnreachable")(a.name)}});return j.apply(this,arguments)}g.getCurrentUserDeviceList=a}),98);
__d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestMixin","WASmaxInDevicesIQErrorItemNotFoundMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInDevicesIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);return c.success?d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorItemNotFound"],[b,c])}g.parseIQErrorBadRequestOrItemNotFoundMixinGroup=a}),98);
__d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin",["WAResultOrError","WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxInDevicesIQErrorBadRequestOrItemNotFoundMixinGroup").parseIQErrorBadRequestOrItemNotFoundMixinGroup(a);return!b.success?b:d("WAResultOrError").makeResult({iQErrorBadRequestOrItemNotFoundMixinGroup:b.value})}g.parseNonRetryableRemoveDeviceIQErrorMixin=a}),98);
__d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup",["WAResultOrError","WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin","WASmaxInDevicesRetryableIQErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInDevicesRetryableIQErrorMixin").parseRetryableIQErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"RetryableIQError",value:b.value});var c=d("WASmaxInDevicesNonRetryableRemoveDeviceIQErrorMixin").parseNonRetryableRemoveDeviceIQErrorMixin(a);return c.success?d("WAResultOrError").makeResult({name:"NonRetryableRemoveDeviceIQError",value:c.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["RetryableIQError","NonRetryableRemoveDeviceIQError"],[b,c])}g.parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup=a}),98);
__d("WASmaxInDevicesRemoveResponseError",["WAResultOrError","WASmaxInDevicesIQErrorResponseMixin","WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInDevicesIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInDevicesRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup").parseRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup:b.value}))}g.parseRemoveResponseError=a}),98);
__d("WASmaxInDevicesRemoveResponseSuccess",["WASmaxInDevicesIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInDevicesIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseRemoveResponseSuccess=a}),98);
__d("WASmaxOutDevicesKeyDataMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.anyElementValue;a=d("WASmaxJsx").smax("smax$any",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeKeyDataMixin=a}),98);
__d("WASmaxOutDevicesIdentityKeyMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutDevicesKeyDataMixin"],(function(a,b,c,d,e,f,g){function h(a){a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutDevicesKeyDataMixin").mergeKeyDataMixin(d("WASmaxJsx").smax("identity",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeIdentityKeyMixin=a}),98);
__d("WASmaxOutDevicesRemoveRequest",["WASmaxJsx","WASmaxOutDevicesBaseIQSetRequestMixin","WASmaxOutDevicesIdentityKeyMixin","WAWap"],(function(a,b,c,d,e,f,g){function a(a){var b=a.removeId;a=a.identityKeyMixinArgs;b=d("WASmaxOutDevicesBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").S_WHATSAPP_NET,xmlns:"fbid:devices"},d("WASmaxOutDevicesIdentityKeyMixin").mergeIdentityKeyMixin(d("WASmaxJsx").smax("remove",{id:d("WAWap").INT(b)}),a)));return b}g.makeRemoveRequest=a}),98);
__d("WASmaxDevicesRemoveRPC",["WAComms","WASmaxInDevicesRemoveResponseError","WASmaxInDevicesRemoveResponseSuccess","WASmaxOutDevicesRemoveRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutDevicesRemoveRequest").makeRemoveRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInDevicesRemoveResponseSuccess").parseRemoveResponseSuccess(b,a);if(c.success)return{name:"RemoveResponseSuccess",value:c.value};b=d("WASmaxInDevicesRemoveResponseError").parseRemoveResponseError(b,a);if(b.success)return{name:"RemoveResponseError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("Remove",{Success:c,Error:b}))});return h.apply(this,arguments)}g.sendRemoveRPC=a}),98);
__d("WARemoveDevice",["WALogger","WAPersistedJobManager","WAPushSafeTypes","WAResultOrError","WASignalOther","WASmaxDevicesRemoveRPC","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeDevice result for ",": "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeDevice called for device "," and identity ",""]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAPushSafeTypes").unsafeNotNullable(b);b=a.deviceId;a=a.identity;d("WALogger").DEV(i(),b,a);a=d("WASignalOther").sliceBytes(a,1,32);a=(yield d("WASmaxDevicesRemoveRPC").sendRemoveRPC({removeId:b,identityKeyMixinArgs:{anyElementValue:a}}));d("WALogger").LOG(h(),b,a);if(a.name==="RemoveResponseSuccess")return d("WAResultOrError").makeResult();else{a.name;b=a.value.errorRetryableOrNonRetryableRemoveDeviceIQErrorMixinGroup;if(b.name!=="RetryableIQError")return d("WAResultOrError").makeError();b.name;a=b.value.backoff;if(a!=null)throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"constant",delay:a},jitter:0});else throw new(d("WAPersistedJobManager").RetryOnBackoff)({algo:{type:"exponential",first:d("WATimeUtils").HOUR_MILLISECONDS/60},jitter:.1})}});return j.apply(this,arguments)}g.removeDevice=a}),98);
__d("WARemoveCurrentDevice",["WAGetCurrentUserDeviceInfoApi","WAGlobals","WALogger","WARemoveDevice","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["There is no stored user info, it was already deleted or this job was called twice, possibly from another tab"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeCurrentDevice called for current device"]);i=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){d("WALogger").DEV(i());var b=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());if(b==null){d("WALogger").WARN(h());return d("WAResultOrError").makeResult()}var c=b.deviceId;b=b.identityKey;a=(yield d("WARemoveDevice").removeDevice(a,{deviceId:c,identity:b}));if(a.success){yield d("WAGlobals").getDependencies().clearSignalAndTempStores();return d("WAResultOrError").makeResult()}return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}();g.removeCurrentDevice=a}),98);
__d("WASaveReceiptApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"saveReceipt",function(a){return function(b){return a.receipts.put({msgId:b.id.externalId.toString(),permittedIdentitiesPerDevice:b.permittedIdentitiesPerDevice,recipientDevices:b.recipientDevices,waMsgId:d("WAMsg").craftWAMsgIdString(b.id)}).then(function(){})}});g.saveReceipt=a}),98);
__d("WASendAppDataFanoutProtocol",["WAAsMessageApplication","WABridge","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAOdsEnums","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Got phash mismatch on appdata, local[","] server[","]"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to more than the allowed "," devices"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Attempting to send an appData stanza to "," devices"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to devices with error: ",""]);n=function(){return a};return a}var o=d("WATagsLogger").TAGS(["sendAppDataFanout"]),p=24;function a(a,b){a=b.contents;var c=b.externalId,e=b.permittedIdentitiesPerDevice;b=b.checkPhash;b=b===void 0?"checkPhash":b;return q(a,c,e,b)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);o.ERROR(n(),a);return d("WAResultOrError").makeError("runtime-error")})}function q(a,b,c,d){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){e===void 0&&(e="checkPhash");o.LOG(m(),b);a=d("WAConvertAppData").convertAppData(a);var f={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArrayView()),version:"v3"},g=[];a=Array.from(c.entries()).map(function(a){var b=a[0];a=a[1];return{identity:a.pubKey,jid:b}});c=p;a.length>c&&(o.WARN(l(),a.length),o.ERROR(k(),c),a=a.slice(0,c));var n=[{devicesInfo:a,user:d("WAGlobals").getMyUserJid()}];c=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptUserMsg(n,{messageBytes:f,type:"appdata"},{cryptoManager:a})},{operationType:"encrypt",flush:!0}));a=c.phash;var q=!1;c.participants!=null&&c.participants.forEach(function(a){a.type==="pkmsg"&&(q=!0),g.push({toJid:a.to,encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)}})});c={appdataTo:d("WAGlobals").getMyUserJid(),toArgs:g};c={peerPeerFanout:c};var r=void 0;if(q){var s=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());s=s==null?void 0:s.identityKey;if(s==null){o.ERROR(j());return d("WAResultOrError").makeError("no-public-identity")}r={deviceIdentityElementValue:s}}s={appdataDeviceListCheck:e==="checkPhash"?"true":"false"};e={appdataId:b,peerMsgTypesArgs:c,deviceIdentityMixinArgs:r,withDeviceListCheckMixinArgs:s};b=(yield d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(e));switch(b.name){case"PeerResponseSuccess":r=(c=b.value.deviceListStaleMixin)==null?void 0:c.phash;if(r!=null&&a!=null&&r!==a){o.LOG(i(),a,r);d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.PHASH_MISMATCH,key:"appdata"});return d("WAResultOrError").makeResult({phashMismatch:!0,serverTs:d("WATimeUtils").castToUnixTime(b.value.t)})}else return d("WAResultOrError").makeResult({phashMismatch:!1,serverTs:d("WATimeUtils").castToUnixTime(b.value.t)});default:b.name;o.ERROR(h(),b.value.error);return d("WAResultOrError").makeError("ack-failure")}});return r.apply(this,arguments)}g.MAX_APPDATA_RECIPIENTS=p;g.sendAppDataToDevicesProtocol=a}),98);
__d("WASendMsgUtilV2",["Promise","WADevicesState","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMsg","WAResultOrError","WASaveReceiptApi","WASendMsgInternal","WASentBytesCache","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error loading current device identity ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg failed to save sent bytes to cache: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients, but it is a self thread"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message with no recipients"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Trying to send a message that does not have a receipt in db"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to save receipt for message with error ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Error during get devices before sending: ",""]);o=function(){return a};return a}function p(a){return(h||(h=b("Promise"))).resolve()}function q(a,b){return d("WADevicesState").getDevicesState().waitForUserDevices(Array.from(new Set([a,d("WAGlobals").getMyUserJid()])),"GetDevicesBeforeSend: "+b)}function r(a,c){a=c.chatJid;var e=c.reason;return d("WAJids").switchOnChatJidType(a,{group:function(a){return p(a)},interopUser:function(a){return q(a,e)},lidUser:function(a){return q(a,e)},msgrUser:function(a){return q(a,e)},phoneUser:function(a){return q(a,e)}})["catch"](function(a){d("WALogger").ERROR(o(),a);return(h||(h=b("Promise"))).resolve()})}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.messagePayload;a=a.loadThreadParticipants;var e={author:c.protocolMsgId.author,chat:c.protocolMsgId.chat,externalId:c.protocolMsgId.externalId},f=(yield d("WALoadReceiptApi").loadReceipt(e));if(f.success)return f;b.addPoint("get_devices_before_send_start");yield r(void 0,{chatJid:c.protocolMsgId.chat,reason:"prepareReceipt"});b.addPoint("get_devices_before_send_end");var g=(yield a(c.protocolMsgId.chat));b.addPoint("get_identities_start");f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(g)},{flush:!1,afterInit:!0,operationType:"prepare_receipt_load_identities"}));a=[];if(f.size===0)a=[].concat(g);else for(c of f){var h=c[0],i=c[1];i.size===0&&a.push(h)}a.length>0&&(yield d("WADevicesState").getDevicesState().waitForUserDevices(a,"GetDevicesBeforeSend: prepareReceipt",!0),f=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return a.storage.bulkLoadIdentities(g)},{afterInit:!0,flush:!1,operationType:"prepare_receipt_load_identities"})));i=new Map();for(h of f){h[0];c=h[1];for(a of c){f=a[0];c=a[1];if(f===d("WAGlobals").getMyDeviceJid())continue;i.set(f,{pubKey:c})}}b.addPoint("get_identities_end");f=new Set();c={permittedIdentitiesPerDevice:i,recipientDevices:f,id:e};b.addPoint("save_receipts_start");yield d("WASaveReceiptApi").saveReceipt(c)["catch"](function(a){b.addPoint("save_receipts_fail");d("WALogger").ERROR(n(),a);return d("WAResultOrError").makeError("missing-receipt")});b.addPoint("save_receipts_end");return d("WAResultOrError").makeResult(c)});return t.apply(this,arguments)}function a(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){a=c.messagePayload;var f=c.loadThreadParticipants,g=c.sendIdentity;g=g===void 0?!1:g;c=c.isInstamadillo;c=c===void 0?!1:c;e.addPoint("prepare_receipt_start");f=(yield s({messagePayload:a,loadThreadParticipants:f},e));if(f.success===!1){e.addPoint("prepare_receipt_fail");d("WALogger").ERROR(m());return d("WAResultOrError").makeError({type:"missing-receipt"})}e.addPoint("prepare_receipt_end");f=f.value;var i=a.frankingKey,n=a.frankingVersion,o=a.messageBytes,p=a.backupDirective,q=a.messageType,r=a.protocolMsgId;a=v(f.permittedIdentitiesPerDevice);f=q.type==="text"&&q.invitedParticipantUserJid!=null?a.filter(function(a){return a.user===q.invitedParticipantUserJid||a.user===d("WAGlobals").getMyUserJid()}):a;e.addPoint("recipients-calculated",{"int":{recipientsCount:f.length},string:{msgType:q.type}});a=q.type==="text"&&q.invitedParticipantUserJid!=null?q.invitedParticipantUserJid:r.chat;var t=r.chat===d("WAGlobals").getMyUserJid();if(f.length===0&&!t){d("WALogger").ERROR(l());return d("WAResultOrError").makeError({type:"no-recipients",isRetriable:!1})}else if(f.length===0&&t){d("WALogger").LOG(k());return d("WAResultOrError").makeResult({baseKey:null,reportingMeta:null,serverTs:d("WATimeUtils").unixTime()})}t=g?yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return w(a)},{operationType:"get_my_device_identity",flush:!1,afterInit:!0}):null;g=(yield q.isRevoked===!0?(h||(h=b("Promise"))).resolve(null):d("WAGenReportingMeta").genReportingMeta(o.bytes,i,n));return d("WASendMsgInternal").sendMessage({type:"chat",messageBytes:o,chat:a,deviceIdentity:t,messageType:q,protocolMsgId:r,externalId:r.externalId,recipients:f,reportingMeta:g,backupDirective:p},e,c).then(function(a){if(a.success)return d("WASentBytesCache").sentBytesCache().saveSentBytes({ts:a.value.serverTs,frankingKey:i,frankingVersion:n,messageBytes:o,backupDirective:p,messageType:q,protocolMsgId:r,waMsgId:d("WAMsg").craftWAMsgIdString({author:r.author,chat:r.chat,externalId:r.externalId})})["catch"](function(a){d("WALogger").ERROR(j(),a)}).then(function(){return a});else return a})});return u.apply(this,arguments)}function v(a){var b=new Map();a.forEach(function(a,c){a=a.pubKey;var e=d("WAJids").extractUserJid(c);a={identity:a,jid:c};c=b.get(e)||[];c.push(a);b.set(e,c)});return Array.from(b,function(a){var b=a[0];a=a[1];return{devicesInfo:a,user:b}})}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield a.storage.loadIdentities(d("WAGlobals").getMyUserJid()));a=a.get(d("WAGlobals").getMyDeviceJid());if(a!=null)return a;throw c("err")("missing-identity")}catch(a){d("WALogger").ERROR(i(),a)}});return x.apply(this,arguments)}g.getDevicesBeforeSend=r;g.sendChatMessage=a}),98);
__d("WASetClockSkewApi",["WASetMetaApiV2"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){a=a.clockSkew;return d("WASetMetaApiV2").setMeta({clockSkew:a})};g.setClockSkew=a}),98);
__d("WASendPing",["WAComms","WALogger","WASetClockSkewApi","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendPing: sending"]);h=function(){return a};return a}function a(){d("WALogger").LOG(h()),d("WAComms").sendPing()}function c(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=b.clockSkew;d("WATimeUtils").setClockSkew(a);yield d("WASetClockSkewApi").setClockSkew({clockSkew:a})});return i.apply(this,arguments)}g.sendPing=a;g.updateClockSkew=c}),98);
__d("WASyncAbProps",["WAAbPropsSync","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Syncing ABProps"]);h=function(){return a};return a}function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=b.sendHash;d("WALogger").LOG(h());yield d("WAAbPropsSync").syncAbProps({sendHash:b,eventFlow:a!=null?a:void 0})});return i.apply(this,arguments)}g.syncAbProps=a}),98);
__d("WAUploadMedia",["WABase64","WABlobToArrayBuffer","WACheckCiphertextInServer","WACreateRetrier","WAEncryptAndUploadPlaintext","WAErrorMessage","WAFindReusableMediaEntry","WALogger","WAMediaUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is not on the server, start uploading"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is partially on the server, start uploading from byteOffset ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: media is on the server"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume/exist check exhausted available retries"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: resume check unexpected runtime error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: async upload"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["encryptAndUploadPlaintext: no plaintext"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: no media entry found, need to upload media"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: get media entry unexpected runtime error: ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: fail to gather media routes"]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateMediaEntry unexpected runtime error: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["uploadMedia: unexpected runtime error: ",""]);u=function(){return a};return a}function a(a){var b=a.uploadMediaMetric;return v(babelHelpers["extends"]({},a))["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);d("WALogger").ERROR(u(),a);return d("WAResultOrError").makeError("runtime-error")}).then(function(a){a.success?b.endSuccess():b.endFail(a.error,{string:{failReason:a.error}});return a})}function v(a){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.chatJid;var b=a.filename,c=a.hash,e=a.mediaTypeDetails,f=a.protocolMsgId,g=a.size,t=a.uploadMediaMetric,u=a.getMediaKnownEntries,v=a.getMediaPlaintext,w=a.updateMediaEntryForMsg,y=a.updateMediaEntryForOptimisticUpload;a=a.getDownloadableThumbnailForMedia;var z;e.type==="regular"?z=e.mediaType:(z="preview",t.addAnnotations({string:{fullSizeMediaType:e.messageType}}));t.addPoint("create_upload_retrier_start");e=(yield d("WACreateRetrier").createUploadRetrier(z,t));if(!e.success){d("WALogger").WARN(s());t.addPoint("create_upload_retrier_fail");return e}t.addPoint("create_upload_retrier_end");e=e.value;w=x(f,c,w,y,t);t.addPoint("get_media_entry_start");y=(yield u(c)["catch"](function(a){d("WALogger").ERROR(r(),d("WAErrorMessage").maybeGetMessageFromError(a));t.addPoint("get_media_entry_fail");throw a}));u=d("WAFindReusableMediaEntry").findReusableMediaEntryForArmadillo(f,y);t.addPoint("get_media_entry_end");if(u==null){t.addPoint("create_media_key_start");d("WALogger").LOG(q());f=d("WAMediaUtils").createMediaKey();y=d("WAMediaUtils").createUploadToken();var A=d("WATimeUtils").unixTime();t.addPoint("create_media_key_end");t.addPoint("get_media_plaintext_start");var B=(yield v(c).then(function(a){return a==null?null:d("WABlobToArrayBuffer").blobToArrayBuffer(a)}));if(B==null){d("WALogger").ERROR(p());t.addPoint("get_media_plaintext_fail");return d("WAResultOrError").makeError("no-plaintext")}t.addPoint("get_media_plaintext_end");return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,mediaKey:f,mediaKeyTimestamp:A,serverMediaType:z,mediaUploadFlow:t,plaintext:B,plaintextHash:c,updateMediaEntry:w,uploadRetrier:e,uploadToken:y,getDownloadableThumbnailForMedia:a})}f=u.directPath;A=u.downloadableThumbnail;B=u.fileEncSha256;y=u.fileSha256;var C=u.mediaKey,D=u.mediaKeyTimestamp,E=u.objectId;u=u.uploadToken;A={directPath:f,downloadableThumbnail:A,fileEncSha256:B,filename:b,fileSha256:y||d("WABase64").decodeB64UrlSafe(c),mediaKey:C,mediaKeyTimestamp:D,objectId:E,serverMediaType:z,size:g,uploadToken:u};if(f!=null){d("WALogger").LOG(o());yield w(A);t.addAnnotations({bool:{reused_media_entry:!0}});return d("WAResultOrError").makeResult(A)}t.addPoint("resume_check_start");y=(yield d("WACheckCiphertextInServer").checkCiphertextInServer(z,B,u,e)["catch"](function(a){d("WALogger").ERROR(n(),d("WAErrorMessage").maybeGetMessageFromError(a));t.addPoint("resume_check_fail");throw a}));if(!y.success){t.addPoint("resume_check_fail");d("WALogger").WARN(m());return y}t.addPoint("resume_check_end");E=y.value;if(E.type==="media-found"){d("WALogger").LOG(l());t.addAnnotations({bool:{existingMediaFound:!0}});f=babelHelpers["extends"]({},A,{directPath:E.directPath,objectId:E.objectId});yield w(f);t.addAnnotations({bool:{reused_media_entry:!0}});return d("WAResultOrError").makeResult(f)}else if(E.type==="media-partial-found"){d("WALogger").LOG(k(),E.resumeFromBytes);B=E.resumeFromBytes;t.addPoint("get_media_plaintext_start");y=(yield v(c).then(function(a){return a==null?null:d("WABlobToArrayBuffer").blobToArrayBuffer(a)}));if(y==null){d("WALogger").ERROR(j());t.addPoint("get_media_plaintext_fail");return d("WAResultOrError").makeError("no-plaintext")}t.addPoint("get_media_plaintext_end");return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,fromOffset:B,mediaKey:C,mediaKeyTimestamp:D,serverMediaType:z,mediaUploadFlow:t,plaintext:y,plaintextHash:c,updateMediaEntry:w,uploadRetrier:e,uploadToken:u,getDownloadableThumbnailForMedia:a})}d("WALogger").LOG(i());A=d("WATimeUtils").unixTime();t.addPoint("get_media_plaintext_start");f=(yield v(c).then(function(a){return a==null?null:d("WABlobToArrayBuffer").blobToArrayBuffer(a)}));if(f==null){d("WALogger").ERROR(h());t.addPoint("get_media_plaintext_fail");return d("WAResultOrError").makeError("no-plaintext")}t.addPoint("get_media_plaintext_end");return d("WAEncryptAndUploadPlaintext").encryptAndUploadPlaintext({size:g,filename:b,mediaKey:C,mediaKeyTimestamp:A,serverMediaType:z,mediaUploadFlow:t,plaintext:f,plaintextHash:c,updateMediaEntry:w,uploadRetrier:e,uploadToken:u,getDownloadableThumbnailForMedia:a})});return w.apply(this,arguments)}function x(a,b,c,e,f){return function(g){f.addPoint("update_media_entry_start");var h=d("WAMediaUtils").encodeMediaEntryForUpload(g);g=a==null?e(b,function(){return h},g==null?void 0:g.objectId,g==null?void 0:g.serverMediaType):c(b,a,function(){return h},g==null?void 0:g.objectId,g==null?void 0:g.serverMediaType);return g.then(function(a){f.addPoint("update_media_entry_end");return a})["catch"](function(a){d("WALogger").ERROR(t(),d("WAErrorMessage").maybeGetMessageFromError(a));f.addPoint("update_media_entry_fail");throw a})}}g.uploadMedia=a}),98);/*FB_PKG_DELIM*/
__d("ACSCipherSuiteModule",[],(function(a,b,c,d,e,f){"use strict";b={hash:"SHA-512",name:"HMAC"};c={curveName:"RISTRETTO",macAlgorithm:b,value:1};var g=new Map([[c.value,c]]);function a(a){return g.has(a)?g.get(a):null}f.VOPRF_RISTRETTO_HMACSHA512=c;f.getACSCipherSuiteByValue=a}),66);
__d("ACSTokenHmacUtil",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return h(a,b).then(function(a){return j(a,c)})}function h(a,b){return d("XPlatReactCrypto").subtleImportKey("raw",b,a,!1,["sign"]).then(function(b){return{algo:a,key:b}})}function i(a){return typeof a.hash==="string"?a.hash:a.hash.name}function j(a,b){var c=a.algo;a=a.key;c={hash:i(c),name:"HMAC"};return d("XPlatReactCrypto").subtleSign(c,a,b).then(function(a){return new Uint8Array(a)})}g.hmac=a}),98);
__d("LSACSExperimentCapability",[],(function(a,b,c,d,e,f){a=Object.freeze({RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:0,BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:1,INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:2});f["default"]=a}),66);
__d("LSBeginHandlingFireForgetTasksForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return c[0]=b.createArray(),b.forEach(b.filter(b.db.table(5).fetch(),function(b){return b.queueName===a[0]}),function(a){a=a.item;return c[3]=new b.Map(),c[3].set("label",a.context),c[3].set("payload",a.taskValue),c[3].set("queue_name",a.queueName),c[3].set("task_id",a.taskId),c[3].set("failure_count",b.i64.eq(b.i64.cast([0,0]),b.i64.cast([0,0]))?void 0:b.i64.cast([0,0])),c[4]=(c[0].push(c[3]),c[0])})},function(e){return c[1]=new b.Map(),c[1].set("tasks",c[0]),c[1].set("epoch_id",void 0),c[2]=new b.Map(),c[2].set("queue_name",a[0]),c[2].set("next_sync_ms",void 0),c[2].set("work_item_type",b.i64.cast([0,5])),c[2].set("network_payload",c[1]),c[2].set("http_url_override",void 0),c[2].set("skip_realtime_gateway",!1),d[0]=c[2]}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreBeginHandlingFireForgetTasksForQueueStoredProcedure";a.__tables__=["pending_fire_and_forget_tasks"];e.exports=a}),null);
__d("LSBeginHandlingFireForgetTasksForQueueStoredProcedure",["LSBeginHandlingFireForgetTasksForQueue","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBeginHandlingFireForgetTasksForQueue"),e.queueName);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSForceTaskExecutionImmediately",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?0:(e=d.item,c[1]=b.i64.of_float(Date.now()),b.i64.lt(c[1],e.minTimeToSyncTimestampMs)?b.forEach(b.db.table(2).fetch([[[a[0]]]]),function(a){var c=a.update;a=a.item;return c({minTimeToSyncTimestampMs:b.i64.cast([0,0]),failureCount:b.i64.add(a.failureCount,b.i64.cast([0,1]))})}):b.resolve())})},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreForceTaskExecutionImmediatelyStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSRemoveUsedTokens",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(a){return b.forEach(b.filter(b.db.table(309).fetch(),function(a){return b.i64.le(a.redeemLimit,b.i64.cast([0,0]))}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSAnonymousCredentialsRemoveUsedTokensStoredProcedure";a.__tables__=["secure_acs_tokens"];e.exports=a}),null);
__d("LSGetCurrentTokenPoolState",["LSArrayGetObjectAt","LSRemoveBlindedTokens","LSRemoveUsedTokens"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),d[1]=c.createArray(),c.count(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]})).then(function(a){return d[2]=a})},function(b){return c.forEach(c.filter(c.db.table(307).fetch(),function(b){return b.projectName===a[0]}),function(a){a=a.item;return d[7]=a.configId,c.i64.gt(d[0],a.expirationTimestampMs)?c.forEach(c.db.table(307).fetch([[[d[7]]]]),function(a){return a["delete"]()}):c.resolve(d[8]=(d[1].push(d[7]),d[1]))})},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[3]=c.i64.cast([0,0]),d[4]=c.i64.of_int32(d[1].length),c.i64.gt(d[4],c.i64.cast([0,0]))?c.loopAsync(d[4],function(a){return d[7]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[1],d[7]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return c.count(c.filter(c.db.table(309).fetch(),function(a){return a.configId===d[8]})).then(function(a){return d[10]=a})},function(a){return d[3]=c.i64.add(d[10],d[3]),c.storedProcedure(b("LSRemoveBlindedTokens"),d[8])}])}):c.resolve()},function(a){return c.i64.gt(d[2],c.i64.cast([0,0]))?(d[7]=c.i64.of_int32(d[1].length),d[5]=c.i64.ge(d[7],c.i64.cast([0,1]))):d[5]=void 0,d[5]!==void 0?(d[5]?(c.i64.gt(d[3],c.i64.cast([0,0]))?d[8]=c.i64.cast([0,3]):d[8]=c.i64.cast([0,2]),d[7]=d[8]):d[7]=c.i64.cast([0,1]),d[6]=d[7]):d[6]=c.i64.cast([0,0]),a=[d[6],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsGetCurrentTokenPoolStateStoredProcedure";a.__tables__=["secure_acs_configurations","secure_acs_tokens"];e.exports=a}),null);
__d("LSIssueNextSync",["LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.count(c.filter(c.db.table(310).fetch(),function(b){return b.projectName===a[1]})).then(function(a){return d[0]=a})},function(e){return c.i64.gt(d[0],c.i64.cast([0,0]))&&a[3]===!0?c.resolve(0):c.sequence([function(b){return c.forEach(c.filter(c.db.table(310).fetch(),function(b){return b.projectName===a[1]}),function(a){return a["delete"]()})},function(e){return c.i64.gt(a[2],c.i64.cast([0,0]))?(d[3]=c.i64.of_float(Date.now()),d[1]=c.i64.add(d[3],a[2])):d[1]=c.i64.cast([0,0]),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["acs_sync","_",a[1]].join(""),c.i64.cast([0,362]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,d[1],c.i64.cast([0,0])).then(function(a){return a=a,d[2]=a[0],a})},function(b){return c.db.table(310).add({taskId:d[2],projectName:a[1],maxClientTokenPoolSize:a[0]})}])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsIssueNextSyncStoredProcedure";a.__tables__=["acs_request_context"];e.exports=a}),null);
__d("LSVoprfBlind.nop",["XPlatReactVoprf","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("XPlatReactVoprf").loadXPlatReactVoprf());b=a.voprfInstance;a=b.voprfInfo;var e=b.voprfWasm;try{e=e.blind(a,new Uint8Array(c));return[e.blindedElement.buffer,e.blindingFactor.buffer]}catch(a){throw a}finally{d("XPlatReactVoprf").freeVoprfInstance(b)}});function c(b,c,d){return a.apply(this,arguments)}return c}();a.__nop_name__="LSVoprfBlind";g["default"]=a}),98);
__d("LSVoprfCreateNonce.nop",["LSSynchronousPromise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h=32;a=function(a,b){a=h;b=new Uint8Array(a);d("XPlatReactCrypto").getRandomValues(b);return d("LSSynchronousPromise").maybeMakeSynchronousPromise([b.buffer])};a.__nop_name__="LSVoprfCreateNonce";g["default"]=a}),98);
__d("LSTaskSerializerAcsIssueNextSync",["LSBase64Encode.nop","LSGetCurrentTokenPoolState","LSIssueNextSync","LSVoprfBlind.nop","LSVoprfCreateNonce.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return c.db.table(310).fetch([[[a[0]]]]).next().then(function(a,e){var f=a.done;a=a.value;return f?(function(a){c.logger(a).mustfix(a)}("Request context for the passed task_id was not found"),f=[void 0,void 0,void 0],d[0]=f[0],d[1]=f[1],d[2]=f[2],f):(e=a.item,c.sequence([function(a){return d[9]=e.projectName,d[10]=e.maxClientTokenPoolSize,c.storedProcedure(b("LSGetCurrentTokenPoolState"),d[9]).then(function(a){return a=a,d[4]=a[0],d[5]=a[1],a})},function(a){return c.i64.eq(d[4],c.i64.cast([0,0]))||c.i64.eq(d[4],c.i64.cast([0,1]))?c.resolve((d[11]=new c.Map(),d[11].set("project_name",d[9]),d[12]=c.toJSON(d[11]),a=[d[12],c.i64.cast([0,351]),void 0],d[6]=a[0],d[7]=a[1],d[8]=a[2],a)):c.sequence([function(a){return d[11]=c.i64.of_float(Date.now()),c.islc(c.sortBy(c.filter(c.db.table(307).fetch(),function(a){return a.projectName===d[9]&&c.i64.gt(a.expirationTimestampMs,d[11])}),[["expirationTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?(function(a){c.logger(a).mustfix(a)}("A config for the passed project name was not found"),d[16]=new c.Map(),d[16].set("project_name",d[9]),d[16].set("max_client_token_pool_size",d[10]),d[17]=c.toJSON(d[16]),a=[d[17],c.i64.cast([0,362]),void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a):(f=e.item,c.sequence([function(a){return d[24]=f.configId,d[16]=f.maxEvals,d[26]=f.tokenPollFrequencyMs,d[25]=f.maxClientTokenPoolSize,d[17]=c.i64.sub(d[10],d[5]),d[23]=c.i64.lt(d[16],d[17])?d[16]:d[17],d[18]=c.createArray(),c.i64.gt(d[23],c.i64.cast([0,0]))?c.loopAsync(d[23],function(a){return d[27]=a,c.sequence([function(a){return c.nativeOperation(b("LSVoprfCreateNonce.nop")).then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.blobs.neq(d[28],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSVoprfBlind.nop"),d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return c.blobs.neq(d[29],void 0)?c.blobs.neq(d[30],void 0)?c.sequence([function(a){return d[31]=c.i64.cast([-1,4294967295]),c.db.table(308).peekNextAutoIncrementId().then(function(a){return d[31]=a})},function(a){return c.db.table(308).add({tokenId:void 0,blindedNonce:d[29],blindingFactor:d[30],nonce:d[28],configId:d[24]})},function(a){return c.db.table(308).fetch([[[d[31]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[32]=c.i64.cast([-1,4294967295]):(e=b.item,d[32]=e.tokenId)})},function(a){return c.i64.eq(d[32],c.i64.cast([-1,4294967295]))?c.sequence([function(a){return c.islc(c.db.table(308).fetchDesc([[[{gt:c.i64.cast([0,0])}]]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,e){var a=b.done;b=b.value;return a?d[37]=c.i64.cast([-1,4294967295]):(e=b.item,d[37]=e.tokenId)})},function(a){return d[34]=d[37]}]):c.resolve(d[34]=d[32])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[36]=new c.Map(),d[36].set("id",d[34]),d[36].set("data",d[35]==null?"":d[35]),d[37]=(d[18].push(d[36]),d[18])}]):c.resolve():c.resolve()}]):c.resolve()}])}):c.resolve()},function(a){return d[19]=c.i64.of_int32(d[18].length),c.i64.gt(d[19],c.i64.cast([0,0]))?c.resolve((d[27]=new c.Map(),d[27].set("project_name",d[9]),d[27].set("config_id",d[24]),d[27].set("blinded_nonces",d[18]),d[28]=c.toJSON(d[27]),a=[d[28],c.i64.cast([0,354]),void 0],d[20]=a[0],d[21]=a[1],d[22]=a[2],a)):c.sequence([function(a){return c.i64.neq(d[26],void 0)?c.sequence([function(a){return c.i64.neq(d[25],void 0)?c.sequence([function(a){return function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling next ACS token sync locally for project: ",d[9]].join("")),c.storedProcedure(b("LSIssueNextSync"),d[25],d[9],d[26],!1)},function(a){return a=[void 0,void 0,void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2],a}]):c.resolve((function(a){c.logger(a).info(a)}(["token_poll_frequency is nonnull but max_client_token_pool_size is null. Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[9]].join("")),d[33]=new c.Map(),d[33].set("project_name",d[9]),d[33].set("max_client_token_pool_size",d[10]),d[34]=c.toJSON(d[33]),a=[d[34],c.i64.cast([0,362]),void 0],d[30]=a[0],d[31]=a[1],d[32]=a[2],a))},function(a){return a=[d[30],d[31],d[32]],d[27]=a[0],d[28]=a[1],d[29]=a[2],a}]):c.resolve((function(a){c.logger(a).info(a)}(["Already have the max number of tokens. Scheduling the next ACS token sync for project: ",d[9]].join("")),d[30]=new c.Map(),d[30].set("project_name",d[9]),d[30].set("max_client_token_pool_size",d[10]),d[31]=c.toJSON(d[30]),a=[d[31],c.i64.cast([0,362]),void 0],d[27]=a[0],d[28]=a[1],d[29]=a[2],a))},function(a){return a=[d[27],d[28],d[29]],d[20]=a[0],d[21]=a[1],d[22]=a[2],a}])},function(a){return a=[d[20],d[21],d[22]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}])},function(a){return a=[d[6],d[7],d[8]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}]))})},function(a){return a=[d[0],d[1],d[2]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsTaskSerializerAcsIssueNextSyncStoredProcedure";a.__tables__=["acs_request_context","secure_acs_configurations","secure_acs_blinded_tokens"];e.exports=a}),null);
__d("LSTaskSerializerDeleteChatHistory",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("taskSerializerDeleteChatHistory: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(a,d){d=a.done;a=a.value;return d?(c[9]=b.createArray(),c[10]=(c[9].push("taskSerializerDeleteChatHistory: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d):(a.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,903]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerDeleteChatHistoryStoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSTaskSerializerE2eeMessageIntegrityCheckV2",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,705]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerE2eeMessageIntegrityCheckV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerE2eeMetadataThreadIntegrityCheck",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,700]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSE2EEMessagingMetadataMailboxTaskSerializerE2eeMetadataThreadIntegrityCheckStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupAction",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,c.i64.cast([0,319]),void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsLoopingUpload",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] LSEncryptedBackupsLoopingUploadPayloadsTable table not found"),d[3]="LSEncryptedBackupsLoopingUploadPayloadsTable table not found",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure] ","",d[3]].join("")),d[2]=c.createArray(),void 0!==void 0?d[10]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure",d[3],d[2],c.i64.cast([0,3]))},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsLoopingUpload] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsLoopingUpload",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=['{"request_id":"unknown","upload_type":"FBN","payload":{"error_code":2,"operation":"","error_message":"","__typename":"MPSUploadFailurePayload"}}',c.i64.cast([0,50043]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsLoopingUploadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSQueryLocalPersistenceStoreForBackup.nop",["Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store).filter(function(a){var b=a.offlineThreadingId;a=a.threadId;return a===e&&f===b})));if(c.length===0)return(h||(h=b("Promise"))).resolve([void 0,void 0,!1]);a=c[0];return(h||(h=b("Promise"))).resolve([a.messagePayload,a.messageTimestampMs,!1])});function c(b,c,d,e){return a.apply(this,arguments)}return c}();a.__nop_name__="LSQueryLocalPersistenceStoreForBackup";g["default"]=a}),98);
__d("LSQueryLocalPersistenceStoreSupplementalForBackup.nop",["Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g){c=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store_supplemental).filter(function(a){var b=a.supplementalKey,c=a.threadId;a=a.toplevelOfflineThreadingId;return c===e&&a===f&&b===g})));return c==null?(h||(h=b("Promise"))).resolve([void 0,void 0]):(h||(h=b("Promise"))).resolve([c.messagePayload,c.messageTimestampMs])});function c(b,c,d,e,f){return a.apply(this,arguments)}return c}();a.__nop_name__="LSQueryLocalPersistenceStoreSupplementalForBackup";g["default"]=a}),98);
__d("LSQueryLocalPersistenceStoreTagsForBackup.nop",["LSVec","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=":";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){e=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.local_message_persistence_store_tag_index.index("offlineThreadingId")).getKeyRange(g,f)));if(e==null)return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray([])]);a=e.tag;return(h||(h=b("Promise"))).resolve([c("LSVec").ofArray(a.split(i))])});function e(b,c,d,e){return a.apply(this,arguments)}return e}();a.__nop_name__="LSQueryLocalPersistenceStoreTagsForBackup";g["default"]=a}),98);
__d("LSLoadUnencryptedProtobufWithInputs",["LSBase64Encode.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadUnencryptedProtobufWithInputs] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[0],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],d[12]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return c.blobs.neq(d[10],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[10]).then(function(a){return a=a,d[16]=a[0],a})},function(b){return d[16]!==void 0?(d[13]!==void 0?(d[21]=new c.Map(),d[21].set("message_tags",d[13]),d[22]=new c.Map(),d[26]="message_tags",d[23]=d[21].get(d[26]),d[23]?d[24]=!1:d[24]=!0,d[24]?0:d[22].set(d[26],d[23]),d[25]=c.toJSON(d[22]),d[19]=d[25]):d[19]=void 0,d[20]=new c.Map(),d[20].set("backup_action",a[0]),d[20].set("protobuf_encrypted",d[16]),d[20].set("supplemental_data_encrypted",void 0),d[20].set("timestamp_ms",a[4]),d[20].set("message_tags",d[19]),b=[d[20],void 0],d[17]=b[0],d[18]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,68])),d[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[19].set("error_message",""),b=[void 0,d[19]],d[17]=b[0],d[18]=b[1],b),b=[d[17],d[18]],d[14]=b[0],d[15]=b[1],b}]):c.resolve((d[12]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,70])),d[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[18].set("error_message",""),e=[void 0,d[18]],d[16]=e[0],d[17]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,63])),d[18].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[18].set("error_message",""),e=[void 0,d[18]],d[16]=e[0],d[17]=e[1],e),e=[d[16],d[17]],d[14]=e[0],d[15]=e[1],e))},function(a){return a=[d[14],d[15]],d[2]=a[0],d[3]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),a[1],a[2],a[3]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[14],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[19]=a[0],a})},function(e){return c.blobs.neq(d[19],void 0)?c.sequence([function(a){return d[22]=new c.Map(),d[22].set("sk_ciphertext",d[19]),d[22].set("sk_hash",d[19]),c.nativeOperation(b("LSBase64Encode.nop"),d[14]).then(function(a){return a=a,d[23]=a[0],a})},function(b){return d[23]!==void 0?(d[16]!==void 0?(d[28]=new c.Map(),d[28].set("message_tags",d[16]),d[29]=new c.Map(),d[33]="message_tags",d[30]=d[28].get(d[33]),d[30]?d[31]=!1:d[31]=!0,d[31]?0:d[29].set(d[33],d[30]),d[32]=c.toJSON(d[29]),d[26]=d[32]):d[26]=void 0,d[27]=new c.Map(),d[27].set("backup_action",a[0]),d[27].set("protobuf_encrypted",d[23]),d[27].set("supplemental_data_encrypted",d[22]),d[27].set("timestamp_ms",a[4]),d[27].set("message_tags",d[26]),b=[d[27],void 0],d[24]=b[0],d[25]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_FORMATTING_FAILED"),d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,68])),d[26].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[26].set("error_message",""),b=[void 0,d[26]],d[24]=b[0],d[25]=b[1],b),b=[d[24],d[25]],d[20]=b[0],d[21]=b[1],b}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_FORMATTING_FAILED"),d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,69])),d[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[22].set("error_message",""),e=[void 0,d[22]],d[20]=e[0],d[21]=e[1],e))},function(a){return a=[d[20],d[21]],d[17]=a[0],d[18]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,64])),d[19].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[19].set("error_message",""),e=[void 0,d[19]],d[17]=e[0],d[18]=e[1],e))},function(a){return a=[d[17],d[18]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,65])),d[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1],e))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}]):c.resolve((c.i64.eq(a[0],c.i64.cast([0,3]))?(d[14]=new c.Map(),d[14].set("backup_action",a[0]),d[14].set("protobuf_encrypted",void 0),d[14].set("supplemental_data_encrypted",void 0),d[14].set("timestamp_ms",a[4]),d[14].set("message_tags",void 0),e=[d[14],void 0],d[12]=e[0],d[13]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure] Returning error INVALID_BACKUP_OPERATION"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([-1,4294967289])),d[14].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1],e),e=[d[12],d[13]],d[10]=e[0],d[11]=e[1],e))},function(a){return a=[d[10],d[11]],d[2]=a[0],d[3]=a[1],a}])},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadUnencryptedProtobufWithInputs] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufWithInputs",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufWithInputsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadUnencryptedProtobufBackupSerializedPayloadData",["LSLoadUnencryptedProtobufWithInputs","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){var e;return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[18]=c.i64.mul(d[1],c.i64.cast([0,1e6])),c.sequence([function(b){return c.db.table(2).fetch([[[a[0]]]]).next().then(function(b,e){var f=b.done;b=b.value;return f?(d[30]=c.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[30],c.i64.cast([0,1e6])),d[18]),void 0],d[22]=f[0],d[23]=f[1],d[24]=f[2],d[25]=f[3],d[26]=f[4],d[27]=f[5],d[28]=f[6],f):(e=b.item,d[30]=c.i64.of_float(Date.now()),f=[a[0],e.queueName,e.enqueueTimestampMs,e.priority,e.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[30],c.i64.cast([0,1e6])),d[18]),void 0],d[22]=f[0],d[23]=f[1],d[24]=f[2],d[25]=f[3],d[26]=f[4],d[27]=f[5],d[28]=f[6],f)})},function(a){return a=[d[22],d[23],d[24],d[25],d[26],d[27],d[28]],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],a}])},function(e){return d[9]=new c.Map(),d[9].set("task_id",d[2]),d[9].set("queue_name",d[3]),d[9].set("enqueue_timestamp_ms",d[4]),d[9].set("priority",d[5]),d[9].set("first_executed_timestamp_ms",d[6]),d[9].set("execution_time_ns",d[7]),d[9].set("echo_encoding_execution_time_ns",d[8]),d[10]=new c.Map(),d[10].set("task_metadata",d[9]),d[10].set("action_type",void 0),d[10].set("content_type",void 0),d[10].set("identifiers",void 0),d[10].set("identifiers_v2",void 0),d[10].set("task_creation_source",void 0),d[10].set("message_payload_source",c.i64.cast([0,2])),c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(d[22]=new c.Map(),d[22].set("error_code",c.i64.cast([0,5])),d[22].set("stored_procedure","LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure"),d[22].set("error_message",""),g=[void 0,d[22],d[10]],d[11]=g[0],d[12]=g[1],d[13]=g[2],g):(f=e.item,c.sequence([function(b){var e;return d[39]=f.actThreadId,d[40]=f.toplevelOfflineThreadingId,d[23]=f.messageTimestampMs,d[22]=new c.Map(),d[22].set("backup_id","openEbUploadGenericBackupId"),d[22].set("act_thread_id",d[39]),d[22].set("server_thread_id",d[39]),d[22].set("timestamp",c.i64.to_string(d[23])),d[22].set("otid",d[40]),d[24]=new c.Map(),d[24].set("backup_id","openEbUploadGenericBackupId"),d[24].set("act_thread_id",d[39]),d[24].set("timestamp",c.i64.to_string(d[23])),d[24].set("otid",d[40]),c.sequence([function(b){return c.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var b=e.done;e=e.value;return b?(d[49]=c.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,c.i64.sub(c.i64.mul(d[49],c.i64.cast([0,1e6])),d[18]),void 0],d[41]=b[0],d[42]=b[1],d[43]=b[2],d[44]=b[3],d[45]=b[4],d[46]=b[5],d[47]=b[6],b):(f=e.item,d[49]=c.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,f.priority,f.firstExecutedTimestampMs,c.i64.sub(c.i64.mul(d[49],c.i64.cast([0,1e6])),d[18]),void 0],d[41]=b[0],d[42]=b[1],d[43]=b[2],d[44]=b[3],d[45]=b[4],d[46]=b[5],d[47]=b[6],b)})},function(a){return a=[d[41],d[42],d[43],d[44],d[45],d[46],d[47]],d[25]=a[0],d[26]=a[1],d[27]=a[2],d[28]=a[3],d[29]=a[4],d[30]=a[5],d[31]=a[6],a}])},function(a){return d[32]=new c.Map(),d[32].set("task_id",d[25]),d[32].set("queue_name",d[26]),d[32].set("enqueue_timestamp_ms",d[27]),d[32].set("priority",d[28]),d[32].set("first_executed_timestamp_ms",d[29]),d[32].set("execution_time_ns",d[30]),d[32].set("echo_encoding_execution_time_ns",d[31]),d[33]=new c.Map(),d[33].set("task_metadata",d[32]),d[33].set("action_type",void 0),d[33].set("content_type",void 0),d[33].set("identifiers",void 0),d[33].set("identifiers_v2",d[24]),d[33].set("task_creation_source",void 0),d[33].set("message_payload_source",c.i64.cast([0,2])),c.storedProcedure(b("LSLoadUnencryptedProtobufWithInputs"),f.backupAction,d[39],d[40],f.supplementalKey,d[23],d[22]).then(function(a){return a=a,d[34]=a[0],d[35]=a[1],a})},function(a){return d[34]!==void 0?(d[41]=new c.Map(),d[41].set("unencrypted_protobuf_backup_payload",d[34]),d[41].set("message_identifiers",d[22]),d[41].set("attachment_backup_payload",f.attachmentPayload),d[41].set("sender_id",f.senderId),d[41].set("extra_data_for_eb_upload",void 0),a=[d[41],void 0,d[33]],d[36]=a[0],d[37]=a[1],d[38]=a[2],a):(a=[void 0,d[35],d[33]],d[36]=a[0],d[37]=a[1],d[38]=a[2],a),a=[d[36],d[37],d[38]],d[11]=a[0],d[12]=a[1],d[13]=a[2],a}]))})},function(a){return d[15]=c.i64.of_float(Date.now()),d[16]=c.i64.random(),d[19]="Finishing execution. Execution time: ",d[20]=c.i64.to_string(c.i64.sub(d[15],d[0])),d[21]=" ms",d[17]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadUnencryptedProtobufBackupSerializedPayloadData] ",d[17],d[19],d[17],d[20],d[17],d[21]].join("")),c.i64.eq(c.i64.mod_(d[16],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[22]=",",d[23]=c.createArray(),void 0!==void 0?d[24]=(d[23].push(void 0),d[23]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadUnencryptedProtobufBackupSerializedPayloadData",[d[19],d[22],d[20],d[22],d[21]].join(""),d[23],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[11],d[12],d[13]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadUnencryptedProtobufBackupSerializedPayloadDataStoredProcedure";a.__tables__=["pending_tasks","pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsOpenUpload",["LSArrayGetObjectAt","LSBase64Encode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSLoadUnencryptedProtobufBackupSerializedPayloadData","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSLoadUnencryptedProtobufBackupSerializedPayloadData"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],a})},function(a){return d[2]!==void 0?c.sequence([function(a){return d[15]=d[2].get("message_identifiers"),d[16]=d[2].get("unencrypted_protobuf_backup_payload"),d[17]=d[15].get("server_thread_id"),d[18]=d[15].get("timestamp"),d[19]=d[15].get("otid"),d[20]=d[15].get("act_thread_id"),d[21]=new c.Map(),d[21].set("server_thread_key",d[17]),d[21].set("timestamp",d[18]),d[21].set("otid",d[19]),d[21].set("wa_thread_id",c.i64.from_string(d[20])),d[22]=new c.Map(),d[22].set("message_identifiers",d[21]),d[23]=d[2].get("extra_data_for_eb_upload"),d[23]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[23]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return d[33]=new c.Map(),d[39]="ttd",d[34]=d[32].get(d[39]),d[34]?d[35]=!1:d[35]=!0,d[35]?c.resolve():c.sequence([function(a){return d[34]?d[42]=!1:d[42]=!0,d[42]?c.resolve(d[43]=void 0):c.sequence([function(a){return d[44]=new c.Map(),d[47]="message_tags",d[45]=d[34].get(d[47]),d[45]?d[46]=!1:d[46]=!0,d[46]?c.resolve():c.sequence([function(a){return d[48]=c.createArray(),d[49]=c.i64.of_int32(d[45].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[48].push(d[51]),d[48])}])}):c.resolve()},function(a){return d[44].set(d[47],d[48])}])},function(a){return d[43]=d[44]}])},function(a){return d[33].set(d[39],d[43])}])},function(a){return d[40]="mt",d[36]=d[32].get(d[40]),d[36]?d[37]=!1:d[37]=!0,d[37]?c.resolve():c.sequence([function(a){return d[36]?d[42]=!1:d[42]=!0,d[42]?c.resolve(d[43]=void 0):c.sequence([function(a){return d[44]=new c.Map(),d[47]="message_tags",d[45]=d[36].get(d[47]),d[45]?d[46]=!1:d[46]=!0,d[46]?c.resolve():c.sequence([function(a){return d[48]=c.createArray(),d[49]=c.i64.of_int32(d[45].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[50]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[45],d[50]).then(function(a){return a=a,d[51]=a[0],d[52]=a[1],a})},function(a){return d[53]=(d[48].push(d[51]),d[48])}])}):c.resolve()},function(a){return d[44].set(d[47],d[48])}])},function(a){return d[43]=d[44]}])},function(a){return d[33].set(d[40],d[43])}])},function(a){return d[41]="mooos",d[38]=d[32].get(d[41]),d[38]!==void 0?d[33].set(d[41],d[38]):0,d[24]=d[33]}]):c.resolve(d[24]=void 0)},function(a){return d[24]!==void 0?(d[32]=d[24].get("mt"),d[32]!==void 0?(d[34]=new c.Map(),d[38]="message_tags",d[35]=d[32].get(d[38]),d[35]?d[36]=!1:d[36]=!0,d[36]?0:d[34].set(d[38],d[35]),d[37]=c.toJSON(d[34]),d[33]=d[37]):d[33]=void 0,d[25]=d[33]):d[25]=void 0,d[26]=d[16].get("supplemental_data_encrypted"),d[26]!==void 0?c.sequence([function(a){return d[32]=d[16].get("protobuf_encrypted"),d[33]=d[16].get("backup_action"),d[34]=d[16].get("timestamp_ms"),d[35]=d[26].get("sk_ciphertext"),c.nativeOperation(b("LSBase64Encode.nop"),d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[37]=d[26].get("sk_hash"),c.nativeOperation(b("LSBase64Encode.nop"),d[37]).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[39]=new c.Map(),d[39].set("supplementary_data_key",void 0),d[39].set("encrypted_protobuf",d[32]),d[39].set("key_value_backup_action",d[33]),d[39].set("protobuf_ts_ms",d[34]),d[39].set("supplemental_key_ciphertext",d[36]),d[39].set("supplemental_key_hash",d[38]),d[39].set("message_tags",d[25]),d[27]=d[39]}]):c.resolve((d[32]=d[16].get("protobuf_encrypted"),d[33]=d[16].get("backup_action"),d[34]=d[16].get("timestamp_ms"),d[35]=new c.Map(),d[35].set("supplementary_data_key",void 0),d[35].set("encrypted_protobuf",d[32]),d[35].set("key_value_backup_action",d[33]),d[35].set("protobuf_ts_ms",d[34]),d[35].set("message_tags",d[25]),d[27]=d[35]))},function(a){return d[22].set("key_value_backup_unencrypted_payload",d[27]),d[28]=d[2].get("sender_id"),d[22].set("sender_id",d[28]),d[29]=d[2].get("attachment_backup_payload"),d[29]!==void 0?d[22].set("attachment_backup_payload",d[29]):0,d[24]!==void 0?(d[32]=d[24].get("ttd"),d[32]!==void 0?(d[34]=new c.Map(),d[38]="message_tags",d[35]=d[32].get(d[38]),d[35]?d[36]=!1:d[36]=!0,d[36]?0:d[34].set(d[38],d[35]),d[37]=c.toJSON(d[34]),d[33]=d[37]):d[33]=void 0,d[30]=d[33]):d[30]=void 0,d[30]!==void 0?d[22].set("tags_to_delete",d[30]):0,d[31]=c.toJSON(d[22]),a=[d[31],void 0,d[4]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a}]):c.resolve((d[3]?d[15]=!1:d[15]=!0,d[15]?(a=[void 0,void 0,d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a):(a=[void 0,d[3],d[4]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a),a=[d[16],d[17],d[18]],d[5]=a[0],d[6]=a[1],d[7]=a[2],a))},function(a){return d[15]=new c.Map(),d[16]=d[15].set("success",d[5]),d[17]=d[15].set("failure",d[6]),d[18]=d[15].set("context",d[7]),d[19]=c.toJSON(d[15]),d[8]=d[19],d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsOpenUpload] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsOpenUpload",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[8],c.i64.cast([0,50048])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsOpenUploadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsRestoreWithSerializer",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeriveValueSecretRefV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][deriveValueSecretRefV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("message_payload_encryption_keys"),d[3]=d[2].get("encryption_version"),d[4]=d[2].get("epoch_anon_id"),d[5]=d[2].get("epoch_root_key"),d[6]=d[2].get("payload_key"),d[7]=c.createArray(),d[41]=(d[7].push(c.i64.cast([0,6])),d[7]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[8]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[8],void 0,d[4],d[7]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return d[9]?d[10]=!1:d[10]=!0,d[10]?c.resolve(d[11]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[11]=d[43]==null?"":d[43]}])},function(a){return d[12]=c.createArray(),d[41]=(d[12].push(c.i64.cast([0,6])),d[12]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[13]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[13],void 0,d[5],d[12]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return d[14]?d[15]=!1:d[15]=!0,d[15]?c.resolve(d[16]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[14],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[16]=d[43]==null?"":d[43]}])},function(a){return d[17]=c.createArray(),d[41]=(d[17].push(c.i64.cast([0,6])),d[17]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[18],void 0,d[6],d[17]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[21]=d[43]==null?"":d[43]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[22]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[22]==null?"":d[22],a[0]].join("")).then(function(a){return a=a,d[23]=a[0],a})},function(a){return d[24]=c.createArray(),d[41]=(d[24].push(c.i64.cast([0,6])),d[24]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[25],void 0,d[23],d[24]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[26]?d[27]=!1:d[27]=!0,d[27]?c.resolve(d[28]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[26],c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],d[42]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[28]=d[43]==null?"":d[43]}])},function(a){return d[29]=":",c.blobs.neq(d[5],void 0)?c.sequence([function(a){return d[41]=c.createArray(),d[47]=(d[41].push(c.i64.cast([0,18])),d[41]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]!==void 0?c.sequence([function(a){return d[47]=c.i64.of_int32(d[42].length),c.i64.ge(d[47],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],c.i64.cast([0,0])).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[48]=d[49]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[50]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[50]].join("")),d[49]=c.createArray(),void 0!==void 0?d[51]=(d[49].push(void 0),d[49]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[50],d[49],c.i64.cast([0,3]))},function(a){return d[48]=void 0}])},function(a){return d[43]=d[48]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[48]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[48]].join("")),d[47]=c.createArray(),void 0!==void 0?d[49]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[48],d[47],c.i64.cast([0,3]))},function(a){return d[43]=void 0}])},function(a){return c.blobs.neq(d[43],void 0)?d[44]=!0:d[44]=!1,d[44]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[43]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]!==void 0?d[46]=d[45]:d[46]="encodingfailed",d[30]=d[46]}]):c.resolve(d[30]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[4]).then(function(a){return a=a,d[31]=a[0],a})},function(e){return d[32]=new c.Map(),d[32].set("encryption_version",d[3]),d[32].set("epoch_anon_id",d[31]==null?"":d[31]),d[32].set("message_encryption_values",[d[11],d[29],d[16],d[29],d[21],d[29],d[28]].join("")),d[32].set("root_key_fingerprint",d[30]),d[32].set("backup_id",a[1]),d[33]=c.toJSON(d[32]),d[34]=new c.Map(),d[34].set("value_secret_ref",d[33]),d[35]=c.i64.of_float(Date.now()),d[36]=c.i64.random(),d[38]="Finishing execution. Execution time: ",d[39]=c.i64.to_string(c.i64.sub(d[35],d[0])),d[40]=" ms",d[37]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deriveValueSecretRefV2] ",d[37],d[38],d[37],d[39],d[37],d[40]].join("")),c.i64.eq(c.i64.mod_(d[36],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[41]=",",d[42]=c.createArray(),void 0!==void 0?d[43]=(d[42].push(void 0),d[42]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deriveValueSecretRefV2",[d[38],d[41],d[39],d[41],d[40]].join(""),d[42],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[34],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeriveValueSecretRefV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSBinaryToHex.nop",["LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,d,e){a=Array.from(new Uint8Array(e));d=a.map(function(a){return a.toString(16).padStart(2,"0")});e=d.join("").toUpperCase();return(h||(h=b("Promise"))).resolve(c("LSResult")(e))};a.__nop_name__="LSBinaryToHex";g["default"]=a}),98);
__d("LSGetBlobFromInt64BE.nop",["I64","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f){var g=new Uint8Array(8);g.reduceRight(function(a,b,c){b=(i||(i=d("I64"))).to_int32(i.mod_(a,i.of_string("256")));g[c]=b;return i.div(a,i.of_string("256"))},f);return(h||(h=b("Promise"))).resolve(c("LSResult")(g.buffer))};a.__nop_name__="LSGetBlobFromInt64BE";g["default"]=a}),98);
__d("PakeCpaceUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.buffer.slice(a.byteOffset,a.byteLength+a.byteOffset)}function b(a,b){var c=new a.VectorInt();b.forEach(function(a){c.push_back(a)});return c}f.typedArrayToBuffer=a;f.uint8ArrayToVectorInt=b}),66);
__d("LSHmac_v2.nop",["CryptoLogger","LSResult","PakeCpaceUtils","Promise","WACryptoSha256HmacBuilder","XPlatReactCrypto","err","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h,i="Subtle sign operation timeout; transaction blocked",j="Subtle import key operation timeout; transaction blocked",k=30*1e3;a=function(a,e,f,g){if(c("gkx")("12402"))try{a=new(d("WACryptoSha256HmacBuilder").Sha256HMacBuilder)(new Uint8Array(f)).update(new Uint8Array(g)).finish();return(h||(h=b("Promise"))).resolve(c("LSResult")(d("PakeCpaceUtils").typedArrayToBuffer(a)))}catch(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("hmac_v2"),a).mustfix("Crypto signing failed: data length: %s, was_timeout: %s",g==null?void 0:g.byteLength,!1);throw a}e=d("XPlatReactCrypto").subtleImportKey("raw",f,{hash:"SHA-256",name:"HMAC"},!1,["sign"]);return(c("justknobx")._("4025")?(h||(h=b("Promise"))).race([e,new(h||(h=b("Promise")))(function(a,b){return window.setTimeout(function(){return b(c("err")(j))},k)})]):e).then(function(a){a=d("XPlatReactCrypto").subtleSign("HMAC",a,g);return c("justknobx")._("4025")?(h||(h=b("Promise"))).race([a,new(h||(h=b("Promise")))(function(a,b){return window.setTimeout(function(){return b(c("err")(i))},k)})]):a}).then(function(a){return(h||(h=b("Promise"))).resolve(c("LSResult")(a))})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("hmac_v2"),a).mustfix("Crypto signing failed: data length: %s, was_timeout: %s",g==null?void 0:g.byteLength,(a==null?void 0:a.message)===i||(a==null?void 0:a.message)===j);throw a})};a.__nop_name__="LSHmac_v2";g["default"]=a}),98);
__d("OcmfClientMap",["CryptoLogger","LSCryptoUtils","Promise","XPlatReactCrypto","gkx","requireDeferred","tweetnacl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("ristretto255").__setRef("OcmfClientMap");a=function(a,e){e=c("gkx")("13930")?d("tweetnacl").hash(d("LSCryptoUtils").bufToUint8(e)):d("XPlatReactCrypto").subtleDigest("SHA-512",e);return(h||(h=b("Promise"))).all([e,i.load()]).then(function(b){var c=b[0];b=b[1];c=b.fromHash(new Uint8Array(c));b=b.scalarMult(new Uint8Array(a),c);return b.buffer})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_map"),a).mustfix("Failed OcmfClientMap.");throw a})};g["default"]=a}),98);
__d("LSOcmfClientMap.nop",["LSResult","OcmfClientMap"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d,e){return c("OcmfClientMap")(d,e).then(function(a){return c("LSResult")(a)})};a.__nop_name__="LSOcmfClientMap";g["default"]=a}),98);
__d("UInt8Array",["XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.length;if(!(b>0&&b%2===0&&/^[\da-f]+$/gi.test(a)))return;var c=[];for(var d=0,b=b/2|0;d<b;++d){var e=parseInt(a.substring(d<<1,(d<<1)+2|0),16);c.push(e)}return new Uint8Array(c)}function b(a){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(a)).buffer}function c(a){a=a.filter(function(a){return a.byteLength!==0});var b=a.reduce(function(a,b){return a+b.byteLength|0},0),c=new Uint8Array(b);a.reduce(function(a,b){c.set(b,a);return a+b.byteLength|0},0);return c}g.fromHexString=a;g.getBufferWithRandomValuesFromLength=b;g.concatBytes=c}),98);
__d("OrderPreservingEncryption",["FBLogger","LSCryptoUtils","LSSynchronousPromise","Promise","UInt8Array","WACryptoHkdfSync","XPlatReactCrypto","gkx","isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(){return d("XPlatReactCrypto").getRandomValues(new Uint8Array(32)).buffer}function j(a){var b=a.length;return b%2!==0?"0"+a:a}function k(a){a=BigInt(a);var b=j(a.toString(16));a=b.length;a=a/2;var c=[];for(var d=0;d<a;++d)c.push(d*2);return new Uint8Array(c.map(function(a){var c=a+2;return b.slice(a,c)}).map(function(a){return parseInt(a,16)}))}function l(a){a=a.map(function(a){return a._0});return{_0:d("UInt8Array").concatBytes(a)}}function m(a){return"OPE key has length "+String(a)+", expected  "+String(32)}function n(a,b,e){var f=new ArrayBuffer(0);if(c("gkx")("13860"))try{var g=d("WACryptoHkdfSync").hkdf(a,d("LSCryptoUtils").bufToUint8(f),d("LSCryptoUtils").bufToUint8(b.buffer),e);return d("LSSynchronousPromise").maybeMakeSynchronousPromise({_0:g})}catch(a){c("FBLogger")("labyrinth_web").mustfix("hkdf failed at OrderPreservingEncryption");throw a}return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey","deriveBits"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveBits({hash:"SHA-256",info:b.buffer,name:"HKDF",salt:f},a,e*8)}).then(function(a){return{_0:d("LSCryptoUtils").bufToUint8(a)}})}function o(a,b){return{_0:d("LSCryptoUtils").modAddBytes(a._0,b)}}function p(a,e,f,g){var j=f.byteLength;if(j!==32)throw c("FBLogger")("labyrinth_web").mustfixThrow(m(j));var k=g.byteLength,p=function(a,b){var c=new Uint8Array(1+k),d=new Uint8Array(k-b).fill(0);c.set([b]);c.set(a.subarray(0,b),1);c.set(d,b+1);return c};if(k>=255)throw c("FBLogger")("labyrinth_web").mustfixThrow("Input is too large");j=Array.from(g).map(function(b,c){c=p(g,c);var e=new Uint8Array(a);e[a-1]=b;b=d("LSCryptoUtils").bufToUint8(f);return n(b,c,a).then(function(a){return o(a,e)})}).map(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise);j=(i||(i=c("isPromise")))(j[0])?(h||(h=b("Promise"))).all(j):d("LSSynchronousPromise").maybeMakeSynchronousPromise(j);return j.then(function(a){return d("UInt8Array").concatBytes([new Uint8Array([e]),l(a)._0])})}function e(a,b,c,d){d=k(d);return p(a,b,c,d)}g.keyGen=a;g.intStringToBEBytes=k;g.buildKeyLengthErrorMsg=m;g.encryptBigEndianBytes=p;g.encryptIntString=e}),98);
__d("LSOpeEncrypt.nop",["CryptoLogger","I64","LSResult","OrderPreservingEncryption"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,b,e,f,g){var i=d("CryptoLogger").CryptoLogger("ope_encrypt");return d("OrderPreservingEncryption").encryptBigEndianBytes((h||(h=d("I64"))).to_int32(g),1,e,new Uint8Array(f)).then(function(a){return c("LSResult")(a.buffer)},function(a){d("CryptoLogger").captureError(i,a).mustfix("OpeEncrypt_impl failed");throw a})};a.__nop_name__="LSOpeEncrypt";g["default"]=a}),98);
__d("LSTruncateSortKey.nop",["CryptoLogger","LSResult","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("CryptoLogger").CryptoLogger("truncate_sort_key");a=function(a,d,e){if(e.byteLength!==8)throw i.mustfixThrow("Bad length on sort key for truncation");a=new Uint8Array(e);d=a.subarray(0,2);if(d.some(function(a){return a!==0}))throw i.mustfixThrow("Bad prefix on sort key for truncation");return(h||(h=b("Promise"))).resolve(c("LSResult")(e.slice(2)))};a.__nop_name__="LSTruncateSortKey";g["default"]=a}),98);
__d("LSEncryptIdentifiersV2",["LSBase64Encode.nop","LSBinaryToHex.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptIdentifiersV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[3]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[2],d[4]).then(function(a){return a=a,d[5]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))&&c.i64.eq(a[1],c.i64.cast([0,2]))?d[7]=a[5]:d[7]=a[3],d[8]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),d[7]).then(function(a){return a=a,d[9]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[9]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[8],d[10]).then(function(a){return a=a,d[11]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[11]).then(function(a){return a=a,d[12]=a[0],a})},function(e){return d[13]=a[6].get("ope_key"),c.nativeOperation(b("LSGetBlobFromInt64BE.nop"),a[4]).then(function(a){return a=a,d[14]=a[0],a})},function(a){return c.nativeOperation(b("LSTruncateSortKey.nop"),d[14]).then(function(a){return a=a,d[15]=a[0],a})},function(a){return c.nativeOperation(b("LSOpeEncrypt.nop"),d[13],d[15],c.i64.cast([0,16])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nativeOperation(b("LSBinaryToHex.nop"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=a[6].get("ocmf_shared_key"),c.nativeOperation(b("LSGetBlobFromString.nop"),a[5]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[18],d[20]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[23]=new c.Map(),d[23].set("backup_id_ocmf_partial",d[6]==null?"":d[6]),d[23].set("act_thread_id_ocmf_partial",d[12]==null?"":d[12]),d[23].set("timestamp_encrypted",d[17]==null?"":d[17]),d[23].set("otid_ocmf_partial",d[22]==null?"":d[22]),d[24]=c.i64.of_float(Date.now()),d[25]=c.i64.random(),d[27]="Finishing execution. Execution time: ",d[28]=c.i64.to_string(c.i64.sub(d[24],d[0])),d[29]=" ms",d[26]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptIdentifiersV2] ",d[26],d[27],d[26],d[28],d[26],d[29]].join("")),c.i64.eq(c.i64.mod_(d[25],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[30]=",",d[31]=c.createArray(),void 0!==void 0?d[32]=(d[31].push(void 0),d[31]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptIdentifiersV2",[d[27],d[30],d[28],d[30],d[29]].join(""),d[31],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[23],void 0],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsEncryptIdentifiersV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("SymmetricEncryptionCreateEncryptedData",["CryptoLogger","EncryptedBackupsSymmetricEncryptionUtils","HChaCha20","Promise","RetUtil","SymmetricEncryptionPaddingUtils","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,c,e){var f=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_data"),g=d("SymmetricEncryptionPaddingUtils").padData(e),i=d("XPlatReactCrypto").getRandomValues(new Uint8Array(d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes));e=new(d("HChaCha20").HChaCha20)();e=e.hChaCha20Bytes(i.slice(0,d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer,a);return d("XPlatReactCrypto").subtleImportKey("raw",e,"AES-GCM",!1,["encrypt"]).then(function(a){return d("XPlatReactCrypto").subtleEncrypt({additionalData:c,iv:new Uint8Array(i.slice(d("EncryptedBackupsSymmetricEncryptionUtils").hChaCha20SubKeyNonceLengthInBytes).buffer),name:"AES-GCM",tagLength:d("EncryptedBackupsSymmetricEncryptionUtils").aesGcmTagLength},a,g)}).then(function(a){var c=i.byteLength+a.byteLength;c=new Uint8Array(c);c.set(i);c.set(new Uint8Array(a),d("EncryptedBackupsSymmetricEncryptionUtils").totalNonceLengthInBytes);return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(c.buffer))})["catch"](function(a){d("CryptoLogger").captureError(f,a).mustfix("symmetric data encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};g["default"]=a}),98);
__d("WAErrorMessage",[],(function(a,b,c,d,e,f){"use strict";var g="NoErrorMessageProvided";function a(a){if(typeof a==="string")return a;if(a instanceof Error)return a.toString();if(typeof a==="object")if(typeof (a==null?void 0:a.description)==="string")return a.description;else if(typeof (a==null?void 0:a.message)==="string")return a.message;return g}f.NO_ERROR_MESSAGE_PROVIDED=g;f.maybeGetMessageFromError=a}),66);
__d("LSSymmetricEncryptionCreateEncryptedData.nop",["EBEncryptMessageTypes","LSSymmetricEncryptionCreateDecryptedData.nop","MWEBODSEntityName.enum","MWFBLogger","ODS","Promise","QPLUserFlow","Random","SymmetricEncryptionCreateEncryptedData","WAArrayBufferUtils","WAErrorMessage","WAGetSafeQPLError","WAResultOrError","asyncToGeneratorRuntime","cr:20303","getErrorSafe","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - Decrypted content is not equal"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - Either JS Decrypted or Rust Decrypted is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - ciphertextFromJS is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["MISMATCH - ciphertextFromWasm failed with error: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["'EB symmetric encryption comparison failed with error: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["EB symmetric encryption in JS failed with error: ",""]);o=function(){return a};return a}var p=c("qpl")._(521471468,"2968"),q=d("MWFBLogger").MWLogger.tags(["LSEncryption"]);function r(a,b,e){var f=d("Random").uint32();c("QPLUserFlow").start(p,{annotations:{string:{implementation:"js",native_op_name:"LSSymmetricEncryptionCreateEncryptedData"}},instanceKey:f});return c("SymmetricEncryptionCreateEncryptedData")(a,b,e).then(function(a){c("QPLUserFlow").endSuccess(p,{instanceKey:f});return d("WAResultOrError").makeResult(a[0])})["catch"](function(a){var b=c("getErrorSafe")(a);c("QPLUserFlow").endFailure(p,"runtime-exception",{annotations:{string:{error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:f});return d("WAResultOrError").makeError({error:b,type:"runtime-exception"})})}function s(a,e,f){if(b("cr:20303")==null)return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeError("skipped"));var g=d("Random").uint32();c("QPLUserFlow").start(p,{annotations:{string:{implementation:"rust",native_op_name:"LSSymmetricEncryptionCreateEncryptedData"}},instanceKey:g});return b("cr:20303").encryptMessage(d("EBEncryptMessageTypes").unsafeCastToSecretKey(a),d("EBEncryptMessageTypes").unsafeCastToAAD(e),d("EBEncryptMessageTypes").unsafeCastToPlaintext(f)).then(function(a){a.success===!1?c("QPLUserFlow").endFailure(p,a.error,{instanceKey:g}):c("QPLUserFlow").endSuccess(p,{instanceKey:g});return a})["catch"](function(a){c("QPLUserFlow").endFailure(p,"runtime-exception",{annotations:{string:{error:d("WAGetSafeQPLError").getSafeQPLErrorMessage(a)}},instanceKey:g});return d("WAResultOrError").makeError("runtime-exception")})}a=function(a,b,d,e,f){return r(d,e,f).then(function(g){if(g.success===!1){q.MUSTFIX(o(),String(g.error));return[void 0]}c("promiseDone")(t(d,e,f,g,a,b));return[g.value]})};function t(a,b,c,d,e,f){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){c=(yield s(a,b,c));try{yield v(f,g,a,b,e,c)}catch(a){q.MUSTFIX(n(),d("WAErrorMessage").maybeGetMessageFromError(a))}});return u.apply(this,arguments)}function v(a,b,c,d,e,f){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,i){if(i.success===!1&&i.error==="skipped")return;if(i.success===!1){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");q.MUSTFIX(m(),i.error);return}g=g.value;i=i.value;if(g==null){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");q.MUSTFIX(l());return}g=(yield c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,g));a=(yield c("LSSymmetricEncryptionCreateDecryptedData.nop")(a,b,e,f,i));b=g[0];e=a[0];if(b==null||e==null){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");q.MUSTFIX(k());return}if(d("WAArrayBufferUtils").arrayBuffersEqualUNSAFE(b,e)===!1){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"mismatch");q.MUSTFIX(j());return}(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").EB_SYMMETRIC_ENCRYPTION_JS_RUST_SHADOW_TEST,"match")});return w.apply(this,arguments)}a.__nop_name__="LSSymmetricEncryptionCreateEncryptedData";g["default"]=a}),98);
__d("LSSymmetricEncryptionCreateEncryptedString.nop",["Base64Utils","CryptoLogger","LSCryptoUtils","LSSymmetricEncryptionCreateEncryptedData.nop","Promise","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f,g,i){var j=d("CryptoLogger").CryptoLogger("symmetric_encryption_create_encrypted_string");return c("LSSymmetricEncryptionCreateEncryptedData.nop")(a,e,f,g,d("LSCryptoUtils").strToBuf(i)).then(function(a){return a[0]}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a?d("Base64Utils").fromArrayBuffer(a):void 0))})["catch"](function(a){d("CryptoLogger").captureError(j,a).mustfix("symmetric string encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})};a.__nop_name__="LSSymmetricEncryptionCreateEncryptedString";g["default"]=a}),98);
__d("LSEncryptMessagePayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][encryptMessagePayloadV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]=a[2].get("message_payload_encryption_keys"),d[3]=d[2].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedString.nop"),d[3],c.blobs.of_string(["message_thread","_",a[1]].join("")),a[3]).then(function(a){return a=a,d[4]=a[0],a})},function(e){return d[4]!==void 0?c.sequence([function(a){return d[13]=d[2].get("encryption_version"),d[14]=d[2].get("epoch_anon_id"),d[15]=d[2].get("epoch_root_key"),d[16]=d[2].get("payload_key"),d[17]=c.createArray(),d[45]=(d[17].push(c.i64.cast([0,6])),d[17]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_anon_id_debug").then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[18],void 0,d[14],d[17]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve(d[21]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[19],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[21]=d[47]==null?"":d[47]}])},function(a){return d[22]=c.createArray(),d[45]=(d[22].push(c.i64.cast([0,6])),d[22]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_debug").then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[23],void 0,d[15],d[22]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[24]?d[25]=!1:d[25]=!0,d[25]?c.resolve(d[26]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[24],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[26]=d[47]==null?"":d[47]}])},function(a){return d[27]=c.createArray(),d[45]=(d[27].push(c.i64.cast([0,6])),d[27]),c.nativeOperation(b("LSGetBlobFromString.nop"),"message_key_debug").then(function(a){return a=a,d[28]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[28],void 0,d[16],d[27]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]?d[30]=!1:d[30]=!0,d[30]?c.resolve(d[31]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[31]=d[47]==null?"":d[47]}])},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[15]).then(function(a){return a=a,d[32]=a[0],a})},function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),[d[32]==null?"":d[32],a[1]].join("")).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=c.createArray(),d[45]=(d[34].push(c.i64.cast([0,6])),d[34]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key_thread_id_debug").then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[35],void 0,d[33],d[34]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[37]=!1:d[37]=!0,d[37]?c.resolve(d[38]=""):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[36],c.i64.cast([0,0])).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[38]=d[47]==null?"":d[47]}])},function(a){return d[39]=":",c.blobs.neq(d[15],void 0)?c.sequence([function(a){return d[45]=c.createArray(),d[51]=(d[45].push(c.i64.cast([0,18])),d[45]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[15],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]!==void 0?c.sequence([function(a){return d[51]=c.i64.of_int32(d[46].length),c.i64.ge(d[51],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],c.i64.cast([0,0])).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[52]=d[53]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[54]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[54]].join("")),d[53]=c.createArray(),void 0!==void 0?d[55]=(d[53].push(void 0),d[53]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[54],d[53],c.i64.cast([0,3]))},function(a){return d[52]=void 0}])},function(a){return d[47]=d[52]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[52]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[53]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[52],d[51],c.i64.cast([0,3]))},function(a){return d[47]=void 0}])},function(a){return c.blobs.neq(d[47],void 0)?d[48]=!0:d[48]=!1,d[48]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[47]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]!==void 0?d[50]=d[49]:d[50]="encodingfailed",d[40]=d[50]}]):c.resolve(d[40]="null")},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[14]).then(function(a){return a=a,d[41]=a[0],a})},function(b){return d[42]=new c.Map(),d[42].set("encryption_version",d[13]),d[42].set("epoch_anon_id",d[41]==null?"":d[41]),d[42].set("message_encryption_values",[d[21],d[39],d[26],d[39],d[31],d[39],d[38]].join("")),d[42].set("root_key_fingerprint",d[40]),d[42].set("backup_id",a[0]),d[43]=c.toJSON(d[42]),d[44]=new c.Map(),d[44].set("encrypted_message_payload",d[4]),d[44].set("value_secret_ref",d[43]),b=[d[44],void 0],d[5]=b[0],d[6]=b[1],b}]):c.resolve((d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,40])),d[13].set("stored_procedure","LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure"),d[13].set("error_message",""),e=[void 0,d[13]],d[5]=e[0],d[6]=e[1],e))},function(a){return d[7]=c.i64.of_float(Date.now()),d[8]=c.i64.random(),d[10]="Finishing execution. Execution time: ",d[11]=c.i64.to_string(c.i64.sub(d[7],d[0])),d[12]=" ms",d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][encryptMessagePayloadV2] ",d[9],d[10],d[9],d[11],d[9],d[12]].join("")),c.i64.eq(c.i64.mod_(d[8],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[13]=",",d[14]=c.createArray(),void 0!==void 0?d[15]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"encryptMessagePayloadV2",[d[10],d[13],d[11],d[13],d[12]].join(""),d[14],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],d[6]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsEncryptMessagePayloadV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSGetLatestEpochKeys",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getLatestEpochKeys] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[2]="",d[3]=void 0,d[4]=void 0,d[5]=void 0,a[0]?c.resolve(0):(d[15]=void 0,c.i64.neq(d[15],void 0)?c.sequence([function(a){return c.count(c.db.table(169).fetch([[[d[15]]]])).then(function(a){return d[16]=a})},function(a){return c.i64.le(d[16],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[15]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[26]=new c.Map(),d[26].set("error_msg","Expected a nonempty query result"),d[26].set("code",c.i64.cast([0,3])),d[26].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[27]=c.createArray(),d[28]=(d[27].push(d[26]),d[27]),e=[void 0,d[27]],d[22]=e[0],d[23]=e[1],e):(b=a.item,d[26]=new c.Map(),d[26].set("epoch_id",b.epochId),d[26].set("backup_id",b.backupId),d[26].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[26].set("epoch_root_key_blob",b.epochRootKeyBlob),d[26].set("epoch_status",b.epochStatus),d[26].set("epoch_head",b.epochHead),d[26].set("authority_level",b.authorityLevel),e=[d[26],void 0],d[22]=e[0],d[23]=e[1],e)})},function(a){return d[25]=new c.Map(),d[25].set("value",d[22]),d[25].set("errors",d[23]),d[17]=d[25]}]):c.resolve((d[22]=new c.Map(),d[22].set("error_msg","Expected at most one result"),d[22].set("code",c.i64.cast([0,4])),d[22].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[23]=c.createArray(),d[25]=(d[23].push(d[22]),d[23]),d[24]=new c.Map(),d[24].set("value",void 0),d[24].set("errors",d[23]),d[17]=d[24]))},function(a){return d[18]=d[17].get("value"),d[18]!==void 0?(d[22]=d[18].get("epoch_id"),d[23]=d[18].get("backup_id"),d[24]=d[18].get("epoch_anon_id_blob"),d[25]=d[18].get("epoch_root_key_blob"),d[26]=d[18].get("epoch_status"),d[27]=d[18].get("epoch_head"),d[28]=d[18].get("authority_level"),d[29]=d[17],d[19]=d[29]):(d[22]=d[17].get("errors"),d[23]=d[17].get("errors"),d[24]=new c.Map(),d[24].set("value",void 0),d[24].set("errors",d[22]),d[19]=d[24]),d[20]=d[19].get("value"),d[20]!==void 0?(d[22]=d[20].get("epoch_id"),d[23]=d[20].get("backup_id"),d[24]=d[20].get("epoch_anon_id_blob"),d[25]=d[20].get("epoch_root_key_blob"),d[26]=d[20].get("epoch_status"),d[27]=d[20].get("epoch_head"),d[28]=d[20].get("authority_level"),d[2]=c.blobs.to_string(d[24]),d[3]=d[22],d[4]=d[25],c.blobs.neq(d[27],void 0)?d[5]=d[27]:0,d[21]=!0):(d[22]=d[19].get("errors"),d[23]=d[19].get("errors"),d[21]=!1)}]):c.resolve())},function(b){return c.i64.neq(d[3],void 0)?c.resolve(0):c.sequence([function(b){return d[15]=void 0,d[16]="",d[17]=void 0,d[18]=void 0,c.forEach(c.filter(c.db.table(169).fetch(),function(b){return a[0]||c.i64.eq(b.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[20]=c.blobs.to_string(a.epochAnonIdBlob),c.i64.eq([0,d[20].length],[0,d[16].length])?d[19]=d[20]>d[16]:d[19]=c.i64.gt([0,d[20].length],[0,d[16].length]),d[19]?(d[15]=a.epochId,d[16]=d[20],d[17]=a.epochRootKeyBlob,d[18]=a.epochHead):0})},function(a){return c.i64.neq(d[15],void 0)?(d[2]=d[16],d[3]=d[15],d[4]=d[17],c.blobs.neq(d[18],void 0)?d[5]=d[18]:0,d[19]=c.i64.of_float(Date.now()),0):0}])},function(a){return d[11]=c.blobs.of_string(d[2]),c.i64.neq(d[3],void 0)?(c.blobs.neq(d[11],void 0)?(c.blobs.neq(d[4],void 0)?(d[19]=new c.Map(),d[19].set("epoch_id",d[3]),d[19].set("epoch_root_key",d[4]),d[19].set("epoch_anon_id",d[11]),d[19].set("epoch_head",d[5]),d[20]=new c.Map(),d[20].set("epoch_keys",d[19]),a=[d[20],void 0],d[17]=a[0],d[18]=a[1],a):(d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,402])),d[19].set("error_message","failed to query latest epoch"),d[19].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[19]],d[17]=a[0],d[18]=a[1],a),a=[d[17],d[18]],d[15]=a[0],d[16]=a[1],a):(d[17]=new c.Map(),d[17].set("error_code",c.i64.cast([0,403])),d[17].set("error_message","failed to query latest epoch"),d[17].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[17]],d[15]=a[0],d[16]=a[1],a),a=[d[15],d[16]],d[6]=a[0],d[7]=a[1],a):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,400])),d[15].set("error_message","failed to query latest epoch"),d[15].set("stored_procedure","LSEncryptedBackupsGetLatestEpochKeysStoredProcedure"),a=[void 0,d[15]],d[6]=a[0],d[7]=a[1],a),d[8]=c.i64.of_float(Date.now()),d[9]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[8],d[0])),d[14]=" ms",d[10]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getLatestEpochKeys] ",d[10],d[12],d[10],d[13],d[10],d[14]].join("")),c.i64.eq(c.i64.mod_(d[9],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getLatestEpochKeys",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[6],d[7]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsGetLatestEpochKeysStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSLoadAndEncryptProtobufWithInputsV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSQueryLocalPersistenceStoreForBackup.nop","LSQueryLocalPersistenceStoreSupplementalForBackup.nop","LSQueryLocalPersistenceStoreTagsForBackup.nop","LSSymmetricEncryptionCreateEncryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[0],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[10]=a[0],d[11]=a[1],d[12]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[13]=a[0],a})},function(e){return d[14]=new c.Map(),d[14].set("message_tags",d[13]),d[15]=new c.Map(),d[15].set("mt",d[14]),c.blobs.neq(d[10],void 0)?c.sequence([function(e){return d[18]=a[5].get("message_payload_encryption_keys"),d[19]=d[18].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[19],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[10]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.blobs.neq(d[20],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[20]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return d[21]=d[24]}]):c.resolve(d[21]=void 0)},function(b){return d[21]!==void 0?(d[15]!==void 0?(d[27]=d[15].get("mt"),d[27]!==void 0?(d[29]=new c.Map(),d[33]="message_tags",d[30]=d[27].get(d[33]),d[30]?d[31]=!1:d[31]=!0,d[31]?0:d[29].set(d[33],d[30]),d[32]=c.toJSON(d[29]),d[28]=d[32]):d[28]=void 0,d[24]=d[28]):d[24]=void 0,d[15]!==void 0?(d[27]=d[15].get("mooos"),d[25]=d[27]):d[25]=void 0,d[26]=new c.Map(),d[26].set("backup_action",a[0]),d[26].set("protobuf_encrypted",d[21]),d[26].set("supplemental_data_encrypted",void 0),d[26].set("timestamp_ms",a[4]),d[26].set("message_tags",d[24]),d[26].set("serialized_attachment_backup_payload",void 0),d[26].set("maybe_ooo_supplemental_upload",d[25]),b=[d[26],void 0],d[22]=b[0],d[23]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,62])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),b=[void 0,d[24]],d[22]=b[0],d[23]=b[1],b),b=[d[22],d[23]],d[16]=b[0],d[17]=b[1],b}]):c.resolve((d[12]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,70])),d[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[18]=e[0],d[19]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,63])),d[20].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[20].set("error_message",""),e=[void 0,d[20]],d[18]=e[0],d[19]=e[1],e),e=[d[18],d[19]],d[16]=e[0],d[17]=e[1],e))},function(a){return a=[d[16],d[17]],d[2]=a[0],d[3]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,2]))?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreSupplementalForBackup.nop"),a[1],a[2],a[3]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[17]=new c.Map(),d[17].set("message_tags",d[16]),d[18]=new c.Map(),d[18].set("mt",d[17]),c.blobs.neq(d[14],void 0)?c.sequence([function(e){return a[3]!==void 0?c.sequence([function(e){return d[23]=a[5].get("mailbox_root_key_v2"),c.blobs.neq(d[23],void 0)?c.sequence([function(e){return d[26]=a[5].get("message_payload_encryption_keys"),d[27]=d[26].get("epoch_root_key"),d[28]=c.createArray(),d[41]=(d[28].push(c.i64.cast([0,32])),d[28]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfcHJmX2tleQ=="),void 0,d[23],d[28]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[29]!==void 0?c.sequence([function(a){return d[41]=c.i64.of_int32(d[29].length),c.i64.ge(d[41],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[29],c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[42]=d[43]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[44],d[43],c.i64.cast([0,3]))},function(a){return d[42]=void 0}])},function(a){return d[30]=d[42]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[42],d[41],c.i64.cast([0,3]))},function(a){return d[30]=void 0}])},function(a){return c.blobs.neq(d[30],void 0)?d[31]=!0:d[31]=!1,d[31]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),d[32]=c.createArray(),d[41]=(d[32].push(c.i64.cast([0,32])),d[32]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5zdXBwbGVtZW50YWxfZW5jX2tleQ=="),void 0,d[27],d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[33]!==void 0?c.sequence([function(a){return d[41]=c.i64.of_int32(d[33].length),c.i64.ge(d[41],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],c.i64.cast([0,0])).then(function(a){return a=a,d[43]=a[0],d[44]=a[1],a})},function(a){return d[42]=d[43]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[44]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[44]].join("")),d[43]=c.createArray(),void 0!==void 0?d[45]=(d[43].push(void 0),d[43]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[44],d[43],c.i64.cast([0,3]))},function(a){return d[42]=void 0}])},function(a){return d[34]=d[42]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[42]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",d[42]].join("")),d[41]=c.createArray(),void 0!==void 0?d[43]=(d[41].push(void 0),d[41]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",d[42],d[41],c.i64.cast([0,3]))},function(a){return d[34]=void 0}])},function(e){return c.blobs.neq(d[34],void 0)?d[35]=!0:d[35]=!1,d[35]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[30],d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[34],c.blob("c3VwcGxlbWVudGFsX2VuY19hYWQ="),d[36]).then(function(a){return a=a,d[38]=a[0],a})},function(e){return c.blobs.neq(d[38],void 0)?c.sequence([function(e){return d[41]=new c.Map(),d[41].set("sk_ciphertext",d[38]),d[41].set("sk_hash",d[37]),d[42]=a[5].get("message_payload_encryption_keys"),d[43]=d[42].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[43],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[14]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.blobs.neq(d[44],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[45]=d[48]}]):c.resolve(d[45]=void 0)},function(b){return d[45]!==void 0?(d[18]!==void 0?(d[51]=d[18].get("mt"),d[51]!==void 0?(d[53]=new c.Map(),d[57]="message_tags",d[54]=d[51].get(d[57]),d[54]?d[55]=!1:d[55]=!0,d[55]?0:d[53].set(d[57],d[54]),d[56]=c.toJSON(d[53]),d[52]=d[56]):d[52]=void 0,d[48]=d[52]):d[48]=void 0,d[18]!==void 0?(d[51]=d[18].get("mooos"),d[49]=d[51]):d[49]=void 0,d[50]=new c.Map(),d[50].set("backup_action",a[0]),d[50].set("protobuf_encrypted",d[45]),d[50].set("supplemental_data_encrypted",d[41]),d[50].set("timestamp_ms",a[4]),d[50].set("message_tags",d[48]),d[50].set("serialized_attachment_backup_payload",void 0),d[50].set("maybe_ooo_supplemental_upload",d[49]),b=[d[50],void 0],d[46]=b[0],d[47]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[48]=new c.Map(),d[48].set("error_code",c.i64.cast([0,62])),d[48].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[48].set("error_message",""),b=[void 0,d[48]],d[46]=b[0],d[47]=b[1],b),b=[d[46],d[47]],d[39]=b[0],d[40]=b[1],b}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_ENCRYPTION_FAILED"),d[41]=new c.Map(),d[41].set("error_code",c.i64.cast([0,66])),d[41].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[41].set("error_message",""),e=[void 0,d[41]],d[39]=e[0],d[40]=e[1],e))},function(a){return a=[d[39],d[40]],d[24]=a[0],d[25]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error NULL_MAILBOX_ROOT_KEY_V2"),d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,27])),d[26].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[26].set("error_message",""),e=[void 0,d[26]],d[24]=e[0],d[25]=e[1],e))},function(a){return a=[d[24],d[25]],d[21]=a[0],d[22]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[23]=new c.Map(),d[23].set("error_code",c.i64.cast([0,65])),d[23].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[23].set("error_message",""),e=[void 0,d[23]],d[21]=e[0],d[22]=e[1],e))},function(a){return a=[d[21],d[22]],d[19]=a[0],d[20]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_SUPPLEMENTAL_TABLE"),d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,64])),d[21].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[21].set("error_message",""),e=[void 0,d[21]],d[19]=e[0],d[20]=e[1],e))},function(a){return a=[d[19],d[20]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error SUPPLEMENTAL_KEY_NOT_SET_IN_CONTEXT_TABLE"),d[14]=new c.Map(),d[14].set("error_code",c.i64.cast([0,65])),d[14].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[14].set("error_message",""),e=[void 0,d[14]],d[12]=e[0],d[13]=e[1],e))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}]):c.sequence([function(e){return c.i64.eq(a[0],c.i64.cast([0,4]))?c.sequence([function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[14]=a[0],d[15]=a[1],d[16]=a[2],a})},function(e){return c.nativeOperation(b("LSQueryLocalPersistenceStoreTagsForBackup.nop"),a[1],a[2]).then(function(a){return a=a,d[17]=a[0],a})},function(e){return d[18]=new c.Map(),d[18].set("message_tags",d[17]),d[19]=new c.Map(),d[19].set("mt",d[18]),c.blobs.neq(d[14],void 0)?c.sequence([function(e){return d[22]=a[5].get("message_payload_encryption_keys"),d[23]=d[22].get("payload_key"),c.nativeOperation(b("LSSymmetricEncryptionCreateEncryptedData.nop"),d[23],c.blobs.of_string(["message_thread","_",a[1]].join("")),d[14]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.blobs.neq(d[24],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[24]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[25]=d[28]}]):c.resolve(d[25]=void 0)},function(b){return d[25]!==void 0?(d[19]!==void 0?(d[31]=d[19].get("mt"),d[31]!==void 0?(d[33]=new c.Map(),d[37]="message_tags",d[34]=d[31].get(d[37]),d[34]?d[35]=!1:d[35]=!0,d[35]?0:d[33].set(d[37],d[34]),d[36]=c.toJSON(d[33]),d[32]=d[36]):d[32]=void 0,d[28]=d[32]):d[28]=void 0,d[19]!==void 0?(d[31]=d[19].get("mooos"),d[29]=d[31]):d[29]=void 0,d[30]=new c.Map(),d[30].set("backup_action",a[0]),d[30].set("protobuf_encrypted",d[25]),d[30].set("supplemental_data_encrypted",void 0),d[30].set("timestamp_ms",a[4]),d[30].set("message_tags",d[28]),d[30].set("serialized_attachment_backup_payload",void 0),d[30].set("maybe_ooo_supplemental_upload",d[29]),b=[d[30],void 0],d[26]=b[0],d[27]=b[1],b):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ENCRYPTION_FAILED"),d[28]=new c.Map(),d[28].set("error_code",c.i64.cast([0,62])),d[28].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[28].set("error_message",""),b=[void 0,d[28]],d[26]=b[0],d[27]=b[1],b),b=[d[26],d[27]],d[20]=b[0],d[21]=b[1],b}]):c.resolve((d[16]?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_ALREADY_DELETED"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,70])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error PROTOBUF_NOT_FOUND_IN_TOPLEVEL_TABLE"),d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,63])),d[24].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[24].set("error_message",""),e=[void 0,d[24]],d[22]=e[0],d[23]=e[1],e),e=[d[22],d[23]],d[20]=e[0],d[21]=e[1],e))},function(a){return a=[d[20],d[21]],d[12]=a[0],d[13]=a[1],a}]):c.resolve((c.i64.eq(a[0],c.i64.cast([0,3]))?(void 0!==void 0?(d[19]=(void 0).get("mt"),d[19]!==void 0?(d[21]=new c.Map(),d[25]="message_tags",d[22]=d[19].get(d[25]),d[22]?d[23]=!1:d[23]=!0,d[23]?0:d[21].set(d[25],d[22]),d[24]=c.toJSON(d[21]),d[20]=d[24]):d[20]=void 0,d[16]=d[20]):d[16]=void 0,void 0!==void 0?(d[19]=(void 0).get("mooos"),d[17]=d[19]):d[17]=void 0,d[18]=new c.Map(),d[18].set("backup_action",a[0]),d[18].set("protobuf_encrypted",void 0),d[18].set("supplemental_data_encrypted",void 0),d[18].set("timestamp_ms",a[4]),d[18].set("message_tags",d[16]),d[18].set("serialized_attachment_backup_payload",void 0),d[18].set("maybe_ooo_supplemental_upload",d[17]),e=[d[18],void 0],d[14]=e[0],d[15]=e[1],e):(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure] Returning error UNKNOWN_PROTOBUF_TYPE"),d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,60])),d[16].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure"),d[16].set("error_message",""),e=[void 0,d[16]],d[14]=e[0],d[15]=e[1],e),e=[d[14],d[15]],d[12]=e[0],d[13]=e[1],e))},function(a){return a=[d[12],d[13]],d[10]=a[0],d[11]=a[1],a}])},function(a){return a=[d[10],d[11]],d[2]=a[0],d[3]=a[1],a}])},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufWithInputsV2] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufWithInputsV2",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufWithInputsV2StoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSLoadAndEncryptProtobufV2",["LSLoadAndEncryptProtobufWithInputsV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][loadAndEncryptProtobufV2] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(305).fetch(),function(b){return c.i64.eq(b.pendingBackupTaskId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure] Returning error PROTOBUF_CONTEXT_ROW_NOT_FOUND"),d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,67])),d[11].set("stored_procedure","LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure"),d[11].set("error_message",""),g=[void 0,d[11]],d[2]=g[0],d[3]=g[1],g):(f=e.item,c.sequence([function(e){return c.storedProcedure(b("LSLoadAndEncryptProtobufWithInputsV2"),f.backupAction,a[2],f.toplevelOfflineThreadingId,f.supplementalKey,f.messageTimestampMs,a[1]).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][loadAndEncryptProtobufV2] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"loadAndEncryptProtobufV2",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsLoadAndEncryptProtobufV2StoredProcedure";a.__tables__=["pending_protobuf_backups_context"];e.exports=a}),null);
__d("LSSerializeBackupPayloadV2",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDeriveValueSecretRefV2","LSEncryptIdentifiersV2","LSEncryptMessagePayloadV2","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSIsEncryptionVersionSecure","LSLoadAndEncryptProtobufV2","LSLogMebClientEvent.nop","LSLogWebQpl.nop","gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(b){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][serializeBackupPayloadV2] Beginning execution."),e[1]=d.i64.of_float(Date.now()),e[18]=d.i64.mul(e[1],d.i64.cast([0,1e6])),e[2]=d.i64.random(),d.db.table(2).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[3]=void 0:(b=a.item,e[3]=b.dataTraceId)})},function(a){return e[3]!==void 0?e[5]=e[3]:e[5]=void 0,d.islc(d.filter(d.db.table(168).fetch(),function(a){return d.i64.eq(a.authorityLevel,d.i64.cast([0,80]))||!1}),0,d.i64.to_float(d.i64.cast([0,1]))).next().then(function(a,b){var c=a.done;a=a.value;return c?(e[22]=new d.Map(),e[22].set("error_msg","Expected a nonempty query result"),e[22].set("code",d.i64.cast([0,3])),e[22].set("src_line","MEBClientStateUtils.php:247 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),e[23]=d.createArray(),e[24]=(e[23].push(e[22]),e[23]),c=[void 0,e[23]],e[6]=c[0],e[7]=c[1],c):(b=a.item,e[22]=new d.Map(),e[22].set("backup_id",b.backupId),e[22].set("device_public_key_blob",b.devicePublicKeyBlob),e[22].set("device_private_key_blob",b.devicePrivateKeyBlob),e[22].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),e[22].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),e[22].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),e[22].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),e[22].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),e[22].set("ocmf_client_state_blob",b.ocmfClientStateBlob),e[22].set("orf_client_state_v2_blob",void 0),e[22].set("orf_v2_authority_level",void 0),e[22].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),e[22].set("device_id",b.deviceId),e[22].set("backup_tenancy",b.backupTenancy),e[22].set("encryption_version",b.encryptionVersion),e[22].set("revision_version",b.revisionVersion),e[22].set("initialize_restore_result",void 0),e[22].set("device_creation_timestamp_sec",void 0),e[22].set("authority_level",b.authorityLevel),c=[e[22],void 0],e[6]=c[0],e[7]=c[1],c)})},function(f){return e[9]=new d.Map(),e[9].set("value",e[6]),e[9].set("errors",e[7]),e[10]=e[9].get("value"),e[10]!==void 0?d.sequence([function(f){return e[22]=e[10].get("backup_id"),e[23]=e[10].get("device_public_key_blob"),e[24]=e[10].get("device_private_key_blob"),e[25]=e[10].get("epoch_storage_public_key_blob"),e[26]=e[10].get("epoch_storage_private_key_blob"),e[27]=e[10].get("epoch_auth_public_key_blob"),e[28]=e[10].get("epoch_auth_private_key_blob"),e[29]=e[10].get("mailbox_root_key_blob"),e[30]=e[10].get("ocmf_client_state_blob"),e[31]=e[10].get("orf_client_state_v2_blob"),e[32]=e[10].get("orf_v2_authority_level"),e[33]=e[10].get("oblivious_validation_token_blob"),e[34]=e[10].get("device_id"),e[35]=e[10].get("backup_tenancy"),e[36]=e[10].get("encryption_version"),e[37]=e[10].get("revision_version"),e[38]=e[10].get("initialize_restore_result"),e[39]=e[10].get("device_creation_timestamp_sec"),e[40]=e[10].get("authority_level"),d.i64.neq(e[34],void 0)?d.sequence([function(a){return e[45]=void 0,d.i64.neq(e[45],void 0)?d.resolve(e[46]=e[45]):d.sequence([function(a){return e[54]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[55]=a[0],a})},function(a){return e[55]?e[64]=(e[54].push(d.i64.cast([0,0])),e[54]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[56]=a[0],a})},function(a){return e[56]?e[64]=(e[54].push(d.i64.cast([0,2])),e[54]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[57]=a[0],a})},function(a){return e[57]?e[64]=(e[54].push(d.i64.cast([0,3])),e[54]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[58]=a[0],a})},function(a){return e[58]?e[64]=(e[54].push(d.i64.cast([0,4])),e[54]):0,e[59]=d.createArray(),e[60]=d.i64.of_int32(e[54].length),d.i64.gt(e[60],d.i64.cast([0,0]))?d.loopAsync(e[60],function(a){return e[64]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[54],e[64]).then(function(a){return a=a,e[65]=a[0],e[66]=a[1],a})},function(a){return e[67]=(e[59].push(e[65]),e[59])}])}):d.resolve()},function(a){return d.sequence([function(a){return e[64]=d.createArray(),e[65]=d.i64.of_int32(e[59].length),d.i64.gt(e[65],d.i64.cast([0,0]))?d.loopAsync(e[65],function(a){return e[67]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[59],e[67]).then(function(a){return a=a,e[68]=a[0],e[69]=a[1],a})},function(a){return e[70]=(e[64].push(d.i64.to_string(e[68])),e[64])}])}):d.resolve()},function(a){return e[66]=e[64].join(","),e[61]=e[66]}])},function(a){return e[59].some(function(a){return d.i64.eq(e[36],a)})?e[62]=e[36]:e[62]=void 0,d.i64.neq(e[62],void 0)?e[63]=e[62]:e[63]=void 0,e[46]=e[63]}])},function(f){return d.i64.neq(e[46],void 0)?e[47]=e[46]:e[47]=d.i64.cast([0,0]),d.i64.neq(e[35],void 0)?e[48]=e[35]:e[48]=d.i64.cast([0,1]),d.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]).next().then(function(f,g){var h=f.done;f=f.value;return h?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[66]=d.i64.of_float(Date.now()),b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[66],d.i64.cast([0,1e6])),e[18]),void 0],e[54]=b[0],e[55]=b[1],e[56]=b[2],e[57]=b[3],e[58]=b[4],e[59]=b[5],e[60]=b[6],b):(f=c.item,e[66]=d.i64.of_float(Date.now()),b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[66],d.i64.cast([0,1e6])),e[18]),void 0],e[54]=b[0],e[55]=b[1],e[56]=b[2],e[57]=b[3],e[58]=b[4],e[59]=b[5],e[60]=b[6],b)})},function(a){return e[62]=new d.Map(),e[62].set("task_id",e[54]),e[62].set("queue_name",e[55]),e[62].set("enqueue_timestamp_ms",e[56]),e[62].set("priority",e[57]),e[62].set("first_executed_timestamp_ms",e[58]),e[62].set("execution_time_ns",e[59]),e[62].set("echo_encoding_execution_time_ns",e[60]),e[63]=new d.Map(),e[63].set("task_metadata",e[62]),e[63].set("action_type",void 0),e[63].set("content_type",void 0),e[63].set("identifiers",void 0),e[63].set("identifiers_v2",void 0),e[63].set("task_creation_source",void 0),e[63].set("message_payload_source",d.i64.cast([0,2])),e[64]=new d.Map(),e[64].set("error_code",d.i64.cast([0,5])),e[64].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[64].set("error_message","Pending backup context row not found"),e[64]!==void 0?(e[66]=e[64].get("stored_procedure"),e[67]=e[64].get("error_code"),e[68]=e[64].get("error_message"),e[69]="."):0,void 0!==void 0?(e[66]=(void 0).get("stored_procedure"),e[67]=(void 0).get("error_code"),e[68]=(void 0).get("error_message"),e[69]="."):0,e[65]=d.createArray(),a=[void 0,e[64],e[63],e[65]],e[49]=a[0],e[50]=a[1],e[51]=a[2],e[52]=a[3],a}]):(g=f.item,d.sequence([function(f){return e[59]=g.actionType,e[60]=g.contentType,e[64]=g.echoContent,e[65]=g.lsTraceId,e[63]=g.echoEncodingLatencyNs,e[62]=g.attachmentPayload,e[66]=g.tamThreadSubtype,e[67]=g.isInstamadillo,e[54]=new d.Map(),e[54].set("backup_id",d.i64.to_string(e[22])),e[54].set("act_thread_id",g.listKey),e[54].set("timestamp",g.sortKey),e[54].set("otid",g.uniqueKey),e[61]=g.error==null?d.i64.cast([0,0]):g.error,[d.i64.cast([0,0]),d.i64.cast([0,32])].some(function(a){return d.i64.eq(e[61],a)})?d.sequence([function(a){return e[68]=e[54].get("act_thread_id"),e[69]=e[54].get("otid"),d.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,e[70]=a[0],e[71]=a[1],a})},function(a){return e[70]!==void 0?d.sequence([function(a){return d.i64.eq(e[60],d.i64.cast([0,1]))?d.sequence([function(a){return e[81]=d.createArray(),e[86]=(e[81].push(d.i64.cast([0,32])),e[81]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[68]].join("")).then(function(a){return a=a,e[82]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[82],void 0,e[29],e[81]).then(function(a){return a=a,e[83]=a[0],a})},function(a){return e[83]?e[84]=!1:e[84]=!0,e[84]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[87]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[87]].join("")),e[86]=d.createArray(),void 0!==void 0?e[88]=(e[86].push(void 0),e[86]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[87],e[86],d.i64.cast([0,3]))},function(a){return e[85]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[83],d.i64.cast([0,0])).then(function(a){return a=a,e[86]=a[0],e[87]=a[1],a})},function(a){return e[85]=e[86]}])},function(a){return e[78]=e[85]}]):d.sequence([function(a){return d.i64.eq(e[59],d.i64.cast([0,2]))?d.sequence([function(a){return e[82]=d.createArray(),e[87]=(e[82].push(d.i64.cast([0,32])),e[82]),d.nativeOperation(b("LSGetBlobFromString.nop"),["thread_ope_key","_",e[69]].join("")).then(function(a){return a=a,e[83]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[83],void 0,e[29],e[82]).then(function(a){return a=a,e[84]=a[0],a})},function(a){return e[84]?e[85]=!1:e[85]=!0,e[85]?d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] Got null keys while deriving message list OPE key. Returning null blobish"),e[88]="Got null keys while deriving message list OPE key. Returning null blobish",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[88]].join("")),e[87]=d.createArray(),void 0!==void 0?e[89]=(e[87].push(void 0),e[87]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[88],e[87],d.i64.cast([0,3]))},function(a){return e[86]=void 0}]):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[84],d.i64.cast([0,0])).then(function(a){return a=a,e[87]=a[0],e[88]=a[1],a})},function(a){return e[86]=e[87]}])},function(a){return e[81]=e[86]}]):d.resolve(e[81]=void 0)},function(a){return e[78]=e[81]}])},function(a){return d.blobs.neq(e[78],void 0)?d.sequence([function(a){return e[81]=e[70].get("epoch_keys"),e[82]=e[81].get("epoch_anon_id"),e[83]=e[81].get("epoch_root_key"),e[84]=d.createArray(),e[99]=(e[84].push(d.i64.cast([0,32])),e[84]),d.i64.ge(e[47],d.i64.cast([0,3]))?d.resolve(e[85]=void 0):d.sequence([function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),e[68]).then(function(a){return a=a,e[99]=a[0],a})},function(a){return e[85]=e[99]}])},function(a){return d.i64.ge(e[47],d.i64.cast([0,4]))?(e[99]="_",e[86]=["message_key_in_epoch",e[99],d.blobs.to_string(e[82]),e[99],"cipher_version",e[99],d.i64.to_string(e[47]),e[99],"thread",e[99],e[68]==null?"":e[68]].join("")):(d.i64.ge(e[47],d.i64.cast([0,3]))?(e[100]="_",e[99]=["message_key_in_epoch",e[100],d.blobs.to_string(e[82]),e[100],"cipher_version",e[100],d.i64.to_string(e[47]),e[100],"thread",e[100],e[68]==null?"":e[68]].join("")):(d.i64.ge(e[47],d.i64.cast([0,2]))?(e[101]="_",e[100]=["message_key_in_epoch",e[101],d.blobs.to_string(e[82]),e[101],"cipher_version",e[101],d.i64.to_string(e[47])].join("")):e[100]=["message_key_in_epoch","_",d.blobs.to_string(e[82])].join(""),e[99]=e[100]),e[86]=e[99]),d.nativeOperation(b("LSGetBlobFromString.nop"),e[86]).then(function(a){return a=a,e[87]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateDerivedKeys.nop"),e[87],e[85],e[83],e[84]).then(function(a){return a=a,e[88]=a[0],a})},function(a){return e[88]?e[89]=!1:e[89]=!0,e[89]?d.resolve(e[90]=void 0):d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[88],d.i64.cast([0,0])).then(function(a){return a=a,e[99]=a[0],e[100]=a[1],a})},function(a){return e[90]=e[99]}])},function(a){return d.filter(d.db.table(169).fetch(),function(a){return d.blobs.eq(a.epochAnonIdBlob,d.blob("MA=="))}).next().then(function(b,c){var a=b.done;b=b.value;return a?(e[99]=new d.Map(),e[99].set("error_msg","Expected a nonempty query result"),e[99].set("code",d.i64.cast([0,3])),e[99].set("src_line","MEBEpochClientUtils.php:556 MEBEpochClientUtils::maybeEpochWithAnonIDFromPersistentEpochsTableDirectly()"),e[100]=d.createArray(),e[101]=(e[100].push(e[99]),e[100]),a=[void 0,e[100]],e[91]=a[0],e[92]=a[1],a):(c=b.item,e[99]=new d.Map(),e[99].set("epoch_id",c.epochId),e[99].set("backup_id",c.backupId),e[99].set("epoch_anon_id_blob",c.epochAnonIdBlob),e[99].set("epoch_root_key_blob",c.epochRootKeyBlob),e[99].set("epoch_status",c.epochStatus),e[99].set("epoch_head",c.epochHead),e[99].set("authority_level",c.authorityLevel),a=[e[99],void 0],e[91]=a[0],e[92]=a[1],a)})},function(a){return e[94]=new d.Map(),e[94].set("value",e[91]),e[94].set("errors",e[92]),e[95]=e[94].get("value"),e[95]!==void 0?d.sequence([function(a){return e[99]=e[95].get("epoch_id"),e[100]=e[95].get("backup_id"),e[101]=e[95].get("epoch_anon_id_blob"),e[102]=e[95].get("epoch_root_key_blob"),e[103]=e[95].get("epoch_status"),e[104]=e[95].get("epoch_head"),e[105]=e[95].get("authority_level"),e[106]=d.createArray(),e[114]=(e[106].push(d.i64.cast([0,32])),e[106]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5zYWx0X21haWxib3hfcm9vdF9rZXlfdjI="),void 0,e[29],e[106]).then(function(a){return a=a,e[107]=a[0],a})},function(a){return e[107]!==void 0?d.sequence([function(a){return e[114]=d.i64.of_int32(e[107].length),d.i64.ge(e[114],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[107],d.i64.cast([0,0])).then(function(a){return a=a,e[116]=a[0],e[117]=a[1],a})},function(a){return e[115]=e[116]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[117]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[117]].join("")),e[116]=d.createArray(),void 0!==void 0?e[118]=(e[116].push(void 0),e[116]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[117],e[116],d.i64.cast([0,3]))},function(a){return e[115]=void 0}])},function(a){return e[108]=e[115]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[115]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[115]].join("")),e[114]=d.createArray(),void 0!==void 0?e[116]=(e[114].push(void 0),e[114]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[115],e[114],d.i64.cast([0,3]))},function(a){return e[108]=void 0}])},function(a){return d.blobs.neq(e[108],void 0)?e[109]=!0:e[109]=!1,e[109]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[110]=d.createArray(),e[114]=(e[110].push(d.i64.cast([0,32])),e[110]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleT5tYWlsYm94X3Jvb3Rfa2V5X3Yy"),e[108],e[102],e[110]).then(function(a){return a=a,e[111]=a[0],a})},function(a){return e[111]!==void 0?d.sequence([function(a){return e[114]=d.i64.of_int32(e[111].length),d.i64.ge(e[114],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[111],d.i64.cast([0,0])).then(function(a){return a=a,e[116]=a[0],e[117]=a[1],a})},function(a){return e[115]=e[116]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[117]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[117]].join("")),e[116]=d.createArray(),void 0!==void 0?e[118]=(e[116].push(void 0),e[116]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[117],e[116],d.i64.cast([0,3]))},function(a){return e[115]=void 0}])},function(a){return e[112]=e[115]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[115]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[115]].join("")),e[114]=d.createArray(),void 0!==void 0?e[116]=(e[114].push(void 0),e[114]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[115],e[114],d.i64.cast([0,3]))},function(a){return e[112]=void 0}])},function(a){return d.blobs.neq(e[112],void 0)?e[113]=!0:e[113]=!1,e[113]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[96]=e[112]}]):d.sequence([function(a){return e[99]=e[94].get("errors"),e[100]=e[94].get("errors"),function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBEpochClientUtils] Failed to get mailbox_root_key_v2: epoch 0 is not available."),e[102]="Failed to get mailbox_root_key_v2: epoch 0 is not available.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBEpochClientUtils] ","",e[102]].join("")),e[101]=d.createArray(),void 0!==void 0?e[103]=(e[101].push(void 0),e[101]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBEpochClientUtils",e[102],e[101],d.i64.cast([0,3]))},function(a){return e[96]=void 0}])},function(a){return d.blobs.neq(e[90],void 0)?d.sequence([function(a){return d.blobs.neq(e[96],void 0)?d.sequence([function(a){return e[105]=d.createArray(),e[109]=(e[105].push(d.i64.cast([0,32])),e[105]),d.nativeOperation(b("LSCreateDerivedKeys.nop"),d.blob("a2RmX2luZm86bWFpbGJveF9yb290X2tleV92Mj5mYWxsYmFja19rZXk="),void 0,e[96],e[105]).then(function(a){return a=a,e[106]=a[0],a})},function(a){return e[106]!==void 0?d.sequence([function(a){return e[109]=d.i64.of_int32(e[106].length),d.i64.ge(e[109],d.i64.cast([0,1]))?d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[106],d.i64.cast([0,0])).then(function(a){return a=a,e[111]=a[0],e[112]=a[1],a})},function(a){return e[110]=e[111]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),e[112]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[112]].join("")),e[111]=d.createArray(),void 0!==void 0?e[113]=(e[111].push(void 0),e[111]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[112],e[111],d.i64.cast([0,3]))},function(a){return e[110]=void 0}])},function(a){return e[107]=e[110]}]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),e[110]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoUtils] ","",e[110]].join("")),e[109]=d.createArray(),void 0!==void 0?e[111]=(e[109].push(void 0),e[109]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils",e[110],e[109],d.i64.cast([0,3]))},function(a){return e[107]=void 0}])},function(a){return d.blobs.neq(e[107],void 0)?e[108]=!0:e[108]=!1,e[108]?0:(function(a){d.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),d["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),e[99]=e[107]}]):d.resolve(e[99]=void 0)},function(a){return e[100]=e[81].get("epoch_root_key"),e[101]=e[81].get("epoch_anon_id"),e[102]=e[81].get("epoch_id"),e[103]=new d.Map(),e[103].set("payload_key",e[90]),e[103].set("payload_fallback_key",e[99]),e[103].set("encryption_version",e[47]),e[103].set("epoch_root_key",e[100]),e[103].set("epoch_anon_id",e[101]),e[103].set("epoch_id",e[102]),e[104]=new d.Map(),e[104].set("ope_key",e[78]),e[104].set("message_payload_encryption_keys",e[103]),e[104].set("ocmf_shared_key",e[30]),e[104].set("mailbox_base_salt",e[29]),e[104].set("mailbox_root_key_v2",e[96]),a=[e[104],void 0],e[97]=a[0],e[98]=a[1],a}]):d.resolve((e[99]=new d.Map(),e[99].set("error_code",d.i64.cast([0,26])),e[99].set("stored_procedure","MEBKeyDeriver"),e[99].set("error_message",""),a=[void 0,e[99]],e[97]=a[0],e[98]=a[1],a))},function(a){return a=[e[97],e[98]],e[79]=a[0],e[80]=a[1],a}]):d.resolve((e[81]=new d.Map(),e[81].set("error_code",d.i64.cast([0,25])),e[81].set("stored_procedure","MEBKeyDeriver"),e[81].set("error_message",""),a=[void 0,e[81]],e[79]=a[0],e[80]=a[1],a))},function(a){return a=[e[79],e[80]],e[72]=a[0],e[73]=a[1],a}]):d.resolve((a=[void 0,e[71]],e[72]=a[0],e[73]=a[1],a))},function(f){return e[72]!==void 0?d.sequence([function(a){return e[78]=e[54].get("backup_id"),e[79]=e[54].get("act_thread_id"),e[80]=e[54].get("timestamp"),e[81]=e[54].get("otid"),d.storedProcedure(b("LSEncryptIdentifiersV2"),e[59],e[60],e[78],e[79],d.i64.from_string(e[80]),e[81],e[72]).then(function(a){return a=a,e[82]=a[0],e[83]=a[1],a})},function(f){return e[82]!==void 0?d.sequence([function(c){return e[88]=e[54].get("act_thread_id"),d.storedProcedure(b("LSLoadAndEncryptProtobufV2"),a[0],e[72],e[88]).then(function(a){return a=a,e[89]=a[0],e[90]=a[1],a})},function(f){return e[95]=d.i64.eq(e[61],d.i64.cast([0,32]))||!1||c("gkx")("12541")||!1,e[96]=e[89]!==void 0,e[95]&&e[96]?d.sequence([function(a){return e[97]=e[54].get("act_thread_id"),e[98]=e[54].get("backup_id"),d.storedProcedure(b("LSDeriveValueSecretRefV2"),e[97],e[98],e[72]).then(function(a){return a=a,e[99]=a[0],e[100]=a[1],a})},function(c){return e[89]!==void 0?d.sequence([function(c){return e[99]!==void 0?d.sequence([function(a){return e[109]=e[99].get("value_secret_ref"),e[110]=e[82].get("act_thread_id_ocmf_partial"),e[111]=e[82].get("otid_ocmf_partial"),e[112]=e[82].get("timestamp_encrypted"),e[113]=new d.Map(),e[113].set("list_key",e[110]),e[113].set("unique_key",e[111]),e[113].set("sort_key",e[112]),void 0!==void 0?(e[146]=(void 0).get("encrypted_message_payload"),e[147]=(void 0).get("value_secret_ref"),e[148]=new d.Map(),e[148].set("value",e[146]),e[148].set("value_secret_ref",e[147]),e[114]=e[148]):e[114]=void 0,e[115]=new d.Map(),e[115].set("list_item_id",e[113]),e[115].set("list_item",e[114]),e[115].set("action_type",e[59]),e[116]=e[54].get("timestamp"),e[117]=e[54].get("otid"),e[118]=e[54].get("act_thread_id"),e[119]=e[54].get("supplemental_otid"),e[120]=new d.Map(),e[120].set("timestamp",e[116]),e[120].set("otid",e[117]),e[120].set("wa_thread_id",d.i64.from_string(e[118])),e[120].set("supplemental_otid",e[119]),e[121]=e[72].get("mailbox_base_salt"),d.nativeOperation(b("LSBase64Encode.nop"),e[121]).then(function(a){return a=a,e[122]=a[0],a})},function(a){return e[123]=e[72].get("ocmf_shared_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[123]).then(function(a){return a=a,e[124]=a[0],a})},function(a){return e[125]=new d.Map(),e[125].set("mailbox_root_key",e[122]==null?"":e[122]),e[125].set("ocmf_client_state_blob",e[124]==null?"":e[124]),e[126]=e[82].get("backup_id_ocmf_partial"),e[127]=e[72].get("message_payload_encryption_keys"),e[128]=e[127].get("epoch_id"),e[129]=e[72].get("message_payload_encryption_keys"),e[130]=e[129].get("encryption_version"),e[145]=e[65]==null?"":e[65],e[131]=new d.Map(),e[131].set("mailbox_partial_id",e[126]),e[131].set("action",e[115]),e[131].set("device_id",e[34]),e[131].set("echo_version",d.i64.cast([0,0])),e[131].set("epoch_id",e[128]),e[131].set("trace_id",void 0),e[131].set("encryption_version",e[130]),e[131].set("is_thread",d.i64.eq(e[60],d.i64.cast([0,2]))),e[131].set("raw_identifiers",e[120]),e[131].set("raw_tokens",e[125]),e[131].set("request_id",e[145]),e[131].set("tam_thread_subtype",e[66]==null?d.i64.cast([0,0]):e[66]),e[131].set("is_instamadillo",e[67]==null?!1:e[67]),e[131].set("empty_echo_payload_reason",d.i64.cast([0,1])),e[131].set("value_secret_ref",e[109]),e[89]!==void 0?d.sequence([function(a){return e[146]=e[89].get("supplemental_data_encrypted"),e[146]!==void 0?d.sequence([function(a){return e[148]=e[89].get("protobuf_encrypted"),e[149]=e[89].get("backup_action"),e[150]=e[89].get("timestamp_ms"),e[151]=e[146].get("sk_ciphertext"),d.nativeOperation(b("LSBase64Encode.nop"),e[151]).then(function(a){return a=a,e[152]=a[0],a})},function(a){return e[153]=e[146].get("sk_hash"),d.nativeOperation(b("LSBase64Encode.nop"),e[153]).then(function(a){return a=a,e[154]=a[0],a})},function(a){return e[155]=e[89].get("message_tags"),e[156]=e[89].get("maybe_ooo_supplemental_upload"),e[157]=new d.Map(),e[157].set("supplementary_data_key",void 0),e[157].set("encrypted_protobuf",e[148]),e[157].set("key_value_backup_action",e[149]),e[157].set("protobuf_ts_ms",e[150]),e[157].set("supplemental_key_ciphertext",e[152]),e[157].set("supplemental_key_hash",e[154]),e[157].set("message_tags",e[155]),e[157].set("maybe_ooo_supplemental_upload",e[156]),e[147]=e[157]}]):d.resolve((e[148]=e[89].get("protobuf_encrypted"),e[149]=e[89].get("backup_action"),e[150]=e[89].get("timestamp_ms"),e[151]=e[89].get("message_tags"),e[152]=new d.Map(),e[152].set("supplementary_data_key",void 0),e[152].set("encrypted_protobuf",e[148]),e[152].set("key_value_backup_action",e[149]),e[152].set("protobuf_ts_ms",e[150]),e[152].set("message_tags",e[151]),e[147]=e[152]))},function(a){return e[131].set("key_value_backup_payload",e[147])}]):d.resolve()},function(a){return e[62]!==void 0?e[131].set("attachment_backup_payload",e[62]):function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),e[145]!==void 0?d.nativeOperation(b("LSLogWebQpl.nop"),e[145],d.i64.cast([0,521481602]),"upload_start",d.i64.cast([0,0]),void 0,void 0):d.resolve()},function(b){return e[132]=d.toJSON(e[131]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[146]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[147]=void 0:e[147]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[146],d.i64.cast([0,1e6])),e[18]),e[147]],e[133]=b[0],e[134]=b[1],e[135]=b[2],e[136]=b[3],e[137]=b[4],e[138]=b[5],e[139]=b[6],b):(f=c.item,e[146]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[147]=void 0:e[147]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[146],d.i64.cast([0,1e6])),e[18]),e[147]],e[133]=b[0],e[134]=b[1],e[135]=b[2],e[136]=b[3],e[137]=b[4],e[138]=b[5],e[139]=b[6],b)})},function(a){return e[141]=new d.Map(),e[141].set("task_id",e[133]),e[141].set("queue_name",e[134]),e[141].set("enqueue_timestamp_ms",e[135]),e[141].set("priority",e[136]),e[141].set("first_executed_timestamp_ms",e[137]),e[141].set("execution_time_ns",e[138]),e[141].set("echo_encoding_execution_time_ns",e[139]),e[142]=new d.Map(),e[142].set("task_metadata",e[141]),e[142].set("action_type",e[59]),e[142].set("content_type",e[60]),e[142].set("identifiers",void 0),e[142].set("identifiers_v2",e[54]),e[142].set("task_creation_source",void 0),e[142].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[146]=(void 0).get("stored_procedure"),e[147]=(void 0).get("error_code"),e[148]=(void 0).get("error_message"),e[149]="."):0,void 0!==void 0?(e[146]=(void 0).get("stored_procedure"),e[147]=(void 0).get("error_code"),e[148]=(void 0).get("error_message"),e[149]="."):0,e[143]=new d.Map(),e[143].set("payload",e[132]),e[144]=d.createArray(),e[146]=(e[144].push(void 0),e[144]),a=[e[143],void 0,e[142],e[144]],e[105]=a[0],e[106]=a[1],e[107]=a[2],e[108]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[120]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[121]=void 0:e[121]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[120],d.i64.cast([0,1e6])),e[18]),e[121]],e[109]=b[0],e[110]=b[1],e[111]=b[2],e[112]=b[3],e[113]=b[4],e[114]=b[5],e[115]=b[6],b):(f=c.item,e[120]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[121]=void 0:e[121]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[120],d.i64.cast([0,1e6])),e[18]),e[121]],e[109]=b[0],e[110]=b[1],e[111]=b[2],e[112]=b[3],e[113]=b[4],e[114]=b[5],e[115]=b[6],b)})},function(a){return e[117]=new d.Map(),e[117].set("task_id",e[109]),e[117].set("queue_name",e[110]),e[117].set("enqueue_timestamp_ms",e[111]),e[117].set("priority",e[112]),e[117].set("first_executed_timestamp_ms",e[113]),e[117].set("execution_time_ns",e[114]),e[117].set("echo_encoding_execution_time_ns",e[115]),e[118]=new d.Map(),e[118].set("task_metadata",e[117]),e[118].set("action_type",e[59]),e[118].set("content_type",e[60]),e[118].set("identifiers",void 0),e[118].set("identifiers_v2",e[54]),e[118].set("task_creation_source",void 0),e[118].set("message_payload_source",d.i64.cast([0,2])),e[100]!==void 0?(e[120]=e[100].get("stored_procedure"),e[121]=e[100].get("error_code"),e[122]=e[100].get("error_message"),e[123]="."):0,void 0!==void 0?(e[120]=(void 0).get("stored_procedure"),e[121]=(void 0).get("error_code"),e[122]=(void 0).get("error_message"),e[123]="."):0,e[119]=d.createArray(),e[120]=(e[119].push(void 0),e[119]),a=[void 0,e[100],e[118],e[119]],e[105]=a[0],e[106]=a[1],e[107]=a[2],e[108]=a[3],a}])},function(a){return a=[e[105],e[106],e[107],e[108]],e[101]=a[0],e[102]=a[1],e[103]=a[2],e[104]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[116]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[117]=void 0:e[117]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[116],d.i64.cast([0,1e6])),e[18]),e[117]],e[105]=b[0],e[106]=b[1],e[107]=b[2],e[108]=b[3],e[109]=b[4],e[110]=b[5],e[111]=b[6],b):(f=c.item,e[116]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[117]=void 0:e[117]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[116],d.i64.cast([0,1e6])),e[18]),e[117]],e[105]=b[0],e[106]=b[1],e[107]=b[2],e[108]=b[3],e[109]=b[4],e[110]=b[5],e[111]=b[6],b)})},function(a){return e[113]=new d.Map(),e[113].set("task_id",e[105]),e[113].set("queue_name",e[106]),e[113].set("enqueue_timestamp_ms",e[107]),e[113].set("priority",e[108]),e[113].set("first_executed_timestamp_ms",e[109]),e[113].set("execution_time_ns",e[110]),e[113].set("echo_encoding_execution_time_ns",e[111]),e[114]=new d.Map(),e[114].set("task_metadata",e[113]),e[114].set("action_type",e[59]),e[114].set("content_type",e[60]),e[114].set("identifiers",void 0),e[114].set("identifiers_v2",e[54]),e[114].set("task_creation_source",void 0),e[114].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[116]=(void 0).get("stored_procedure"),e[117]=(void 0).get("error_code"),e[118]=(void 0).get("error_message"),e[119]="."):0,e[90]!==void 0?(e[116]=e[90].get("stored_procedure"),e[117]=e[90].get("error_code"),e[118]=e[90].get("error_message"),e[119]="."):0,e[115]=d.createArray(),e[116]=(e[115].push(e[90]),e[115]),a=[void 0,void 0,e[114],e[115]],e[101]=a[0],e[102]=a[1],e[103]=a[2],e[104]=a[3],a}])},function(a){return a=[e[101],e[102],e[103],e[104]],e[91]=a[0],e[92]=a[1],e[93]=a[2],e[94]=a[3],a}]):d.sequence([function(c){return e[95]===!0&&e[96]===!1?d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[112]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[113]=void 0:e[113]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[112],d.i64.cast([0,1e6])),e[18]),e[113]],e[101]=b[0],e[102]=b[1],e[103]=b[2],e[104]=b[3],e[105]=b[4],e[106]=b[5],e[107]=b[6],b):(f=c.item,e[112]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[113]=void 0:e[113]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[112],d.i64.cast([0,1e6])),e[18]),e[113]],e[101]=b[0],e[102]=b[1],e[103]=b[2],e[104]=b[3],e[105]=b[4],e[106]=b[5],e[107]=b[6],b)})},function(a){return e[109]=new d.Map(),e[109].set("task_id",e[101]),e[109].set("queue_name",e[102]),e[109].set("enqueue_timestamp_ms",e[103]),e[109].set("priority",e[104]),e[109].set("first_executed_timestamp_ms",e[105]),e[109].set("execution_time_ns",e[106]),e[109].set("echo_encoding_execution_time_ns",e[107]),e[110]=new d.Map(),e[110].set("task_metadata",e[109]),e[110].set("action_type",e[59]),e[110].set("content_type",e[60]),e[110].set("identifiers",void 0),e[110].set("identifiers_v2",e[54]),e[110].set("task_creation_source",void 0),e[110].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[112]=(void 0).get("stored_procedure"),e[113]=(void 0).get("error_code"),e[114]=(void 0).get("error_message"),e[115]="."):0,e[90]!==void 0?(e[112]=e[90].get("stored_procedure"),e[113]=e[90].get("error_code"),e[114]=e[90].get("error_message"),e[115]="."):0,e[111]=d.createArray(),e[112]=(e[111].push(e[90]),e[111]),a=[void 0,void 0,e[110],e[111]],e[97]=a[0],e[98]=a[1],e[99]=a[2],e[100]=a[3],a}]):d.sequence([function(c){return d.i64.eq(e[59],d.i64.cast([0,1]))?(e[109]=e[64]===""?void 0:e[64],e[109]!==void 0?(c=[e[109],void 0],e[107]=c[0],e[108]=c[1],c):(e[110]=new d.Map(),e[110].set("error_code",d.i64.cast([0,30])),e[110].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[110].set("error_message",""),c=[void 0,e[110]],e[107]=c[0],e[108]=c[1],c),c=[e[107],e[108]],e[101]=c[0],e[102]=c[1],c):(c=["",void 0],e[101]=c[0],e[102]=c[1],c),e[101]!==void 0?d.sequence([function(a){return d.i64.eq(e[59],d.i64.cast([0,1]))?d.sequence([function(a){return e[113]=e[54].get("backup_id"),e[114]=e[54].get("act_thread_id"),d.storedProcedure(b("LSEncryptMessagePayloadV2"),e[113],e[114],e[72],e[101]).then(function(a){return a=a,e[115]=a[0],e[116]=a[1],a})},function(a){return a=[e[115],e[116]],e[107]=a[0],e[108]=a[1],a}]):d.resolve((e[113]=new d.Map(),e[113].set("encrypted_message_payload",""),e[113].set("value_secret_ref",""),a=[e[113],void 0],e[107]=a[0],e[108]=a[1],a))},function(c){return e[107]!==void 0?d.sequence([function(a){return e[113]=e[82].get("act_thread_id_ocmf_partial"),e[114]=e[82].get("otid_ocmf_partial"),e[115]=e[82].get("timestamp_encrypted"),e[116]=new d.Map(),e[116].set("list_key",e[113]),e[116].set("unique_key",e[114]),e[116].set("sort_key",e[115]),e[107]!==void 0?(e[149]=e[107].get("encrypted_message_payload"),e[150]=e[107].get("value_secret_ref"),e[151]=new d.Map(),e[151].set("value",e[149]),e[151].set("value_secret_ref",e[150]),e[117]=e[151]):e[117]=void 0,e[118]=new d.Map(),e[118].set("list_item_id",e[116]),e[118].set("list_item",e[117]),e[118].set("action_type",e[59]),e[119]=e[54].get("timestamp"),e[120]=e[54].get("otid"),e[121]=e[54].get("act_thread_id"),e[122]=e[54].get("supplemental_otid"),e[123]=new d.Map(),e[123].set("timestamp",e[119]),e[123].set("otid",e[120]),e[123].set("wa_thread_id",d.i64.from_string(e[121])),e[123].set("supplemental_otid",e[122]),e[124]=e[72].get("mailbox_base_salt"),d.nativeOperation(b("LSBase64Encode.nop"),e[124]).then(function(a){return a=a,e[125]=a[0],a})},function(a){return e[126]=e[72].get("ocmf_shared_key"),d.nativeOperation(b("LSBase64Encode.nop"),e[126]).then(function(a){return a=a,e[127]=a[0],a})},function(a){return e[128]=new d.Map(),e[128].set("mailbox_root_key",e[125]==null?"":e[125]),e[128].set("ocmf_client_state_blob",e[127]==null?"":e[127]),e[129]=e[82].get("backup_id_ocmf_partial"),e[130]=e[72].get("message_payload_encryption_keys"),e[131]=e[130].get("epoch_id"),e[132]=e[72].get("message_payload_encryption_keys"),e[133]=e[132].get("encryption_version"),e[148]=e[65]==null?"":e[65],e[134]=new d.Map(),e[134].set("mailbox_partial_id",e[129]),e[134].set("action",e[118]),e[134].set("device_id",e[34]),e[134].set("echo_version",d.i64.cast([0,0])),e[134].set("epoch_id",e[131]),e[134].set("trace_id",void 0),e[134].set("encryption_version",e[133]),e[134].set("is_thread",d.i64.eq(e[60],d.i64.cast([0,2]))),e[134].set("raw_identifiers",e[123]),e[134].set("raw_tokens",e[128]),e[134].set("request_id",e[148]),e[134].set("tam_thread_subtype",e[66]==null?d.i64.cast([0,0]):e[66]),e[134].set("is_instamadillo",e[67]==null?!1:e[67]),e[89]!==void 0?d.sequence([function(a){return e[149]=e[89].get("supplemental_data_encrypted"),e[149]!==void 0?d.sequence([function(a){return e[151]=e[89].get("protobuf_encrypted"),e[152]=e[89].get("backup_action"),e[153]=e[89].get("timestamp_ms"),e[154]=e[149].get("sk_ciphertext"),d.nativeOperation(b("LSBase64Encode.nop"),e[154]).then(function(a){return a=a,e[155]=a[0],a})},function(a){return e[156]=e[149].get("sk_hash"),d.nativeOperation(b("LSBase64Encode.nop"),e[156]).then(function(a){return a=a,e[157]=a[0],a})},function(a){return e[158]=e[89].get("message_tags"),e[159]=e[89].get("maybe_ooo_supplemental_upload"),e[160]=new d.Map(),e[160].set("supplementary_data_key",void 0),e[160].set("encrypted_protobuf",e[151]),e[160].set("key_value_backup_action",e[152]),e[160].set("protobuf_ts_ms",e[153]),e[160].set("supplemental_key_ciphertext",e[155]),e[160].set("supplemental_key_hash",e[157]),e[160].set("message_tags",e[158]),e[160].set("maybe_ooo_supplemental_upload",e[159]),e[150]=e[160]}]):d.resolve((e[151]=e[89].get("protobuf_encrypted"),e[152]=e[89].get("backup_action"),e[153]=e[89].get("timestamp_ms"),e[154]=e[89].get("message_tags"),e[155]=new d.Map(),e[155].set("supplementary_data_key",void 0),e[155].set("encrypted_protobuf",e[151]),e[155].set("key_value_backup_action",e[152]),e[155].set("protobuf_ts_ms",e[153]),e[155].set("message_tags",e[154]),e[150]=e[155]))},function(a){return e[134].set("key_value_backup_payload",e[150])}]):d.resolve()},function(a){return e[62]!==void 0?e[134].set("attachment_backup_payload",e[62]):function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure] attachment_payload is null."),e[148]!==void 0?d.nativeOperation(b("LSLogWebQpl.nop"),e[148],d.i64.cast([0,521481602]),"upload_start",d.i64.cast([0,0]),void 0,void 0):d.resolve()},function(b){return e[135]=d.toJSON(e[134]),d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[149]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[150]=void 0:e[150]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[149],d.i64.cast([0,1e6])),e[18]),e[150]],e[136]=b[0],e[137]=b[1],e[138]=b[2],e[139]=b[3],e[140]=b[4],e[141]=b[5],e[142]=b[6],b):(f=c.item,e[149]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[150]=void 0:e[150]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[149],d.i64.cast([0,1e6])),e[18]),e[150]],e[136]=b[0],e[137]=b[1],e[138]=b[2],e[139]=b[3],e[140]=b[4],e[141]=b[5],e[142]=b[6],b)})},function(a){return e[144]=new d.Map(),e[144].set("task_id",e[136]),e[144].set("queue_name",e[137]),e[144].set("enqueue_timestamp_ms",e[138]),e[144].set("priority",e[139]),e[144].set("first_executed_timestamp_ms",e[140]),e[144].set("execution_time_ns",e[141]),e[144].set("echo_encoding_execution_time_ns",e[142]),e[145]=new d.Map(),e[145].set("task_metadata",e[144]),e[145].set("action_type",e[59]),e[145].set("content_type",e[60]),e[145].set("identifiers",void 0),e[145].set("identifiers_v2",e[54]),e[145].set("task_creation_source",void 0),e[145].set("message_payload_source",d.i64.cast([0,2])),void 0!==void 0?(e[149]=(void 0).get("stored_procedure"),e[150]=(void 0).get("error_code"),e[151]=(void 0).get("error_message"),e[152]="."):0,e[90]!==void 0?(e[149]=e[90].get("stored_procedure"),e[150]=e[90].get("error_code"),e[151]=e[90].get("error_message"),e[152]="."):0,e[146]=new d.Map(),e[146].set("payload",e[135]),e[147]=d.createArray(),e[149]=(e[147].push(e[90]),e[147]),a=[e[146],void 0,e[145],e[147]],e[109]=a[0],e[110]=a[1],e[111]=a[2],e[112]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[124]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[125]=void 0:e[125]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[124],d.i64.cast([0,1e6])),e[18]),e[125]],e[113]=b[0],e[114]=b[1],e[115]=b[2],e[116]=b[3],e[117]=b[4],e[118]=b[5],e[119]=b[6],b):(f=c.item,e[124]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[125]=void 0:e[125]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[124],d.i64.cast([0,1e6])),e[18]),e[125]],e[113]=b[0],e[114]=b[1],e[115]=b[2],e[116]=b[3],e[117]=b[4],e[118]=b[5],e[119]=b[6],b)})},function(a){return e[121]=new d.Map(),e[121].set("task_id",e[113]),e[121].set("queue_name",e[114]),e[121].set("enqueue_timestamp_ms",e[115]),e[121].set("priority",e[116]),e[121].set("first_executed_timestamp_ms",e[117]),e[121].set("execution_time_ns",e[118]),e[121].set("echo_encoding_execution_time_ns",e[119]),e[122]=new d.Map(),e[122].set("task_metadata",e[121]),e[122].set("action_type",e[59]),e[122].set("content_type",e[60]),e[122].set("identifiers",void 0),e[122].set("identifiers_v2",e[54]),e[122].set("task_creation_source",void 0),e[122].set("message_payload_source",d.i64.cast([0,2])),e[108]!==void 0?(e[124]=e[108].get("stored_procedure"),e[125]=e[108].get("error_code"),e[126]=e[108].get("error_message"),e[127]="."):0,e[90]!==void 0?(e[124]=e[90].get("stored_procedure"),e[125]=e[90].get("error_code"),e[126]=e[90].get("error_message"),e[127]="."):0,e[123]=d.createArray(),e[124]=(e[123].push(e[90]),e[123]),a=[void 0,e[108],e[122],e[123]],e[109]=a[0],e[110]=a[1],e[111]=a[2],e[112]=a[3],a}])},function(a){return a=[e[109],e[110],e[111],e[112]],e[103]=a[0],e[104]=a[1],e[105]=a[2],e[106]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[118]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[119]=void 0:e[119]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[118],d.i64.cast([0,1e6])),e[18]),e[119]],e[107]=b[0],e[108]=b[1],e[109]=b[2],e[110]=b[3],e[111]=b[4],e[112]=b[5],e[113]=b[6],b):(f=c.item,e[118]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[119]=void 0:e[119]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[118],d.i64.cast([0,1e6])),e[18]),e[119]],e[107]=b[0],e[108]=b[1],e[109]=b[2],e[110]=b[3],e[111]=b[4],e[112]=b[5],e[113]=b[6],b)})},function(a){return e[115]=new d.Map(),e[115].set("task_id",e[107]),e[115].set("queue_name",e[108]),e[115].set("enqueue_timestamp_ms",e[109]),e[115].set("priority",e[110]),e[115].set("first_executed_timestamp_ms",e[111]),e[115].set("execution_time_ns",e[112]),e[115].set("echo_encoding_execution_time_ns",e[113]),e[116]=new d.Map(),e[116].set("task_metadata",e[115]),e[116].set("action_type",e[59]),e[116].set("content_type",e[60]),e[116].set("identifiers",void 0),e[116].set("identifiers_v2",e[54]),e[116].set("task_creation_source",void 0),e[116].set("message_payload_source",d.i64.cast([0,2])),e[102]!==void 0?(e[118]=e[102].get("stored_procedure"),e[119]=e[102].get("error_code"),e[120]=e[102].get("error_message"),e[121]="."):0,e[90]!==void 0?(e[118]=e[90].get("stored_procedure"),e[119]=e[90].get("error_code"),e[120]=e[90].get("error_message"),e[121]="."):0,e[117]=d.createArray(),e[118]=(e[117].push(e[90]),e[117]),a=[void 0,e[102],e[116],e[117]],e[103]=a[0],e[104]=a[1],e[105]=a[2],e[106]=a[3],a}])},function(a){return a=[e[103],e[104],e[105],e[106]],e[97]=a[0],e[98]=a[1],e[99]=a[2],e[100]=a[3],a}])},function(a){return a=[e[97],e[98],e[99],e[100]],e[91]=a[0],e[92]=a[1],e[93]=a[2],e[94]=a[3],a}])},function(a){return a=[e[91],e[92],e[93],e[94]],e[84]=a[0],e[85]=a[1],e[86]=a[2],e[87]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[99]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[100]=void 0:e[100]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[99],d.i64.cast([0,1e6])),e[18]),e[100]],e[88]=b[0],e[89]=b[1],e[90]=b[2],e[91]=b[3],e[92]=b[4],e[93]=b[5],e[94]=b[6],b):(f=c.item,e[99]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[100]=void 0:e[100]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[99],d.i64.cast([0,1e6])),e[18]),e[100]],e[88]=b[0],e[89]=b[1],e[90]=b[2],e[91]=b[3],e[92]=b[4],e[93]=b[5],e[94]=b[6],b)})},function(a){return e[96]=new d.Map(),e[96].set("task_id",e[88]),e[96].set("queue_name",e[89]),e[96].set("enqueue_timestamp_ms",e[90]),e[96].set("priority",e[91]),e[96].set("first_executed_timestamp_ms",e[92]),e[96].set("execution_time_ns",e[93]),e[96].set("echo_encoding_execution_time_ns",e[94]),e[97]=new d.Map(),e[97].set("task_metadata",e[96]),e[97].set("action_type",e[59]),e[97].set("content_type",e[60]),e[97].set("identifiers",void 0),e[97].set("identifiers_v2",e[54]),e[97].set("task_creation_source",void 0),e[97].set("message_payload_source",d.i64.cast([0,2])),e[83]!==void 0?(e[99]=e[83].get("stored_procedure"),e[100]=e[83].get("error_code"),e[101]=e[83].get("error_message"),e[102]="."):0,void 0!==void 0?(e[99]=(void 0).get("stored_procedure"),e[100]=(void 0).get("error_code"),e[101]=(void 0).get("error_message"),e[102]="."):0,e[98]=d.createArray(),e[99]=(e[98].push(void 0),e[98]),a=[void 0,e[83],e[97],e[98]],e[84]=a[0],e[85]=a[1],e[86]=a[2],e[87]=a[3],a}])},function(a){return a=[e[84],e[85],e[86],e[87]],e[74]=a[0],e[75]=a[1],e[76]=a[2],e[77]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[89]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[90]=void 0:e[90]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[89],d.i64.cast([0,1e6])),e[18]),e[90]],e[78]=b[0],e[79]=b[1],e[80]=b[2],e[81]=b[3],e[82]=b[4],e[83]=b[5],e[84]=b[6],b):(f=c.item,e[89]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[90]=void 0:e[90]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[89],d.i64.cast([0,1e6])),e[18]),e[90]],e[78]=b[0],e[79]=b[1],e[80]=b[2],e[81]=b[3],e[82]=b[4],e[83]=b[5],e[84]=b[6],b)})},function(a){return e[86]=new d.Map(),e[86].set("task_id",e[78]),e[86].set("queue_name",e[79]),e[86].set("enqueue_timestamp_ms",e[80]),e[86].set("priority",e[81]),e[86].set("first_executed_timestamp_ms",e[82]),e[86].set("execution_time_ns",e[83]),e[86].set("echo_encoding_execution_time_ns",e[84]),e[87]=new d.Map(),e[87].set("task_metadata",e[86]),e[87].set("action_type",e[59]),e[87].set("content_type",e[60]),e[87].set("identifiers",void 0),e[87].set("identifiers_v2",e[54]),e[87].set("task_creation_source",void 0),e[87].set("message_payload_source",d.i64.cast([0,2])),e[73]!==void 0?(e[89]=e[73].get("stored_procedure"),e[90]=e[73].get("error_code"),e[91]=e[73].get("error_message"),e[92]="."):0,void 0!==void 0?(e[89]=(void 0).get("stored_procedure"),e[90]=(void 0).get("error_code"),e[91]=(void 0).get("error_message"),e[92]="."):0,e[88]=d.createArray(),e[89]=(e[88].push(void 0),e[88]),a=[void 0,e[73],e[87],e[88]],e[74]=a[0],e[75]=a[1],e[76]=a[2],e[77]=a[3],a}])},function(a){return a=[e[74],e[75],e[76],e[77]],e[55]=a[0],e[56]=a[1],e[57]=a[2],e[58]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(c,f){var b=c.done;c=c.value;return b?(e[80]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[81]=void 0:e[81]=e[63],b=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[80],d.i64.cast([0,1e6])),e[18]),e[81]],e[68]=b[0],e[69]=b[1],e[70]=b[2],e[71]=b[3],e[72]=b[4],e[73]=b[5],e[74]=b[6],b):(f=c.item,e[80]=d.i64.of_float(Date.now()),d.i64.eq(e[63],d.i64.cast([0,0]))||d.i64.eq(e[63],void 0)?e[81]=void 0:e[81]=e[63],b=[a[0],f.queueName,f.enqueueTimestampMs,void 0,f.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[80],d.i64.cast([0,1e6])),e[18]),e[81]],e[68]=b[0],e[69]=b[1],e[70]=b[2],e[71]=b[3],e[72]=b[4],e[73]=b[5],e[74]=b[6],b)})},function(a){return e[76]=new d.Map(),e[76].set("task_id",e[68]),e[76].set("queue_name",e[69]),e[76].set("enqueue_timestamp_ms",e[70]),e[76].set("priority",e[71]),e[76].set("first_executed_timestamp_ms",e[72]),e[76].set("execution_time_ns",e[73]),e[76].set("echo_encoding_execution_time_ns",e[74]),e[77]=new d.Map(),e[77].set("task_metadata",e[76]),e[77].set("action_type",e[59]),e[77].set("content_type",e[60]),e[77].set("identifiers",void 0),e[77].set("identifiers_v2",e[54]),e[77].set("task_creation_source",void 0),e[77].set("message_payload_source",d.i64.cast([0,2])),e[78]=new d.Map(),e[78].set("error_code",e[61]),e[78].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[78].set("error_message",""),e[78]!==void 0?(e[80]=e[78].get("stored_procedure"),e[81]=e[78].get("error_code"),e[82]=e[78].get("error_message"),e[83]="."):0,void 0!==void 0?(e[80]=(void 0).get("stored_procedure"),e[81]=(void 0).get("error_code"),e[82]=(void 0).get("error_message"),e[83]="."):0,e[79]=d.createArray(),a=[void 0,e[78],e[77],e[79]],e[55]=a[0],e[56]=a[1],e[57]=a[2],e[58]=a[3],a}])},function(a){return a=[e[55],e[56],e[57],e[58]],e[49]=a[0],e[50]=a[1],e[51]=a[2],e[52]=a[3],a}]))})},function(a){return a=[e[49],e[50],e[51],e[52]],e[41]=a[0],e[42]=a[1],e[43]=a[2],e[44]=a[3],a}]):d.sequence([function(b){return d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[57]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[57],d.i64.cast([0,1e6])),e[18]),void 0],e[45]=f[0],e[46]=f[1],e[47]=f[2],e[48]=f[3],e[49]=f[4],e[50]=f[5],e[51]=f[6],f):(c=b.item,e[57]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,void 0,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[57],d.i64.cast([0,1e6])),e[18]),void 0],e[45]=f[0],e[46]=f[1],e[47]=f[2],e[48]=f[3],e[49]=f[4],e[50]=f[5],e[51]=f[6],f)})},function(a){return e[53]=new d.Map(),e[53].set("task_id",e[45]),e[53].set("queue_name",e[46]),e[53].set("enqueue_timestamp_ms",e[47]),e[53].set("priority",e[48]),e[53].set("first_executed_timestamp_ms",e[49]),e[53].set("execution_time_ns",e[50]),e[53].set("echo_encoding_execution_time_ns",e[51]),e[54]=new d.Map(),e[54].set("task_metadata",e[53]),e[54].set("action_type",void 0),e[54].set("content_type",void 0),e[54].set("identifiers",void 0),e[54].set("identifiers_v2",void 0),e[54].set("task_creation_source",void 0),e[54].set("message_payload_source",d.i64.cast([0,2])),e[55]=new d.Map(),e[55].set("error_code",d.i64.cast([0,24])),e[55].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[55].set("error_message",""),e[55]!==void 0?(e[57]=e[55].get("stored_procedure"),e[58]=e[55].get("error_code"),e[59]=e[55].get("error_message"),e[60]="."):0,void 0!==void 0?(e[57]=(void 0).get("stored_procedure"),e[58]=(void 0).get("error_code"),e[59]=(void 0).get("error_message"),e[60]="."):0,e[56]=d.createArray(),a=[void 0,e[55],e[54],e[56]],e[41]=a[0],e[42]=a[1],e[43]=a[2],e[44]=a[3],a}])},function(a){return a=[e[41],e[42],e[43],e[44]],e[11]=a[0],e[12]=a[1],e[13]=a[2],e[14]=a[3],a}]):d.sequence([function(b){return e[22]=e[9].get("errors"),e[23]=e[9].get("errors"),d.db.table(2).fetch([[[a[0]]]]).next().then(function(b,c){var f=b.done;b=b.value;return f?(e[36]=d.i64.of_float(Date.now()),f=[a[0],void 0,void 0,void 0,void 0,d.i64.sub(d.i64.mul(e[36],d.i64.cast([0,1e6])),e[18]),void 0],e[24]=f[0],e[25]=f[1],e[26]=f[2],e[27]=f[3],e[28]=f[4],e[29]=f[5],e[30]=f[6],f):(c=b.item,e[36]=d.i64.of_float(Date.now()),f=[a[0],c.queueName,c.enqueueTimestampMs,void 0,c.firstExecutedTimestampMs,d.i64.sub(d.i64.mul(e[36],d.i64.cast([0,1e6])),e[18]),void 0],e[24]=f[0],e[25]=f[1],e[26]=f[2],e[27]=f[3],e[28]=f[4],e[29]=f[5],e[30]=f[6],f)})},function(a){return e[32]=new d.Map(),e[32].set("task_id",e[24]),e[32].set("queue_name",e[25]),e[32].set("enqueue_timestamp_ms",e[26]),e[32].set("priority",e[27]),e[32].set("first_executed_timestamp_ms",e[28]),e[32].set("execution_time_ns",e[29]),e[32].set("echo_encoding_execution_time_ns",e[30]),e[33]=new d.Map(),e[33].set("task_metadata",e[32]),e[33].set("action_type",void 0),e[33].set("content_type",void 0),e[33].set("identifiers",void 0),e[33].set("identifiers_v2",void 0),e[33].set("task_creation_source",void 0),e[33].set("message_payload_source",d.i64.cast([0,2])),e[34]=new d.Map(),e[34].set("error_code",d.i64.cast([0,1])),e[34].set("stored_procedure","LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure"),e[34].set("error_message",""),e[34]!==void 0?(e[36]=e[34].get("stored_procedure"),e[37]=e[34].get("error_code"),e[38]=e[34].get("error_message"),e[39]="."):0,void 0!==void 0?(e[36]=(void 0).get("stored_procedure"),e[37]=(void 0).get("error_code"),e[38]=(void 0).get("error_message"),e[39]="."):0,e[35]=d.createArray(),a=[void 0,e[34],e[33],e[35]],e[11]=a[0],e[12]=a[1],e[13]=a[2],e[14]=a[3],a}])},function(a){return e[15]=d.i64.of_float(Date.now()),e[16]=d.i64.random(),e[19]="Finishing execution. Execution time: ",e[20]=d.i64.to_string(d.i64.sub(e[15],e[0])),e[21]=" ms",e[17]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][serializeBackupPayloadV2] ",e[17],e[19],e[17],e[20],e[17],e[21]].join("")),d.i64.eq(d.i64.mod_(e[16],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[22]=",",e[23]=d.createArray(),void 0!==void 0?e[24]=(e[23].push(void 0),e[23]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"serializeBackupPayloadV2",[e[19],e[22],e[20],e[22],e[21]].join(""),e[23],d.i64.cast([0,4]))):d.resolve()},function(a){return a=[e[11],e[12],e[13],e[14]],f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],a}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsSerializeBackupPayloadV2StoredProcedure";a.__tables__=["pending_tasks","secure_encrypted_backups_client_state","pending_backups_context_v2","secure_encrypted_backups_epochs"];d=a;g["default"]=d}),98);
__d("LSTaskSerializerEncryptedBackupsUpload",["LSArrayGetObjectAt","LSLogMebClientEvent.nop","LSSerializeBackupPayloadV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUpload] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.forEach(c.db.table(177).fetch([[[a[0]]],"fk_pending_tasks"]),function(a){var b=a.update;a.item;return b({backupStatus:c.i64.cast([0,2])})})},function(e){return c.storedProcedure(b("LSSerializeBackupPayloadV2"),a[0]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],a})},function(a){return d[6]=c.createArray(),d[7]=c.i64.of_int32(d[5].length),c.i64.gt(d[7],c.i64.cast([0,0]))?c.loopAsync(d[7],function(a){return d[23]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[5],d[23]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return d[24]!==void 0?d[26]=(d[6].push(d[24]),d[6]):0}])}):c.resolve()},function(a){return d[8]=c.i64.of_int32(d[6].length),c.i64.gt(d[8],c.i64.cast([0,0]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[6],c.i64.cast([0,0])).then(function(a){return a=a,d[23]=a[0],d[24]=a[1],a})},function(a){return d[9]=d[23]}]):c.resolve(d[9]=void 0)},function(a){return d[2]?d[10]=!1:d[10]=!0,d[10]?(d[3]?d[23]=!1:d[23]=!0,d[23]?(a=[void 0,void 0,d[9],d[6],d[4]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],d[28]=a[4],a):(a=[void 0,d[3],d[9],d[6],d[4]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],d[28]=a[4],a),a=[d[24],d[25],d[26],d[27],d[28]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4],a):(d[23]=d[2].get("payload"),a=[d[23],d[3],d[9],d[6],d[4]],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4],a),d[23]=new c.Map(),d[24]=d[23].set("success",d[11]),d[25]=d[23].set("failure",d[12]),d[26]=d[23].set("protobuf_failure",d[13]),d[27]=d[23].set("protobuf_failures",d[14]),d[28]=d[23].set("context",d[15]),d[29]=c.toJSON(d[23]),d[16]=d[29],d[17]=c.i64.of_float(Date.now()),d[18]=c.i64.random(),d[20]="Finishing execution. Execution time: ",d[21]=c.i64.to_string(c.i64.sub(d[17],d[0])),d[22]=" ms",d[19]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUpload] ",d[19],d[20],d[19],d[21],d[19],d[22]].join("")),c.i64.eq(c.i64.mod_(d[18],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[23]=",",d[24]=c.createArray(),void 0!==void 0?d[25]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUpload",[d[20],d[23],d[21],d[23],d[22]].join(""),d[24],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[16],c.i64.cast([0,50026])],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadStoredProcedure";a.__tables__=["pending_backups_context_v2"];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadProtobufOnly",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[],e=[];return d[0]=new c.Map(),d[0].set("error_code",c.i64.cast([0,802])),d[0].set("stored_procedure","LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure"),d[0].set("error_message",""),d[2]=new c.Map(),d[3]=d[2].set("success",void 0),d[4]=d[2].set("failure",d[0]),d[5]=d[2].set("context",void 0),d[6]=c.toJSON(d[2]),d[1]=d[6],a=[d[1],c.i64.cast([0,50042]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a,c.resolve(e)}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadProtobufOnlyStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerEncryptedBackupsUploadSenderBackup",["LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] Beginning execution."),d[1]=c.i64.of_float(Date.now()),function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] LSEncryptedBackupsMinosEncrypt native op not supported"),d[3]="LSEncryptedBackupsMinosEncrypt native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure] ","",d[3]].join("")),d[2]=c.createArray(),void 0!==void 0?d[12]=(d[2].push(void 0),d[2]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure",d[3],d[2],c.i64.cast([0,3]))},function(a){return d[4]=new c.Map(),d[4].set("error_code",c.i64.cast([0,3])),d[4].set("stored_procedure","taskSerializerEncryptedBackupsUploadSenderBackup"),d[4].set("error_message",""),d[12]=new c.Map(),d[13]=d[12].set("success",void 0),d[14]=d[12].set("failure",d[4]),d[15]=d[12].set("context",void 0),d[16]=c.toJSON(d[12]),d[5]=d[16],d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][taskSerializerEncryptedBackupsUploadSenderBackup] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"taskSerializerEncryptedBackupsUploadSenderBackup",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[5],c.i64.cast([0,50057]),void 0],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsTaskSerializerEncryptedBackupsUploadSenderBackupStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("TaskSerializerMuteThreadV2: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[9]=b.createArray(),c[10]=(c[9].push("TaskSerializerMuteThreadV2: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),a=[void 0,void 0,void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("mailbox_type",b.i64.cast([0,0])),c[11].set("mute_expire_time_ms",e.muteExpireTimeMs),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,144]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerMuteThreadV2StoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSTaskSerializerRemoveThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("TaskSerializerRemoveThreadV2: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,c[7]=e.removeType,b.i64.neq(c[7],void 0)?(c[8]=new b.Map(),c[8].set("thread_key",e.threadKey),c[8].set("remove_type",c[7]),c[8].set("sync_group",e.syncGroup==null?b.i64.cast([0,1]):e.syncGroup),c[9]=b.toJSON(c[8]),f=[c[9],b.i64.cast([0,146]),void 0],c[4]=f[0],c[5]=f[1],c[6]=f[2],f):(d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d),e=[c[4],c[5],c[6]],c[0]=e[0],c[1]=e[1],c[2]=e[2],e)})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerRemoveThreadStoredProcedure";a.__tables__=["threads_optimistic_context"];e.exports=a}),null);
__d("LSTaskSerializerSendMessageV2",["LSSymmetricEncryptionCreateEncryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(31).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(d){return c[11]=e.offlineThreadingId,c[12]=e.messageId,c[21]=e.threadAttributionSource,c[9]=e.platformRef,c[10]=e.platformToken,c[8]=e.replySourceId,c[13]=e.replySourceType,c[20]=e.sendType,c[22]=e.markThreadRead,c[14]=e.initiatingSource,c[15]=e.skipUrlPreviewGen,c[17]=e.textHasLinks,c[18]=e.dataclassParams,c[19]=e.multitabEnv,c[16]=e.richTextFormatType,b.db.table(12).fetch([[[c[11]]],"optimistic"]).next().then(function(e,f){var d=e.done;e=e.value;return d?(c[23]=b.createArray(),c[24]=(c[23].push("OTID not found"),c[23]),c[25]=(c[23].push(c[11]),c[23]),c[26]=b.toJSON(c[23]),function(a){b.logger(a).mustfix(a)}(c[26]),d=[void 0,void 0,void 0],c[4]=d[0],c[5]=d[1],c[6]=d[2],d):(f=e.item,b.sequence([function(d){return c[31]=f.text,c[27]=f.threadKey,c[32]=f.messageId,c[40]=f.senderId,c[29]=f.stickerId,c[34]=f.mentionOffsets,c[35]=f.mentionLengths,c[28]=f.mentionIds,c[36]=f.mentionTypes,c[39]=f.replyType,c[37]=f.isForwarded,c[33]=f.forwardScore,c[38]=f.hotEmojiSize,c[30]=f.metadataDataclass,b.db.table(9).fetch([[[c[27]]]]).next().then(function(e,g){var d=e.done;e=e.value;return d?(c[41]=b.createArray(),c[42]=(c[41].push("thread not found"),c[41]),c[43]=(c[41].push(c[27]),c[41]),c[44]=b.toJSON(c[41]),function(a){b.logger(a).mustfix(a)}(c[44]),d=[void 0,void 0,void 0],c[23]=d[0],c[24]=d[1],c[25]=d[2],d):(g=e.item,b.sequence([function(d){return c[48]=g.threadName,c[47]=g.threadKey,c[49]=g.mailboxType,c[41]=g.threadType,c[50]=g.capabilities,c[51]=g.capabilities2,c[52]=g.capabilities3,c[53]=g.capabilities4,c[54]=g.capabilities5,b.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?c[42]=!1:(f=e.item,b.sequence([function(d){return b.islc(b.db.table(2).fetch([[[f.queueName]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(e,f){var d=e.done;e=e.value;return d?c[55]=!1:(f=e.item,c[55]=b.i64.eq(f.taskId,a[0]))})},function(a){return c[42]=c[55]}]))})},function(a){return b.i64.eq(g.authorityLevel,b.i64.cast([0,20]))&&(b.i64.eq(c[41],b.i64.cast([0,2]))||b.i64.eq(c[41],b.i64.cast([0,5]))||b.i64.eq(c[41],b.i64.cast([0,26])))&&c[42]?b.sequence([function(a){return c[58]=c[20]==null?b.i64.cast([0,1]):c[20],b.db.table(9).fetch([[[c[27]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[55]=b.i64.cast([0,1]):(e=d.item,c[73]=e.syncGroup,b.i64.neq(c[73],void 0)?c[72]=c[73]:c[72]=b.i64.cast([0,1]),c[55]=c[72])})},function(a){return c[57]=new b.Map(),c[57].set("thread_id",c[27]),c[57].set("otid",c[11]),c[57].set("source",c[21]==null?b.i64.cast([0,0]):c[21]),c[57].set("send_type",b.i64.cast([0,1])),c[57].set("sync_group",c[55]),c[57].set("mark_thread_read",c[22]),b.i64.eq(c[58],b.i64.cast([0,1]))?b.resolve(c[57].set("text",c[31])):b.i64.eq(c[58],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[29],void 0)?(c[57].set("sticker_id",c[29]),c[57].set("send_type",c[58])):0):b.i64.eq(c[58],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[72]=a[0],c[73]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[72]=a[0],c[73]=a[1],a)})},function(a){return c[72]!==void 0?b.i64.neq(c[73],void 0)?(c[57].set("url",c[72]),c[57].set("attribution_app_id",c[73]),c[57].set("send_type",c[58]),c[30]!==void 0?c[57].set("metadata_dataclass",c[30]):0):0:0}]):b.i64.eq(c[58],b.i64.cast([0,3]))?b.sequence([function(a){return c[57].set("text",c[31]),c[72]=b.createArray(),c[73]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[74]=a.offlineAttachmentId,c[75]=(c[72].push(b.i64.from_string(a.attachmentFbid)),c[72]),c[74]!==void 0?c[75]=(c[73].push(c[74]),c[73]):0})},function(a){return c[57].set("attachment_fbids",c[72]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[73]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,9]))?b.sequence([function(a){return c[57].set("text",c[31]),c[72]=b.createArray(),c[73]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[74]=a.offlineAttachmentId,c[75]=(c[72].push(b.i64.from_string(a.attachmentFbid)),c[72]),c[74]!==void 0?c[75]=(c[73].push(c[74]),c[73]):0})},function(a){return c[57].set("attachment_fbids",c[72]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[73]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[72]=void 0:(d=b.item,c[72]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[74]=void 0:(d=b.item,c[74]=d.actionUrl)})},function(a){return c[72]!==void 0?(c[57].set("text",c[31]),c[74]!==void 0?c[57].set("url",c[74]):0,c[57].set("forwarded_share_id",c[72]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,5]))?b.resolve(c[12]!==void 0?(c[57].set("forwarded_msg_id",c[12]),c[57].set("send_type",c[58]),b.i64.neq(c[33],void 0)?c[57].set("forward_score",c[33]):0,c[57].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[58],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[72]=a[0],c[73]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[72]=a[0],c[73]=a[1],a)})},function(a){return c[72]!==void 0?(c[57].set("url",c[72]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[72]=a[0],c[73]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[72]=a[0],c[73]=a[1],a)})},function(a){return c[72]!==void 0?(c[57].set("url",c[72]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.resolve(0)},function(a){return c[68]=c[8]===""?void 0:c[8],c[68]!==void 0?b.i64.neq(c[13],void 0)?(c[72]=new b.Map(),c[72].set("reply_source_id",c[68]),c[72].set("reply_source_type",c[13]),c[72].set("reply_type",c[39]==null?b.i64.cast([0,0]):c[39]),c[72].set("reply_source_attachment_id",void 0),c[57].set("reply_metadata",c[72])):0:0,c[69]=c[28]===""?void 0:c[28],c[69]!==void 0?(c[72]=c[34]===""?void 0:c[34],c[72]!==void 0?(c[73]=c[35]===""?void 0:c[35],c[73]!==void 0?(c[74]=new b.Map(),c[74].set("mention_ids",c[69]),c[74].set("mention_offsets",c[72]),c[74].set("mention_lengths",c[73]),c[74].set("mention_types",c[36]===""?void 0:c[36]),c[57].set("mention_data",c[74])):0):0):0,c[37]!==void 0?c[57].set("is_forwarded",c[37]):0,c[70]=c[9]===""?void 0:c[9],c[70]!==void 0?c[57].set("platform_ref",c[70]):0,c[71]=c[10]===""?void 0:c[10],c[71]!==void 0?c[57].set("platform_token",c[71]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[58],a)})?b.i64.neq(c[38],void 0)?c[57].set("hot_emoji_size",c[38]):0:0,b.i64.neq(c[14],void 0)?c[57].set("initiating_source",c[14]):0,c[15]!==void 0?c[57].set("skip_url_preview_gen",c[15]):0,b.i64.neq(c[16],void 0)?c[57].set("rich_text_format_type",c[16]):0,b.resolve()},function(a){return c[17]!==void 0?c[57].set("text_has_links",c[17]):0,c[18]!==void 0?c[57].set("dataclass_params",c[18]):0,c[19]!==void 0?c[57].set("multitab_env",c[19]):0,b.filter(b.db.table(14).fetch([[[c[47],c[40]]]]),function(a){return b.i64.eq(a.threadKey,c[47])&&b.i64.eq(b.i64.cast([0,0]),c[49])&&b.i64.eq(a.contactId,c[40])}).next().then(function(d,e){var a=d.done;d=d.value;return a?c[59]=!1:(e=d.item,b.i64.eq(c[41],b.i64.cast([0,152]))?(c[73]=e.threadRoles,b.i64.lt(b.i64.cast([0,7]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,7]),b.i64.cast([0,7]))?c[74]=!1:c[74]=!b.i64.eq(b.i64.and_(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.cast([0,7]))),c[73]),b.i64.cast([0,0])),c[75]=c[50],c[76]=c[51],c[77]=c[52],c[78]=c[53],c[79]=c[54],c[81]=b.i64.div(b.i64.cast([0,223]),b.i64.cast([0,64])),c[82]=b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.sub(b.i64.cast([0,223]),b.i64.mul(c[81],b.i64.cast([0,64]))))),b.i64.lt(b.i64.cast([0,223]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,223]),b.i64.cast([0,281]))?c[80]=!1:(b.i64.eq(c[81],b.i64.cast([0,0]))?c[83]=!b.i64.eq(b.i64.and_(c[82],c[75]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,1]))?c[84]=!b.i64.eq(b.i64.and_(c[82],c[76]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,2]))?c[85]=!b.i64.eq(b.i64.and_(c[82],c[77]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,3]))?c[86]=!b.i64.eq(b.i64.and_(c[82],c[78]),b.i64.cast([0,0])):(b.i64.eq(c[81],b.i64.cast([0,4]))?c[87]=!b.i64.eq(b.i64.and_(c[82],c[79]),b.i64.cast([0,0])):c[87]=!1,c[86]=c[87]),c[85]=c[86]),c[84]=c[85]),c[83]=c[84]),c[80]=c[83]),c[74]===c[80]?0:(function(a){b.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),b["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),c[72]=c[74]):c[72]=!1,c[59]=c[72])})},function(a){return c[59]?c[57].set("perform_action_as_page",!0):0,c[61]=b.createArray(),b.forEach(b.db.table(14).fetch([[[c[27]]]]),function(a){a=a.item;return c[72]=(c[61].push(a.contactId),c[61])})},function(a){return c[62]=new b.Map(),c[62].set("participants",c[61]),c[62].set("send_payload",c[57]),c[48]!==void 0?c[62].set("thread_name",c[48]):0,b.db.table(312).fetch([[[c[27]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[63]=void 0:(d=b.item,c[63]=d.metadata)})},function(a){return c[62].set("thread_metadata",c[63]),b.forEach(b.db.table(9).fetch([[[c[47]]]]),function(a){var b=a.update;a.item;return b({otidOfFirstMessage:f.offlineThreadingId})})},function(a){return c[63]===void 0||!1?(b.i64.eq(c[41],b.i64.cast([0,5]))||b.i64.eq(c[41],b.i64.cast([0,26]))?(function(a){b.logger(a).mustfix(a)}("For Marketplace & community chat subthreads, thread metadata cannot be null"),a=[void 0,void 0,void 0],c[72]=a[0],c[73]=a[1],c[74]=a[2],a):(c[75]=b.toJSON(c[62]),a=[c[75],b.i64.cast([0,130]),void 0],c[72]=a[0],c[73]=a[1],c[74]=a[2],a),a=[c[72],c[73],c[74]],c[65]=a[0],c[66]=a[1],c[67]=a[2],a):(b.i64.eq(c[41],b.i64.cast([0,5]))?(c[75]=b.toJSON(c[62]),a=[c[75],b.i64.cast([0,645]),void 0],c[72]=a[0],c[73]=a[1],c[74]=a[2],a):(b.i64.eq(c[41],b.i64.cast([0,2]))?(c[78]=b.toJSON(c[62]),a=[c[78],b.i64.cast([0,787]),void 0],c[75]=a[0],c[76]=a[1],c[77]=a[2],a):(c[78]=b.toJSON(c[62]),a=[c[78],b.i64.cast([0,645]),void 0],c[75]=a[0],c[76]=a[1],c[77]=a[2],a),a=[c[75],c[76],c[77]],c[72]=a[0],c[73]=a[1],c[74]=a[2],a),a=[c[72],c[73],c[74]],c[65]=a[0],c[66]=a[1],c[67]=a[2],a),a=[c[65],c[66],c[67]],c[44]=a[0],c[45]=a[1],c[46]=a[2],a}]):b.sequence([function(a){return c[58]=c[20]==null?b.i64.cast([0,1]):c[20],b.db.table(9).fetch([[[c[27]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[55]=b.i64.cast([0,1]):(e=d.item,c[67]=e.syncGroup,b.i64.neq(c[67],void 0)?c[66]=c[67]:c[66]=b.i64.cast([0,1]),c[55]=c[66])})},function(a){return c[57]=new b.Map(),c[57].set("thread_id",c[27]),c[57].set("otid",c[11]),c[57].set("source",c[21]==null?b.i64.cast([0,0]):c[21]),c[57].set("send_type",b.i64.cast([0,1])),c[57].set("sync_group",c[55]),c[57].set("mark_thread_read",c[22]),b.i64.eq(c[58],b.i64.cast([0,1]))?b.resolve(c[57].set("text",c[31])):b.i64.eq(c[58],b.i64.cast([0,2]))?b.resolve(b.i64.neq(c[29],void 0)?(c[57].set("sticker_id",c[29]),c[57].set("send_type",c[58])):0):b.i64.eq(c[58],b.i64.cast([0,7]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[66]=a[0],c[67]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[66]=a[0],c[67]=a[1],a)})},function(a){return c[66]!==void 0?b.i64.neq(c[67],void 0)?(c[57].set("url",c[66]),c[57].set("attribution_app_id",c[67]),c[57].set("send_type",c[58]),c[30]!==void 0?c[57].set("metadata_dataclass",c[30]):0):0:0}]):b.i64.eq(c[58],b.i64.cast([0,3]))?b.sequence([function(a){return c[57].set("text",c[31]),c[66]=b.createArray(),c[67]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[68]=a.offlineAttachmentId,c[69]=(c[66].push(b.i64.from_string(a.attachmentFbid)),c[66]),c[68]!==void 0?c[69]=(c[67].push(c[68]),c[67]):0})},function(a){return c[57].set("attachment_fbids",c[66]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[67]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,9]))?b.sequence([function(a){return c[57].set("text",c[31]),c[66]=b.createArray(),c[67]=b.createArray(),b.forEach(b.sortBy(b.db.table(16).fetch([[[c[27],c[32]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[68]=a.offlineAttachmentId,c[69]=(c[66].push(b.i64.from_string(a.attachmentFbid)),c[66]),c[68]!==void 0?c[69]=(c[67].push(c[68]),c[67]):0})},function(a){return c[57].set("attachment_fbids",c[66]),b.i64.eq(c[58],b.i64.cast([0,9]))?c[57].set("offline_attachment_ids",c[67]):0,c[57].set("send_type",c[58])}]):b.i64.eq(c[58],b.i64.cast([0,4]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[66]=void 0:(d=b.item,c[66]=d.attachmentFbid)})},function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[68]=void 0:(d=b.item,c[68]=d.actionUrl)})},function(a){return c[66]!==void 0?(c[57].set("text",c[31]),c[68]!==void 0?c[57].set("url",c[68]):0,c[57].set("forwarded_share_id",c[66]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,5]))?b.resolve(c[12]!==void 0?(c[57].set("forwarded_msg_id",c[12]),c[57].set("send_type",c[58]),b.i64.neq(c[33],void 0)?c[57].set("forward_score",c[33]):0,c[57].set("strip_forwarded_msg_caption",!1)):0):b.i64.eq(c[58],b.i64.cast([0,6]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[66]=a[0],c[67]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[66]=a[0],c[67]=a[1],a)})},function(a){return c[66]!==void 0?(c[57].set("url",c[66]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.i64.eq(c[58],b.i64.cast([0,11]))?b.sequence([function(a){return b.db.table(16).fetch([[[c[27],c[32]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[void 0,void 0],c[66]=a[0],c[67]=a[1],a):(d=b.item,a=[d.actionUrl,d.attributionAppId],c[66]=a[0],c[67]=a[1],a)})},function(a){return c[66]!==void 0?(c[57].set("url",c[66]),c[57].set("text",c[31]),c[57].set("send_type",c[58])):0}]):b.resolve(0)},function(a){return c[62]=c[8]===""?void 0:c[8],c[62]!==void 0?b.i64.neq(c[13],void 0)?(c[66]=new b.Map(),c[66].set("reply_source_id",c[62]),c[66].set("reply_source_type",c[13]),c[66].set("reply_type",c[39]==null?b.i64.cast([0,0]):c[39]),c[66].set("reply_source_attachment_id",void 0),c[57].set("reply_metadata",c[66])):0:0,c[63]=c[28]===""?void 0:c[28],c[63]!==void 0?(c[66]=c[34]===""?void 0:c[34],c[66]!==void 0?(c[67]=c[35]===""?void 0:c[35],c[67]!==void 0?(c[68]=new b.Map(),c[68].set("mention_ids",c[63]),c[68].set("mention_offsets",c[66]),c[68].set("mention_lengths",c[67]),c[68].set("mention_types",c[36]===""?void 0:c[36]),c[57].set("mention_data",c[68])):0):0):0,c[37]!==void 0?c[57].set("is_forwarded",c[37]):0,c[64]=c[9]===""?void 0:c[9],c[64]!==void 0?c[57].set("platform_ref",c[64]):0,c[65]=c[10]===""?void 0:c[10],c[65]!==void 0?c[57].set("platform_token",c[65]):0,[b.i64.cast([0,1]),b.i64.cast([0,2])].some(function(a){return b.i64.eq(c[58],a)})?b.i64.neq(c[38],void 0)?c[57].set("hot_emoji_size",c[38]):0:0,b.i64.neq(c[14],void 0)?c[57].set("initiating_source",c[14]):0,c[15]!==void 0?c[57].set("skip_url_preview_gen",c[15]):0,b.i64.neq(c[16],void 0)?c[57].set("rich_text_format_type",c[16]):0,b.resolve()},function(a){return c[17]!==void 0?c[57].set("text_has_links",c[17]):0,c[18]!==void 0?c[57].set("dataclass_params",c[18]):0,c[19]!==void 0?c[57].set("multitab_env",c[19]):0,b.filter(b.db.table(14).fetch([[[c[47],c[40]]]]),function(a){return b.i64.eq(a.threadKey,c[47])&&b.i64.eq(b.i64.cast([0,0]),c[49])&&b.i64.eq(a.contactId,c[40])}).next().then(function(d,e){var a=d.done;d=d.value;return a?c[59]=!1:(e=d.item,b.i64.eq(c[41],b.i64.cast([0,152]))?(c[67]=e.threadRoles,b.i64.lt(b.i64.cast([0,7]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,7]),b.i64.cast([0,7]))?c[68]=!1:c[68]=!b.i64.eq(b.i64.and_(b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.cast([0,7]))),c[67]),b.i64.cast([0,0])),c[69]=c[50],c[70]=c[51],c[71]=c[52],c[72]=c[53],c[73]=c[54],c[75]=b.i64.div(b.i64.cast([0,223]),b.i64.cast([0,64])),c[76]=b.i64.lsl_(b.i64.cast([0,1]),b.i64.to_int32(b.i64.sub(b.i64.cast([0,223]),b.i64.mul(c[75],b.i64.cast([0,64]))))),b.i64.lt(b.i64.cast([0,223]),b.i64.cast([0,0]))||b.i64.gt(b.i64.cast([0,223]),b.i64.cast([0,281]))?c[74]=!1:(b.i64.eq(c[75],b.i64.cast([0,0]))?c[77]=!b.i64.eq(b.i64.and_(c[76],c[69]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,1]))?c[78]=!b.i64.eq(b.i64.and_(c[76],c[70]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,2]))?c[79]=!b.i64.eq(b.i64.and_(c[76],c[71]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,3]))?c[80]=!b.i64.eq(b.i64.and_(c[76],c[72]),b.i64.cast([0,0])):(b.i64.eq(c[75],b.i64.cast([0,4]))?c[81]=!b.i64.eq(b.i64.and_(c[76],c[73]),b.i64.cast([0,0])):c[81]=!1,c[80]=c[81]),c[79]=c[80]),c[78]=c[79]),c[77]=c[78]),c[74]=c[77]),c[68]===c[74]?0:(function(a){b.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),b["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),c[66]=c[68]):c[66]=!1,c[59]=c[66])})},function(a){return c[59]?c[57].set("perform_action_as_page",!0):0,c[61]=b.toJSON(c[57]),a=[c[61],b.i64.cast([0,46]),void 0],c[44]=a[0],c[45]=a[1],c[46]=a[2],a}])},function(a){return a=[c[44],c[45],c[46]],c[23]=a[0],c[24]=a[1],c[25]=a[2],a}]))})},function(a){return a=[c[23],c[24],c[25]],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerSendMessageV2StoredProcedure";a.__tables__=["messages_optimistic_context","messages","threads","pending_tasks","attachments","participants","threads_optimistic_metadata"];e.exports=a}),null);
__d("LSTaskSerializerSyncThreadCapabilities",[],(function(a,b,c,d,e,f){function a(){var a,b=arguments,c=b[b.length-1],d=[];return a=[void 0,void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],a,c.resolve(d)}a.__sproc_name__="LSMailboxTaskSerializerSyncThreadCapabilitiesStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIsExperimentCapabilityEnabled.nop",["LSACSExperimentCapability","LSIntEnum","MetaConfig","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("MetaConfig")._("87"),k=c("MetaConfig")._("156");a=function(a,e,f,g){switch((i||(i=d("LSIntEnum"))).toNumber(f)){case c("LSACSExperimentCapability").BUMP_TOKEN_SYNC_TASK_AT_TASK_SERIALIZATION:return(h||(h=b("Promise"))).resolve([k]);case c("LSACSExperimentCapability").INSERT_PENDING_TASK_PARENT_ROW_WHEN_NO_ACS_TOKENS_AT_TASK_INSERTION:return(h||(h=b("Promise"))).resolve([!1]);case c("LSACSExperimentCapability").RETRY_AFTER_TASK_SERIALIZATION_FAILURE_EXPONENTIAL_BACKOFF:return(h||(h=b("Promise"))).resolve([j])}return(h||(h=b("Promise"))).resolve([!1])};a.__nop_name__="LSIsExperimentCapabilityEnabled";g["default"]=a}),98);
__d("LSMailboxTaskCompletionApiOnTaskCompletion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(233).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({success:a[1]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSCoreMailboxTaskCompletionApiOnTaskCompletionStoredProcedure";a.__tables__=["mailbox_task_completion_api_tasks"];e.exports=a}),null);
__d("LSVoprfHmac.nop",["ACSCipherSuiteModule","ACSTokenHmacUtil","Promise","XPlatReactTextEncoder","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){a=d("ACSCipherSuiteModule").getACSCipherSuiteByValue(d("ACSCipherSuiteModule").VOPRF_RISTRETTO_HMACSHA512.value);if(!a)return(h||(h=b("Promise"))).resolve([void 0]);c=(yield d("ACSTokenHmacUtil").hmac(a.macAlgorithm,new Uint8Array(f).slice(),new(d("XPlatReactTextEncoder").TextEncoder)().encode(e)));return(h||(h=b("Promise"))).resolve([c.buffer])});function c(b,c,d,e){return a.apply(this,arguments)}return c}();a.__nop_name__="LSVoprfHmac";g["default"]=a}),98);
__d("LSTaskSerializerUnauthenticatedTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsExperimentCapabilityEnabled.nop","LSMailboxTaskCompletionApiOnTaskCompletion","LSRemoveUsedTokens","LSVoprfHmac.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=void 0:(b=a.item,d[0]=b.projectName)})},function(e){return d[0]!==void 0?c.sequence([function(e){return a[1]!==void 0?c.sequence([function(a){return d[9]=c.createArray(),d[10]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[0]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[10])}),function(a){a=a.item;return d[16]=(d[9].push(a.configId),d[9])})},function(a){return c.sequence([function(a){return d[16]=c.createArray(),d[17]=c.i64.of_int32(d[9].length),c.i64.gt(d[17],c.i64.cast([0,0]))?c.loopAsync(d[17],function(a){return d[19]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[9],d[19]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(a){return d[22]=(d[16].push(d[20]),d[16])}])}):c.resolve()},function(a){return d[18]=d[16].join(","),d[11]=d[18]}])},function(e){return c.filter(c.db.table(309).fetch(),function(a){return d[9].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSIsExperimentCapabilityEnabled.nop"),c.i64.cast([0,0]),d[0]).then(function(a){return a=a,d[16]=a[0],a})},function(e){return d[16]?c.sequence([function(b){return c.db.table(311).fetch([[[a[0]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[20]=c.i64.cast([0,0]):(e=b.item,d[20]=e.failureCount)})},function(b){return c.forEach(c.db.table(311).fetch([[[a[0]]]]),function(a){a=a.item;return c.forEach(c.db.table(311).fetch([[[a.taskId]]]),function(a){var b=a.update;a.item;return b({failureCount:c.i64.add(d[20],c.i64.cast([0,1]))})})})},function(a){return a=[void 0,void 0,c.i64.mul(c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.mod_(d[20],c.i64.cast([0,7])))),c.i64.cast([0,500]))],d[17]=a[0],d[18]=a[1],d[19]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[20]=c.createArray(),d[21]=(d[20].push("Unauthenticated Task Serializer: no valid tokens"),d[20]),d[22]=(d[20].push(a[0]),d[20]),d[23]=(d[20].push(d[0]),d[20]),d[24]=c.toJSON(d[20]),function(a){c.logger(a).mustfix(a)}(d[24]),b=[void 0,void 0,void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2],b}])},function(a){return a=[d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(f=e.item,c.sequence([function(e){return d[20]=f.tokenId,c.nativeOperation(b("LSVoprfHmac.nop"),a[2]==null?"":a[2],f.sharedSecret).then(function(a){return a=a,d[16]=a[0],a})},function(e){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[20]]]]),function(a){var b=a.update;a=a.item;return b({redeemLimit:c.i64.sub(a.redeemLimit,c.i64.cast([0,1]))})})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[16]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),f.nonce).then(function(a){return a=a,d[22]=a[0],a})},function(b){return d[23]=new c.Map(),d[23].set("config_id",f.configId),d[23].set("tag",d[21]==null?"":d[21]),d[23].set("aux",d[22]==null?"":d[22]),d[23].set("project_name",d[0]),d[24]=c.toJSON(d[23]),d[25]=new c.Map(),d[25].set("payload",a[2]==null?"":a[2]),d[25].set("token",d[24]),d[26]=c.toJSON(d[25]),b=[d[26],c.i64.from_string(a[1]),void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2],b}]):c.sequence([function(a){return c.forEach(c.db.table(309).fetch([[[d[20]]]]),function(a){return a["delete"]()})},function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[21]=c.createArray(),d[22]=(d[21].push("Unauthenticated Task Serializer: hmac failed"),d[21]),d[23]=(d[21].push(a[0]),d[21]),d[24]=c.toJSON(d[21]),function(a){c.logger(a).mustfix(a)}(d[24]),b=[void 0,void 0,void 0],d[17]=b[0],d[18]=b[1],d[19]=b[2],b}])},function(a){return a=[d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[6]=a[0],d[7]=a[1],d[8]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[9]=c.createArray(),d[10]=(d[9].push("Unauthenticated Task Serializer: task has no write label"),d[9]),d[11]=(d[9].push(a[0]),d[9]),d[12]=c.toJSON(d[9]),function(a){c.logger(a).mustfix(a)}(d[12]),b=[void 0,void 0,void 0],d[6]=b[0],d[7]=b[1],d[8]=b[2],b}])},function(a){return a=[d[6],d[7],d[8]],d[2]=a[0],d[3]=a[1],d[4]=a[2],a}]):c.sequence([function(d){return c.storedProcedure(b("LSMailboxTaskCompletionApiOnTaskCompletion"),a[0],!1)},function(b){return d[6]=c.createArray(),d[7]=(d[6].push("Unauthenticated Task Serializer: anonymous_task_context row not found"),d[6]),d[8]=(d[6].push(a[0]),d[6]),d[9]=c.toJSON(d[6]),function(a){c.logger(a).mustfix(a)}(d[9]),b=[void 0,void 0,void 0],d[2]=b[0],d[3]=b[1],d[4]=b[2],b}])},function(a){return c.storedProcedure(b("LSRemoveUsedTokens"))},function(a){return d[0]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSIsExperimentCapabilityEnabled.nop"),c.i64.cast([0,1]),d[0]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[6]?c.sequence([function(a){return c.i64.neq(d[4],void 0)?c.resolve(d[8]=!0):c.sequence([function(a){return d[10]=c.createArray(),d[11]=c.i64.of_float(Date.now()),c.forEach(c.filter(c.db.table(307).fetch(),function(a){return d[0]===a.projectName&&c.i64.gt(a.expirationTimestampMs,d[11])}),function(a){a=a.item;return d[15]=(d[10].push(a.configId),d[10])})},function(a){return c.sequence([function(a){return d[15]=c.createArray(),d[16]=c.i64.of_int32(d[10].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.loopAsync(d[16],function(a){return d[18]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[10],d[18]).then(function(a){return a=a,d[19]=a[0],d[20]=a[1],a})},function(a){return d[21]=(d[15].push(d[19]),d[15])}])}):c.resolve()},function(a){return d[17]=d[15].join(","),d[12]=d[17]}])},function(a){return c.filter(c.db.table(309).fetch(),function(a){return d[10].includes(a.configId)&&c.i64.gt(a.redeemLimit,c.i64.cast([0,0]))}).next().then(function(a,b){b=a.done;a=a.value;return b?d[13]=!0:(a.item,d[13]=!1)})},function(a){return d[8]=d[13]}])},function(a){return d[8]?c.sequence([function(a){return c.filter(c.db.table(310).fetch(),function(a){return a.projectName===d[0]}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[10]=void 0:(b=a.item,d[10]=b.taskId)})},function(a){return d[9]=d[10]}]):c.resolve(d[9]=void 0)},function(a){return d[7]=d[9]}]):c.resolve(d[7]=void 0)},function(a){return d[5]=d[7]}]):c.resolve(d[5]=void 0)},function(a){return a=[d[2],d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAnonymousCredentialsTaskSerializerUnauthenticatedTaskStoredProcedure";a.__tables__=["anonymous_task_context","secure_acs_configurations","secure_acs_tokens","acs_request_context"];e.exports=a}),null);
__d("LSTaskSerializerUpdateThreadName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(e){return b.sequence([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,e){var f=d.done;d=d.value;return f?(c[4]=b.createArray(),c[5]=(c[4].push("taskSerializerUpdateThreadName: Task ID not found"),c[4]),c[6]=(c[4].push(a[0]),c[4]),c[7]=b.toJSON(c[4]),function(a){b.logger(a).mustfix(a)}(c[7]),f=[void 0,void 0,void 0],c[0]=f[0],c[1]=f[1],c[2]=f[2],f):(e=d.item,b.sequence([function(a){return c[8]=e.threadKey,b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?(c[9]=b.createArray(),c[10]=(c[9].push("taskSerializerUpdateThreadName: Thread not found"),c[9]),c[11]=(c[9].push(c[8]),c[9]),c[12]=b.toJSON(c[9]),function(a){b.logger(a).mustfix(a)}(c[12]),a=[void 0,void 0,void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a):(e=d.item,b.sequence([function(a){return b.db.table(9).fetch([[[c[8]]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?c[9]=b.i64.cast([0,1]):(e=d.item,c[14]=e.syncGroup,b.i64.neq(c[14],void 0)?c[13]=c[14]:c[13]=b.i64.cast([0,1]),c[9]=c[13])})},function(a){return c[11]=new b.Map(),c[11].set("thread_key",c[8]),c[11].set("thread_name",e.threadName==null?"":e.threadName),c[11].set("sync_group",c[9]),c[12]=b.toJSON(c[11]),a=[c[12],b.i64.cast([0,32]),void 0],c[4]=a[0],c[5]=a[1],c[6]=a[2],a}]))})},function(a){return a=[c[4],c[5],c[6]],c[0]=a[0],c[1]=a[1],c[2]=a[2],a}]))})},function(a){return a=[c[0],c[1],c[2]],d[0]=a[0],d[1]=a[1],d[2]=a[2],a}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSMailboxTaskSerializerUpdateThreadNameStoredProcedure";a.__tables__=["threads_optimistic_context","threads"];e.exports=a}),null);
__d("LSSerializeTask",["LSForceTaskExecutionImmediately","LSLogMebClientEvent.nop","LSTaskSerializerAcsIssueNextSync","LSTaskSerializerDeleteChatHistory","LSTaskSerializerE2eeMessageIntegrityCheckV2","LSTaskSerializerE2eeMetadataThreadIntegrityCheck","LSTaskSerializerEncryptedBackupAction","LSTaskSerializerEncryptedBackupsLoopingUpload","LSTaskSerializerEncryptedBackupsOpenUpload","LSTaskSerializerEncryptedBackupsRestoreWithSerializer","LSTaskSerializerEncryptedBackupsUpload","LSTaskSerializerEncryptedBackupsUploadProtobufOnly","LSTaskSerializerEncryptedBackupsUploadSenderBackup","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","LSTaskSerializerSyncThreadCapabilities","LSTaskSerializerUnauthenticatedTask","LSTaskSerializerUpdateThreadName"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return a[1]==="46"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSendMessageV2"),a[0]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],a})},function(a){return a=[d[8],c.i64.to_string(d[9]),void 0,void 0],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],a}]):c.sequence([function(e){return a[1]==="144"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerMuteThreadV2"),a[0]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return a=[d[12],c.i64.to_string(d[13]),void 0,void 0],d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a}]):c.sequence([function(e){return a[1]==="146"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerRemoveThread"),a[0]).then(function(a){return a=a,d[16]=a[0],d[17]=a[1],a})},function(a){return a=[d[16],c.i64.to_string(d[17]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=a[3],a}]):c.sequence([function(e){return a[1]==="32"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUpdateThreadName"),a[0]).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],d[22]=a[2],a})},function(a){return a=[d[20],c.i64.to_string(d[21]),void 0,d[22]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],a}]):c.sequence([function(e){return a[1]==="362"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerAcsIssueNextSync"),a[0]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],d[26]=a[2],a})},function(a){return a=[d[24],c.i64.to_string(d[25]),void 0,d[26]],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],a}]):c.sequence([function(e){return a[1]==="50015"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsRestoreWithSerializer"),a[0]).then(function(a){return a=a,d[28]=a[0],d[29]=a[1],d[30]=a[2],a})},function(a){return a=[d[28],c.i64.to_string(d[29]),void 0,d[30]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],a}]):c.sequence([function(e){return a[1]==="319"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupAction"),a[0]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],d[34]=a[2],a})},function(a){return a=[d[32],c.i64.to_string(d[33]),void 0,d[34]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}]):c.sequence([function(e){return a[1]==="50026"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUpload"),a[0]).then(function(a){return a=a,d[36]=a[0],d[37]=a[1],a})},function(a){return a=[d[36],c.i64.to_string(d[37]),void 0,void 0],d[32]=a[0],d[33]=a[1],d[34]=a[2],d[35]=a[3],a}]):c.sequence([function(e){return a[1]==="50042"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadProtobufOnly"),a[0]).then(function(a){return a=a,d[40]=a[0],d[41]=a[1],d[42]=a[2],a})},function(a){return a=[d[40],c.i64.to_string(d[41]),void 0,d[42]],d[36]=a[0],d[37]=a[1],d[38]=a[2],d[39]=a[3],a}]):c.sequence([function(e){return a[1]==="700"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMetadataThreadIntegrityCheck"),a[0]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],d[46]=a[2],a})},function(a){return a=[d[44],c.i64.to_string(d[45]),void 0,d[46]],d[40]=a[0],d[41]=a[1],d[42]=a[2],d[43]=a[3],a}]):c.sequence([function(e){return a[1]==="705"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerE2eeMessageIntegrityCheckV2"),a[0]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],d[50]=a[2],a})},function(a){return a=[d[48],c.i64.to_string(d[49]),void 0,d[50]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],a}]):c.sequence([function(e){return a[1]==="50043"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsLoopingUpload"),a[0]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],d[54]=a[2],a})},function(a){return a=[d[52],c.i64.to_string(d[53]),void 0,d[54]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],a}]):c.sequence([function(e){return a[1]==="50048"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsOpenUpload"),a[0]).then(function(a){return a=a,d[56]=a[0],d[57]=a[1],a})},function(a){return a=[d[56],c.i64.to_string(d[57]),void 0,void 0],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],a}]):c.sequence([function(e){return a[1]==="160013"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerSyncThreadCapabilities"),a[0]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],d[62]=a[2],a})},function(a){return a=[d[60],c.i64.to_string(d[61]),void 0,d[62]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],a}]):c.sequence([function(e){return a[1]==="903"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerDeleteChatHistory"),a[0]).then(function(a){return a=a,d[64]=a[0],d[65]=a[1],d[66]=a[2],a})},function(a){return a=[d[64],c.i64.to_string(d[65]),void 0,d[66]],d[60]=a[0],d[61]=a[1],d[62]=a[2],d[63]=a[3],a}]):c.sequence([function(e){return a[1]==="50057"?c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerEncryptedBackupsUploadSenderBackup"),a[0]).then(function(a){return a=a,d[68]=a[0],d[69]=a[1],d[70]=a[2],a})},function(a){return a=[d[68],c.i64.to_string(d[69]),void 0,d[70]],d[64]=a[0],d[65]=a[1],d[66]=a[2],d[67]=a[3],a}]):c.resolve((e=[a[2],a[1],void 0,void 0],d[64]=e[0],d[65]=e[1],d[66]=e[2],d[67]=e[3],e))},function(a){return a=[d[64],d[65],d[66],d[67]],d[60]=a[0],d[61]=a[1],d[62]=a[2],d[63]=a[3],a}])},function(a){return a=[d[60],d[61],d[62],d[63]],d[56]=a[0],d[57]=a[1],d[58]=a[2],d[59]=a[3],a}])},function(a){return a=[d[56],d[57],d[58],d[59]],d[52]=a[0],d[53]=a[1],d[54]=a[2],d[55]=a[3],a}])},function(a){return a=[d[52],d[53],d[54],d[55]],d[48]=a[0],d[49]=a[1],d[50]=a[2],d[51]=a[3],a}])},function(a){return a=[d[48],d[49],d[50],d[51]],d[44]=a[0],d[45]=a[1],d[46]=a[2],d[47]=a[3],a}])},function(a){return a=[d[44],d[45],d[46],d[47]],d[40]=a[0],d[41]=a[1],d[42]=a[2],d[43]=a[3],a}])},function(a){return a=[d[40],d[41],d[42],d[43]],d[36]=a[0],d[37]=a[1],d[38]=a[2],d[39]=a[3],a}])},function(a){return a=[d[36],d[37],d[38],d[39]],d[32]=a[0],d[33]=a[1],d[34]=a[2],d[35]=a[3],a}])},function(a){return a=[d[32],d[33],d[34],d[35]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}])},function(a){return a=[d[28],d[29],d[30],d[31]],d[24]=a[0],d[25]=a[1],d[26]=a[2],d[27]=a[3],a}])},function(a){return a=[d[24],d[25],d[26],d[27]],d[20]=a[0],d[21]=a[1],d[22]=a[2],d[23]=a[3],a}])},function(a){return a=[d[20],d[21],d[22],d[23]],d[16]=a[0],d[17]=a[1],d[18]=a[2],d[19]=a[3],a}])},function(a){return a=[d[16],d[17],d[18],d[19]],d[12]=a[0],d[13]=a[1],d[14]=a[2],d[15]=a[3],a}])},function(a){return a=[d[12],d[13],d[14],d[15]],d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a}])},function(a){return a=[d[8],d[9],d[10],d[11]],d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],a}])},function(e){return a[3]?c.sequence([function(a){return d[9]="60009"===d[1]||"60006"===d[1]||"60008"===d[1]||"60011"===d[1]||"765"===d[1]||"1006"===d[1]||"160009"===d[1]||"761"===d[1]||"1018"===d[1]||"632"===d[1]||"384"===d[1]||"384"===d[1],d[9]?d[1]!==void 0?(d[15]=["Deidentified task is being executed through the 'identified' path. Canceling task with label: ",d[1]].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSCoreSerializeTaskStoredProcedure] ","",d[15]].join("")),d[14]=c.createArray(),void 0!==void 0?d[16]=(d[14].push(void 0),d[14]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSCoreSerializeTaskStoredProcedure",d[15],d[14],c.i64.cast([0,3]))):c.resolve():c.resolve()},function(a){return c.resolve(d[8]=!1)},function(a){return d[9]||d[8]?(a=[void 0,void 0,void 0,void 0],d[10]=a[0],d[11]=a[1],d[12]=a[2],d[13]=a[3],a):(a=[d[0],d[1],d[2],d[3]],d[10]=a[0],d[11]=a[1],d[12]=a[2],d[13]=a[3],a),a=[d[10],d[11],d[12],d[13]],d[4]=a[0],d[5]=a[1],d[6]=a[2],d[7]=a[3],a}]):c.sequence([function(e){return c.storedProcedure(b("LSTaskSerializerUnauthenticatedTask"),a[0],d[1],d[0]).then(function(a){return a=a,d[8]=a[0],d[9]=a[1],d[10]=a[2],d[11]=a[3],a})},function(a){return c.i64.neq(d[11],void 0)?c.storedProcedure(b("LSForceTaskExecutionImmediately"),d[11]):c.resolve()},function(a){return a=[d[8],c.i64.to_string(d[9]),void 0,d[10]],d[4]=a[0],d[5]=a[1],d[6]=a[2],d[7]=a[3],a}])},function(a){return a=[d[4],d[5],d[6],d[7]],e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSCoreSerializeTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSSerializeTaskStoredProcedure",["LSSerializeTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSerializeTask"),e.taskId,e.taskLabel,e.taskValue,e.requiresAuthentication);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSBeginHandlingPendingTasksForQueue2",["I64","LSFactory","LSIntEnum","LSPendingTasksPluginType","LSSerializeTaskStoredProcedure","LSShape","LSVec","Promise","ReQL","XPlatReactCrypto","asyncToGeneratorRuntime","gkx","isNativeTask","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=500,l=3e4,m=5,n=(e=c("qex")._("4835"))!=null?e:50,o=7;function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.lightspeed_task_context.get(b));return a==null||a.requiresAuthentication});return q.apply(this,arguments)}function r(a,b){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b)));return a==null?{context:void 0,failureCount:(i||(i=d("I64"))).neg_one,httpUrlOverride:void 0,minTimeToSyncTimestampMs:i.neg_one,pluginType:(j||(j=d("LSIntEnum"))).ofNumber(c("LSPendingTasksPluginType").LS_BROKER),queueName:""}:a});return s.apply(this,arguments)}function t(a,b){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange(b)));return a==null?0:(i||(i=d("I64"))).to_float(a.lastSyncRequestTimestampMs)});return u.apply(this,arguments)}function v(a,b,c){b=(i||(i=d("I64"))).equal(a.failureCount,(i||(i=d("I64"))).zero)||b;if(b)return 0;b=(i||(i=d("I64"))).to_float(a.failureCount)>o?(i||(i=d("I64"))).to_float(a.failureCount)-o:(i||(i=d("I64"))).to_float(a.failureCount);a=Math.min((1<<Math.min(b-1,o))*k,l);b=c+a;return Math.max(b-Date.now(),0)}function w(){var a=Array.from(d("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));a[0]>>>=1;return(i||(i=d("I64"))).add(i.lsl_(i.of_float(a[0]),32),i.of_float(a[1]))}function x(){var a=(i||(i=d("I64"))).of_float(Date.now());return i.and_(i.or_(i.lsl_(a,22),i.and_(w(),i.castExn([0,4194303]))),i.castExn([2147483647,4294967295]))}function y(a,b){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=x(),e=(yield a.network_requests.get(b,(i||(i=d("I64"))).neg_one));e==null?yield a.network_requests.add({epochId:c,failureCount:(i||(i=d("I64"))).zero,lastSentTimestampMs:i.zero,lastSyncRequestTimestampMs:i.of_float(Date.now()),syncDatabaseId:i.neg_one,taskQueueName:b}):yield a.network_requests.put(babelHelpers["extends"]({},e,{epochId:c,lastSyncRequestTimestampMs:(i||(i=d("I64"))).of_float(Date.now())}));return c});return z.apply(this,arguments)}function A(a,b){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){return(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.network_requests).getKeyRange(b).filter(function(a){return a.epochId!=null})))!=null});return B.apply(this,arguments)}function C(a,b,c){var e=(i||(i=d("I64"))).to_float(a.minTimeToSyncTimestampMs),f=Date.now();e=e-f;f=e<=0;return f?v(a,b,c):e}function D(a){return a.httpUrlOverride!=null||(i||(i=d("I64"))).to_float(a.failureCount)>o}function E(a){return a.timeoutTimestampMs!=null?(i||(i=d("I64"))).to_float(a.timeoutTimestampMs)<=Date.now():!1}function F(a){return a===90..toString()||a===130..toString()||a===153..toString()}function G(a,b,c,d,e){e=e===0?void 0:e;return{failureCount:e,label:a,payload:b,queueName:c,taskId:d}}function H(a,b,c){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){a=(yield c("LSSerializeTaskStoredProcedure")(c("LSFactory")(a),{requiresAuthentication:e,taskId:b.taskId,taskLabel:b.context,taskValue:b.taskValue}));e=a[0];var f=a[1];a[2];a=a[3];if(e==null){if(a!=null)return{minRetryDelayMs:a};return}return G(f,e,b.queueName,b.taskId,(i||(i=d("I64"))).to_float(b.failureCount))});return I.apply(this,arguments)}function J(a,b,c){return K.apply(this,arguments)}function K(){K=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(b.context==null){yield a.pending_tasks["delete"](b.taskId);return}var d=E(b);if(d){yield a.pending_tasks["delete"](b.taskId);return}return H(a,b,c)});return K.apply(this,arguments)}function L(a,b){b=b>=(c("gkx")("26373")&&a===String(207)?n:m)||F(a);return!b}function M(a,b){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield a.pending_tasks.get(b.taskId));c!=null&&(i||(i=d("I64"))).equal(b.firstExecutedTimestampMs,(i||(i=d("I64"))).zero)&&(yield a.pending_tasks.put(babelHelpers["extends"]({},c,{firstExecutedTimestampMs:(i||(i=d("I64"))).of_float(Date.now())})))});return N.apply(this,arguments)}function O(a,b){return P.apply(this,arguments)}function P(){P=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){if(c.length===0)return{epochId:void 0,tasks:[]};var e=[],f=c[0].httpUrlOverride,g=(yield (h||(h=b("Promise"))).all(c.map(function(b){return p(a,b.taskId)}))).some(Boolean);for(c of c){var j=c.httpUrlOverride===f,k=(yield p(a,c.taskId))===g;yield M(a,c);if(!j||!k)break;j=(yield J(a,c,g));if(j!=null&&j.payload!=null)e.push(j);else if((j==null?void 0:j.minRetryDelayMs)!=null){k=(yield a.pending_tasks.get(c.taskId));if(k!=null){yield a.pending_tasks.put(babelHelpers["extends"]({},k,{failureCount:(i||(i=d("I64"))).add((k=k.failureCount)!=null?k:(i||(i=d("I64"))).zero,i.one),minTimeToSyncTimestampMs:i.add(j.minRetryDelayMs,i.of_float(Date.now()))}))}}else yield a.pending_tasks["delete"](c.taskId);if(!L(c.context,e.length))break}return{epochId:void 0,tasks:e}});return P.apply(this,arguments)}function Q(a,b,c,d,e){return R.apply(this,arguments)}function R(){R=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d,e){e===void 0&&(e=!0);b=(yield O(a,b));var f=b.tasks;if(f.length===0)return{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:c,skipRealtimeGateway:!1,workItemType:4};if(e===!0){f=(yield y(a,c));b.epochId=f}e=(yield r(a,c));return{httpUrlOverride:e.httpUrlOverride,networkPayload:b,nextSyncMs:void 0,queueName:c,skipRealtimeGateway:D(e),workItemType:d}});return R.apply(this,arguments)}function S(a,b,c){return T.apply(this,arguments)}function T(){T=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield r(a,b)),g=(yield t(a,b));f=C(f,e,g);e=f!==0;if(e)return[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:f,queueName:b,skipRealtimeGateway:!1,workItemType:3}];g=[];e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b)));f=e.filter(c("isNativeTask"));if(f.length>0){f=(yield Q(a,f,b,2,c("gkx")("4778")===!0));g.push(f)}f=e.filter(function(a){return!c("isNativeTask")(a)});if(f.length>0){e=(yield Q(a,f,b,1));g.push(e)}return g});return T.apply(this,arguments)}function U(a,b,c){return V.apply(this,arguments)}function V(){V=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var d=!(yield A(a,b));return d?S(a,b,c):[{httpUrlOverride:void 0,networkPayload:void 0,nextSyncMs:void 0,queueName:b,skipRealtimeGateway:!1,workItemType:4}]});return V.apply(this,arguments)}function a(a,b){return W.apply(this,arguments)}function W(){W=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=b.ignoreSoftDelay;b=b.queueName;a=(yield U(a,b,e));return a.map(function(a){var b;return d("LSShape").ofRecord({network_payload:d("LSShape").ofRecord({epoch_id:(b=a.networkPayload)==null?void 0:b.epochId,tasks:c("LSVec").ofArray(((b=(b=a.networkPayload)==null?void 0:b.tasks)!=null?b:[]).map(function(a){var b;return d("LSShape").ofRecord({failure_count:a.failureCount!=null?(i||(i=d("I64"))).of_float(a.failureCount):void 0,label:(b=a.label)!=null?b:void 0,payload:a.payload,queue_name:a.queueName,task_id:a.taskId})}))}),next_sync_ms:a.nextSyncMs!=null?(i||(i=d("I64"))).of_float(a.nextSyncMs):void 0,queue_name:a.queueName,skip_realtime_gateway:a.skipRealtimeGateway,work_item_type:(j||(j=d("LSIntEnum"))).ofNumber(a.workItemType)})})});return W.apply(this,arguments)}a._updateTaskIfNeeded=M;a._getHeadOfNormalQueue=r;a._lastSyncRequestTimestampForQueue=t;a._exponentialBackoffForNormalQueue=v;a._generateNewEpoch=x;a._openNewEpochForQueue=y;a._isEpochOpenForQueue=A;a._calculateDelayForNormalQueue=C;a._queueShouldSkipRealtimeGateway=D;a._isNativeTask=c("isNativeTask");a._taskIsTimedOut=E;a._taskShouldStopBatching=F;a._buildTaskPayloadExpressionForNormalTaskWithParameters=G;a._buildTaskPayloadExpressionForValidatedNormalTask=H;a._buildTaskPayloadExpressionForUnvalidatedNormalTask=J;a._workForNormalQueueWithoutDelay=Q;a._workForNormalQueueWithClosedEpoch=S;a._buildWorkForNormalQueue=U;a._buildNetworkPayloadShapeForTasks=O;a._canContinueBatchingForQueue=L;g["default"]=a}),98);
__d("LSCookie",["$InternalEnum","Cookie","CookieCore","CurrentEnvironment","CurrentMessengerUser","FBLogger","I64","LSE2EEMetadataSyncGroupUtils","LSIntEnum","MessengerLogHistory","MqttWebDeviceID","ReQL","SortedAsyncIterable","isPromise","isStringNullOrEmpty","pageID","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=b("$InternalEnum")({SYNCING:"1",NOT_SYNCING:"0"}),l=d("MessengerLogHistory").getInstance("client_init"),m=c("CurrentEnvironment").instagramdotcom?"igd_ls":"m_ls",n={c:{},d:c("MqttWebDeviceID").clientID,s:k.NOT_SYNCING,u:c("pageID")};function o(a){function b(a){d("CookieCore").setWithDomain_FOR_MESSENGER_LS_ONLY(m,JSON.stringify(a),window.location.hostname)}var e=c("Cookie").get(m);if(e==null){var f;b((f={},f[d("CurrentMessengerUser").getIDorEIMU()]=a,f));return}f=JSON.parse(e);if(f.u==null){b(babelHelpers["extends"]({},f,(e={},e[d("CurrentMessengerUser").getIDorEIMU()]=a,e)))}else{b((f={},f[d("CurrentMessengerUser").getIDorEIMU()]=a,f))}}function a(){c("Cookie").clear(m)}function p(a){if(typeof a!=="object")return null;if(a==null)return null;var b=a.c,c=a.d,d=a.s;a=a.u;d=typeof d==="string"?k.cast(d):null;b=typeof b==="object"&&b!=null?Object.entries(b).reduce(function(a,b){var c=b[0];b=b[1];if(a==null||typeof b!=="string")return null;a[c]=b;return a},{}):null;if(typeof c!=="string")return null;if(d==null)return null;if(b==null)return null;return typeof a!=="string"?null:{c:b,d:c,s:d,u:a}}function q(){var a=c("Cookie").get(m);if(c("isStringNullOrEmpty")(a))return n;a=JSON.parse(a);var b=d("CurrentMessengerUser").getIDorEIMU(),e=p(a);a=typeof a==="object"&&a!=null?p(a[b]):null;return(b=a!=null?a:e)!=null?b:n}function r(a){var b=q();if(b.u!==c("pageID"))return;var e={};a.forEach(function(a){a[0];a=a[1];var b=a.currentCursor;a=a.groupId;b!=null&&(e[(i||(i=d("I64"))).to_string(a)]=b)});l.debug("Updated sync cookie to set syncing=false, saving latest cursors");o(babelHelpers["extends"]({},b,{c:e,s:k.NOT_SYNCING}))}var s=[1,2,d("LSE2EEMetadataSyncGroupUtils").shouldAlwaysResetE2EEMetadata()?null:95];function e(a){var b=d("SortedAsyncIterable").toArray(d("ReQL").union.apply(void 0,s.map(function(b){return b==null?d("ReQL").empty():d("ReQL").fromTableAscending(a.tables.sync_groups).getKeyRange((j||(j=d("LSIntEnum"))).ofNumber(b))})));if((h||(h=c("isPromise")))(b)){c("promiseDone")(b.then(function(a){r(a)}));return}r(b)}function f(){try{var a=q();l.debug("Updated sync cookie to set syncing=true");o(babelHelpers["extends"]({},a,{s:k.SYNCING,u:c("pageID")}))}catch(a){c("FBLogger")("messenger_web").catching(a).warn("[LS] Failed to sync cookie")}}g.Status=k;g.DEFAULT_COOKIE=n;g.clear=a;g.get=q;g.syncBeforeUnload=e;g.setSyncing=f}),98);
__d("LSDataTraceFlushDeferred",["MetaConfig","Promise","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("LSDataTraceFlush").__setRef("LSDataTraceFlushDeferred");function a(a){if(!c("MetaConfig")._("62"))return(h||(h=b("Promise"))).resolve(function(){});else return i.load().then(function(b){return b.flushExpiredDataTraces(a)})}g.watchForExpiredTraces=a}),98);
__d("LSDatabaseProviderType",[],(function(a,b,c,d,e,f){"use strict";function a(a){return g(a.persistenceTypes)}function g(a){return a.includes("indexeddb")}f.isProviderPersisted=a;f.hasPersistentType=g}),66);
__d("LSDatascriptEvaluatorDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("LSDatascriptEvaluator").__setRef("LSDatascriptEvaluatorDeferred");function a(){return h.load()}g["default"]=a}),98);
__d("LSDatascriptEvaluatorMaybeDeferred",["cr:21308","cr:582"],(function(a,b,c,d,e,f,g){"use strict";c=(a=b("cr:21308"))!=null?a:b("cr:582");d=c;g["default"]=d}),98);
__d("LSTruncateTableAndSetShowError",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(a){return b.forEach(b.db.table(115).fetch(),function(a){return a["delete"]()})},function(d){return c[0]=b.i64.of_float(Date.now()),b.db.table(115).add({statusId:b.i64.cast([0,0]),timestampMs:c[0],errorShouldBeShown:a[0]})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSConnectivityTruncateTableAndSetShowErrorStoredProcedure";a.__tables__=["user_visible_network_connectivity_error"];e.exports=a}),null);
__d("LSDeleteAllAndInsertConnectivityStatus",["LSTruncateTableAndSetShowError"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.forEach(c.db.table(114).fetch(),function(a){return a["delete"]()})},function(b){return d[0]=c.i64.of_float(Date.now()),c.db.table(114).add({statusId:void 0,timestampMs:d[0],internetConnectionState:a[0]})},function(d){return c.storedProcedure(b("LSTruncateTableAndSetShowError"),c.i64.neq(a[0],c.i64.cast([0,1])))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSConnectivityDeleteAllAndInsertConnectivityStatusStoredProcedure";a.__tables__=["connectivity_status"];e.exports=a}),null);
__d("LSDeleteAllAndInsertConnectivityStatusStoredProcedure",["LSDeleteAllAndInsertConnectivityStatus","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeleteAllAndInsertConnectivityStatus"),e.internetConnectionState);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSyncStoredProcedureUtils",["I64","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){c=c!=null?(h||(h=d("I64"))).of_float(Date.now()+c):b.minTimeToSyncTimestampMs;yield a.pending_tasks.put(babelHelpers["extends"]({},b,{failureCount:(h||(h=d("I64"))).add(b.failureCount,h.one),minTimeToSyncTimestampMs:c}))});return j.apply(this,arguments)}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.pending_tasks.index("queueNameTaskId")).getKeyRange(b)));if(b==null)return;return i(a,b,c)});return k.apply(this,arguments)}function c(a,b,c){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=(yield a.network_requests.get(b,c));if(b==null)return;yield a.network_requests.put(babelHelpers["extends"]({},b,{failureCount:(h||(h=d("I64"))).add(b==null?void 0:b.failureCount,h.one)}))});return l.apply(this,arguments)}function e(a,b,c){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){b=(yield a.network_requests.get(b,c));if(b==null)return;yield a.network_requests.put(babelHelpers["extends"]({},b,{epochId:void 0,networkTaskIdentifier:void 0}))});return m.apply(this,arguments)}g.incrementPendingTaskFailureCount=i;g.incrementPendingTasksTaskFailureCount=a;g.incrementNetworkRequestsTaskFailureCount=c;g.closeEpoch=e}),98);
__d("LSHandleTaskSendFailureForQueue2",["I64","LSSyncStoredProcedureUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){yield d("LSSyncStoredProcedureUtils").incrementPendingTasksTaskFailureCount(a,b,c),yield d("LSSyncStoredProcedureUtils").incrementNetworkRequestsTaskFailureCount(a,b,(h||(h=d("I64"))).neg_one),yield d("LSSyncStoredProcedureUtils").closeEpoch(a,b,h.neg_one)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("LSHandleTaskSendSuccessForQueue2",["I64","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield a.network_requests.get(b,(h||(h=d("I64"))).neg_one));if(c==null||c.epochId==null)return;yield a.network_requests["delete"](b,h.neg_one)});return i.apply(this,arguments)}g["default"]=a}),98);
__d("LSPlatformDefaultUnderlyingApi",["Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return c("emptyFunction")}function d(){return(h||(h=b("Promise"))).resolve()}e={cleanup:c("emptyFunction"),logEvent:function(a){},onConnectionStatusChange:a,onReconnect:a,publish:d,subscribe:a};g["default"]=e}),98);
__d("LSPlatformDeviceId",["ChannelClientID","FBLogger","LSCookie","MqttWebDeviceID","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){if(c("gkx")("21118"))return c("MqttWebDeviceID").clientID;else return c("ChannelClientID").getID()}b=h();function a(a){a==null&&c("FBLogger")("messenger_web").info("Missed provider type for deviceId");return a==="persisted"?d("LSCookie").get().d:h()}g.deviceId=b;g.getDeviceIdForProviderType=a}),98);
__d("MessengerPWAVersionForUserAgent",["isMessengerPWA","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){if(!c("justknobx")._("3005"))return void 0;var a=c("isMessengerPWA")();if(!a)return void 0;a=(a=new URL(window.location.href).searchParams.get("__pwa"))!=null?a:"1.0.0";return a}g["default"]=a}),98);
__d("LSPlatformRealtimeTransport",["I64","LSDynamicDependencies","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSShape","MessengerPWAVersionForUserAgent","Promise","clearTimeout","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;e="LSPlatformRealtimeTransport.NotConnected";var k="LSPlatformRealtimeTransport.Timeout";function l(a){var b=new Map();return{getAll:function(){return Array.from(b.values())},getOrStart:function(c){var d=c.toString(),e=b.get(d);e==null&&(e=a(c),b.set(d,e));return e}}}function m(){}function a(a,e,f){var g=new Map(),n={contents:m},o=new Set(),p=new Map(),q=[],r=l(function(b){b=a(b,f);q.push(b.subscribe(function(a){var b=JSON.parse(a),e=d("LSDynamicDependencies").downloadBootloaderDependencies(b.sp,b.nop,b.ntop);a=b.request_id;var f;if(a!=null){var h=g.get(a);h==null?f=!1:(c("clearTimeout")(h.timeoutId),h.resolve({downloadTask:e,payload:b,type:"taskresponse"}),g["delete"](a),f=!0)}else f=!1;if(!f){Array.from(p.entries()).forEach(function(a){return a[1](e,b)});return}}));q.push(b.onReconnect(function(){return n.contents()}));q.push(b.onConnectionStatusChange(function(a){o.forEach(function(b){return b(a)})}));return b});r.getOrStart((j||(j=d("LSIntEnum"))).unwrapIntEnum(d("LSMailboxInitialSyncCursor").syncChannel));return{cleanup:function(){q.forEach(function(a){return a()}),r.getAll().forEach(function(a){return a.cleanup()})},logEvent:function(a){r.getAll().forEach(function(b){return b.logEvent(a)})},onConnectionStatusChange:function(a){o.add(a);return function(){o["delete"](a)}},onReconnect:function(a){n.contents=a;return function(){n.contents=m}},publish:function(a){var f=a.databaseType,l=a.payload,m=a.queueName,n=a.requestId,o=a.syncChannel,p=a.type_;return new(h||(h=b("Promise")))(function(a,b){var h=r.getOrStart((j||(j=d("LSIntEnum"))).unwrapIntEnum(o));if((i||(i=d("I64"))).equal(p,(j||(j=d("LSIntEnum"))).ofNumber(3))){var q=c("setTimeout")(function(){h.logEvent("Timeout");var a=g.get(n);a!=null&&(g["delete"](n),a.reject({RE_EXN_ID:k}));return b({RE_EXN_ID:k})},3e4);g.set(n,{queueName:m,reject:b,resolve:a,timeoutId:q,timestamp:Date.now()})}q=c("MessengerPWAVersionForUserAgent")();c("promiseDone")(h.publish(d("LSJson").stringify(d("LSShape").ofRecord(babelHelpers["extends"]({app_id:e,payload:l},q!=null?{pwa_version:q}:{},{request_id:n,type:p}))),p,f),function(){if(!(i||(i=d("I64"))).equal(p,(j||(j=d("LSIntEnum"))).ofNumber(3)))return a({type:"noresponseexpected"})},function(a){b(a)})})},subscribeToNonTaskResponses:function(a){var b={};p.set(b,a);return function(){p["delete"](b)}}}}g.NotConnected=e;g.Timeout=k;g.LSPlatformRealtimeTransport=a}),98);
__d("shouldStubUnderlyingTransport",["ExecutionEnvironment"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return!(h||(h=c("ExecutionEnvironment"))).canUseDOM&&!(h||(h=c("ExecutionEnvironment"))).isInWorker}g["default"]=a}),98);
__d("LSPlatformMqttRealtimeTransport",["I64","LSIntEnum","LSPlatformDefaultUnderlyingApi","LSPlatformRealtimeTransport","Promise","promiseDone","shouldStubUnderlyingTransport"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a){return[{payload:JSON.stringify({ls_fdid:"",ls_sv:a}),qos:1,topic:"/ls_app_settings"}]}function l(a){var e={contents:a.getConnectionState()},f={contents:function(){}},g={contents:new(j||(j=b("Promise")))(function(a,b){f.contents=a})},k={onMQTTStateChanged:function(a){a==="Connected"?f.contents():a==="Disconnected"&&e.contents==="Connected"&&(g.contents=new(j||(j=b("Promise")))(function(a,b){f.contents=a})),e.contents=a}};e.contents==="Connected"&&f.contents();a.subscribeChannelEvents(k);return[function(){a.unsubscribeChannelEvents(k)},function(e,f,k){return g.contents.then(function(){return new(j||(j=b("Promise")))(function(b,g){c("promiseDone")(a.publish("/ls_req",e,{listener:{onEvent:function(a){if(a==="NOT_CONNECTED")return g({RE_EXN_ID:d("LSPlatformRealtimeTransport").NotConnected})}},qos:(h||(h=d("I64"))).equal(f,(i||(i=d("LSIntEnum"))).ofNumber(4))?0:1,skipBuffer:!1}),function(){return b()},function(a){if(a.message==="Publish Timed Out")return g({RE_EXN_ID:d("LSPlatformRealtimeTransport").Timeout});else return g(a)})})})}]}var m={contents:void 0};function a(a,b,d){if(c("shouldStubUnderlyingTransport")())return c("LSPlatformDefaultUnderlyingApi");var e=d.getInstance(b),f={getPublishMessages:function(){return k(a)}};e.registerExtraConnectPayloadProvider(f);var g={onMQTTStateChanged:function(a){var b=m.contents;if(b!=null)return b(a)}};e.subscribeChannelEvents(g);var h=e.subscribe("/ls_foreground_state",function(){});b=l(e);var i=b[0];b=b[1];return{cleanup:function(){e.unregisterExtraConnectPayloadProvider(f),d.shutdownAndClear(),e.unsubscribeChannelEvents(g),h(),i()},logEvent:function(a){},onConnectionStatusChange:function(a){m.contents=a;return function(){m.contents=void 0}},onReconnect:function(a){var b={contents:e.getConnectionState()},c={contents:b.contents==="Connected"},d={onMQTTStateChanged:function(d){d==="Connected"&&(c.contents&&b.contents!=="Connected"&&a(),c.contents=!0),b.contents=d}};e.subscribeChannelEvents(d);return function(){e.unsubscribeChannelEvents(d)}},publish:b,subscribe:function(a){return e.subscribe("/ls_resp",function(b){return a(b)})}}}g["default"]=a}),98);
__d("LSPlatformRequestId",[],(function(a,b,c,d,e,f){"use strict";var g=4;function a(){var a=g;g+=1;return a}b={generate:a};f["default"]=b}),66);
__d("LSPlatformRequestScheduler",["clearTimeout","justknobx","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h=Math.pow(2,31)-1;a=function(){function a(){this.requests=new Map()}var b=a.prototype;b.schedule=function(a,b,d){var e=this.requests.get(b);e!=null&&c("clearTimeout")(e);e=c("justknobx")._("4435")?Math.min(d,h):d;this.requests.set(b,c("setTimeout")(a,e))};b.cleanup=function(){this.requests.forEach(function(a){return c("clearTimeout")(a)})};return a}();g["default"]=a}),98);
__d("LSPlatformServerResponseHandler",["FBLogger","Promise","asyncToGeneratorRuntime","clearTimeout","nullthrows","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i="executeFirstBlockForSyncTransaction";a=function(){function a(a){this.eval=a,this.currentlyRunning=new Map()}var d=a.prototype;d.evalWhenReady=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d;try{yield a,d=c("setTimeout")(function(){c("FBLogger")("messenger_web").mustfix("waited longer than 30 seconds to eval sync script")},3e4),yield this.eval(b)}finally{c("clearTimeout")(d)}});function d(b,c){return a.apply(this,arguments)}return d}();d.$1=function(a){var c=this.currentlyRunning.get(a);c==null&&(c=(h||(h=b("Promise"))).resolve(),this.currentlyRunning.set(a,c));return c};a.getSyncScriptType=function(a){var b;if(!((b=a.sp)==null?void 0:b.includes(i)))return{status:"non-transactional"};b=function(){try{var b;return(b=JSON.parse(a.syncScript))==null?void 0:b.step}catch(a){return null}}();if(!Array.isArray(b)){c("FBLogger")("messenger_web").warn("Sync payload appears invalid.");return{status:"non-transactional"}}b=[b];while(b.length){var d=c("nullthrows")(b.shift());for(d of d)if(Array.isArray(d)){if(d[0]===5&&d[1]===i&&Array.isArray(d[2]))return{status:"transactional",syncGroup:parseInt(d[2][1],10)};b.push(d)}}return{status:"err"}};d.maybeEvalInOrderReceived=function(b,d){var e,f=this,g=a.getSyncScriptType(d),h=0;switch(g.status){case"err":c("FBLogger")("messenger_web").warn("Sync script sync group parsing failed: employed sprocs were %s",JSON.stringify((e=d.sp)!=null?e:void 0));break;case"non-transactional":return this.evalWhenReady(b,d);case"transactional":h=g.syncGroup;break}e=this.$1(h);g=e.then(function(){return f.evalWhenReady(b,babelHelpers["extends"]({},d,{priority:"sync_script"}))})["catch"](function(a){f.currentlyRunning["delete"](h);throw a});this.currentlyRunning.set(h,g);return g};return a}();g["default"]=a}),98);
__d("LSPlatformTaskSyncGroupId",[],(function(a,b,c,d,e,f){"use strict";a=-1;b=a;f["default"]=b}),66);
__d("MWPBeginHandlingPendingTasksForQueue",["LSBeginHandlingFireForgetTasksForQueueStoredProcedure","LSBeginHandlingPendingTasksForQueue2","LSFactory","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){var e=d.fireAndForgetTask,g=d.ignoreSoftDelay,h=d.queueName;d=(yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(e===!0){var b=(yield c("LSBeginHandlingFireForgetTasksForQueueStoredProcedure")(c("LSFactory")(a),{queueName:h}));b=b[0];return[b]}return c("LSBeginHandlingPendingTasksForQueue2")(a,{ignoreSoftDelay:g,queueName:h})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":37"));return d});return h.apply(this,arguments)}g["default"]=a}),98);
__d("MWPlatformTaskUtils",["FBLogger","I64","JSScheduler","MetaConfig","Promise","ReQL","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,e){function f(){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield a(e)}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to calculate work for task queue %s",e.queueName)}});return g.apply(this,arguments)}if((j||(j=d("I64"))).gt(e.priority,(j||(j=d("I64"))).zero)&&c("MetaConfig")._("78")){var h=function(){f()};(i||(i=c("JSScheduler"))).scheduleLoggingPriCallback(h)}else c("promiseDone")(f())}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){try{yield a(b)}catch(a){c("FBLogger")("messenger_web").catching(a).warn("Failed to calculate work for fire forget queue %s",b.queueName)}});return m.apply(this,arguments)}function a(a,c){var e=new Set(),f=[],g=[];g.push(a.tables.pending_tasks.index("queueNameTaskId").subscribe(function(a,b){var c;if(b.operation==="delete"){e.add(a[0]);return}a=b.operation==="put"&&b.prevValue==null||b.operation==="add";c=b.operation==="put"&&(j||(j=d("I64"))).compare(b.value.failureCount,(c=(c=b.prevValue)==null?void 0:c.failureCount)!=null?c:(j||(j=d("I64"))).zero)>0;(a||c)&&e.add(b.value.queueName);(b.operation==="add"&&b.value.dataTraceId==null||b.value.dataTraceId==="")&&f.push(b.value)}));g.push(a.tables.network_requests.subscribe(function(a,b){a=a[0];if(a==="")return;b.operation==="delete"?e.add(a):b.value.epochId==null&&e.add(a)}));g.push(a.subscribeToCommit(function(){var g=Array.from(e);e.clear();f=[];g.forEach(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.pending_tasks.index("queueNameTaskId")).bounds({gte:[b]})));b!=null&&k(c,b)});return function(a){return e.apply(this,arguments)}}())}));return g}function e(a,e){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.pending_tasks))),c=new Set();for(b of b){if(c.has(b.queueName))continue;c.add(b.queueName);k(e,b)}})())}function n(a,e){c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var g=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.tables.pending_fire_and_forget_tasks)));yield (h||(h=b("Promise"))).all(g.map(function(a){return l(e,a)}));c("promiseDone")(a.runInTransaction(function(a){return(h||(h=b("Promise"))).all(g.map(function(b){return a.pending_fire_and_forget_tasks["delete"](b.taskId)}))},"readwrite","background",void 0,f.id+":196"))})())}function o(a,b){var c=!1,d=[];d.push(a.tables.pending_fire_and_forget_tasks.subscribe(function(a,b){if(b.operation==="delete")return;a=b.operation==="put"&&b.prevValue==null||b.operation==="add";a&&(c=!0)}));d.push(a.subscribeToCommit(function(){c&&n(a,b),c=!1}));return d}g.checkQueuesWhenPendingTaskTableUpdates=a;g.checkAllPendingTasksForWork=e;g.checkAllFireForgetTasksForWork=n;g.checkQueuesWhenPendingFireForgetTaskTableUpdates=o}),98);
__d("LSPlatformTaskSystemTransport",["CurrentMessengerUser","FBLogger","I64","JSResourceForInteraction","JSScheduler","LSDatabaseProviderType","LSHandleTaskSendFailureForQueue2","LSHandleTaskSendSuccessForQueue2","LSIntEnum","LSJson","LSMailboxInitialSyncCursor","LSPlatformRealtimeTransport","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSPlatformTaskSyncGroupId","LSShape","LSVec","MWPBeginHandlingPendingTasksForQueue","MWPBumpEntityKey","MWPlatformTaskUtils","Promise","ReQL","asyncToGeneratorRuntime","cr:4031","cr:6668","gkx","isInstamadillo","justknobx","promiseDone","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=500,m=c("JSResourceForInteraction")("publishLSPlatformDeidentifiedPayload").__setRef("LSPlatformTaskSystemTransport"),n=new Set([632,765,60011,1006,1018].map(function(a){return a.toString()}));a=function(){function a(a,e,f,g){var h=this;this.key="ls";this.$8=!1;this.$18=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield c("MWPBeginHandlingPendingTasksForQueue")(h.$1,{ignoreSoftDelay:b,queueName:a}));for(a of b)yield h.$17(d("LSShape").toRecord(a))});return function(b,c){return a.apply(this,arguments)}}();this.$1=a;this.$2=e;this.$3=f;this.$4=g;this.$8=d("LSDatabaseProviderType").isProviderPersisted(a);this.$5=new(c("LSPlatformRequestScheduler"))();this.$6=new(c("LSPlatformServerResponseHandler"))(f);this.$7=this.$9();this.$10()}var e=a.prototype;e.$11=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(!(c("justknobx")._("3637")||c("isInstamadillo")())){var d=(yield this.$2.publish(b));return d}d=a.filter(function(a){return a.label!=null&&n.has(a.label)});if(d.length<a.length){d.length>0&&c("FBLogger")("maw_ohai").mustfix("Deidentifed tasks label %s sent together with normal tasks",d[0].label);a=(yield this.$2.publish(b));return a}a=d[0];d=(yield m.load());d=(yield d(babelHelpers["extends"]({},b,{taskLabel:a.label})));return d});function d(b,c){return a.apply(this,arguments)}return d}();e.$12=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield this.$1.runInTransaction(function(b){return c("LSHandleTaskSendFailureForQueue2")(b,a)},"readwrite",void 0,void 0,f.id+":157")});function d(b){return a.apply(this,arguments)}return d}();e.$13=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield this.$1.runInTransaction(function(b){return c("LSHandleTaskSendSuccessForQueue2")(b,a)},"readwrite","background",void 0,f.id+":166")});function d(b){return a.apply(this,arguments)}return d}();e.$14=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=c("LSVec").toArray(a.tasks).slice(0).map(function(a){return d("LSShape").toRecord(a)});a=a[0];if(a==null)return;a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(this.$1.tables.pending_tasks).getKeyRange(a.task_id)));return a==null?void 0:a.dataTraceId});function e(b){return a.apply(this,arguments)}return e}();e.$15=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=this;if(a.network_payload==null)return;var g=d("LSShape").toRecord(a.network_payload);(k||(k=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return g&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(g.tasks))});var i=this.$4;try{yield (j||(j=b("Promise"))).all(c("LSVec").toArray(g.tasks).map(function(a){return d("LSShape").toRecord(a)}).map(function(b){var g=c("LSPlatformRequestId").generate();return f.$11([b],{databaseType:c("LSPlatformTaskSyncGroupId"),payload:d("LSJson").stringify(d("LSShape").ofRecord({label:b.label,payload:b.payload,version:i})),queueName:a.queue_name,requestId:g,syncChannel:d("LSMailboxInitialSyncCursor").taskChannel,type_:(h||(h=d("I64"))).of_int32(e)})}))}catch(a){}});function e(b,c){return a.apply(this,arguments)}return e}();e.$16=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){if(a.network_payload==null)return;var f=d("LSShape").toRecord(a.network_payload),g=c("LSVec").toArray(f.tasks).map(function(a){return d("LSShape").toRecord(a)}),j=(yield this.$14(f));(k||(k=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSending(f.tasks))});var l=c("LSPlatformRequestId").generate(),m,n=c("qex")._("789");if(n!=null&&n!=="default"){var o=n+"."+(i||(i=d("LSIntEnum"))).toNumber(d("LSMailboxInitialSyncCursor").taskChannel)+"."+e.toString();d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o)}try{m=(yield this.$11(g,{databaseType:c("LSPlatformTaskSyncGroupId"),payload:d("LSJson").stringify(d("LSShape").ofRecord(babelHelpers["extends"]({},f,{version_id:this.$4},j==null?{}:{data_trace_id:j}))),queueName:a.queue_name,requestId:l,syncChannel:d("LSMailboxInitialSyncCursor").taskChannel,type_:(h||(h=d("I64"))).of_int32(e)}))}catch(b){if(n!=null&&n!=="default"){o=n+"."+(i||(i=d("LSIntEnum"))).toNumber(d("LSMailboxInitialSyncCursor").taskChannel)+"."+e.toString();d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception");b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception.timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("messenger.lightspeed",o+".exception.notconnected")}b.RE_EXN_ID===d("LSPlatformRealtimeTransport").Timeout?d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"):b.RE_EXN_ID===d("LSPlatformRealtimeTransport").NotConnected?(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_notconnected"),c("FBLogger")("messenger_web").warn("Publishing a task to the server not connected")):(d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),c("FBLogger")("messenger_web").warn("Error while publishing a task for request: %s, error %s",e,JSON.stringify(b)));yield this.$12(a.queue_name)}if(m!=null&&m.type==="taskresponse")try{j=m.downloadTask;var p=m.payload;l={experiments:p.ex,sp:p.sp,syncScript:p.payload,target:p.target,taskNames:g.map(function(a){return a.label}).filter(Boolean)};this.$8||c("gkx")("10470")?yield this.$6.evalWhenReady(j,l):yield this.$3(l);yield this.$13(a.queue_name);(k||(k=c("JSScheduler"))).scheduleLoggingPriCallback(function(){return f&&(b("cr:6668")==null?void 0:b("cr:6668").recordTaskSent(f.tasks,p.payload))})}catch(b){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure"),c("FBLogger")("messenger_web").catching(b).mustfix("Encountered an error while processing a task response via realtime transport"),yield this.$12(a.queue_name)}});function e(b,c){return a.apply(this,arguments)}return e}();e.decideWhatToDoWithTask=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var h=this,i=(yield c("MWPBeginHandlingPendingTasksForQueue")(a,{fireAndForgetTask:g,ignoreSoftDelay:!1,queueName:e,transportKey:f}));c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var a of i)yield h.$17(d("LSShape").toRecord(a))})())});function e(b,c,d,e){return a.apply(this,arguments)}return e}();e.$17=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=this.$5,f=this.$18;function g(a,b){e.schedule(function(){c("promiseDone")(f(a,!1))},a,b!=null?(h||(h=d("I64"))).to_float(b):l)}var i=(h||(h=d("I64"))).to_int32(a.work_item_type);switch(i){case 1:yield this.$16(a,3);break;case 5:yield this.$15(a,4);break;case 3:g(a.queue_name,a.next_sync_ms);break;case 2:yield b("cr:4031").handleLSWork(this.$1,a,d("CurrentMessengerUser").getAccountID());break;case 4:break;default:c("FBLogger")("messenger_web").warn("Unknown Task type of %s",i)}});function e(b){return a.apply(this,arguments)}return e}();e.$9=function(){var a=this,e=this.$1;return this.$2.onReconnect(function(){c("promiseDone")(e.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.network_requests).bounds({gte:d("ReQL").key("")})));yield (j||(j=b("Promise"))).all(e.map(function(b){b=b.taskQueueName;return c("LSHandleTaskSendFailureForQueue2")(a,b)}))});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":473")),a.$10()})};e.$10=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.decideWhatToDoWithTask(a.$1,b)})};e.cleanup=function(){this.$7()};return a}();g["default"]=a}),98);
__d("LSProgramTarget",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({DASM:1,JS:2,JSON:3});c=a;f["default"]=c}),66);
__d("LSVersion",[],(function(a,b,c,d,e,f){e.exports="9892381377546539"}),null);
__d("MAWUpdateThreadListItemUtils",["MAWAckLevel","MAWDbMsg","MAWDbMsgOrReaction","MAWMsgType","MAWXMAUtils","vulture"],(function(a,b,c,d,e,f,g){"use strict";function a(a){c("vulture")("OIvSKeeabHAO6MpMLvvp_BQ3McI=");return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.altIndex===d("MAWDbMsg").SPAM_ALT_INDEX||a.altIndex===d("MAWDbMsg").FUTUREPROOF_SPAM_ALT_INDEX},forReaction:function(){return!1}})}function b(a){c("vulture")("OtbZNEU3WqjoY7jCmVAF0MZdV-o=");return d("MAWDbMsgOrReaction").switchOnMsgOrReactionMaybeUnstored(a,{forMessage:function(a){return a.ack===d("MAWAckLevel").ACK.clock},forReaction:function(){return!1}})}function e(a){c("vulture")("SOS8C4SqDuRhPFAPvG8CmibzE_8=");return a.msgId!=null&&a.type===d("MAWMsgType").MSG_TYPE.XMA&&((a=a.msgContent)==null?void 0:a.content)===""}function f(a){c("vulture")("h8oMMzHFmo_rX-ygoEwtg04LWss=");return a.type===d("MAWMsgType").MSG_TYPE.XMA&&d("MAWXMAUtils").isRtcXMA(a==null?void 0:a.xmaMessageType)}g.isSpamMessage=a;g.isOptimisticMessage=b;g.isXMAThreadSnippet=e;g.isRTCXMAMessage=f}),98);
__d("MAWWormOdsLogger",["WABridge","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";a={log:function(a){return d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{entity:d("WAOdsEnums").Entity.WORM,key:a})}};g.wormOdsWorkerLogger=a}),98);
__d("MWPExecuteTaskBridge",["FBLogger","QuickPerformanceLogger","cr:6551"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,d,e){var f=d.event,g=d.taskID;(h||(h=c("QuickPerformanceLogger"))).markerPoint(f,"execute_task_through_bridge",{instanceKey:g});if(b("cr:6551")==null||b("cr:6551")[e]==null){(h||(h=c("QuickPerformanceLogger"))).markerPoint(f,"handler_not_found",{instanceKey:g});throw c("FBLogger")("messenger_web").mustfixThrow("[LS] No bridge task handler found for %s",e)}h.markerPoint(f,"bridge_api_call",{instanceKey:g});return b("cr:6551")[e](a,d)}g.executeTask=a}),98);
__d("MWPHandleNativeTaskBatched",["FBLogger","I64","LSHandleTaskSendSuccessForQueue2","LSJson","LSShape","LSSyncStoredProcedureUtils","LSVec","MWPExecuteTaskBridge","Promise","QuickPerformanceLogger","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new Set();function l(a){try{var b=a.payload!==""?d("LSJson").parse(a.payload):"";return b}catch(b){throw c("FBLogger")("messenger_web").catching(b).mustfix("[LS] parseLSTaskReqType: Error parsing native task payload for queue: %s, falling back to null payload",a.queue_name)}}function m(a,b,c){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g){if(k.has((j||(j=d("I64"))).to_string(e.task_id))){c("FBLogger")("messenger_web").warn("[LS] MWPHAndleNativeTask: Task is already being processed, skipping");return(i||(i=b("Promise"))).resolve()}k.add((j||(j=d("I64"))).to_string(e.task_id));var m=j.to_float(e.task_id),n=c("qpl")._(164763515,"1216");(h||(h=c("QuickPerformanceLogger"))).markerStart(n,m);if(e.label==null){c("FBLogger")("messenger_web").warn("[LS] MWPHandleNativeTask: Cannot find a handler for task if task label is empty");(h||(h=c("QuickPerformanceLogger"))).markerPoint(n,"null_task_label",{instanceKey:m});h.markerEnd(n,3,m);k["delete"]((j||(j=d("I64"))).to_string(e.task_id));return a.runInTransaction(function(a){return a.pending_tasks["delete"](e.task_id)},"readwrite",void 0,void 0,f.id+":81")}var o;try{(h||(h=c("QuickPerformanceLogger"))).markerPoint(n,"parse_task",{instanceKey:m}),o=l(e)}catch(a){(h||(h=c("QuickPerformanceLogger"))).markerPoint(n,"parse_task_failed",{instanceKey:m});c("FBLogger")("messenger_web").catching(a);k["delete"]((j||(j=d("I64"))).to_string(e.task_id));return}var p=e.label;h.markerAnnotate(n,{string:{source:"MWPHandleNativeTaskBatched_handleTask",taskName:p}},{instanceKey:m});try{(h||(h=c("QuickPerformanceLogger"))).markerPoint(n,"task_execute",{instanceKey:m}),yield d("MWPExecuteTaskBridge").executeTask(o,{actorID:g,event:n,source:"MWPHandleNativeTaskBatched_handleTask",taskID:(j||(j=d("I64"))).to_float(e.task_id)},p),yield a.runInTransaction(function(a){return a.pending_tasks["delete"](e.task_id)},"readwrite",void 0,void 0,f.id+":130"),h.markerEnd(n,2,m)}catch(g){yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.pending_tasks.get(e.task_id));if(b!=null)return d("LSSyncStoredProcedureUtils").incrementPendingTaskFailureCount(a,b)});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":141"),(h||(h=c("QuickPerformanceLogger"))).markerPoint(n,"task_execute_failed",{instanceKey:m}),h.markerEnd(n,3,m),c("FBLogger")("messenger_web").catching(g).mustfix("Error handling native task for %s.",e.label)}k["delete"](j.to_string(e.task_id))});return n.apply(this,arguments)}function a(a,b,c){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g){var h=e.network_payload,k=e.queue_name;if(h==null){c("FBLogger")("messenger_web").warn("[LS] MWPHAndleNativeTask: network_payload is empty, there's nothing to handle");return(i||(i=b("Promise"))).resolve()}e=d("LSShape").toRecord(h);h=c("LSVec").toArray(e.tasks).map(function(a){return d("LSShape").toRecord(a)});e=h.map(function(b){return m(a,b,g)});try{yield (i||(i=b("Promise"))).all(e),yield a.runInTransaction(function(a){return c("LSHandleTaskSendSuccessForQueue2")(a,k)},"readwrite",void 0,void 0,f.id+":184")}catch(e){c("FBLogger")("messenger_web").warn("[LS] MWPHAndleNativeTask: tasks network_payload is empty, there's nothing to handle",k);try{yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("LSSyncStoredProcedureUtils").incrementNetworkRequestsTaskFailureCount(a,k,(j||(j=d("I64"))).neg_one),yield d("LSSyncStoredProcedureUtils").closeEpoch(a,k,j.neg_one)});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":194")}catch(a){c("FBLogger")("messenger_web").catching(a).mustfix("[LS] Error bumping failure cound for task")}}});return o.apply(this,arguments)}e={handleLSWork:a};g["default"]=e}),98);
__d("MWPlatformTaskSystem",["LSPlatformRequestScheduler","MWPlatformTaskUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var e=this;this.$1=a;this.$2=b;this.$3=new(c("LSPlatformRequestScheduler"))();this.$4=d("MWPlatformTaskUtils").checkQueuesWhenPendingTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b,!1)});this.$5=d("MWPlatformTaskUtils").checkQueuesWhenPendingFireForgetTaskTableUpdates(a,function(b){var c=b.queueName;b=b.transportKey;return e.$6(a,c,b,!0)});this.$7()}var e=a.prototype;e.$6=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,d){yield this.$2.decideWhatToDoWithTask(a,b,c,d)});function c(b,c,d,e){return a.apply(this,arguments)}return c}();e.$7=function(){var a=this;d("MWPlatformTaskUtils").checkAllPendingTasksForWork(this.$1,function(b){b=b.queueName;return a.$6(a.$1,b)})};e.cleanup=function(){this.$4.forEach(function(a){return a()}),this.$5.forEach(function(a){return a()}),this.$2.cleanup()};return a}();g["default"]=a}),98);
__d("XPlatRelayEnvironment",["CometRelayEnvironment","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){throw c("err")("RelayEnvironment is already set")}function b(){return c("CometRelayEnvironment")}g.setRelayEnvironment=a;g.getRelayEnvironment=b}),98);
__d("getMWLSRegion",["MessengerWebRegion"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=c("MessengerWebRegion").regionNullable;return a==null?"":a}g["default"]=a}),98);/*FB_PKG_DELIM*/
__d("EARInitType",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["EB_INIT","LS_INIT","MAW_INIT","MAW_RP_INIT","MAW_IN_UI_INIT"]);c=a;f["default"]=c}),66);
__d("EBEnableUnifiedAttachment",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(a){g=a}function b(){return g}f.setEbEnableUnifiedAttachment=a;f.getEbEnableUnifiedAttachment=b}),66);
__d("EBLogger",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";a=c("FBLogger")("labyrinth_web").tags(["labyrinth_web"]);g.EBLogger=a}),98);
__d("MWEBUseLocalStorage",["WALogger","WebStorage","getMWEncryptedBackupsIsLocalStorageSupported"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Encrypted Backups key "," written to local storage"]);i=function(){return a};return a}function a(a,b){a=a;b=b!=null?b:"true";if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var e;d("WALogger").LOG(i(),a);(e=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:e.setItem(a,b)}}function b(a){a=a;if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var b;(b=(h||(h=c("WebStorage"))).getLocalStorage())==null?void 0:b.removeItem(a)}}function e(a){if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var b;a=a;return(b=(h||(h=c("WebStorage"))).getLocalStorageForRead())==null?void 0:b.getItem(a)}return null}function f(a){if(d("getMWEncryptedBackupsIsLocalStorageSupported").getMWEncryptedBackupsIsLocalStorageSupported()){var b;a=a;return((b=(h||(h=c("WebStorage"))).getLocalStorageForRead())==null?void 0:b.getItem(a))!=null}return!0}g.mwEBCreateLocalStorageEntry=a;g.mwEBDeleteLocalStorageEntry=b;g.mwEBGetLocalStorageEntryValue=e;g.mwEBGetIsLocalStorageEntryValuePresent=f}),98);
__d("EBReenrollmentTriggerHandler",["EBLogger","LSIntEnum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("EBLogger").EBLogger.tags(["DefaultEBReenrollmentTriggerHandler"]);a=function(){function a(){}var b=a.prototype;b.handle=function(a){i.debug("Running default reenrollment trigger handler for reason: "+(h||(h=d("LSIntEnum"))).toNumber(a.deviceReenrollmentReason));for(a of c("MWEncryptedBackupsLocalStorageEntryEnum").members())i.debug("Clearing local storage key: "+a),a!==c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE&&d("MWEBUseLocalStorage").mwEBDeleteLocalStorageEntry(a)};return a}();g.DefaultEBReenrollmentTriggerHandler=a}),98);
__d("MWEBODSCategory",[],(function(a,b,c,d,e,f){"use strict";a=7319;f["default"]=a}),66);
__d("EBReenrollmentTriggerListener",["EBReenrollmentTriggerHandler","LSIntEnum","MWEBODSCategory","MWEBODSEntityName.enum","ODS","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){function a(a){this.$1=new Map(),this.$4=new(d("EBReenrollmentTriggerHandler").DefaultEBReenrollmentTriggerHandler)(),this.$2=a,this.$5()}var b=a.prototype;b.$5=function(){var a=this;this.$3==null&&(this.$3=d("ReQL").fromTableAscending(this.$2.tables.encrypted_backups_reenrollment_trigger).take(1).subscribe(function(b,e){if(e.operation==="add"||e.operation==="put"){(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EBSM_COUNTERS,"reenrollment_trigger");b=a.getDefaultHandler();if(e.value.deviceReenrollmentReason!=null){var g;b=(g=a.$1.get((i||(i=d("LSIntEnum"))).unwrapIntEnum(e.value.deviceReenrollmentReason)))!=null?g:b}b.handle(e.value);c("promiseDone")(a.$2.runInTransaction(function(a){return a.encrypted_backups_reenrollment_trigger["delete"](e.value.pk)},"readwrite",void 0,void 0,f.id+":77"))}}));return this.$3};b.attachHandler=function(a,b){this.$1.set(a,b)};b.getDefaultHandler=function(){return this.$4};return a}(),k;function l(a){if(k!=null)return k;k=new j(a);return k}function a(a){k==null&&l(a);return k}g.initEBReenrollmentTriggerListener=l;g.getEBReenrollmentTriggerListener_TESTING_ONLY=a}),98);
__d("EBUnifyLegacyMediaUpload",[],(function(a,b,c,d,e,f){"use strict";var g=!1;function a(a){g=a}function b(){return g}f.setEnableUnifyLegacyMediaUpload=a;f.getEnableUnifyLegacyMediaUpload=b}),66);
__d("EncryptedBackupTaskIssuedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("5726");b=d("FalcoLoggerInternal").create("encrypted_backup_task_issued",a);e=b;g["default"]=e}),98);
__d("EncryptedBackupsDYITypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({NotStarted:0,InProgress:1,Completed:2,Failed:3});c=b("$InternalEnum")({Armadillo:0,Instamadillo:1});f.EncryptedBackupsDYIState=a;f.EncryptedBackupsDYIConfig=c}),66);
__d("EncryptedBackupsUtils",["FBLogger","WAJids","WAStanzaUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";f=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};var h=function(a){return Date.now()-a>d("WATimeUtils").DAY_MILLISECONDS*30};function a(a,b,c,d,e){d={frankingTag:d==null?void 0:d.frankingTag,reportingTag:d==null?void 0:d.reportingTag};d={frankingMetadata:d,messageId:b,senderId:a,timestampMs:c};return{encryptedTransportMessage:e,metadata:d}}function b(a){return JSON.stringify([a.author,a.chat,a.externalId])}function e(a){a=JSON.parse(a);if(!Array.isArray(a))throw c("FBLogger")("labyrinth_web").mustfixThrow("Unable to parse msg id string as proper json");if(a.length!==3)throw c("FBLogger")("labyrinth_web").mustfixThrow("Parsed array should have 3 components");var b=d("WAJids").unsafeCoerceToUserJid(a[0]),e=d("WAJids").unsafeCoerceToChatJid(a[1]);a=d("WAStanzaUtils").toStanzaId(a[2]);return{author:b,chat:e,externalId:a}}g.entryOlderThan30Days=f;g.timestampOlderThan30Days=h;g.asBackupMessage=a;g.convertWAMsgIdToStringId=b;g.convertStringIdToWAMsgId=e}),98);
__d("MAWExtractMsFromExternalId",["I64","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to convert externalId to number: ",""]);i=function(){return a};return a}function j(a){return new Date(a).getTime()>0}var k=2199023255551;function a(a){try{a=(h||(h=d("I64"))).of_string_opt(a);if(a!=null){return(a=l(a))!=null?a:0}}catch(a){d("WALogger").ERROR(i(),a)}return 0}function l(a){a=Number((h||(h=d("I64"))).to_string(h.and_(h.lsr_(a,22),h.of_float(k))));if(j(a)){a=Math.floor(Number(a)%1e5/100);return a}}g.extractMsFromStanzaId=a;g.extractMsFromExternalId=l}),98);
__d("IGDWEBUploadMessageUtils",["I64","MAWExtractMsFromExternalId","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[sortOrder] Could not extract ms from externalId: ",""]);i=function(){return a};return a}function a(a,b){var c=d("MAWExtractMsFromExternalId").extractMsFromExternalId((h||(h=d("I64"))).of_string(a));c==null&&d("WALogger").WARN(i(),a);return d("WATimeUtils").castToMillisTime(Number(b)*1e3+(c!=null?c:0))}g.generateProtobufServerTs=a}),98);
__d("WAArmadilloBackupCommon.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};a.name="Subprotocol";a.internalSpec={payload:[1,d("WAProtoConst").TYPES.BYTES],version:[2,d("WAProtoConst").TYPES.INT32]};g.SubprotocolSpec=a}),98);
__d("WAArmadilloBackupMessage.pb",["WAArmadilloBackupCommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};c={};a.name="BackupMessage";a.internalSpec={metadata:[1,(e=d("WAProtoConst")).TYPES.MESSAGE,b],encryptedTransportMessage:[2,e.TYPES.BYTES],encryptedTransportEvent:[5,e.TYPES.MESSAGE,d("WAArmadilloBackupCommon.pb").SubprotocolSpec],encryptedTransportLocallyTransformedMessage:[6,e.TYPES.MESSAGE,d("WAArmadilloBackupCommon.pb").SubprotocolSpec],miTransportAdminMessage:[7,e.TYPES.MESSAGE,d("WAArmadilloBackupCommon.pb").SubprotocolSpec],__oneofs__:{payload:["encryptedTransportMessage","encryptedTransportEvent","encryptedTransportLocallyTransformedMessage","miTransportAdminMessage"]}};b.name="BackupMessage$Metadata";b.internalSpec={senderId:[1,e.TYPES.STRING],messageId:[2,e.TYPES.STRING],timestampMs:[3,e.TYPES.INT64],frankingMetadata:[4,e.TYPES.MESSAGE,c],payloadVersion:[5,e.TYPES.INT32],futureProofBehavior:[6,e.TYPES.INT32],threadTypeTag:[7,e.TYPES.INT32]};c.name="BackupMessage$Metadata$FrankingMetadata";c.internalSpec={frankingTag:[3,e.TYPES.BYTES],reportingTag:[4,e.TYPES.BYTES]};g.BackupMessageSpec=a;g.BackupMessage$MetadataSpec=b;g.BackupMessage$Metadata$FrankingMetadataSpec=c}),98);
__d("EncryptedBackupsUploadEntity",["$InternalEnum","EncryptedBackupsUtils","IGDWEBUploadMessageUtils","WAArmadilloBackupMessage.pb","WAByteArray","WAGlobals","WAJids","WATimeUtils","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a instanceof ArrayBuffer?new Uint8Array(a):a}var h=b("$InternalEnum").Mirrored(["NEEDS_BACKUP","COMPLETED","NEEDS_BACKUP_RETRY","PERMANENT_FAILURE","EXPIRED","THREAD_DELETED","DELETION_PURGED","MESSAGE_DELETED","UPLOADING"]);b=b("$InternalEnum")({INVALID:"-1",IMAGE:"0",PTT:"1",DOCUMENT:"3",VIDEO:"4",GIF:"5",STICKER:"6",XMA:"22",MESSENGER_PREVIEW:"25"});function c(a){return a}function i(a){var b=a.messageApplication,c=a.msgId,e=a.reportingMeta;a=a.sortOrderMs;var f=d("WAJids").authorToUserId(c.author,d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()));return d("encodeProtobuf").encodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,d("EncryptedBackupsUtils").asBackupMessage(f,c.externalId,a,e!=null?e:{frankingKey:null,frankingTag:null,frankingVersion:null,reportingContent:null,reportingTag:null},b)).readByteArrayView()}function e(a){return d("WAByteArray").uint8ArrayToBuffer(a)}function f(a){var b=a.attachmentContext,c=a.backupDirective,e=a.dbMsgType,f=a.instanceKey,g=a.isOpenEB,j=a.isRetroactiveUpload,k=a.legacyAttachmentContext,l=a.messageApplication,m=a.msgId,n=a.originalMsgProtocolId,o=a.reportingMeta,p=a.retryCount,q=a.senderId,r=a.serverTs,s=a.sortOrderMs,t=a.tags;a=a.triggerSource;l=i({messageApplication:l,msgId:m,reportingMeta:o,sortOrderMs:c.actionType===4?d("IGDWEBUploadMessageUtils").generateProtobufServerTs(m.externalId,r):s});o={backupActionType:c.actionType,backupDirective:c,dbMsgType:e,failTsMs:d("WATimeUtils").castToMillisTime(0),instanceKey:f,isOpenEB:g,isRetroactiveUpload:j,msgId:m,msgIdKey:d("EncryptedBackupsUtils").convertWAMsgIdToStringId(m),msgType:"text",originalMsgProtocolId:n,protobuf:l,retryCount:p,senderId:q,serverTs:r,sortOrderMs:s,supplementalKey:c.supplementalKey,tags:t,triggerSource:a,uploadStatus:h.NEEDS_BACKUP,uploadTsSec:d("WATimeUtils").unixTime()};b!=null&&(o=babelHelpers["extends"]({},o,{attachmentContext:b,legacyAttachmentContext:k,msgType:"media"}));return o}g.toEbBackupMessageBytes=a;g.EbUploadStatus=h;g.AttachmentContextMediaType=b;g.castToEBQueueId=c;g.encodeBackupMessage=i;g.getEbBackupMessageBytesBuffer=e;g.asEBUploadEntity=f}),98);
__d("EphemeralMediaViewMode",[],(function(a,b,c,d,e,f){a=Object.freeze({READ_ONCE:0,REPLAYABLE:1,PERMANENT:2});f["default"]=a}),66);
__d("LSDecryptProtobuf",["LSArrayGetObjectAt","LSBase64Decode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSLogMebClientEvent.nop","LSSymmetricEncryptionCreateDecryptedData.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptProtobuf] Beginning execution."),d[1]=c.i64.of_float(Date.now()),d[8]=a[1]==null?c.i64.cast([0,0]):a[1],d[2]=c.i64.of_int32(a[3].length),c.i64.eq(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],c.i64.cast([0,0])).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(e){return d[14]=d[12].get("epoch_anon_id"),d[15]=d[12].get("epoch_root_key"),d[16]=c.createArray(),d[26]=(d[16].push(c.i64.cast([0,32])),d[16]),c.i64.ge(d[8],c.i64.cast([0,3]))?c.resolve(d[17]=void 0):c.sequence([function(e){return c.nativeOperation(b("LSGetBlobFromString.nop"),a[2]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return d[17]=d[26]}])},function(e){return c.i64.ge(d[8],c.i64.cast([0,4]))?(d[26]="_",d[18]=["message_key_in_epoch",d[26],c.blobs.to_string(d[14]),d[26],"cipher_version",d[26],c.i64.to_string(d[8]),d[26],"thread",d[26],a[2]==null?"":a[2]].join("")):(c.i64.ge(d[8],c.i64.cast([0,3]))?(d[27]="_",d[26]=["message_key_in_epoch",d[27],c.blobs.to_string(d[14]),d[27],"cipher_version",d[27],c.i64.to_string(d[8]),d[27],"thread",d[27],a[2]==null?"":a[2]].join("")):(c.i64.ge(d[8],c.i64.cast([0,2]))?(d[28]="_",d[27]=["message_key_in_epoch",d[28],c.blobs.to_string(d[14]),d[28],"cipher_version",d[28],c.i64.to_string(d[8])].join("")):d[27]=["message_key_in_epoch","_",c.blobs.to_string(d[14])].join(""),d[26]=d[27]),d[18]=d[26]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[19],d[17],d[15],d[16]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[21]=!1:d[21]=!0,d[21]?c.resolve(d[22]=void 0):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[20],c.i64.cast([0,0])).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return d[22]=d[26]}])},function(e){return c.blobs.neq(d[22],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSBase64Decode.nop"),a[0]).then(function(a){return a=a,d[26]=a[0],a})},function(e){return c.blobs.neq(d[26],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedData.nop"),d[22],c.blobs.of_string(["message_thread","_",a[2]].join("")),d[26]).then(function(a){return a=a,d[29]=a[0],a})},function(a){return d[27]=d[29]}]):c.resolve(d[27]=void 0)},function(a){return c.blobs.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[29]=["Failed to decrypt message. Epoch Anon ID: ",c.blobs.to_string(d[14]),", Encryption Version: ",c.i64.to_string(d[8])].join(""),function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] ","",d[29]].join("")),d[30]=c.createArray(),void 0!==void 0?d[31]=(d[30].push(void 0),d[30]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptProtobufStoredProcedure",[d[29]].join(""),d[30],c.i64.cast([0,3]))},function(a){return d[28]=void 0}])},function(a){return d[23]=d[28]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDecryptProtobufStoredProcedure] Decryption message key is null"),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDecryptProtobufStoredProcedure","Decryption message key is null",d[26],c.i64.cast([0,3]))},function(a){return d[23]=void 0}])},function(a){return c.blobs.neq(d[23],void 0)?(a=[d[23],void 0],d[24]=a[0],d[25]=a[1],a):(d[26]=new c.Map(),d[26].set("error_code",c.i64.cast([0,101])),d[26].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[26].set("error_message",""),a=[void 0,d[26]],d[24]=a[0],d[25]=a[1],a),a=[d[24],d[25]],d[3]=a[0],d[4]=a[1],a}]):c.resolve((d[12]=c.i64.of_int32(a[3].length),c.i64.eq(d[12],c.i64.cast([0,0]))?(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,102])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,103])),d[15].set("stored_procedure","LSEncryptedBackupsDecryptProtobufStoredProcedure"),d[15].set("error_message",""),e=[void 0,d[15]],d[13]=e[0],d[14]=e[1],e),e=[d[13],d[14]],d[3]=e[0],d[4]=e[1],e))},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[11]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptProtobuf] ",d[7],d[9],d[7],d[10],d[7],d[11]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptProtobuf",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDecryptProtobufStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSIsMobileClient",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return c[0]=!1,b.resolve(c)}a.__sproc_name__="LSEncryptedBackupsIsMobileClientStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSMEBTaskCreationSource",[],(function(a,b,c,d,e,f){a=Object.freeze({UNKNOWN:-1,TEST_ONLY:0,TAM:1,MEM:2,RETROACTIVE_BACKUP:3,TAM_WEB:4,ACT_MESSAGE_DELETE:5,ACT_THREAD_DELETE:6,ACT_UPDATE_ATTACHMENT:7,TAM_PERSISTENCE_TASK:8,TAM_XMA_TOMBSTONE:9,MEM_RECEIVE:10,MEM_SEND:11,MEM_PEER_SYNC:12,MEM_RECEIVE_PROTOBUF:13,MEM_SEND_PROTOBUF:14,MEM_PEER_SYNC_PROTOBUF:15,EB_ADD_DEVICE:21,OPTIMISTIC_THREAD_CREATE_VIA_SHIM:22,ACT_THREAD_INSERT_VIA_SHIM:23,MI_THREAD_INSERT_VIA_SHIM:24,POINT_QUERY_FROM_EB:25,MESSENGER_SEARCH:26,ACT_MESSAGE_RANGE_TASK_HANDLER:27,POINT_QUERY_ON_FULLY_LOADED_THREAD:28,THREAD_CUTOVER:29,HYBRID_THREAD_VERIFY_OR_CREATE_VIA_SHIM:30,BURNER_INTERNAL_LOAD_TESTING_FRAMEWORK:31,THREAD_GALLERY_RESTORE:32,ACT_SURROUNDING_QUERY:33,EB_SNAPSHOT_RESTORE:34,PROTOBUF_RESTORE:39,FTS_INDEX_EB_MESSAGES:40,INSTAMADILLO_DYI:41,MESSENGER_MESSAGE_LIST_PAGINATION:45,DELTA_GENERIC_MESSAGE_SYNC:55,MEDIA_GALLERY_RESTORE:57,EB_PROTOBUF_RESTORE_NO_OP:58,NEW_MEMBER_EXPORT:59,THREAD_POINT_QUERY:76,EB_RESTORE_REPLIED_MESSAGES_AFTER_RANGE_RESTORE:35,REPL_TESTING:36,EB_POINT_QUERY_IN_ACT:37,EB_POINT_QUERY_RETRY_DECRYPTION_FAILURES:38,IGD_DYI:42,FTS_INDEX_EB_MESSAGES_WEB:43,BULK_QUERY_FOR_SEARCH_RESULT:44,MSGR_DYI:46,EB_RESTORE_ON_REGISTRATION:47,EB_RESTORE_ON_OFFLINE_QUEUE_COUNT_LIMIT:48,EB_POINT_QUERY_RESTORE_ON_ACK_DROP:49,EB_POINT_QUERY_RESTORE_ON_DECRYPTION_FAILURE:50,EB_POINT_QUERY_RESTORE_ON_UNAVAILABLE_DEVICE:51,EB_RANGE_QUERY_RESTORE_ON_THREAD_SESSION_ACTIVATE:52,EB_POINT_QUERY_PINNED_MESSAGES:53,EB_POINT_QUERY_RESTORE_PROTOBUF:54,EB_POINT_QUERY_IN_ACT_REACTIONS:56,EB_POINT_QUERY_BUMP_MESSAGES:60,EB_POINT_QUERY_IN_ACT_FOR_INCOMING_RETRY_RECEIPT:61,EB_POINT_QUERY_IN_ACT_FOR_REPORTING:62,EB_POINT_QUERY_IN_ACT_FOR_MESSAGE_STATUS_UPDATE:63,EB_POINT_QUERY_IN_ACT_FOR_REPL_TEST:64,EB_POINT_QUERY_IN_ACT_FOR_FACEBOOK_APP_NSE_NOTIFICATION_RENDERING:65,EB_POINT_QUERY_IN_ACT_FOR_MESSAGE_EXPORT_HANDLING:66,EB_POINT_QUERY_IN_ACT_FOR_TAM_ACT_PROXY:67,EB_POINT_QUERY_IN_ACT_FOR_REALTIME_INCOMING_MESSAGE:68,EB_POINT_QUERY_IN_ACT_FOR_REALTIME_INCOMING_AI_BOT_MESSAGE:69,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_PERSISTENCE:70,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_INDEXING:71,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_NEW_MEMBER_HYDRATION:72,EB_POINT_QUERY_IN_ACT_FOR_ENCRYPTED_BACKUPS_RESTORE_FOR_ECHO_TO_PROTO_CONVERSION:73,EB_POINT_QUERY_IN_ACT_FOR_PENDING_MESSAGE_RECOVERY_HISTORICAL_FUTURE_PROOF:74,EB_POINT_QUERY_IN_ACT_FOR_PENDING_MESSAGE_RECOVERY_REALTIME_BLOCKED:75,RESONANCE_UTILS:80,MPS_RESTORE_REVERB_RESTORE:81,REPORTING:82,CLIENT_MESSAGE_TRUNCATION:83});f["default"]=a}),66);
__d("LSThreadMediaGalleryGroup",[],(function(a,b,c,d,e,f){a=Object.freeze({PHOTOS_AND_VIDEOS:0,FILES_ONLY:1,LINKS:2});f["default"]=a}),66);
__d("MAWAckLevel",["LSIntEnum","LSMessageSendStatus"],(function(a,b,c,d,e,f,g){"use strict";var h,i={clock:0,contentGone:-3,contentTooBig:-4,contentUnuploadable:-5,expired:-2,failed:-1,failedRetryable:-9,inactiveReceived:-6,partialOptimistic:-8,played:4,read:3,received:2,senderBackFillSent:-7,sent:1};function a(a){return a>0}function b(a){switch(a){case i.partialOptimistic:return(h||(h=d("LSIntEnum"))).ofNumber(0);case i.clock:return(h||(h=d("LSIntEnum"))).ofNumber(1);case i.sent:case i.received:case i.read:case i.played:return(h||(h=d("LSIntEnum"))).ofNumber(2);case i.failedRetryable:return(h||(h=d("LSIntEnum"))).ofNumber(5);default:return(h||(h=d("LSIntEnum"))).ofNumber(4)}}function e(a){switch(a){case i.partialOptimistic:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").NONE);case i.clock:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SENDING_TO_SERVER);case i.sent:case i.received:case i.read:case i.played:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").SERVER_RECEIVED);case i.failedRetryable:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").RETRIABLE_ERROR);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSendStatus").NON_RETRIABLE_ERROR)}}g.ACK=i;g.isMsgAuthoritative=a;g.levelToMessagingSendStatusV2=b;g.levelToMessagingSendStatus=e}),98);
__d("MAWAdminMsgType",[],(function(a,b,c,d,e,f){"use strict";a="currentUserAddedDevice";b="participantAddedDevice";c="currentUserRemovedDevice";d="participantRemovedDevice";e="currentUserUpdatedDevice";var g="participantUpdatedDevice",h="participantAddedYou",i="participantAddedYouAndOneUser",j="participantAddedYouAndMoreThanOneUsers",k="unknowUserAddedYou",l="unknowUserAddedYouAndOneUser",m="unknowUserAddedYouAndMoreThanOneUser",n="unknownUserAddedOneUser",o="unknownUserAddedTwoUser",p="unknownUserAddedMoreThanTwoUser",q="participantAddedOneUser",aa="participantAddedTwoUser",ba="participantAddedMoreThanTwoUser",ca="currentUserRemovedOneParticipant",da="currentUserRemovedTwoParticipant",ea="currentUserRemovedMoreThanTwoParticipant",fa="currentUserAddedOneParticipant",ga="currentUserAddedTwoParticipant",r="currentUserAddedMoreThanTwoParticipant",ha="participantRemovedYou",ia="participantRemovedYouAndOneUser",ja="participantRemovedYouAndMoreThanOneUsers",ka="unknowUserRemovedYou",la="unknowUserRemovedYouAndOneUser",ma="unknowUserRemovedYouAndMoreThanOneUser",na="unknownUserRemovedOneUser",oa="unknownUserRemovedTwoUser",pa="unknownUserRemovedMoreThanTwoUser",qa="participantRemovedOneUser",ra="participantRemovedTwoUser",sa="participantRemovedMoreThanTwoUser",ta="participantLeftGroup",ua="currentUserLeftGroup",va="participantCustomizeParticipantNickname",wa="participantClearParticipantNickname",xa="participantCustomizeCurrentUserNickname",ya="currentUserSetOwnNickname",za="currentUserClearOwnNickname",Aa="currentUserClearParticipantNickname",Ba="participantSetOwnNickname",Ca="participantClearOwnNickname",Da="participantClearCurrentUserNickname",Ea="currentUserCustomizeNickname",Fa="currentUserNamedGroup",Ga="unkonwnUserNamedGroup",Ha="participantNamedGroup",Ia="currentUserCustomizeHotlike",Ja="participantCustomizeHotlike",Ka="currentUserCustomizeTheme",La="currentUserCustomizeAITheme",Ma="currentUserCustomizePhoto",Na="participantCustomizeTheme",Oa="participantCustomizeAITheme",Pa="participantCustomizePhoto",Qa="currentUserSetAddModeAdminOnly",Ra="currentUserSetAddModeAllMembers",Sa="participantSetAddModeAdminOnly",Ta="participantSetAddModeAllMembers",Ua="serverSetAddModeAdminOnly",Va="serverSetAddModeAllMembers",s="currentUserPinnedMessage",t="currentUserUnpinnedMessage",u="participantPinnedMessage",v="participantUnpinnedMessage",w="currentUserLimitSharingDisabled",x="currentUserLimitSharingEnabled",y="participantLimitSharingDisabled",z="participantLimitSharingEnabled",A="cutoverThreadAdminMessage",B="cutoverIGDThreadAdminMessage",C="cutoverRollbackAdminMessage",D="dualThreadCutoverAdminMessage",E="e2eeThreadDescription",F="e2eeThreadUKOSAAdminMessage",Wa="debugMsg",Xa="reachabilityError",Ya="twoUsersConnected",Za="twoUsersConnectedOneMSplit",G="CurrentUserCreatedPoll",H="ParticipantCreatedPoll",I="CurrentUserAddedPollOption",J="ParticipantAddedPollOption",K="CurrentUserAddedMultiplePollOptions",L="ParticipantAddedMultiplePollOptions",M="CurrentUserAddedPollVote",N="ParticipantAddedPollVote",O="CurrentUserAddedMultiplePollVotes",P="ParticipantAddedMultiplePollVotes",Q="CurrentUserRemovedPollVote",R="ParticipantRemovedPollVote",S="CurrentUserRemovedMultiplePollVotes",T="ParticipantRemovedMultiplePollVotes",U="CurrentUserMixedPollUpdate",V="ParticipantMixedPollUpdate",W="CurrentUserChangedPollVote",X="ParticipantChangedPollVote",Y="CurrentUserChangedMultiplePollVotes",Z="ParticipantChangedMultiplePollVotes",$="PollUnsentUpdate";r={CURRENT_USER_ADDED_DEVICE:a,CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:r,CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS:K,CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES:O,CURRENT_USER_ADDED_ONE_PARTICIPANT:fa,CURRENT_USER_ADDED_POLL_OPTION:I,CURRENT_USER_ADDED_POLL_VOTE:M,CURRENT_USER_ADDED_TWO_PARTICIPANTS:ga,CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES:Y,CURRENT_USER_CHANGED_POLL_VOTE:W,CURRENT_USER_CLEAR_OWN_NICKNAME:za,CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:Aa,CURRENT_USER_CREATED_POLL:G,CURRENT_USER_CUSTOMIZE_AI_THEME:La,CURRENT_USER_CUSTOMIZE_HOTLIKE:Ia,CURRENT_USER_CUSTOMIZE_NICKNAME:Ea,CURRENT_USER_CUSTOMIZE_PHOTO:Ma,CURRENT_USER_CUSTOMIZE_THEME:Ka,CURRENT_USER_LEFT_GROUP:ua,CURRENT_USER_LIMIT_SHARING_DISABLED:w,CURRENT_USER_LIMIT_SHARING_ENABLED:x,CURRENT_USER_MIXED_POLL_UPDATE:U,CURRENT_USER_NAMED_GROUP:Fa,CURRENT_USER_PINNED_MESSAGE:s,CURRENT_USER_REMOVED_DEVICE:c,CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS:ea,CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES:S,CURRENT_USER_REMOVED_ONE_PARTICIPANT:ca,CURRENT_USER_REMOVED_POLL_VOTE:Q,CURRENT_USER_REMOVED_TWO_PARTICIPANTS:da,CURRENT_USER_SET_ADD_MODE_ADMIN_ONLY:Qa,CURRENT_USER_SET_ADD_MODE_ALL_MEMBERS:Ra,CURRENT_USER_SET_OWN_NICKNAME:ya,CURRENT_USER_UNPINNED_MESSAGE:t,CURRENT_USER_UPDATED_DEVICE:e,CUTOVER_IGD_THREAD_ADMIN_MESSAGE:B,CUTOVER_ROLLBACK_ADMIN_MESSAGE:C,CUTOVER_THREAD_ADMIN_MESSAGE:A,DEBUG_MSG:Wa,DUAL_THREAD_CUTOVER_ADMIN_MESSAGE:D,E2EE_THREAD_DESCRIPTION:E,E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:F,PARTICIPANT_ADDED_DEVICE:b,PARTICIPANT_ADDED_MORE_THAN_TWO_USER:ba,PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS:L,PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES:P,PARTICIPANT_ADDED_ONE_USER:q,PARTICIPANT_ADDED_POLL_OPTION:J,PARTICIPANT_ADDED_POLL_VOTE:N,PARTICIPANT_ADDED_TWO_USER:aa,PARTICIPANT_ADDED_YOU:h,PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:j,PARTICIPANT_ADDED_YOU_AND_ONE_USER:i,PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES:Z,PARTICIPANT_CHANGED_POLL_VOTE:X,PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:Da,PARTICIPANT_CLEAR_OWN_NICKNAME:Ca,PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:wa,PARTICIPANT_CREATED_POLL:H,PARTICIPANT_CUSTOMIZE_AI_THEME:Oa,PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:xa,PARTICIPANT_CUSTOMIZE_HOTLIKE:Ja,PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:va,PARTICIPANT_CUSTOMIZE_PHOTO:Pa,PARTICIPANT_CUSTOMIZE_THEME:Na,PARTICIPANT_LEFT_GROUP:ta,PARTICIPANT_LIMIT_SHARING_DISABLED:y,PARTICIPANT_LIMIT_SHARING_ENABLED:z,PARTICIPANT_MIXED_POLL_UPDATE:V,PARTICIPANT_NAMED_GROUP:Ha,PARTICIPANT_PINNED_MESSAGE:u,PARTICIPANT_REMOVED_DEVICE:d,PARTICIPANT_REMOVED_MORE_THAN_TWO_USER:sa,PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES:T,PARTICIPANT_REMOVED_ONE_USER:qa,PARTICIPANT_REMOVED_POLL_VOTE:R,PARTICIPANT_REMOVED_TWO_USER:ra,PARTICIPANT_REMOVED_YOU:ha,PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:ja,PARTICIPANT_REMOVED_YOU_AND_ONE_USER:ia,PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:Sa,PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:Ta,PARTICIPANT_SET_OWN_NICKNAME:Ba,PARTICIPANT_UNPINNED_MESSAGE:v,PARTICIPANT_UPDATED_DEVICE:g,POLL_UNSENT_UPDATE:$,REACHABILITY_ERROR:Xa,SERVER_SET_ADD_MODE_ADMIN_ONLY:Ua,SERVER_SET_ADD_MODE_ALL_MEMBERS:Va,TWO_USERS_CONNECTED:Ya,TWO_USERS_CONNECTED_ONE_MSPLIT:Za,UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:p,UNKNOWN_USER_ADDED_ONE_USER:n,UNKNOWN_USER_ADDED_TWO_USER:o,UNKNOWN_USER_ADDED_YOU:k,UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:m,UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:l,UNKNOWN_USER_NAMED_GROUP:Ga,UNKNOWN_USER_REMOVED_MORE_THAN_TWO_USER:pa,UNKNOWN_USER_REMOVED_ONE_USER:na,UNKNOWN_USER_REMOVED_TWO_USER:oa,UNKNOWN_USER_REMOVED_YOU:ka,UNKNOWN_USER_REMOVED_YOU_AND_MORE_THAN_ONE_USER:ma,UNKNOWN_USER_REMOVED_YOU_AND_ONE_USER:la};f.CURRENT_USER_ADDED_DEVICE=a;f.CURRENT_USER_PINNED_MESSAGE=s;f.CURRENT_USER_UNPINNED_MESSAGE=t;f.PARTICIPANT_PINNED_MESSAGE=u;f.PARTICIPANT_UNPINNED_MESSAGE=v;f.CURRENT_USER_LIMIT_SHARING_DISABLED=w;f.CURRENT_USER_LIMIT_SHARING_ENABLED=x;f.PARTICIPANT_LIMIT_SHARING_DISABLED=y;f.PARTICIPANT_LIMIT_SHARING_ENABLED=z;f.CUTOVER_THREAD_ADMIN_MESSAGE=A;f.CUTOVER_IGD_THREAD_ADMIN_MESSAGE=B;f.CUTOVER_ROLLBACK_ADMIN_MESSAGE=C;f.DUAL_THREAD_CUTOVER_ADMIN_MESSAGE=D;f.E2EE_THREAD_DESCRIPTION=E;f.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE=F;f.CURRENT_USER_CREATED_POLL=G;f.PARTICIPANT_CREATED_POLL=H;f.CURRENT_USER_ADDED_POLL_OPTION=I;f.PARTICIPANT_ADDED_POLL_OPTION=J;f.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS=K;f.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS=L;f.CURRENT_USER_ADDED_POLL_VOTE=M;f.PARTICIPANT_ADDED_POLL_VOTE=N;f.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES=O;f.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES=P;f.CURRENT_USER_REMOVED_POLL_VOTE=Q;f.PARTICIPANT_REMOVED_POLL_VOTE=R;f.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES=S;f.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES=T;f.CURRENT_USER_MIXED_POLL_UPDATE=U;f.PARTICIPANT_MIXED_POLL_UPDATE=V;f.CURRENT_USER_CHANGED_POLL_VOTE=W;f.PARTICIPANT_CHANGED_POLL_VOTE=X;f.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES=Y;f.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES=Z;f.POLL_UNSENT_UPDATE=$;f.ADMIN_MSG_TYPE=r}),66);
__d("MAWLocalizationType",["MAWAdminMsgType"],(function(a,b,c,d,e,f,g){"use strict";a="emptySnippet";b="currentUserCreatedGroup";c="participantCreatedGroup";e="unknownUserCreatedGroup";f="currentUserGotPromoted";var h="currentUserGotDemoted",i="participantGotPromoted",j="participantGotDemoted",k="participantPromotedYou",l="participantDemotedYou",m="currentUserPromotedParticipant",n="currentUserDemotedParticipant",o="participantDemotedParticipant",p="participantPromotedParticipant",q="participantSelfDemoted",r="currentUserSelfDemoted",s="currentUserSendText",t="currentUserSendImage",u="currentUserSendVideo",v="currentUserSendAudio",w="currentUserSendGif",x="currentUserSendSticker",y="participantSendText",z="participantSendTextInGroup",A="participantSendImage",B="participantSendVideo",C="participantSendAudio",D="participantSendGif",E="participantSendSticker",F="unavailableSnippet",G="unknownUserEphemeralSettingTurnedOnSeconds",H="unknownUserEphemeralSettingTurnedOnMinutes",I="unknownUserEphemeralSettingTurnedOnHours",J="unknownUserEphemeralSettingTurnedOnDays",K="youEphemeralSettingTurnedOnSeconds",L="youEphemeralSettingTurnedOnMinutes",M="youEphemeralSettingTurnedOnHours",N="youEphemeralSettingTurnedOnDays",O="participantEphemeralSettingTurnedOnSeconds",P="participantEphemeralSettingTurnedOnMinutes",Q="participantEphemeralSettingTurnedOnHours",R="participantEphemeralSettingTurnedOnDays",S="unknownUserEphemeralSettingChangeSeconds",T="unknownUserEphemeralSettingChangeMinutes",U="unknownUserEphemeralSettingChangeHours",V="unknownUserEphemeralSettingChangeDays",W="youEphemeralSettingChangeSeconds",X="youEphemeralSettingChangeMinutes",Y="youEphemeralSettingChangeHours",aa="youEphemeralSettingChangeDays",ba="participantEphemeralSettingChangeSeconds",ca="participantEphemeralSettingChangeMinutes",da="participantEphemeralSettingChangeHours",ea="participantEphemeralSettingChangeDays",fa="unknownUserEphemeralSettingTurnedOff",ga="youEphemeralSettingTurnedOff",ha="participantEphemeralSettingTurnedOff",ia="ephemeralSettingsAutoReset",ja="currentUserUnsentMessage",ka="participantUnsentMessage",la="participantReactMessage",ma="participantReactMessageInGroup",Z="unknownUserEphemeralTakeScreenshot",na="unknownUserEphemeralRecordScreen",oa="youEphemeralTakeScreenshot",pa="youEphemeralRecordScreen",qa="participantEphemeralTakeScreenshot",ra="participantEphemeralRecordScreen",sa="icdcAlertAdminMessage",ta="yourDeviceICDCAlertAdminMessage",$="currentUserSendAttachment",ua="participantSendAttachment",va="currentUserSentPost",wa="currentUserSentReel",xa="currentUserSentStory",ya="currentUserSentEvent",za="currentUserMentionedStoryIG",Aa="currentUserReceivedStoryMentionIG",Ba="participantSentPost",Ca="participantSentReel",Da="participantSentStory",Ea="participantSentEvent",Fa="currentUserSentStoryHighlight",Ga="participantSentStoryHighlight",Ha="currentUserMissedAudioCall",Ia="participantMissedAudioCall",Ja="currentUserMissedVideoCall",Ka="participantMissedVideoCall",La="currentUserAudioCalled",Ma="participantAudioCalled",Na="currentUserVideoCalled",Oa="participantVideoCalled",Pa="currentUserStartedGroupAudioCall",Qa="participantStartedGroupAudioCall",Ra="currentUserStartedGroupVideoCall",Sa="participantStartedGroupVideoCall",Ta="currentUserBumpedOwnMessage",Ua="currentUserBumpedMessage",Va="participantBumpedOwnMessage",Wa="participantBumpedParticipantMessage",Xa="participantBumpedCurrentUserMessage",Ya="userSendUnavailableMessage",Za="userSendEncryptedMessage",$a="currentUserSendUnrenderableMessage",ab="participantSendUnrenderableMessage",bb="currentUserSendLocationFallback",cb="participantSendLocation",db="currentUserSendLiveLocationFallback",eb="participantSendLiveLocation",fb="currentUserSendLocation",gb="participantSendLocation",hb="currentUserSendPollCreationFallback",ib="participantSendPollCreation",jb="currentUserSendContactShareFallback",kb="participantSendContactShareFallback",lb="currentUserSendContactShare",mb="participantSendContactShare",nb="currentUserSendAIContactShare",ob="participantSendAIContactShare",pb="currentUserSendStoryMentionFallback",qb="currentUserSendStoryMention",rb="participantSendStoryMention",sb="participantSendStoryMentionFallback",tb="currentUserSendPostMentionFallback",ub="participantSendPostMentionFallback",vb="currentUserSendMemoriesShare",wb="participantSendMemoriesShare",xb="currentUserSendPostMention",yb="participantSendPostMention",zb="currentUserSendNoteMentionFallback",Ab="participantSendNoteMentionFallback",Bb="messengerMemoryEncryptedMessageFallback",Cb="rtcXMAMessageFallback",Db="metaAISendMessageFallback",Eb="currentUserSendBumpMessageFallback",Fb="participantSendBumpMessageFallback",Gb="participantSendBumpMessageOriginalUnavailable",Hb="currentUserSendStickerReceiverFetchMessageFallback",Ib="participantSendStickerReceiverFetchMessageFallback",Jb="viewOncePhotoMessageFallback",Kb="viewOnceVideoMessageFallback",Lb="unavailableStory",Mb="currentUserLimitSharingDisabled",Nb="currentUserLimitSharingEnabled",Ob="participantLimitSharingDisabled",Pb="participantLimitSharingEnabled";d=babelHelpers["extends"]({},d("MAWAdminMsgType").ADMIN_MSG_TYPE,{CURRENT_USER_AUDIO_CALLED:La,CURRENT_USER_BUMPED_MESSAGE:Ua,CURRENT_USER_BUMPED_OWN_MESSAGE:Ta,CURRENT_USER_CREATED_GROUP:b,CURRENT_USER_DEMOTED_PARTICIPANT:n,CURRENT_USER_GOT_DEMOTED:h,CURRENT_USER_GOT_PROMOTED:f,CURRENT_USER_LIMIT_SHARING_DISABLED:Mb,CURRENT_USER_LIMIT_SHARING_ENABLED:Nb,CURRENT_USER_MENTIONED_STORY_IG:za,CURRENT_USER_MISSED_AUDIO_CALL:Ha,CURRENT_USER_MISSED_VIDEO_CALL:Ja,CURRENT_USER_PROMOTED_PARTICIPANT:m,CURRENT_USER_RECEIVED_STORY_MENTION_IG:Aa,CURRENT_USER_SELF_DEMOTED:r,CURRENT_USER_SEND_AI_CONTACT_SHARE:nb,CURRENT_USER_SEND_ATTACHMENT:$,CURRENT_USER_SEND_AUDIO:v,CURRENT_USER_SEND_BUMP_MESSAGE_FALLBACK:Eb,CURRENT_USER_SEND_CONTACT_SHARE:lb,CURRENT_USER_SEND_CONTACT_SHARE_FALLBACK:jb,CURRENT_USER_SEND_GIF:w,CURRENT_USER_SEND_IMAGE:t,CURRENT_USER_SEND_LIVE_LOCATION_FALLBACK:db,CURRENT_USER_SEND_LOCATION:fb,CURRENT_USER_SEND_LOCATION_FALLBACK:bb,CURRENT_USER_SEND_MEMORIES_SHARE:vb,CURRENT_USER_SEND_NOTE_MENTION_FALLBACK:zb,CURRENT_USER_SEND_POLL_CREATION_FALLBACK:hb,CURRENT_USER_SEND_POST_MENTION:xb,CURRENT_USER_SEND_POST_MENTION_FALLBACK:tb,CURRENT_USER_SEND_STICKER:x,CURRENT_USER_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK:Hb,CURRENT_USER_SEND_STORY_MENTION:qb,CURRENT_USER_SEND_STORY_MENTION_FALLBACK:pb,CURRENT_USER_SEND_TEXT:s,CURRENT_USER_SEND_UNRENDERABLE_MESSAGE_FALLBACK:$a,CURRENT_USER_SEND_VIDEO:u,CURRENT_USER_SENT_EVENT:ya,CURRENT_USER_SENT_POST:va,CURRENT_USER_SENT_REEL:wa,CURRENT_USER_SENT_STORY:xa,CURRENT_USER_SENT_STORY_HIGHLIGHT:Fa,CURRENT_USER_STARTED_GROUP_AUDIO_CALL:Pa,CURRENT_USER_STARTED_GROUP_VIDEO_CALL:Ra,CURRENT_USER_UNSENT_MESSAGE:ja,CURRENT_USER_VIDEO_CALLED:Na,EMPTY_SNIPPET:a,EPHEMERAL_SETTINGS_AUTO_RESET:ia,ICDC_ALERT_ADMIN_MESSAGE:sa,MESSENGER_MEMORY_ENCRYPTED_MESSAGE_FALLBACK:Bb,META_AI_SEND_MESSAGE_FALLBACK:Db,PARTICIPANT_AUDIO_CALLED:Ma,PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:Xa,PARTICIPANT_BUMPED_OWN_MESSAGE:Va,PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:Wa,PARTICIPANT_CREATED_GROUP:c,PARTICIPANT_DEMOTED_PARTICIPANT:o,PARTICIPANT_DEMOTED_YOU:l,PARTICIPANT_EPHEMERAL_RECORD_SCREEN:ra,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:ea,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:da,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:ca,PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:ba,PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:ha,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:R,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:Q,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:P,PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:O,PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:qa,PARTICIPANT_GOT_DEMOTED:j,PARTICIPANT_GOT_PROMOTED:i,PARTICIPANT_LIMIT_SHARING_DISABLED:Ob,PARTICIPANT_LIMIT_SHARING_ENABLED:Pb,PARTICIPANT_MISSED_AUDIO_CALL:Ia,PARTICIPANT_MISSED_VIDEO_CALL:Ka,PARTICIPANT_PROMOTED_PARTICIPANT:p,PARTICIPANT_PROMOTED_YOU:k,PARTICIPANT_REACT_MESSAGE:la,PARTICIPANT_REACT_MESSAGE_IN_GROUP:ma,PARTICIPANT_SELF_DEMOTED:q,PARTICIPANT_SEND_AI_CONTACT_SHARE:ob,PARTICIPANT_SEND_ATTACHMENT:ua,PARTICIPANT_SEND_AUDIO:C,PARTICIPANT_SEND_BUMP_MESSAGE:Fb,PARTICIPANT_SEND_BUMP_MESSAGE_ORIGINAL_UNAVAILABLE_FALLBACK:Gb,PARTICIPANT_SEND_CONTACT_SHARE:mb,PARTICIPANT_SEND_CONTACT_SHARE_FALLBACK:kb,PARTICIPANT_SEND_GIF:D,PARTICIPANT_SEND_IMAGE:A,PARTICIPANT_SEND_LIVE_LOCATION_FALLBACK:eb,PARTICIPANT_SEND_LOCATION:gb,PARTICIPANT_SEND_LOCATION_FALLBACK:cb,PARTICIPANT_SEND_MEMORIES_SHARE:wb,PARTICIPANT_SEND_NOTE_MENTION_FALLBACK:Ab,PARTICIPANT_SEND_POLL_CREATION_FALLBACK:ib,PARTICIPANT_SEND_POST_MENTION:yb,PARTICIPANT_SEND_POST_MENTION_FALLBACK:ub,PARTICIPANT_SEND_STICKER:E,PARTICIPANT_SEND_STICKER_RECEIVER_FETCH_MESSAGE_FALLBACK:Ib,PARTICIPANT_SEND_STORY_MENTION:rb,PARTICIPANT_SEND_STORY_MENTION_FALLBACK:sb,PARTICIPANT_SEND_TEXT:y,PARTICIPANT_SEND_TEXT_IN_GROUP:z,PARTICIPANT_SEND_UNRENDERABLE_MESSAGE_FALLBACK:ab,PARTICIPANT_SEND_VIDEO:B,PARTICIPANT_SENT_EVENT:Ea,PARTICIPANT_SENT_POST:Ba,PARTICIPANT_SENT_REEL:Ca,PARTICIPANT_SENT_STORY:Da,PARTICIPANT_SENT_STORY_HIGHLIGHT:Ga,PARTICIPANT_STARTED_GROUP_AUDIO_CALL:Qa,PARTICIPANT_STARTED_GROUP_VIDEO_CALL:Sa,PARTICIPANT_UNSENT_MESSAGE:ka,PARTICIPANT_VIDEO_CALLED:Oa,RTC_XMA_FALLBACK:Cb,UNAVAILABLE_SNIPPET:F,UNAVAILABLE_STORY:Lb,UNKNOWN_USER_CREATED_GROUP:e,UNKNOWN_USER_EPHEMERAL_RECORD_SCREEN:na,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS:V,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS:U,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES:T,UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS:S,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:fa,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:J,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:I,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:H,UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:G,UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT:Z,USER_SEND_ENCRYPTED_MESSAGE_FALLBACK:Za,USER_SEND_UNAVAILABLE_MESSAGE_FALLBACK:Ya,VIEW_ONCE_PHOTO_MESSAGE:Jb,VIEW_ONCE_VIDEO_MESSAGE:Kb,YOU_EPHEMERAL_RECORD_SCREEN:pa,YOU_EPHEMERAL_SETTING_CHANGE_DAYS:aa,YOU_EPHEMERAL_SETTING_CHANGE_HOURS:Y,YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:X,YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:W,YOU_EPHEMERAL_SETTING_TURNED_OFF:ga,YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:N,YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:M,YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:L,YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:K,YOU_EPHEMERAL_TAKE_SCREENSHOT:oa,YOUR_DEVICE_ICDC_ALERT_ADMIN_MESSAGE:ta});g.CURRENT_USER_CREATED_GROUP=b;g.CURRENT_USER_SEND_TEXT=s;g.CURRENT_USER_SEND_IMAGE=t;g.CURRENT_USER_SEND_VIDEO=u;g.CURRENT_USER_SEND_AUDIO=v;g.CURRENT_USER_SEND_GIF=w;g.CURRENT_USER_SEND_STICKER=x;g.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS=G;g.UNKNOWN_USER_EPHEMERAL_TAKE_SCREENSHOT=Z;g.CURRENT_USER_SEND_ATTACHMENT=$;g.LOCALIZATION_TYPE=d}),98);
__d("MAWAdminMsgNormalized",["MAWLocalizationType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){switch(a){case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LEFT_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_REMOVED_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PHOTO:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UNPINNED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_UK_OSA_ADMIN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_PROMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_GOT_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_YOU:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_PROMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SELF_DEMOTED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_DEMOTED_PARTICIPANT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CLEAR_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ADMIN_ONLY:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_ADD_MODE_ALL_MEMBERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_BUMPED_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_CURRENT_USER_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_OWN_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_BUMPED_PARTICIPANT_MESSAGE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_DISABLED:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_LIMIT_SHARING_ENABLED:return{contactIds:b,contents:[]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CREATED_POLL:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_MIXED_POLL_UPDATE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_CURRENT_USER_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS:a=b[0];var c=b[1];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_PARTICIPANT_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CLEAR_PARTICIPANT_NICKNAME:a=b[0];c=b[1];var e=b[2];return{contactIds:[a,c],contents:[e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_AI_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CUSTOMIZE_THEME:a=b[0];c=b[1];e=b[2];return{contactIds:[a],contents:[c,e]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_POLL_OPTION:a=b[0];c=b[1];b[2];return{contactIds:[a],contents:[c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_CHANGED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MULTIPLE_POLL_OPTIONS:e=b[0];a=b[1];c=b[2];b[3];return{contactIds:[e],contents:[a,c]};case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_VOTES:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_NAMED_GROUP:case d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_AI_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_THEME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CUSTOMIZE_HOTLIKE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_SET_OWN_NICKNAME:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CREATED_POLL:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_POLL_OPTION:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MULTIPLE_POLL_OPTIONS:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_MIXED_POLL_UPDATE:case d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_CHANGED_POLL_VOTE:case d("MAWLocalizationType").LOCALIZATION_TYPE.POLL_UNSENT_UPDATE:default:return{contactIds:[],contents:b}}}g.deconstructContactIdsFromAdminContent=a}),98);
__d("MAWMediaGalleryEBTaggingUtils",["LSThreadMediaGalleryGroup","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("13725")}function b(a){return a===c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS}g.isMediaGalleryEBTaggingRestoreEnabled=a;g.isMediaGalleryGroupSupportedForTaggedRestore=b}),98);
__d("MAWMediaGalleryM2Utils",["MAWMediaGalleryEBTaggingUtils","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){return c("gkx")("4219")}function a(){return c("justknobx")._("3060")&&(h()||d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled())}function b(){return c("gkx")("4219")}g.isMediaGalleryM2Enabled=h;g.shouldSkipSyncToLSDB=a;g.isFilesEBRestoreEnabled=b}),98);
__d("getReplyContentForNoteReply",["WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=a.author,e=a.msgId;c=d("WAJids").authorToUserId(c,b);b=(b=a.quote)==null?void 0:(b=b.content.msgContent)==null?void 0:b.content;a=(a=a.quote)==null?void 0:a.content.expirationTs;return{isNoteReply:!0,replyMediaExpirationTimestampMs:a!=null?a*1e3:void 0,replyMessageText:b,replySourceId:e,replyToUserId:c}}g["default"]=a}),98);
__d("MAWBridgeMsg",["LSHotEmojiSize","LSIntEnum","MAWDbMsg","MAWImageUtils","MAWMediaGalleryM2Utils","MAWMsgType","MAWUserJidWrapper","MAWVault","MAWXMAUtils","MWPBumpEntityKey","WAAssertUnreachable","WAHashUtils","WAJids","WALogger","WAMsgType","WATimeUtils","getReplyContentForNoteReply","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWBridgeMsg] Missing content for external link share XMA message"]);i=function(){return a};return a}function j(a){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType))return;if(a.quote==null)return;if(a.quote.content.type!==d("MAWMsgType").MSG_TYPE.XMA&&a.quote.content.msgId!=null)return{replyToMsgId:a.quote.content.msgId,replyType:1}}function k(a,b,e){var f,g;f=((f=a.quote)==null?void 0:f.content.type)===d("WAMsgType").NOTE_REPLY;if(f)return c("getReplyContentForNoteReply")(a,e);f=(f=a.quote)==null?void 0:f.content;if(d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType)||d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var h=a.author,i=a.mediaId,j=a.msgId,k=d("WAJids").authorToUserId(h,e);if(d("MAWXMAUtils").isXMAStoryMention(a.xmaMessageType)||d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType)){var l=a.threadJid,m;l!=null&&(m=d("WAJids").interpretAsUserJid(l));m!=null&&(k=d("WAJids").userIdFromJid(m))}i!=null&&a.plaintextHash==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","bridge_msg_get_reply_content");return{isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),isIGStoryMention:d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(a.xmaMessageType),isMsgHighlightsTabFriendUpdatesReply:d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),isStoryHighlightShare:d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),isStoryReply:d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType),replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:i,replyPlaintextHash:(l=a.plaintextHash)!=null?l:void 0,replySenderIsMe:h===d("WAJids").AUTHOR_ME||k===e,replySourceId:j,replySourceTimestampMs:a.sortOrderMs,replyStatusType:i!=null?d("MAWMsgType").MSG_TYPE.IMAGE:void 0,replyToUserId:k,storyShareAuthor:b==null?void 0:b.storyShareAuthor}}if(f==null||(f==null?void 0:f.msgId)==null&&(f==null?void 0:f.sourceId)==null)return;l=f||{};h=l.author;j=l.mediaId;a=l.msgId;i=l.plaintextHash;k=l.sourceId;var n=l.specialTextSize,o=l.ts,p=l.type;l=l.xmaMessageType;o=o!=null?o*1e3:void 0;g=f.type===d("MAWMsgType").MSG_TYPE.TEXT||d("MAWXMAUtils").isXMAExternalLinkShare(l)?(g=f.msgContent)==null?void 0:g.content:void 0;var q=d("WAJids").authorToUserId(h,e),r=f.type===d("MAWMsgType").MSG_TYPE.TEXT?f.msgContent.mentionedJids:void 0;h=h===d("WAJids").AUTHOR_ME||q===e;e=b||{};b=e.replyMediaId;var s=e.replyMediaPreviewHeight,t=e.replyMediaPreviewWidth,u=e.replyMediaUrlFallback,v=e.replyPlaintextHash;e=e.replyXMAId;if(d("MAWXMAUtils").isXMAStoryReply(l)){return{isStoryProducerReply:d("MAWXMAUtils").isXMAStoryProducerReply(l),isStoryReaction:d("MAWXMAUtils").isXMAStoryReaction(l),isStoryReply:!0,replyMediaExpirationTimestampMs:f==null?void 0:f.expirationTs,replyMediaId:j,replyPlaintextHash:(f=v!=null?d("WAHashUtils").stringToPlaintextHash(v):i)!=null?f:void 0,replySenderIsMe:h,replySourceId:k,replySourceTimestampMs:o,replyStatusType:j!=null?d("MAWMsgType").MSG_TYPE.IMAGE:void 0,replyToUserId:q}}i=d("MAWImageUtils").boundHeightWidth(s,t,96*.8);f=i.height;k=i.width;return{isIGXMAPostShare:d("MAWXMAUtils").isIGXMAPostShare(l),isIGXMAStoryShare:d("MAWXMAUtils").isIGXMAStoryShare(l),isStoryReply:!1,replyMediaId:b,replyMediaPreviewHeight:p===d("MAWMsgType").MSG_TYPE.STICKER?f:s,replyMediaPreviewWidth:p===d("MAWMsgType").MSG_TYPE.STICKER?k:t,replyMediaUrlFallback:u,replyMentionedJids:r,replyMessageText:g,replyPlaintextHash:v!=null?d("WAHashUtils").stringToPlaintextHash(v):void 0,replySenderIsMe:h,replySourceId:a,replySourceTimestampMs:o,replyStatusType:n===1||n===2||n===3?d("MAWMsgType").MSG_TYPE.STICKER:p,replyToUserId:q,replyXMAId:e}}function a(a){a=a.specialTextSize;switch(a){case 1:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").SMALL);case 2:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").MEDIUM);case 3:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").LARGE);default:return(h||(h=d("LSIntEnum"))).ofNumber(c("LSHotEmojiSize").NONE)}}function b(a,b,e,f,g){var h,l,m=d("WAJids").extractUserId(d("MAWUserJidWrapper").getMyUserJid());h=((h=a.isForwarded)!=null?h:!1)&&a.type!==d("MAWMsgType").MSG_TYPE.STICKER;l=(l=a.forwardingScore)!=null?l:0;var n=d("MAWDbMsg").getCanonicalTsFromMsg(a),o=k(a,e,m),p=j(a),q=d("MAWXMAUtils").isXMAStoryShare(a.xmaMessageType),r=d("MAWXMAUtils").isXMAStoryReaction(a.xmaMessageType),s=d("MAWXMAUtils").isXMAExternalLinkShare(a.xmaMessageType),t=d("MAWXMAUtils").isIGXMAStoryMention(a.xmaMessageType),u=d("MAWXMAUtils").isFBXMAStoryMention(a.xmaMessageType),v=d("MAWXMAUtils").isXMAStoryHighlightShare(a.xmaMessageType),w=d("MAWXMAUtils").isXMAPostPrivateReply(a.xmaMessageType),x=d("MAWXMAUtils").isXMAMsgHighlightsTabFriendUpdatesReply(a.xmaMessageType),y=a.messageExpirationTs!=null&&a.messageExpirationTs<=d("WATimeUtils").unixTime(),z=d("MAWDbMsg").getSortOrderWithFallback(a),A=a.externalId;f=c("justknobx")._("3424")&&d("MAWMediaGalleryM2Utils").isMediaGalleryM2Enabled()&&a.source==="media_restore"?"EncryptedBackupsMedia":f;var B=void 0;if(!c("justknobx")._("2996"))B=(e==null?void 0:e.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(e==null?void 0:e.replyPlaintextHash):void 0;else{B=(e==null?void 0:e.replyPlaintextHash)!=null?d("WAHashUtils").stringToPlaintextHash(e==null?void 0:e.replyPlaintextHash):(e=o==null?void 0:o.replyPlaintextHash)!=null?e:void 0}switch(a.type){case d("MAWMsgType").MSG_TYPE.TEXT:e=d("MAWVault").isVaulted(a.msgContent.content)?a.msgContent.content:d("MAWVault").vault(a.msgContent.content);return babelHelpers["extends"]({},o,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:a.msgContent.commands,content:e,editCount:a.editCount,ephemeralDurationInSec:(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,externalId:A,forwardingScore:l,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,mentionedJids:a.msgContent.mentionedJids,msgId:a.msgId,offlineMsg:b,replyContent:p,replyPlaintextHash:B,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,specialTextSize:a.specialTextSize,transportKey:f,ts:n,type_:a.type});case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:return babelHelpers["extends"]({},o,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,ephemeralDurationInSec:(e=a.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec,externalId:A,forwardingScore:l,groupId:a.groupId,groupIndex:a.groupIndex,groupSize:a.groupSize,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyContent:p,replyPlaintextHash:B,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type});case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:return babelHelpers["extends"]({},o,{ack:a.ack,chatJid:a.threadJid,externalId:A,forwardingScore:l,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyContent:p,replyPlaintextHash:B,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type,unsupportedType:a.msgContent.subtype});case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:return{ack:a.ack,chatJid:a.threadJid,externalId:A,forwardingScore:l,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type};case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:case d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL:return babelHelpers["extends"]({},o,{ack:a.ack,chatJid:a.threadJid,externalId:A,forwardingScore:l,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,replyContent:p,replyPlaintextHash:B,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return{ack:a.ack,adminContent:[a.msgContent.authorName],adminType:a.msgContent.adminType,chatJid:a.threadJid,externalId:A,forwardingScore:l,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type};case d("MAWMsgType").MSG_TYPE.ADMIN:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_CREATE:case d("MAWMsgType").MSG_TYPE.GROUP_POLL_UPDATE:return{ack:a.ack,adminContent:(e=a.msgContent)==null?void 0:(e=e.adminMsgContent)==null?void 0:e.map(function(a){return a==="Facebook User"?"0":a}),adminType:(e=a.msgContent)==null?void 0:e.adminType,adminVersion:(e=a.msgContent)==null?void 0:e.version,chatJid:a.threadJid,externalId:A,forwardingScore:l,isAdminMessage:!0,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type};case d("MAWMsgType").MSG_TYPE.REVOKED:return{ack:a.ack,chatJid:a.threadJid,externalId:A,forwardingScore:l,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isExpiredMsg:y,isForwarded:h,msgId:a.msgId,offlineMsg:b,originalTs:a.originalTs,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type};case d("MAWMsgType").MSG_TYPE.XMA:var C;e=(e=a.msgContent)==null?void 0:e.content;C=e!=null?d("MAWVault").isVaulted(e)?(C=a.msgContent)==null?void 0:C.content:d("MAWVault").vault(e):void 0;s&&C==null&&d("WALogger").WARN(i());e=c("justknobx")._("1191")||r||s?C:void 0;return babelHelpers["extends"]({},o,{ack:a.ack,applicationErrorCode:a.applicationErrorCode,chatJid:a.threadJid,commands:(s=a.msgContent)==null?void 0:s.commands,content:e,ephemeralDurationInSec:(C=a.ephemeralSetting)==null?void 0:C.ephemeralExpirationInSec,externalId:A,forwardingScore:l,instanceKey:g,isAdminMessage:!1,isAuthorMe:a.author===d("WAJids").AUTHOR_ME,isCollapsed:a.isCollapsed,isExpiredMsg:y,isExpiredXmaMsg:a.isExpiredXmaMsg,isFBPostMention:d("MAWXMAUtils").isFBXMAPostMention(a.xmaMessageType),isFBStoryMention:u,isForwarded:h,isIGStoryMention:t,isMsgHighlightsTabFriendUpdatesReply:x,isPostPrivateReply:w,isStoryHighlightShare:v,isStoryReaction:r,isStoryShare:q,mentionedJids:(o=a.msgContent)==null?void 0:o.mentionedJids,msgId:a.msgId,offlineMsg:b,replyContent:p,replyPlaintextHash:B,sender:d("WAJids").authorToUserId(a.author,m),sortOrderMs:z,transportKey:f,ts:n,type_:a.type,xmaMessageType:a.xmaMessageType});default:return c("WAAssertUnreachable")(a.type)}}g.getSpecialTextSize=a;g.createBridgeMsg=b}),98);
__d("MAWBridgeSafeActionsWorkerAndUI",["ExecutionEnvironment","FBLogger","MAWBridge","Promise","ifRequireable"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e,f){return(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWBridge").getBridge().sendAndReceive("backend",a,e,f==null?void 0:f.isLoggingDisabled):new(h||(h=b("Promise")))(function(b,d){return c("ifRequireable")("MAWBridgeSendAndReceive",function(c){c=c.sendAndReceive;return b(c("backend",a,e,f))},function(){return d("MAWBridgeSendAndReceive not available in UI ifRequired")})})}function e(a,b,e){return(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWBridge").getBridge().fireAndForget("backend",a,b,e):c("ifRequireable")("MAWBridgeFireAndForget",function(c){c=c.fireAndForget;return c("backend",a,b,e)},function(){throw c("FBLogger")("messenger_web").mustfixThrow("MAWBridgeFireAndForget not available in UI ifRequired")})}g.sendAndReceiveBackendWorkerAndUIShared=a;g.fireAndForgetBackendWorkerAndUIShared=e}),98);
__d("MAWBridgeUIEventDataValidation",["FBLogger","I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){try{return(h||(h=d("I64"))).of_string(a)}catch(b){c("FBLogger")("messenger_web").catching(b).mustfix("Cannot convert string to i64: %s",a)}}g.stringToI64Opt=a}),98);
__d("MAWConvertExtendedContentTypeToLSXmaContentType",["LSXmaContentType","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==null)return null;switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_SHARE:return c("LSXmaContentType").FB_FEED_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY:return c("LSXmaContentType").FB_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:return c("LSXmaContentType").FB_STORY_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_MENTION:return c("LSXmaContentType").FB_STORY_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_VIDEO_SHARE:return c("LSXmaContentType").FB_FEED_VIDEO_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_GAMING_CUSTOM_UPDATE:return c("LSXmaContentType").FB_GAMING_CUSTOM_UPDATE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PRODUCER_STORY_REPLY:return c("LSXmaContentType").FB_PRODUCER_STORY_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_EVENT:return c("LSXmaContentType").FB_EVENT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_FEED_POST_PRIVATE_REPLY:return c("LSXmaContentType").FB_FEED_POST_PRIVATE_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:return c("LSXmaContentType").MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_SHORT:return c("LSXmaContentType").FB_SHORT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING:return c("LSXmaContentType").MSG_LOCATION_SHARING;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_LOCATION_SHARING_V2:return c("LSXmaContentType").MSG_LOCATION_SHARING_V2;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_POST_MENTION:return c("LSXmaContentType").FB_POST_MENTION;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_CONTACT:return c("LSXmaContentType").MSG_CONTACT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_AI_CONTACT:return c("LSXmaContentType").MSG_AI_CONTACT;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_MEMORIES_SHARE:return c("LSXmaContentType").MSG_MEMORIES_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE:return c("LSXmaContentType").MSG_EXTERNAL_LINK_SHARE;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:return c("LSXmaContentType").RTC_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:return c("LSXmaContentType").RTC_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:return c("LSXmaContentType").RTC_MISSED_AUDIO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:return c("LSXmaContentType").RTC_MISSED_VIDEO_CALL;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_PROFILE_DIRECTORY_ITEM:return c("LSXmaContentType").FB_PROFILE_DIRECTORY_ITEM;default:return null}}g.convertExtendedContentTypeToLSXmaContentType=a}),98);
__d("MAWBridgeXMAUtils",["I64","LSIntEnum","MAWBridgeUIEventDataValidation","MAWConvertExtendedContentTypeToLSXmaContentType","MAWXMAUtils","MNLSXMALayoutType","MNXMAPreviewImageDecorationType","MWPBumpEntityKey","MessagingAttachmentType","Promise","Random","ReQL","WAArmadilloXMA.pb","WAJids","asyncToGeneratorRuntime","cr:3468","gkx","vulture"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,d,e,f){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,k){c("vulture")("O9HqUR9Ln66booY-YJ_H00qQYSk=");var l=e.ctas,o=e.defaultCTA,s=m(e.targetId,e.targetType),t=(j||(j=d("I64"))).of_int32(d("Random").uint32());if(o!=null){var u=p(o,t,g,f,i,s,e.targetType);yield r(a,u,t,k.defaultCta)}u=d("MAWXMAUtils").isFBXMAPostMention(e.targetType)&&e.author===d("WAJids").AUTHOR_ME;e=[];l!=null&&!u&&(e=(yield (h||(h=b("Promise"))).all(l.map(function(b,d){c("vulture")("FS9rgRtQSCBgqBDmjEhGx6oF14I=");var e=n(t,d);b=q(b,e,g,f,i,s);d=d===0?k.attachmentCta1:d===1?k.attachmentCta2:d===2?k.attachmentCta3:void 0;return r(a,b,e,d)}))));return{attachmentCta1Id:e.length>0?e[0]:void 0,attachmentCta2Id:e.length>1?e[1]:void 0,attachmentCta3Id:e.length>2?e[2]:void 0,defaultCtaId:o==null?void 0:t}});return k.apply(this,arguments)}function l(a){c("vulture")("hXUTvUlLddAt4tnK51PASde0ql4=");var b="xma_web_url";switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:b="xma_rtc_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:b="xma_rtc_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:b="xma_rtc_missed_audio";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:b="xma_rtc_missed_video";break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:b="igd_web_post_share";break}return b}function m(a,b){c("vulture")("RtrQPFyKbSxp3zQ6y7mRAyIpKg0=");return d("MAWXMAUtils").isFBXMAPostMention(b)?void 0:a!=null?d("MAWBridgeUIEventDataValidation").stringToI64Opt(a):void 0}function n(a,b){c("vulture")("JeoHtr-cANPUXRFURoTT-O9wNGw=");return(j||(j=d("I64"))).add(a,j.of_int32(b+1))}function o(a,b,e,f,g,h,i){i===void 0&&(i="xma_web_url");c("vulture")("TPVjzD3W2FhHtDFXV7frriVWOF4=");var k=a.actionUrl,l=a.nativeUrl;return{actionContentBlob:void 0,actionUrl:k!=null?k:l,attachmentFbid:g,attachmentIndex:(j||(j=d("I64"))).zero,ctaId:b,enableExtensions:!1,extensionHeightType:void 0,messageId:e,nativeUrl:l!=null?l:k,platformToken:void 0,targetId:h!=null?h:void 0,threadKey:f,title:(g=a.title)!=null?g:"Tap to view status update",type_:(b=i)!=null?b:"xma_web_url",urlWebviewType:void 0}}function p(a,b,d,e,f,g,h){c("vulture")("paKBJ90wVybJw9AE17Uahus-Tcw=");h=l(h);return o(a,b,d,e,f,g,h)}function q(a,b,d,e,f,g){c("vulture")("h6hxaD-G7lwZC6MPq4LKF4PwrcQ=");var h;switch(a.ctaType){case"contact_sharing_profile":h="contact_sharing_profile";break;case"contact_sharing_message":h="contact_sharing_message";break}return o(a,b,d,e,f,g,h)}function r(a,b,c,d){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,d,e){c("vulture")("DTetya-IU_PFmX8oHIx4vTaUgK8=");e!=null?yield a.attachment_ctas.upsert([e.ctaId],b):yield a.attachment_ctas.add(b);return d});return s.apply(this,arguments)}function e(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){c("vulture")("yfSGZVb6sl7NxuKoaOXCME8zjEo=");var f=null,g={attachmentCta1:void 0,attachmentCta2:void 0,attachmentCta3:void 0,defaultCta:void 0};f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,e)));f!=null&&(g.defaultCta=(yield u(a,f.defaultCtaId)),g.attachmentCta1=(yield u(a,f.attachmentCta1Id)),g.attachmentCta2=(yield u(a,f.attachmentCta2Id)),g.attachmentCta3=(yield u(a,f.attachmentCta3Id)));return[f,g]});return t.apply(this,arguments)}function u(a,e){c("vulture")("_xth6X03My6Q_hMNqb4d6th4mqc=");return e==null?(h||(h=b("Promise"))).resolve(void 0):(a=d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachment_ctas).getKeyRange(e)))!=null?a:void 0}function f(a,e,f,g,h,k,l,m,n){var o;c("vulture")("742za5xaNRYbKPRvd0fsHwCgluA=");var p=b("cr:3468")!=null?(j||(j=d("I64"))).of_int32(b("cr:3468").getInChatMsgIdFromMsgId(g)):(j||(j=d("I64"))).zero,q=v(a),r=d("MAWConvertExtendedContentTypeToLSXmaContentType").convertExtendedContentTypeToLSXmaContentType(a.targetType);r=r?(j||(j=d("I64"))).of_int32(r):void 0;o=(o=a==null?void 0:(o=a.defaultCTA)==null?void 0:o.actionUrl)!=null?o:a==null?void 0:(o=a.defaultCTA)==null?void 0:o.nativeUrl;a.defaultPreviewMediaId!=null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.new_xma_handler","xma_preview_media_has_plaintext_hash."+n+"."+a.targetType+"."+(a.defaultPreviewMediaPlaintextHash!=null?"true":"false"));n=c("gkx")("11351");return{accessibilitySummaryText:void 0,actionUrl:o!=null?o:void 0,attachmentCta1Id:h,attachmentCta2Id:k,attachmentCta3Id:l,attachmentFbid:f,attachmentIndex:(j||(j=d("I64"))).zero,attachmentLoggingType:void 0,attachmentType:(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").XMA),attributionAppIcon:void 0,attributionAppIconFallback:void 0,attributionAppIconUrlExpirationTimestampMs:void 0,attributionAppId:void 0,attributionAppName:void 0,authorityLevel:j.zero,avatarCount:void 0,avatarViewAccessibilityLabel:void 0,avatarViewSize:void 0,avatarViewTitleList:void 0,avatarViewUrlExpirationTimestampList:void 0,avatarViewUrlFallbackList:void 0,avatarViewUrlList:void 0,captionBodyText:void 0,cta1Title:x(a.ctas,1),cta1Type:w(a.ctas,1),cta2Title:x(a.ctas,2),cta2Type:w(a.ctas,2),cta3Title:x(a.ctas,3),cta3Type:w(a.ctas,3),dashManifest:void 0,decryptionKey:void 0,defaultCtaId:m,defaultCtaTitle:(o=a.defaultCTA)==null?void 0:o.title,defaultCtaType:q.xmaContentType,descriptionText:void 0,ephemeralMediaState:void 0,faviconUrl:void 0,faviconUrlExpirationTimestampMs:void 0,faviconUrlFallback:void 0,filename:void 0,filesize:a.filesize!=null?(j||(j=d("I64"))).of_int32(a.filesize):void 0,gatingTitle:a.overlayTitle,gatingType:a.overlayIconGlyph!=null?String(a.overlayIconGlyph):void 0,hasMedia:a.hasMedia!=null?a.hasMedia:!1,hasXma:!0,hasXmaFavicon:n?a.faviconPlaintextHash!=null:a.faviconMediaId!=null,hasXmaHeaderImage:n?a.headerMediaPlaintextHash!=null:a.headerMediaId!=null,hasXmaPreview:n?a.defaultPreviewMediaPlaintextHash!=null:a.defaultPreviewMediaId!=null,headerImageUrl:void 0,headerImageUrlExpirationTimestampMs:void 0,headerImageUrlFallback:void 0,headerImageUrlMimeType:void 0,headerTitle:a.headerTitle,imageUrl:void 0,imageUrlExpirationTimestampMs:void 0,imageUrlFallback:void 0,imageUrlMimeType:void 0,isBorderless:void 0,isPreviewImage:void 0,isSharable:!0,listItemAccessibilityText1:void 0,listItemAccessibilityText2:void 0,listItemAccessibilityText3:void 0,listItemContactUrlExpirationTimestampList1:void 0,listItemContactUrlExpirationTimestampList2:void 0,listItemContactUrlExpirationTimestampList3:void 0,listItemContactUrlFallbackList1:void 0,listItemContactUrlFallbackList2:void 0,listItemContactUrlFallbackList3:void 0,listItemContactUrlList1:void 0,listItemContactUrlList2:void 0,listItemContactUrlList3:void 0,listItemId1:void 0,listItemId2:void 0,listItemId3:void 0,listItemProfilePictureUrl1:void 0,listItemProfilePictureUrl2:void 0,listItemProfilePictureUrl3:void 0,listItemProfilePictureUrlExpirationTimestamp1:void 0,listItemProfilePictureUrlExpirationTimestamp2:void 0,listItemProfilePictureUrlExpirationTimestamp3:void 0,listItemProfilePictureUrlFallback1:void 0,listItemProfilePictureUrlFallback2:void 0,listItemProfilePictureUrlFallback3:void 0,listItemProgressBarFilledPercentage1:void 0,listItemProgressBarFilledPercentage2:void 0,listItemProgressBarFilledPercentage3:void 0,listItemsDescriptionSubtitleText:void 0,listItemsDescriptionText:void 0,listItemsId:void 0,listItemsSecondaryDescriptionText:void 0,listItemTitleText1:void 0,listItemTitleText2:void 0,listItemTitleText3:void 0,localPlayableUrl:void 0,maxSubtitleNumOfLines:a.maxSubtitleNumOfLines!=null?(j||(j=d("I64"))).of_int32(a.maxSubtitleNumOfLines):void 0,maxTitleNumOfLines:a.maxTitleNumOfLines!=null?(j||(j=d("I64"))).of_int32(a.maxTitleNumOfLines):void 0,messageId:g,miniPreview:void 0,offlineAttachmentId:(h=a.offlineAttachmentId)!=null?h:f,originalFileHash:void 0,originalPageSenderId:void 0,playableDurationMs:void 0,playableUrl:void 0,playableUrlExpirationTimestampMs:void 0,playableUrlFallback:void 0,playableUrlMimeType:void 0,preheaderText:void 0,previewHeight:q.height,previewHeightLarge:a.previewHeightLarge!=null?(j||(j=d("I64"))).of_int32(a.previewHeightLarge):void 0,previewImageDecorationType:z(a.targetType),previewUrl:void 0,previewUrlExpirationTimestampMs:void 0,previewUrlFallback:void 0,previewUrlLarge:void 0,previewUrlMimeType:void 0,previewWidth:q.width,previewWidthLarge:a.previewWidthLarge!=null?(j||(j=d("I64"))).of_int32(a.previewWidthLarge):void 0,samplingFrequencyHz:void 0,shouldAutoplayVideo:void 0,shouldHighlightHeaderTitleInTitle:void 0,shouldRespectServerPreviewSize:void 0,sourceText:void 0,subtitleIconUrl:void 0,subtitleText:a.subtitleText,targetId:void 0,threadKey:e,timestampMs:p,titleText:a.titleText,transportKey:"WhatsApp",viewerSeenTimestampMs:void 0,waveformData:void 0,xmaContentType:r,xmaDataclass:a.xmaDataclass,xmaFaviconFbid:n?a.faviconPlaintextHash:c("gkx")("8162")?(k=a.faviconPlaintextHash)!=null?k:(l=a.faviconMediaId)==null?void 0:l.toString():(m=a.faviconMediaId)==null?void 0:m.toString(),xmaHeaderImageFbid:n?a.headerMediaPlaintextHash:c("gkx")("8162")?(o=a.headerMediaPlaintextHash)!=null?o:(g=a.headerMediaId)==null?void 0:g.toString():(h=a.headerMediaId)==null?void 0:h.toString(),xmaLayoutType:a.xmaLayoutType!=null?y(a.xmaLayoutType):void 0,xmaPreviewFbid:n?a.defaultPreviewMediaPlaintextHash:c("gkx")("8162")?(f=a.defaultPreviewMediaPlaintextHash)!=null?f:(q=a.defaultPreviewMediaId)==null?void 0:q.toString():(e=a.defaultPreviewMediaId)==null?void 0:e.toString(),xmasTemplateType:a.xmaLayoutType!=null?y(a.xmaLayoutType):void 0}}function v(a){c("vulture")("jDkoucRq29lspjqv5EoQ6AgFAd0=");var b;switch(a.targetType){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_SHARE:b={height:(j||(j=d("I64"))).of_int32(108),width:(j||(j=d("I64"))).of_int32(72),xmaContentType:"xma_montage_share"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_AUDIO_CALL:b={xmaContentType:"xma_rtc_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_VIDEO_CALL:b={xmaContentType:"xma_rtc_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_AUDIO_CALL:b={xmaContentType:"xma_rtc_missed_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_MISSED_VIDEO_CALL:b={xmaContentType:"xma_rtc_missed_video"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_AUDIO_CALL:b={xmaContentType:"xma_rtc_missed_group_audio"};break;case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.RTC_GROUP_VIDEO_CALL:b={xmaContentType:"xma_rtc_missed_group_video"};break;default:b={height:a.previewHeight!=null?(j||(j=d("I64"))).of_int32(a.previewHeight):void 0,width:a.previewWidth!=null?(j||(j=d("I64"))).of_int32(a.previewWidth):void 0,xmaContentType:"xma_web_url"};break}return b}function w(a,b){c("vulture")("TheQVa9Nd4XKW6zs8pdW_r3R5dg=");if(a==null)return;a=a[b-1];if(a==null)return;b=a.buttonType;a=a.ctaType;switch(a){case"contact_sharing_profile":return"contact_sharing_profile";case"contact_sharing_message":return"contact_sharing_message";default:return b===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_VIDEO_POST_SHARE?"xma_open_native":void 0}}function x(a,b){c("vulture")("idNERK5bjV0orYRNft9x_2C0Snw=");if(a==null)return;a=a[b-1];if(a!=null)return a.title}function y(a){c("vulture")("3qCMJv9X6w87pBTl2ps2SOMJ2wI=");return a===0||a!==3?(i||(i=d("LSIntEnum"))).ofNumber(c("MNLSXMALayoutType").SINGLE):(i||(i=d("LSIntEnum"))).ofNumber(c("MNLSXMALayoutType").PORTRAIT)}function z(a){c("vulture")("al4CANl8TA9Z0WUMhchfaDG4SLk=");switch(a){case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").COLLAGE);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").REEL);case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION:case d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").INSTAGRAM_ICON);default:return(i||(i=d("LSIntEnum"))).ofNumber(c("MNXMAPreviewImageDecorationType").DEFAULT)}}g.addAttachmentCtas=a;g.maybeBridgeToLSTargetId=m;g.getCtaIdFromDefaultCtaId=n;g.composeDefaultAttachmentCta=p;g.composeAttachmentCta=q;g.getExistingAttachmentAndAttachmentCtas=e;g.composeAttachmentXMA=f}),98);
__d("MAWCastToMsgrServerMediaType",["EncryptedBackupsUploadEntity","MAWDbMedia","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid attachment mediaType: "," for castMediaAttachmentTypeToServerMediaType method"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid client mediaType: "," for castClientMediaTypeToServerMediaType method"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["invalid mediaType: "," for castToMsgrServerMediaType method"]);j=function(){return a};return a}function a(a,b){b===void 0&&(b=!1);if(b&&a==="image")return"xma";switch(a){case"image":case"video":case"gif":case"sticker":return a;case"document":return"file";case"ptt":return"audio";case"xma-image":return"xma";case"preview":return"preview";default:d("WALogger").ERROR(j(),a);return null}}function b(a,b){b===void 0&&(b=!1);if(b&&a===d("MAWDbMedia").MEDIA_TYPE.IMAGE)return"xma";switch(a){case"Image":return"image";case"Video":return"video";case"Gif":return"gif";case"Sticker":return"sticker";case"DocumentFile":return"file";case"Ptt":return"audio";default:d("WALogger").ERROR(i(),a);return null}}function c(a){switch(a){case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.IMAGE:return"image";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.VIDEO:return"video";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.GIF:return"gif";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.STICKER:return"sticker";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.DOCUMENT:return"file";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.PTT:return"audio";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.XMA:return"xma";case d("EncryptedBackupsUploadEntity").AttachmentContextMediaType.MESSENGER_PREVIEW:return"preview";default:d("WALogger").ERROR(h(),a);return null}}g.castToMsgrServerMediaType=a;g.castClientMediaTypeToServerMediaType=b;g.castMediaAttachmentTypeToServerMediaType=c}),98);
__d("MAWDbEditMsgHistory",["I64"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return a}function b(a){return(h||(h=d("I64"))).of_float(a)}function c(a){return(h||(h=d("I64"))).to_float(a)}g.unsafeCoerceToEditMsgHistoryId=a;g.convertToEditMsgHistoryId64=b;g.convertToEditMsgHistoryId=c}),98);
__d("MAWDbPoll",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}function c(a,b){a=(a+b).split("");return Math.abs(a.reduce(function(a,b){b=b.charCodeAt(0);a=(a<<5)-a+b;a&=a;return a},0))}f.convertStringToOptionHash=a;f.convertOptionHashToString=b;f.generateStableIdFromOptionHash=c}),66);
__d("MAWEBRestoreTrackingUtils",["LSIntEnum","LSMEBTaskCreationSource","MAWQplProxy","MWEBODSEntityName.enum","ODS","QPLUserFlow","WAHashStringToNumber","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={dyi:c("justknobx")._("467"),frontloaded:20,initial:20,paginated:c("justknobx")._("3177"),point:1,search:c("justknobx")._("2477")};function a(a,b,e,f){b!=null&&p({querySource:e,runningInWorker:f!=null?f:!1,taskSource:a,traceId:b,triggerType:"paginated"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.paginated")}function b(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource;a=a.traceId;a!=null&&p({querySource:b,runningInWorker:e!=null?e:!1,taskSource:f,traceId:a,triggerType:"initial"});(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.initial")}function e(a,b,e){b!=null&&p({querySource:"LS",runningInWorker:e!=null?e:!1,taskSource:a,traceId:b,triggerType:"dyi"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.dyi")}function f(a,b,e){b!=null&&p({querySource:"LS",runningInWorker:e!=null?e:!1,taskSource:a,traceId:b,triggerType:"frontloaded"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.frontloaded")}function k(a,b,e,f){b!=null&&p({querySource:e,runningInWorker:f!=null?f:!1,taskSource:a,traceId:b,triggerType:"point"}),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.point")}function l(a){var b=a.querySource,e=a.runningInWorker;a=a.traceId;a!=null&&p({querySource:b,runningInWorker:e!=null?e:!1,taskSource:c("LSMEBTaskCreationSource").FTS_INDEX_EB_MESSAGES_WEB,traceId:a,triggerType:"search"});(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.request.search")}function m(a,b){a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLSuccessThroughBridge(c("qpl")._(521476165,"2432"),void 0,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endSuccess(c("qpl")._(521476165,"2432"),{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.success")}function n(a,b,e,f){e===void 0&&(e="restore_failure"),a!=null&&(b!=null&&b?d("MAWQplProxy").sendQPLFailThroughBridge(c("qpl")._(521476165,"2432"),e,f,d("WAHashStringToNumber").hashStringToNumber(a)):c("QPLUserFlow").endFailure(c("qpl")._(521476165,"2432"),e,{annotations:f,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})),(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore.decryption.failure")}function o(a){u("protobuf",a)}function p(a){var b=a.querySource,e=a.runningInWorker,f=a.taskSource,g=a.traceId;a=a.triggerType;if(e!=null&&e){var h;d("MAWQplProxy").startQplUserFlow(c("qpl")._(521476165,"2432"),{bool:{runningInWorker:e!=null?e:!1},"int":{requestedMessagesCount:(h=j[a])!=null?h:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},{providedInstanceKey:d("WAHashStringToNumber").hashStringToNumber(g),providedTimeoutInMs:c("justknobx")._("2950")})}else{c("QPLUserFlow").start(c("qpl")._(521476165,"2432"),{annotations:{bool:{runningInWorker:e!=null?e:!1},"int":{requestedMessagesCount:(h=j[a])!=null?h:10},string:{querySource:b,taskSource:v(f),traceId:g,triggerType:a}},instanceKey:d("WAHashStringToNumber").hashStringToNumber(g),timeoutInMs:c("justknobx")._("2950")})}}function q(a){var b=a.pointName;a=a.traceId;c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function r(a){var b=a.annotations,e=a.pointName;a=a.traceId;c("QPLUserFlow").addAnnotations(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)});c("QPLUserFlow").addPoint(c("qpl")._(521476165,"2432"),e,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function s(a){var b=a.annotations,e=a.pointName;a=a.traceId;a!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),e,{annotations:b,instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function t(a){var b=a.pointName;a=a.traceId;d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(521476165,"2432"),b,{instanceKey:d("WAHashStringToNumber").hashStringToNumber(a)})}function u(a,b){b=b?(i||(i=d("LSIntEnum"))).unwrapIntEnum(b):null;(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore."+a+"."+v(b))}function v(a){return(a=a==null?void 0:a.toString())!=null?a:"unknown"}g.markEBRestorePaginated=a;g.markEBRestoreInitial=b;g.markEBRestoreDYI=e;g.markEBRestoreFrontloaded=f;g.markEBRestorePoint=k;g.markEBRestoreSearch=l;g.markEBRestoreSuccess=m;g.markEBRestoreFail=n;g.markEBRestoreProtobuf=o;g.addQPLRestorePoint=q;g.addQPLRestorePointWithAnnotations=r;g.addQPLRestorePointWithAnnotationsWorker=s;g.addQPLRestorePointWorker=t}),98);
__d("MWEBODSEntityKey.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({START:"start",SUCCESS:"success",FAIL:"fail",INCORRECT_PIN_CODE:"incorrect_pin_code",INCORRECT_RECOVERY_CODE:"incorrect_recovery_code",TIMEOUT:"timeout",CANCEL:"cancel"});c=a;f["default"]=c}),66);
__d("MWEBODSUtils",["CurrentMessengerUser","MWEBODSCategory","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){var f=d("CurrentMessengerUser").getAppID();f=f!=null?f.toString():"unknown";f=a+"."+f;(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),f,b,e!=null?e:1);h.bumpEntityKey(c("MWEBODSCategory"),a,b,e!=null?e:1)}function b(a,b,c){b===void 0&&(b=100);c===void 0&&(c=5);if(a===0)return"zero";if(a<0)return"negative";if(c<=0)return"invalidIncrement";if(a>b)return"greaterThanLimit";a=Math.floor((a-1)/c)*c+1;c=Math.min(a+c-1,b);return a+"-"+c}g.markODSForEB=a;g.getBucketName=b}),98);
__d("WAGetHashFromProtocolMsgId",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a.externalId+"_"+a.author+"_"+a.chat}f.getHashFromProtocolMsgId=a}),66);
__d("WAWaitForComms",["WACommsConnectionState","WAResolvable"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WAResolvable").Resolvable)();function a(){return h.promise}function b(){d("WACommsConnectionState").WACommsConnectionState.set(!1),h.isSettled&&(h=new(d("WAResolvable").Resolvable)())}function c(){d("WACommsConnectionState").WACommsConnectionState.set(!0),h.resolve()}function e(){return!h.resolveWasCalled()}function f(a){return h.reject(a)}g.waitForComms=a;g.commsConnectionLost=b;g.unblockComms=c;g.isStillWaitingForComms=e;g.failComms=f}),98);
__d("WANetworkConnectionUtils",["ExecutionEnvironment","Promise","WATagsLogger","WAWaitForComms"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["waitForNetworkConnection is only supported in the shared worker. Returning a hard-coded resolved promise."]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["hasNetworkConnection is only supported in the shared worker. Returning hard-coded true."]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["WANetworkConnectionUtils"]);function a(){if((i||(i=c("ExecutionEnvironment"))).isInSharedWorker!==!0){l.ERROR(k());return!0}return!d("WAWaitForComms").isStillWaitingForComms()}function e(){if((i||(i=c("ExecutionEnvironment"))).isInSharedWorker!==!0){l.ERROR(j());return(h||(h=b("Promise"))).resolve()}return d("WAWaitForComms").waitForComms()}g.hasNetworkConnection=a;g.waitForNetworkConnection=e}),98);
__d("MAWEBUploadTrackingUtils",["MAWAckLevel","MAWEBSwitch","MAWExternalId","MAWMsgType","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","MWEBODSUtils","ODS","QPLUserFlow","QuickPerformanceLogger","WAExceededStorageQuota","WAGetHashFromProtocolMsgId","WAGlobals","WAHashStringToNumber","WANetworkConnectionUtils","justknobx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={ERROR_FETCHING_DB_MESSAGE:"error_fetching_db_message",FAILED_TO_ACK_MESSAGE:"failed_to_ack_message",FAILED_TO_CONSTRUCT_ECHO_MESSAGE:"failed_to_construct_echo_message",MESSAGE_UPLOAD_TIMEOUT:"message_upload_timeout",RUNTIME_ERROR:"runtime_error"};function a(a,b,e,f,g,h,j,k,m){g===void 0&&(g=!1);h===void 0&&(h=!1);k===void 0&&(k="unknown");m===void 0&&(m=0);if(!c("MAWEBSwitch").isEnabled())return;c("QPLUserFlow").start(c("qpl")._(521481602,"829"),{annotations:{bool:{eb_switch:c("MAWEBSwitch").isEnabled(),eb_upload_queue:!0,fromUploadQueue:g,is_retroactive_upload:h,middleware_init:!1},"int":{attachmentsSize:j!=null?j:0,instanceKey:f,retryCount:m},string:{comms_status:d("WANetworkConnectionUtils").hasNetworkConnection()===!0?"connected":"disconnected",externalId:a,msgType:b,payloadType:k,triggerType:e}},instanceKey:f,timeoutInMs:c("justknobx")._("1405")});l(f,"upload_tracking_started");(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").START);d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+(b!=null?b:"unknown"));g=d("MAWMsgType").isMAWSupportedMediaType(b!=null?b:"Text")?"media":"non-media";d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload."+g)}function k(a){return a==null?{string:{comms_status_on_failure:d("WANetworkConnectionUtils").hasNetworkConnection()===!0?"connected":"disconnected"}}:babelHelpers["extends"]({},a,{string:babelHelpers["extends"]({},a.string,{comms_status_on_failure:d("WANetworkConnectionUtils").hasNetworkConnection()===!0?"connected":"disconnected"})})}function b(a,b,c,d){switch(a){case"success":n(b,c,d);break;case"fail":m(b,c,d);break;case"point":l(b,c,d);break}}function l(a,b,d){d&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),d,{instanceKey:a}),c("QPLUserFlow").addPoint(c("qpl")._(521481602,"829"),b,{instanceKey:a})}function e(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),k(b),{instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:b==null?void 0:(b=b.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").CANCEL)}function m(a,b,e){c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),k(e),{instanceKey:a});c("QPLUserFlow").endFailure(c("qpl")._(521481602,"829"),b,{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:e==null?void 0:(b=e.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").FAIL)}function n(a,b,c){l(a,b),o(a,c)}function o(a,b){b&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),b,{instanceKey:a}),c("QPLUserFlow").endSuccess(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0}},instanceKey:a}),(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").SUCCESS)}function f(a,b,e){l(a,b);e&&c("QPLUserFlow").addAnnotations(c("qpl")._(521481602,"829"),e,{instanceKey:a});c("QPLUserFlow").endTimeout(c("qpl")._(521481602,"829"),{annotations:{bool:{exceededStorageQuota:d("WAExceededStorageQuota").getExceededStorageQuota(),isRelaxedDurability:!0},string:{threadID:e==null?void 0:(b=e.string)==null?void 0:b.jid}},instanceKey:a});(i||(i=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,c("MWEBODSEntityKey.enum").TIMEOUT)}function p(a,b,d){var e=c("qpl")._(521481602,"829");l(a,b);d&&(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(e,d,{instanceKey:a});(h||(h=c("QuickPerformanceLogger"))).markerEnd(e,52,a,h.currentTimestamp())}function q(){return d("WAHashStringToNumber").hashStringToNumber(d("MAWExternalId").generateExternalId())}function r(a,b){b===void 0&&(b=0);return d("WAHashStringToNumber").hashStringToNumber(d("WAGetHashFromProtocolMsgId").getHashFromProtocolMsgId(a)+"_"+d("WAGlobals").getMyDeviceJid()+"_"+b)}function s(a){return c("MAWEBSwitch").isEnabled()&&d("MAWMsgType").isEBSupportedMsgType(a.type)&&a.ack>=d("MAWAckLevel").ACK.sent&&a.serverTs!=null&&!(a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0)}function t(a){return{addAnnotations:function(b){u(a,b)},addPoint:function(b,c){l(a,b,c)},endFail:function(b,c){m(a,b,c)},endSuccess:function(b){o(a,b)},getQPLAttrs:function(){return{event:c("qpl")._(521481602,"829"),instanceKey:a}},isActive:function(){return!0}}}function u(a,b){}function v(a,b){return a.get(b)}function w(a,b,c,d,e){b=v(b,c);if(b!=null)switch(a){case"success":n(b,d,e);break;case"fail":m(b,d,e);break;case"point":l(b,d,e);break}}g.EBUploadTrackingWorkerFailurePoints=j;g.startUploadTracking=a;g.handleBridgeEbUploadTrackingQPL=b;g.addPointWorkerOnly=l;g.endCancelWorkerOnly=e;g.endFailWorkerOnly=m;g.endSuccessWorkerOnly=n;g.endTimeoutWorkerOnly=f;g.endRetryWorkerOnly=p;g.genInstanceKeyOnly=q;g.genInstanceKeyForUploadQueue=r;g.isUploadSupported=s;g.makeEBWorkerQplFlowFromInstanceKey=t;g.getUploadTrackingInstanceKey=v;g.addUploadTrackingByType=w}),98);
__d("MAWEncryptedBackupsStateManager",["MAWEBSwitch"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case 1:return;case 3:c("MAWEBSwitch").set(!0);return;case 2:case 4:default:c("MAWEBSwitch").set(!1);return}}function b(a){return a===4||a===3}g.setEncryptedBackupsState=a;g.eligibleForEBUX=b}),98);
__d("MAWIndexedDBDeletion",["CurrentMessengerUser","FBLogger","MAWIndexedDbMetadata","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,d){return indexedDB==null||a==null?(h||(h=b("Promise"))).resolve():new(h||(h=b("Promise")))(function(b,e){var f=indexedDB.deleteDatabase(a);f.onsuccess=function(){c("FBLogger")("maw_db").warn("%s db was deleted",d),b()};f.onblocked=function(){c("FBLogger")("maw_db").mustfix("Cannot delete %s db: blocked. Make sure DB is closed.",d)};f.onerror=function(){c("FBLogger")("maw_db").mustfix("Cannot delete %s db",d),e(f.error)}})}function a(){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=d("CurrentMessengerUser").getID();yield (h||(h=b("Promise"))).all([i(d("MAWIndexedDbMetadata").dbName(a),"maw_v1"),i(d("MAWIndexedDbMetadata").restoreDbName2(a),"maw_v3"),i(d("MAWIndexedDbMetadata").jobsDbName(a),"signal"),i(d("MAWIndexedDbMetadata").logDbName(a),"logDb")])});return j.apply(this,arguments)}g.deleteDB=i;g.deleteMAWPersistence=a}),98);
__d("MAWLocalStorage",["LocalStorageWrapper","MWLocalStorageErrorHandler","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["not storage found"]);h=function(){return a};return a}function i(a){d("WALogger").LOG([a])}function j(a){d("WALogger").ERROR([a])}function a(){return d("LocalStorageWrapper").getStorage(i)}function b(){return d("LocalStorageWrapper").isLocalStorageAvailable(i)}function c(a,b,c){return d("LocalStorageWrapper").setItemGuarded(a,b,c,j,d("MWLocalStorageErrorHandler").onQuotaExceeded)}function e(a,b){a==null?d("WALogger").ERROR(h()):a.removeItem(b)}g.getStorage=a;g.isLocalStorageAvailable=b;g.setItemGuarded=c;g.removeItemGuarded=e}),98);
__d("MWTabCommunicationChannel",["MAWLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof window!=="undefined"?window:self;function i(a){var b=d("MAWLocalStorage").getStorage(),c=function(c){d("MAWLocalStorage").setItemGuarded(b,a,JSON.stringify(c))},e=function(c){window.removeEventListener("storage",c),d("MAWLocalStorage").removeItemGuarded(b,a)},f=function(a){window.addEventListener("storage",a)},g=function(b){return b!=null&&b.key===a&&typeof b.newValue==="string"?JSON.parse(b.newValue):null};return{getMessage:g,onRequestReceived:function(a){var b=function(b){b=g(b);b!=null&&a(b)};f(b);return{release:function(){e(b)}}},sendMessage:c,stopWaitingForReply:e,waitForReply:f}}function j(a){var b=new h.BroadcastChannel(a),c=new Set();b.addEventListener("message",function(a){c.forEach(function(b){b(a)})});var d=function(a){c.add(a)},e=function(a){c["delete"](a)};a=function(a){b.postMessage(JSON.stringify(a))};var f=function(a){return a!=null&&typeof a.data==="string"?JSON.parse(a.data):null};return{getMessage:f,onRequestReceived:function(a){var b=function(b){b=f(b);b!=null&&a(b)};d(b);return{release:function(){e(b)}}},sendMessage:a,stopWaitingForReply:e,waitForReply:d}}function a(a){return h.BroadcastChannel!=null?j(a):i(a)}g.getChannel=a}),98);
__d("MWTabCommunication",["MWTabCommunicationChannel","Promise","clearTimeout","pageID","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){function a(a,b){var c=this;this.$2=null;this.$5=function(a){a=c.$4.getMessage(a);a!=null&&a.a==="sb"&&a.t!==c.tabID()&&a.r===c.tabID()&&a.k!=null&&(c.$2&&c.$2(a.k),c.$4.stopWaitingForReply(c.$5),c.$2=null)};this.$1=a;this.$3=b!=null?b:500;this.$4=d("MWTabCommunicationChannel").getChannel(a)}var e=a.prototype;e.tabID=function(){return c("pageID")};e.$6=function(){var a={a:"r",t:this.tabID()};this.$4.sendMessage(a)};e.listenToRequest=function(a){return this.listenToRequestAsync(function(){return(h||(h=b("Promise"))).resolve(a())})};e.listenToRequestAsync=function(a){var b=this,d=function(d){d.a==="r"&&d.t!==b.tabID()&&c("promiseDone")(a().then(function(a){a={a:"sb",k:a,r:d.t,t:b.tabID()};b.$4.sendMessage(a)}))};return this.$4.onRequestReceived(d)};e.$7=function(){var a=this;return new(h||(h=b("Promise")))(function(b){a.$2=b,a.$4.waitForReply(a.$5),a.$6()})};e.request=function(a,d){var e=this,f,g=function(){f!=null&&c("clearTimeout")(f)};return(h||(h=b("Promise"))).race([this.$7().then(function(b){e.$4.stopWaitingForReply(e.$5);return a(b)}),new h(function(a){f=c("setTimeout")(function(){a(d()),e.$4.stopWaitingForReply(e.$5)},e.$3)})]).then(function(a){g();return a})};return a}();g.MWTabCommunication=a}),98);
__d("MWEARKeychainV3",["$InternalEnum","Deferred","ExecutionEnvironment","FBLogger","LSPlatformLsInitLog","MAWCryptoConsts","MAWCurrentUser","MAWEARGenNewKeychainCryptoKey","MAWGenKeychainCryptoKeyWithVersion","MAWQplProxy","MAWReliabilityMonitor","MWEARKeychainV3Errors","MWTabCommunication","Promise","QPLUserFlow","Random","ReStoreTabNotifier","WAArrayBufferUtils","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","getErrorSafe","gkx","memoizeOneWithArgs","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(){return{accountKey:null,databaseEncryptionKeys:new Map(),dbReady:new(c("Deferred"))(),latestVersion:d("MAWCryptoConsts").VERSION}},k={global_ear:j(),maw_ear:j()},l=null,m=function(){var a=Object.keys(k).reduce(function(a,b){a[b]="none";return a},{});return{get:function(b){return a[b]},is:function(b,c){return a[b]===c},set:function(b,c){a[b]=c;(b=l)==null?void 0:b.updateState()}}}();function a(a){k[a]=j(),m.set(a,"none")}function e(a,b){m.set(a,b)}function n(a){var b=d("Random").uint32();while(a.some(function(a){return a.randomisedVersion===b}))b=d("Random").uint32();return b}var o={global_ear:function(){return null},maw_ear:function(){return null}},p=function(a){return o[a]()},q=function(a,b){o[a]=function(){return b}},r=function(a,b){q(a,b),x(a).dbReady.resolve()},s={global_ear:"browserEncryptionMetaV2",maw_ear:"encryptionMetaV3"},t=c("memoizeOneWithArgs")(function(a,b){return new(d("MWTabCommunication").MWTabCommunication)("ear_keys_"+b+"_"+a)});function f(a,b,c){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f;e===void 0&&(e=N);c("gkx")("9396")&&c("FBLogger")("messenger_web").info("Initialise EAR keychain: %s",a);l=K(a);if(m.is(a,"success")&&x(a).databaseEncryptionKeys.size!==0)return d("WAResultOrError").makeResult(w(a));var g=d("MAWCurrentUser").getID(),h=c("ReStoreTabNotifier")("channel-ear-keychain-v3-"+g);h.onEventReceive("notifyEarKeychainV2",G);var j=(i||(i=c("ExecutionEnvironment"))).isInWorker?"Worker":"UI";e(a+"_ear_init_start",{string:(f={},f["initFlow_"+a+"_"+j]=b,f)});try{b=(yield L(h,a,void 0,e));e(a+"_ear_import_end");for(f of b)x(a).databaseEncryptionKeys.set(f.result.version,{dbEntry:f.entry,keys:f.result.keys});F(a);t(a,g).listenToRequest(function(){return JSON.stringify(Array.from(x(a).databaseEncryptionKeys.entries()).map(function(a){var b=a[0];a=a[1];var c=a.dbEntry;a=a.keys;return[b,{dbEntry:c,keys:a.map(function(a){return d("WAArrayBufferUtils").arrayBufferToString(a)})}]}))});e(a+"_ear_init_end",{string_array:(h={},h[a+"_randomisedVersionKeys"+j]=v(a).map(function(a){a[0];a=a[1].dbEntry;return String(a.randomisedVersion)}),h)});m.set(a,"success");return d("WAResultOrError").makeResult(w(a))}catch(b){m.set(a,"failure");e(a+"_ear_init_error");c("gkx")("9396")&&c("FBLogger")("messenger_web").catching(c("getErrorSafe")(b)).mustfix("Failed to setup EAR Keychain V3. Namespace: %s",a);return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}});return u.apply(this,arguments)}function v(a){return Array.from(x(a).databaseEncryptionKeys.entries())}function w(a){return x(a).latestVersion}function x(a){return k[a]}function y(a,b){var e=b!=null?b:w(a);b=x(a).databaseEncryptionKeys.get(e);if(b==null){c("promiseDone")(C(a).then(function(a){var b=a.map(function(a){return a.version}).includes(e);c("FBLogger")("messenger_web").info("EAR Keychain DB match found: %s. Version = %s. NumberVersions = %s",b,e,a.length)}));var f=w(a),g=Array.from(x(a).databaseEncryptionKeys.keys());c("FBLogger")("messenger_web").mustfix("EAR Key v%s was null. Latest version: %s has key: %s, keychain length: %s, currentLatestVersion: %s, init status %s, in worker %s",e,f,x(a).databaseEncryptionKeys.get(f)==null,x(a).databaseEncryptionKeys.size,Math.max.apply(Math,g),m.get(a),(i||(i=c("ExecutionEnvironment"))).isInWorker);throw new(d("MWEARKeychainV3Errors").EARKeychainNotFoundError)("EAR Key "+e+" was null.")}return{dbEntry:b.dbEntry,keys:b.keys,randomisedVersion:b.dbEntry.randomisedVersion,version:e}}function z(a){return c("MAWGenKeychainCryptoKeyWithVersion")(a.key,a.seed,a.version,a.formatVersion,a.accountKeyString,a.userKeyBaseString,a.appIdOrigin)}var A=b("$InternalEnum")({UNKNOWN:-1,NO_KEY:0,EBSM_EARV2_UPGRADE:1,RANDOMISED_VERSION_UPGRADE:2,EXPIRED_KEY:3,FORCE_KEY_ROTATION:4});function B(a){if(a.length===0)return{reason:A.NO_KEY,result:!0};a=a[a.length-1];return!d("WATimeUtils").isInFuture(a.expiration)?{reason:A.EXPIRED_KEY,result:!0}:{result:!1}}function C(a){var c=E(a,"readonly");return new(h||(h=b("Promise")))(function(b,d){c.onabort=function(){return d(c.error)};c.onerror=function(){return d(c.error)};var e=c.objectStore(s[a]).getAll();e.onsuccess=function(){return b(e.result)};e.onerror=function(){return d(e.error)}}).then(D)}function D(a){var b=a.find(function(a){return a.version==null});b!=null&&c("FBLogger")("messenger_web").mustfix("EAR Keychain Rotation null version: fields nonnull: %s %s %s %s %s %s",b.id==null,b.key==null,b.seed==null,b.formatVersion==null,b.accountKeyString==null,b.userKeyBaseString==null);b=a.filter(function(a){return a.version!=null});return b.sort(function(a,b){return a.version-b.version})}function E(a,b){var d=p(a);if(d==null)throw c("FBLogger")("messenger_web").mustfixThrow("Encryption IndexDB should've been initialized. Namespace: %s",a);return d.transaction(s[a],b,{durability:"strict"})}var F=function(a){var b=Array.from(x(a).databaseEncryptionKeys.keys());b.length>0?x(a).latestVersion=Math.max.apply(Math,b):c("FBLogger")("messenger_web").mustfix("EAR latest version does not exist")},G=function(a){var d=a.namespace,e=a.version;c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{c("FBLogger")("messenger_web").info("Received key rotation notification. Namespace: %s",d);yield x(d).dbReady.getPromise();var a=(yield C(d)).find(function(a){return a.version===e});if(a==null)throw c("FBLogger")("messenger_web").mustfixThrow("Notified new Ear Key but missing in DB");var b=(yield z(a));x(d).databaseEncryptionKeys.set(b.version,{dbEntry:a,keys:b.keys});F(d);c("FBLogger")("messenger_web").info("Rotated key successfully. Namespace: %s",d)}catch(a){return c("FBLogger")("messenger_web").catching(a).mustfix("Failed to handleNewVersion. In worker %s. Namespace: %s.",(i||(i=c("ExecutionEnvironment"))).isInWorker,d)}})())};function H(a){return m.get(a)!=="none"}function I(a){return m.get(a)}function J(a){if(m.is(a,"success")){x(a).databaseEncryptionKeys.size===0&&c("FBLogger")("messenger_web").mustfix("Keychain initialised but no keys present");return!0}return!1}function K(a){return d("MAWReliabilityMonitor").MAWReliabilityMonitorSingleton.startMonitoring("EARv3",function(){return{extra:{isKeychainInitialised:J(a).toString(),latestVersion:w(a).toString()},reason:m.get(a),state:function(){switch(m.get(a)){case"none":return d("MAWReliabilityMonitor").HealthReportState.PENDING;case"success":return d("MAWReliabilityMonitor").HealthReportState.OK;case"failure":return d("MAWReliabilityMonitor").HealthReportState.ERROR;default:return d("MAWReliabilityMonitor").HealthReportState.UNKNOWN}}()}})}function L(a,b,c,d){return M.apply(this,arguments)}function M(){M=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d,e,f){var g=(yield c("MAWEARGenNewKeychainCryptoKey")());f(d+"_ear_raw_key_generated");var j=(yield new(h||(h=b("Promise")))(function(b,h){var j=E(d,"readwrite");j.onerror=function(){return h(j.error)};j.onabort=function(){return h(j.error)};var k=j.objectStore(s[d]).getAll();k.onerror=function(){return h(k.error)};k.onsuccess=function(){var l;f(d+"_ear_keys_fetched");var m=D(k.result),o=B(m),p=o.reason;o=o.result;if((e==null?void 0:e.forceKeyRotation)!==!0&&!o)return b(m);o=(e==null?void 0:e.forceKeyRotation)===!0?A.FORCE_KEY_ROTATION:p!=null?p:A.UNKNOWN;p=m.map(function(a){return a.version});l=(l=p[p.length-1])!=null?l:0;c("FBLogger")("messenger_web").info("Key rotation. EAR versions: %s. Latest version: %s. Namespace: %s, Worker: %s",p.toString(),l,d,(i||(i=c("ExecutionEnvironment"))).isInWorker);var q=babelHelpers["extends"]({},g,{randomisedVersion:n(m),source:o,version:l+1});f(d+"_ear_adding_new_key");j.oncomplete=function(){m.push(babelHelpers["extends"]({},q,{id:q.version})),a.postMessage("notifyEarKeychainV2",{namespace:d,version:q.version}),f(d+"_ear_gen_key_end"),b(m)};var r=j.objectStore(s[d]).add(q);r.onerror=function(){return h(c("FBLogger")("messenger_web").catching(r.error).mustfixThrow("Failed to rotate EAR key"))}}}));f(d+"_ear_import_start");j=(yield h.allSettled(j.map(function(a){return z(a).then(function(b){return{entry:a,result:b}})})));var k=j[j.length-1];if(k.status==="rejected"){var l;l=(l=e==null?void 0:e.corruptedEARRetryCount)!=null?l:0;if(l>=1)throw k.reason;return L(a,d,{corruptedEARRetryCount:l+1,forceKeyRotation:!0},f)}return j.map(function(a){if(a.status==="fulfilled")return a.value}).filter(Boolean)});return M.apply(this,arguments)}var N=function(a,b){d("LSPlatformLsInitLog").addPoint(a,b),O(a,b)},O=function(a,b){var e=c("qpl")._(25310776,"6155");(i||(i=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(e,"backend_"+a,{annotations:b}):(c("QPLUserFlow").addPoint(e,"ui_"+a),b!=null&&c("QPLUserFlow").addAnnotations(e,b))},P=function(a,b){return t(a,b).request(function(b){b=JSON.parse(b);b.forEach(function(b){var c=b[0];b=b[1];var e=b.keys.map(d("WAArrayBufferUtils").stringToArrayBuffer);x(a).databaseEncryptionKeys.set(c,{dbEntry:b.dbEntry,keys:e})});F(a);m.set(a,"success");return!0},function(){return!1})};g.InitStatus=m;g.resetKeychain__TEST_ONLY_DO_NOT_USE=a;g.setInitStatus__TEST_ONLY_DO_NOT_USE=e;g.generateNewRandomisedVersionNumber=n;g.setNamespaceSourceDbWithoutMarkingDbReady=q;g.setNamespaceSourceDbAndMarkAsReady=r;g.getEncryptionKeysTabCommunication=t;g.init=f;g.getLatestVersion=w;g.getKeychain=x;g.getDbEncryptionKey=y;g.isKeychainSettled=H;g.getKeychainInitStatus=I;g.isKeychainInitialised=J;g.logMawInitPoint=O;g.importKeysFromOtherTab=P}),98);
__d("WAWorkerGlobalScope",[],(function(a,b,c,d,e,f){"use strict";a=function(){if(typeof window!=="undefined")return window;return typeof globalThis!=="undefined"?globalThis:self}();f.workerGlobalScope=a}),66);
__d("MAWEncryptionIndexedDbV2",["BrowserLockManager","EARInitType","ExecutionEnvironment","FBLogger","IndexedDbPolyfills","MAWCurrentUser","MAWIndexedDBDeletion","MAWIndexedDbMetadata","MAWQplProxy","MWEARKeychainV3","Promise","QPLUserFlow","WALogger","WAWorkerGlobalScope","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Armadillo Web Remote Presence] MAW RP Initialising EAR"]);j=function(){return a};return a}b("IndexedDbPolyfills");var k="browserEncryptionMetaV2",l="version",m=1,n=6e4,o=null,p=null,q=null;function a(){return o}function e(){return o!=null}var r=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(babelHelpers.wrapNativeSuper(Error));function s(a,e){e===void 0&&(e=0);var f=d("MAWCurrentUser").getID();if(e>m){v(a,"ear_idb_retry_failed_max_reached");return(i||(i=b("Promise"))).reject(new r())}if(o!=null){v(a,"ear_db_exists");return(i||(i=b("Promise"))).resolve()}if(indexedDB==null){v(a,"ear_idb_unavailable");return(i||(i=b("Promise"))).reject(c("err")("IndexedDB API not available"))}v(a,"ear_db_open_start",{bool:{browserLockEnabled:c("BrowserLockManager")!=null}});return new(i||(i=b("Promise")))(function(b,g){var i=function(c){s(a,e+1).then(b)["catch"](function(a){if(a instanceof r)return g(c);g(a)})};try{q=d("MAWIndexedDbMetadata").encryptionDbName(f);var j=indexedDB.open(q),m=d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){g(c("err")("IndexedDB initialisation timeout in %s flow, isInWorker: %s, openRequest: %s",String(a),(h||(h=c("ExecutionEnvironment"))).isInWorker?"true":"false",j.readyState))},n);j.onupgradeneeded=function(b){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);v(a,"ear_db_upgrade_start");b=b.target.result;if(!b.objectStoreNames.contains(k)){b=b.createObjectStore(k,{autoIncrement:!0,keyPath:"id"});b.createIndex(l,l,{unique:!0})}v(a,"ear_db_upgrade_end")};j.onblocked=function(){v(a,"ear_db_open_blocked"),d("WAWorkerGlobalScope").workerGlobalScope.setTimeout(function(){g(c("err")("EAR Open timed out while blocked"))},2e3)};j.onsuccess=function(e){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);var f=e.target.result;if(!f.objectStoreNames.contains(k)){e=j.result.objectStoreNames.contains(k);c("FBLogger")("messenger_web").warn("Missing encryption meta table. Is store present: %s",e);d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);return t(f,"missing_encryption_meta_table").then(function(){i(c("err")("Malformed encryption DB"))})["catch"](function(b){v(a,"ear_idb_retry_failed_delete_failed");return g(c("err")("Failed to delete malformed encryption DB: "+b.message))})}f.onversionchange=function(){f.close(),c("FBLogger")("messenger_web").info("EAR onversionchange triggered"),d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m),p==null?void 0:p()};v(a,"ear_db_open_end");o=f;d("MWEARKeychainV3").setNamespaceSourceDbAndMarkAsReady("global_ear",o);b()};j.onerror=function(){d("WAWorkerGlobalScope").workerGlobalScope.clearTimeout(m);if(j.error.name==="UnknownError"){v(a,"ear_db_open_error_unknown_error");return i(j.error)}v(a,"ear_db_open_error");g(j.error)}}catch(b){v(a,"ear_db_error"),g(b)}})}function f(a){p=p==null?a:p}function t(a,b){a===void 0&&(a=o);c("FBLogger")("messenger_web").warn("EAR DB deletion triggered: %s",b);a!=null&&a.close();return d("MAWIndexedDBDeletion").deleteDB(q,"ear")}function u(a){switch(a){case c("EARInitType").EB_INIT:return c("qpl")._(521477507,"1406");case c("EARInitType").MAW_INIT:return c("qpl")._(25310776,"6155");case c("EARInitType").MAW_RP_INIT:d("WALogger").DEV(j());return c("qpl")._(25310776,"6155");case c("EARInitType").LS_INIT:return c("qpl")._(25305590,"1127");case c("EARInitType").MAW_IN_UI_INIT:return null}}function v(a,b,e){a=u(a);if(a==null)return;(h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWQplProxy").sendQplPointThroughBridge(a,"worker_"+b,{annotations:e}):(c("QPLUserFlow").addPoint(a,b),e!=null&&c("QPLUserFlow").addAnnotations(a,e))}g.storeName=k;g.ENCRYPTION_MAW_STORES_INDEX=l;g.getEncryptionDB=a;g.isEncryptionDBInited=e;g.makeEncryptionDB=s;g.maybeSetEncryptionDbOnVersionChange=f;g.deleteEncryptionDB_UNSAFE=t}),98);
__d("MAWEphemeralConsts",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=300;b=600;c=900;e=1800;d=Math.imul((f=d("WATimeUtils")).HOUR_SECONDS,6);var h=Math.imul(f.HOUR_SECONDS,12),i=Math.imul(f.DAY_SECONDS,14),j=1e3,k=5,l=10,m=30,n=60,o=d;g.fiveMinutesInSeconds=a;g.tenMinutesInSeconds=b;g.fifteenMinutesInSeconds=c;g.thirtyMinutesInSeconds=e;g.oneHourInSeconds=f.HOUR_SECONDS;g.sixHoursInSeconds=d;g.twelveHoursInSeconds=h;g.oneDayInSeconds=f.DAY_SECONDS;g.ephemeralMaxDelectionWindowForUnseenMessage=i;g.msPerSec=j;g.fiveSeconds=k;g.tenSeconds=l;g.thirtySeconds=m;g.oneMinuteInSeconds=n;g.ephemeralReportingWindowInSeconds=o}),98);
__d("MAWKeychain",["MWEARKeychainV3"],(function(a,b,c,d,e,f,g){"use strict";a={getDbEncryptionKey:d("MWEARKeychainV3").getDbEncryptionKey,getLatestVersion:d("MWEARKeychainV3").getLatestVersion,init:d("MWEARKeychainV3").init};g["default"]=a}),98);
__d("MAWMainTraceUtils",["I64","LSRequestId","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return c("LSRequestId").generate()}function e(a,b,c,d,e,f,g){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,i){yield a.data_trace_meta.add({contextOne:f,contextThree:i,contextTwo:g,foregroundTimestampMs:(h||(h=d("I64"))).zero,initTimestampMs:b,predefinedId:void 0,shouldFlush:!1,traceId:c,traceType:e})});return i.apply(this,arguments)}g.createTraceId=a;g.startTraceWithTxn=e}),98);
__d("MAWMediaDownloadStatus",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["DOWNLOADING","SUCCESS","NOT_MANUAL_RETRYABLE_FAILURE","MANUAL_RETRYABLE_FAILURE","MISSING_FILE","RETRYING","AUTOMATICALLY_RETRYABLE_TIMEOUT_FAILURE"]);c=a;f["default"]=c}),66);
__d("MAWMsg",["$InternalEnum","I64","LSBitFlag","LSIntEnum","LSMessagingThreadTypeUtil","LSReplyMessageAttachmentType","MAWMsgType","WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,b,c,e,f,g){if(a===d("MAWMsgType").MSG_TYPE.TEXT)if(b)return(i||(i=d("LSIntEnum"))).ofNumber(8192);else return(i||(i=d("LSIntEnum"))).ofNumber(1);else if(a===d("MAWMsgType").MSG_TYPE.IMAGE||a===d("MAWMsgType").MSG_TYPE.VIDEO||a===d("MAWMsgType").MSG_TYPE.RAVEN)return(i||(i=d("LSIntEnum"))).ofNumber(2);else if(a===d("MAWMsgType").MSG_TYPE.PTT)return(i||(i=d("LSIntEnum"))).ofNumber(4);else if(a===d("MAWMsgType").MSG_TYPE.FUTUREPROOF)return k(f);else if(a===d("MAWMsgType").MSG_TYPE.CIPHERTEXT)return(i||(i=d("LSIntEnum"))).ofNumber(65536);else if(a===d("MAWMsgType").MSG_TYPE.UNAVAILABLE)return(i||(i=d("LSIntEnum"))).ofNumber(262144);else if(a===d("MAWMsgType").MSG_TYPE.GIF)return(i||(i=d("LSIntEnum"))).ofNumber(16384);else if(a===d("MAWMsgType").MSG_TYPE.STICKER)return(i||(i=d("LSIntEnum"))).ofNumber(4096);else if(a===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE)return(i||(i=d("LSIntEnum"))).ofNumber(64);else if(a===d("MAWMsgType").MSG_TYPE.XMA)if(c!=null&&c)return(i||(i=d("LSIntEnum"))).ofNumber(256);else return g===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_RECEIVER_FETCH?(i||(i=d("LSIntEnum"))).ofNumber(536870912):(i||(i=d("LSIntEnum"))).ofNumber(1024);else if(a===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)if(!e)return(i||(i=d("LSIntEnum"))).ofNumber(33554432);else return(i||(i=d("LSIntEnum"))).ofNumber(1);else if(a===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH)return(i||(i=d("LSIntEnum"))).ofNumber(134217728);else return(i||(i=d("LSIntEnum"))).ofNumber(1)}function k(a){switch(a){case"liveLocationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(4294967296);case"locationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(524288);case"pollCreationMessage":return(i||(i=d("LSIntEnum"))).ofNumber(1048576);case"contactShareMessage":return(i||(i=d("LSIntEnum"))).ofNumber(2097152);case"storyMentionMessage":return(i||(i=d("LSIntEnum"))).ofNumber(4194304);case"postMentionMessage":return(i||(i=d("LSIntEnum"))).ofNumber(2147483648);case"metaAiMessage":return(i||(i=d("LSIntEnum"))).ofNumber(8388608);case"bumpMessage":return(i||(i=d("LSIntEnum"))).ofNumber(16777216);case"stickerReceiverFetchMessage":return(i||(i=d("LSIntEnum"))).ofNumber(67108864);case"noteMention":return(i||(i=d("LSIntEnum"))).ofNumber(1073741824);case"messengerMemory":return(i||(i=d("LSIntEnum"))).ofNumber(8589934592);case"rtcMessage":return(i||(i=d("LSIntEnum"))).ofNumber(17179869184);default:return(i||(i=d("LSIntEnum"))).ofNumber(131072)}}function e(a){a=a.displayedContentTypes;return(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16384))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(64))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4096))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(134217728))}function f(a,b){var e=a.replyAttachmentType;if(e==null)return!1;b=d("LSMessagingThreadTypeUtil").isArmadilloSecure(b);return b&&a.replyAttachmentId==null?!1:(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").PHOTO))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").GIF))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").AUDIO))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").STICKER))||(j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSReplyMessageAttachmentType").VIDEO))}function l(a){return(j||(j=d("I64"))).equal(a.displayedContentTypes,(i||(i=d("LSIntEnum"))).ofNumber(134217728))}function m(a){return d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(536870912),a.displayedContentTypes)}function n(a){a=a.displayedContentTypes;if((j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(32)))return!0;else return!1}function o(a){return(j||(j=d("I64"))).lt(a.sendStatusV2,(i||(i=d("LSIntEnum"))).ofNumber(2))}function p(a){a=a.displayedContentTypes;return d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(1024),a)||d("LSBitFlag").has((i||(i=d("LSIntEnum"))).ofNumber(536870912),a)}function q(a){a=a.displayedContentTypes;return(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(65536))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(131072))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(524288))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4294967296))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1048576))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2097152))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(4194304))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(2147483648))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8388608))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(16777216))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(1073741824))||(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(8589934592))?!0:(j||(j=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(262144))}var r=(b=b("$InternalEnum"))({PLAYED:0,SCREENSHOTTED:1,FORCE_DISABLED:2}),s=b({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4}),t=b({VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2});b=b({IMAGE:0,VIDEO:1});g.text=(h=d("MAWMsgType")).MSG_TYPE.TEXT;g.image=h.MSG_TYPE.IMAGE;g.video=h.MSG_TYPE.VIDEO;g.ptt=h.MSG_TYPE.PTT;g.unsent=h.MSG_TYPE.REVOKED;g.gif=h.MSG_TYPE.GIF;g.bumpExistingMessage=h.MSG_TYPE.BUMP_EXISTING_MESSAGE;g.getDisplayedContentTypes=a;g.isMediaMsg=e;g.isMediaReplyAttachmentType=f;g.isReceiverFetchMsg=l;g.isReceiverFetchXMAMsg=m;g.isAdminMsg=n;g.isOptimistic=o;g.isXMAMsg=p;g.isPlaceholder=q;g.MAWRavenActionNotifType=r;g.MAWRavenMsgEphemeralMediaState=s;g.MAWRavenMsgEphemeralType=t;g.MAWRavenMsgMediaType=b}),98);
__d("MAWSharedProtocolQueueConst",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({Initializing:"initializing",Failed:"failed",Processing:"processing",Complete:"complete"});f.OfflineConsumerStatus=a}),66);
__d("MAWOfflineQueueStatus",["FBLogger","MAWSharedProtocolQueueConst"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map(),i=!1;function j(a,b){h.set(a,b),h.size>5e3&&c("FBLogger")("labyrinth_web").warn("Offline queue status map size (%s) is too large",h.size)}function k(a){return h.get(a)}function a(){h=new Map(),i=!1}function b(){return i}function e(){i=!0}function f(a,b){a=Object.keys(a);a.map(function(a){j(a,b)})}function l(a){return k(a)===d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}function m(){return Array.from(h.entries()).filter(function(a){a[0];a=a[1];return a!==d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete&&a!==d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed}).map(function(a){a=a[0];return a})}g.setOfflineQueueStatus=j;g.getOfflineQueueStatus=k;g.resetOfflineQueueState=a;g.isOfflineQueueComplete=b;g.markOfflineQueueComplete=e;g.markThreadWithOfflineQueueStatus=f;g.isOfflineQueueDoneForThread=l;g.getAllThreadsWithOfflineQueueIncomplete=m}),98);
__d("WAArmadilloApplication.pb",["WAArmadilloXMA.pb","WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h,i;a={ES_OPEN:1,ES_CLOSE:2};b={PAYMENT_UNKNOWN:-1,REQUEST_INITED:4,REQUEST_DECLINED:5,REQUEST_TRANSFER_INITED:6,REQUEST_TRANSFER_COMPLETED:7,REQUEST_TRANSFER_FAILED:8,REQUEST_CANCELED:9,REQUEST_EXPIRED:10,TRANSFER_INITED:11,TRANSFER_PENDING:12,TRANSFER_PENDING_RECIPIENT_VERIFICATION:13,TRANSFER_CANCELED:14,TRANSFER_COMPLETED:15,TRANSFER_NO_RECEIVER_CREDENTIAL_NO_RTS_PENDING_CANCELED:16,TRANSFER_NO_RECEIVER_CREDENTIAL_NO_RTS_PENDING_OTHER:17,TRANSFER_REFUNDED:18,TRANSFER_PARTIAL_REFUND:19,TRANSFER_CHARGED_BACK:20,TRANSFER_EXPIRED:21,TRANSFER_DECLINED:22,TRANSFER_UNAVAILABLE:23};c={SCREENSHOT_IMAGE:1,SCREEN_RECORDING:2};e={PLAYED:0,SCREENSHOT:1,FORCE_DISABLE:2};f={VIEW_ONCE:0,ALLOW_REPLAY:1,KEEP_IN_CHAT:2};var j={SMALL_LIKE:1,MEDIUM_LIKE:2,LARGE_LIKE:3},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={},N={},O={};k.name="Armadillo";k.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,m],metadata:[2,h.TYPES.MESSAGE,l]};l.name="Armadillo$Metadata";l.internalSpec={};m.name="Armadillo$Payload";m.internalSpec={content:[1,h.TYPES.MESSAGE,E],applicationData:[2,h.TYPES.MESSAGE,r],signal:[3,h.TYPES.MESSAGE,o],subProtocol:[4,h.TYPES.MESSAGE,n],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};n.name="Armadillo$SubProtocolPayload";n.internalSpec={futureProof:[1,h.TYPES.ENUM,(i=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};o.name="Armadillo$Signal";o.internalSpec={encryptedBackupsSecrets:[1,h.TYPES.MESSAGE,p],__oneofs__:{signal:["encryptedBackupsSecrets"]}};p.name="Armadillo$Signal$EncryptedBackupsSecrets";p.internalSpec={backupId:[1,h.TYPES.UINT64],serverDataId:[2,h.TYPES.UINT64],epoch:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,q],tempOcmfClientState:[4,h.TYPES.BYTES],mailboxRootKey:[5,h.TYPES.BYTES],obliviousValidationToken:[6,h.TYPES.BYTES]};q.name="Armadillo$Signal$EncryptedBackupsSecrets$Epoch";q.internalSpec={id:[1,h.TYPES.UINT64],anonId:[2,h.TYPES.BYTES],rootKey:[3,h.TYPES.BYTES],status:[4,h.TYPES.ENUM,a]};r.name="Armadillo$ApplicationData";r.internalSpec={metadataSync:[1,h.TYPES.MESSAGE,D],aiBotResponse:[2,h.TYPES.MESSAGE,t],messageHistoryDocumentMessage:[3,h.TYPES.MESSAGE,s],__oneofs__:{applicationData:["metadataSync","aiBotResponse","messageHistoryDocumentMessage"]}};s.name="Armadillo$ApplicationData$MessageHistoryDocumentMessage";s.internalSpec={document:[1,h.TYPES.MESSAGE,i.SubProtocolSpec]};t.name="Armadillo$ApplicationData$AIBotResponseMessage";t.internalSpec={summonToken:[1,h.TYPES.STRING],messageText:[2,h.TYPES.STRING],serializedExtras:[3,h.TYPES.STRING]};u.name="Armadillo$ApplicationData$MetadataSyncAction";u.internalSpec={actionTimestamp:[1,h.TYPES.INT64],chatAction:[101,h.TYPES.MESSAGE,x],messageAction:[102,h.TYPES.MESSAGE,v],__oneofs__:{actionType:["chatAction","messageAction"]}};v.name="Armadillo$ApplicationData$MetadataSyncAction$SyncMessageAction";v.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],messageDelete:[101,h.TYPES.MESSAGE,w],__oneofs__:{action:["messageDelete"]}};w.name="Armadillo$ApplicationData$MetadataSyncAction$SyncMessageAction$ActionMessageDelete";w.internalSpec={};x.name="Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction";x.internalSpec={chatId:[1,h.TYPES.STRING],chatArchive:[101,h.TYPES.MESSAGE,A],chatDelete:[102,h.TYPES.MESSAGE,z],chatRead:[103,h.TYPES.MESSAGE,y],__oneofs__:{action:["chatArchive","chatDelete","chatRead"]}};y.name="Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatRead";y.internalSpec={messageRange:[1,h.TYPES.MESSAGE,C],read:[2,h.TYPES.BOOL]};z.name="Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatDelete";z.internalSpec={messageRange:[1,h.TYPES.MESSAGE,C]};A.name="Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatArchive";A.internalSpec={messageRange:[1,h.TYPES.MESSAGE,C],archived:[2,h.TYPES.BOOL]};B.name="Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessage";B.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],timestamp:[2,h.TYPES.INT64]};C.name="Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageRange";C.internalSpec={lastMessageTimestamp:[1,h.TYPES.INT64],lastSystemMessageTimestamp:[2,h.TYPES.INT64],messages:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,B]};D.name="Armadillo$ApplicationData$MetadataSyncNotification";D.internalSpec={actions:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,u]};E.name="Armadillo$Content";E.internalSpec={commonSticker:[1,h.TYPES.MESSAGE,O],screenshotAction:[3,h.TYPES.MESSAGE,K],extendedContentMessage:[4,h.TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec],ravenMessage:[5,h.TYPES.MESSAGE,N],ravenActionNotifMessage:[6,h.TYPES.MESSAGE,M],extendedMessageContentWithSear:[7,h.TYPES.MESSAGE,L],imageGalleryMessage:[8,h.TYPES.MESSAGE,J],paymentsTransactionMessage:[10,h.TYPES.MESSAGE,F],bumpExistingMessage:[11,h.TYPES.MESSAGE,I],noteReplyMessage:[13,h.TYPES.MESSAGE,H],ravenMessageMsgr:[14,h.TYPES.MESSAGE,N],networkVerificationMessage:[15,h.TYPES.MESSAGE,G],__oneofs__:{content:["commonSticker","screenshotAction","extendedContentMessage","ravenMessage","ravenActionNotifMessage","extendedMessageContentWithSear","imageGalleryMessage","paymentsTransactionMessage","bumpExistingMessage","noteReplyMessage","ravenMessageMsgr","networkVerificationMessage"]}};F.name="Armadillo$Content$PaymentsTransactionMessage";F.internalSpec={transactionId:[1,h.TYPES.UINT64],amount:[2,h.TYPES.STRING],currency:[3,h.TYPES.STRING],paymentStatus:[4,h.TYPES.ENUM,b],extendedContentMessage:[5,h.TYPES.MESSAGE,d("WAArmadilloXMA.pb").ExtendedContentMessageSpec]};G.name="Armadillo$Content$NetworkVerificationMessage";G.internalSpec={codeText:[1,h.TYPES.STRING]};H.name="Armadillo$Content$NoteReplyMessage";H.internalSpec={noteId:[1,h.TYPES.STRING],noteText:[2,h.TYPES.MESSAGE,i.MessageTextSpec],noteTimestampMs:[3,h.TYPES.INT64],textContent:[4,h.TYPES.MESSAGE,i.MessageTextSpec],stickerContent:[5,h.TYPES.MESSAGE,i.SubProtocolSpec],videoContent:[6,h.TYPES.MESSAGE,i.SubProtocolSpec],__oneofs__:{noteReplyContent:["textContent","stickerContent","videoContent"]}};I.name="Armadillo$Content$BumpExistingMessage";I.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec]};J.name="Armadillo$Content$ImageGalleryMessage";J.internalSpec={images:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,i.SubProtocolSpec]};K.name="Armadillo$Content$ScreenshotAction";K.internalSpec={screenshotType:[1,h.TYPES.ENUM,c]};L.name="Armadillo$Content$ExtendedContentMessageWithSear";L.internalSpec={searId:[1,h.TYPES.STRING],payload:[2,h.TYPES.BYTES],nativeUrl:[3,h.TYPES.STRING],searAssociatedMessage:[4,h.TYPES.MESSAGE,i.SubProtocolSpec],searSentWithMessageId:[5,h.TYPES.STRING]};M.name="Armadillo$Content$RavenActionNotifMessage";M.internalSpec={key:[1,h.TYPES.MESSAGE,i.MessageKeySpec],actionTimestamp:[2,h.TYPES.INT64],actionType:[3,h.TYPES.ENUM,e]};N.name="Armadillo$Content$RavenMessage";N.internalSpec={ephemeralType:[1,h.TYPES.ENUM,f],imageMessage:[2,h.TYPES.MESSAGE,i.SubProtocolSpec],videoMessage:[3,h.TYPES.MESSAGE,i.SubProtocolSpec],__oneofs__:{mediaContent:["imageMessage","videoMessage"]}};O.name="Armadillo$Content$CommonSticker";O.internalSpec={stickerType:[1,h.TYPES.ENUM,j]};g.ARMADILLO_SIGNAL_ENCRYPTED_BACKUPS_SECRETS_EPOCH_EPOCH_STATUS=a;g.ARMADILLO_CONTENT_PAYMENTS_TRANSACTION_MESSAGE_PAYMENT_STATUS=b;g.ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE=c;g.ARMADILLO_CONTENT_RAVEN_ACTION_NOTIF_MESSAGE_ACTION_TYPE=e;g.ARMADILLO_CONTENT_RAVEN_MESSAGE_EPHEMERAL_TYPE=f;g.ARMADILLO_CONTENT_COMMON_STICKER_STICKER_TYPE=j;g.ArmadilloSpec=k;g.Armadillo$MetadataSpec=l;g.Armadillo$PayloadSpec=m;g.Armadillo$SubProtocolPayloadSpec=n;g.Armadillo$SignalSpec=o;g.Armadillo$Signal$EncryptedBackupsSecretsSpec=p;g.Armadillo$Signal$EncryptedBackupsSecrets$EpochSpec=q;g.Armadillo$ApplicationDataSpec=r;g.Armadillo$ApplicationData$MessageHistoryDocumentMessageSpec=s;g.Armadillo$ApplicationData$AIBotResponseMessageSpec=t;g.Armadillo$ApplicationData$MetadataSyncActionSpec=u;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageActionSpec=v;g.Armadillo$ApplicationData$MetadataSyncAction$SyncMessageAction$ActionMessageDeleteSpec=w;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatActionSpec=x;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatReadSpec=y;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatDeleteSpec=z;g.Armadillo$ApplicationData$MetadataSyncAction$SyncChatAction$ActionChatArchiveSpec=A;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageSpec=B;g.Armadillo$ApplicationData$MetadataSyncAction$SyncActionMessageRangeSpec=C;g.Armadillo$ApplicationData$MetadataSyncNotificationSpec=D;g.Armadillo$ContentSpec=E;g.Armadillo$Content$PaymentsTransactionMessageSpec=F;g.Armadillo$Content$NetworkVerificationMessageSpec=G;g.Armadillo$Content$NoteReplyMessageSpec=H;g.Armadillo$Content$BumpExistingMessageSpec=I;g.Armadillo$Content$ImageGalleryMessageSpec=J;g.Armadillo$Content$ScreenshotActionSpec=K;g.Armadillo$Content$ExtendedContentMessageWithSearSpec=L;g.Armadillo$Content$RavenActionNotifMessageSpec=M;g.Armadillo$Content$RavenMessageSpec=N;g.Armadillo$Content$CommonStickerSpec=O}),98);
__d("WAArmadilloLocallyTransformedMessage.pb",["WAProtoConst"],(function(a,b,c,d,e,f,g){a={};b={};a.name="LocallyTransformedMessage";a.internalSpec={pollUpdateMessage:[1,d("WAProtoConst").TYPES.MESSAGE,b],__oneofs__:{content:["pollUpdateMessage"]}};b.name="LocallyTransformedMessage$PollUpdateAdminMessage";b.internalSpec={pollCreationMessageId:[1,d("WAProtoConst").TYPES.STRING],pollUpdateMessageId:[2,d("WAProtoConst").TYPES.STRING]};g.LocallyTransformedMessageSpec=a;g.LocallyTransformedMessage$PollUpdateAdminMessageSpec=b}),98);
__d("WAArmadilloMiTransportAdminMessage.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){c=(a=b("$InternalEnum"))({DISABLED:1,ENABLED:2});e=a({CHANGED:1,REMOVED:2});f=a({PINNED:1,UNPINNED:2});b=a({ALL_MEMBERS:1,ADMINS_ONLY:2});var h=a({ADDED:1,REMOVED:2});a=a({ADDED:1,REMOVED:2});var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={};i.name="MiTransportAdminMessage";i.internalSpec={chatThemeChanged:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,w],nicknameChanged:[2,d.TYPES.MESSAGE,v],groupParticipantChanged:[3,d.TYPES.MESSAGE,u],groupAdminChanged:[4,d.TYPES.MESSAGE,t],groupNameChanged:[5,d.TYPES.MESSAGE,s],groupMembershipAddModeChanged:[6,d.TYPES.MESSAGE,r],messagePinned:[7,d.TYPES.MESSAGE,q],groupImageChanged:[8,d.TYPES.MESSAGE,p],quickReactionChanged:[9,d.TYPES.MESSAGE,o],linkCta:[10,d.TYPES.MESSAGE,m],iconChanged:[11,d.TYPES.MESSAGE,l],disappearingSettingChanged:[12,d.TYPES.MESSAGE,k],limitSharingChanged:[13,d.TYPES.MESSAGE,j],__oneofs__:{content:["chatThemeChanged","nicknameChanged","groupParticipantChanged","groupAdminChanged","groupNameChanged","groupMembershipAddModeChanged","messagePinned","groupImageChanged","quickReactionChanged","linkCta","iconChanged","disappearingSettingChanged","limitSharingChanged"]}};j.name="MiTransportAdminMessage$LimitSharingChanged";j.internalSpec={sharingType:[1,d.TYPES.ENUM,c]};k.name="MiTransportAdminMessage$DisappearingSettingChanged";k.internalSpec={disappearingSettingDurationSeconds:[1,d.TYPES.INT32],oldDisappearingSettingDurationSeconds:[2,d.TYPES.INT32]};l.name="MiTransportAdminMessage$IconChanged";l.internalSpec={threadIcon:[1,d.TYPES.STRING]};m.name="MiTransportAdminMessage$LinkCta";m.internalSpec={ukOsaAdminText:[1,d.TYPES.MESSAGE,n],__oneofs__:{content:["ukOsaAdminText"]}};n.name="MiTransportAdminMessage$LinkCta$UkOsaAdminText";n.internalSpec={initiatorUserId:[2,d.TYPES.STRING]};o.name="MiTransportAdminMessage$QuickReactionChanged";o.internalSpec={emojiName:[1,d.TYPES.STRING]};p.name="MiTransportAdminMessage$GroupImageChanged";p.internalSpec={action:[1,d.TYPES.ENUM,e]};q.name="MiTransportAdminMessage$MessagePinned";q.internalSpec={action:[1,d.TYPES.ENUM,f]};r.name="MiTransportAdminMessage$GroupMembershipAddModeChanged";r.internalSpec={mode:[1,d.TYPES.ENUM,b]};s.name="MiTransportAdminMessage$GroupNameChanged";s.internalSpec={groupName:[1,d.TYPES.STRING]};t.name="MiTransportAdminMessage$GroupAdminChanged";t.internalSpec={targetUserId:[1,d.FLAGS.REPEATED|d.TYPES.STRING],action:[2,d.TYPES.ENUM,h]};u.name="MiTransportAdminMessage$GroupParticipantChanged";u.internalSpec={targetUserId:[1,d.FLAGS.REPEATED|d.TYPES.STRING],action:[2,d.TYPES.ENUM,a]};v.name="MiTransportAdminMessage$NicknameChanged";v.internalSpec={targetUserId:[1,d.TYPES.STRING],nickname:[2,d.TYPES.STRING]};w.name="MiTransportAdminMessage$ChatThemeChanged";w.internalSpec={themeName:[1,d.TYPES.STRING],themeEmoji:[2,d.TYPES.STRING],themeType:[3,d.TYPES.INT32]};g.MiTransportAdminMessage$LimitSharingChanged$SharingType=c;g.MiTransportAdminMessage$GroupImageChanged$Action=e;g.MiTransportAdminMessage$MessagePinned$Action=f;g.MiTransportAdminMessage$GroupMembershipAddModeChanged$Mode=b;g.MiTransportAdminMessage$GroupAdminChanged$Action=h;g.MiTransportAdminMessage$GroupParticipantChanged$Action=a;g.MiTransportAdminMessageSpec=i;g.MiTransportAdminMessage$LimitSharingChangedSpec=j;g.MiTransportAdminMessage$DisappearingSettingChangedSpec=k;g.MiTransportAdminMessage$IconChangedSpec=l;g.MiTransportAdminMessage$LinkCtaSpec=m;g.MiTransportAdminMessage$LinkCta$UkOsaAdminTextSpec=n;g.MiTransportAdminMessage$QuickReactionChangedSpec=o;g.MiTransportAdminMessage$GroupImageChangedSpec=p;g.MiTransportAdminMessage$MessagePinnedSpec=q;g.MiTransportAdminMessage$GroupMembershipAddModeChangedSpec=r;g.MiTransportAdminMessage$GroupNameChangedSpec=s;g.MiTransportAdminMessage$GroupAdminChangedSpec=t;g.MiTransportAdminMessage$GroupParticipantChangedSpec=u;g.MiTransportAdminMessage$NicknameChangedSpec=v;g.MiTransportAdminMessage$ChatThemeChangedSpec=w}),98);
__d("WAArmadilloTransportEvent.pb",["$InternalEnum","WAProtoConst"],(function(a,b,c,d,e,f,g){a=b("$InternalEnum")({NONE:0,DETECTED:1,CLEARED:2});c=b("$InternalEnum")({NONE:0,ADDED:1,REMOVED:2,REPLACED:3});e=b("$InternalEnum")({DECRYPTION_FAILURE:1,UNAVAILABLE_MESSAGE:2});f={};b={};var h={},i={},j={};f.name="TransportEvent";f.internalSpec={placeholder:[1,(d=d("WAProtoConst")).TYPES.MESSAGE,j],event:[2,d.TYPES.MESSAGE,b],__oneofs__:{content:["placeholder","event"]}};b.name="TransportEvent$Event";b.internalSpec={deviceChange:[1,d.TYPES.MESSAGE,i],icdcAlert:[2,d.TYPES.MESSAGE,h],__oneofs__:{event:["deviceChange","icdcAlert"]}};h.name="TransportEvent$Event$IcdcAlert";h.internalSpec={type:[1,d.TYPES.ENUM,a]};i.name="TransportEvent$Event$DeviceChange";i.internalSpec={type:[1,d.TYPES.ENUM,c],deviceName:[2,d.TYPES.STRING],devicePlatform:[3,d.TYPES.STRING],deviceModel:[4,d.TYPES.STRING]};j.name="TransportEvent$Placeholder";j.internalSpec={type:[1,d.TYPES.ENUM,e]};g.TransportEvent$Event$IcdcAlert$Type=a;g.TransportEvent$Event$DeviceChange$Type=c;g.TransportEvent$Placeholder$Type=e;g.TransportEventSpec=f;g.TransportEvent$EventSpec=b;g.TransportEvent$Event$IcdcAlertSpec=h;g.TransportEvent$Event$DeviceChangeSpec=i;g.TransportEvent$PlaceholderSpec=j}),98);
__d("WAConsumerApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={SMALL:1,MEDIUM:2,LARGE:3};b={SANS_SERIF:0,SERIF:1,NORICAN_REGULAR:2,BRYNDAN_WRITE:3,BEBASNEUE_REGULAR:4,OSWALD_HEAVY:5};c={NONE:0,VIDEO:1};e={};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={},G={},H={},I={},J={},K={},L={},M={};e.name="ConsumerApplication";e.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,f],metadata:[2,h.TYPES.MESSAGE,j]};f.name="ConsumerApplication$Payload";f.internalSpec={content:[1,h.TYPES.MESSAGE,m],applicationData:[2,h.TYPES.MESSAGE,l],signal:[3,h.TYPES.MESSAGE,k],subProtocol:[4,h.TYPES.MESSAGE,i],__oneofs__:{payload:["content","applicationData","signal","subProtocol"]}};i.name="ConsumerApplication$SubProtocolPayload";i.internalSpec={futureProof:[1,h.TYPES.ENUM,(d=d("WACommon.pb")).FUTURE_PROOF_BEHAVIOR]};j.name="ConsumerApplication$Metadata";j.internalSpec={specialTextSize:[1,h.TYPES.ENUM,a]};k.name="ConsumerApplication$Signal";k.internalSpec={};l.name="ConsumerApplication$ApplicationData";l.internalSpec={revoke:[1,h.TYPES.MESSAGE,v],__oneofs__:{applicationContent:["revoke"]}};m.name="ConsumerApplication$Content";m.internalSpec={messageText:[1,h.TYPES.MESSAGE,d.MessageTextSpec],imageMessage:[2,h.TYPES.MESSAGE,I],contactMessage:[3,h.TYPES.MESSAGE,A],locationMessage:[4,h.TYPES.MESSAGE,D],extendedTextMessage:[5,h.TYPES.MESSAGE,C],statusTextMessage:[6,h.TYPES.MESSAGE,B],documentMessage:[7,h.TYPES.MESSAGE,F],audioMessage:[8,h.TYPES.MESSAGE,H],videoMessage:[9,h.TYPES.MESSAGE,G],contactsArrayMessage:[10,h.TYPES.MESSAGE,z],liveLocationMessage:[11,h.TYPES.MESSAGE,y],stickerMessage:[12,h.TYPES.MESSAGE,E],groupInviteMessage:[13,h.TYPES.MESSAGE,x],viewOnceMessage:[14,h.TYPES.MESSAGE,w],reactionMessage:[16,h.TYPES.MESSAGE,u],pollCreationMessage:[17,h.TYPES.MESSAGE,s],pollUpdateMessage:[18,h.TYPES.MESSAGE,r],editMessage:[19,h.TYPES.MESSAGE,n],__oneofs__:{content:["messageText","imageMessage","contactMessage","locationMessage","extendedTextMessage","statusTextMessage","documentMessage","audioMessage","videoMessage","contactsArrayMessage","liveLocationMessage","stickerMessage","groupInviteMessage","viewOnceMessage","reactionMessage","pollCreationMessage","pollUpdateMessage","editMessage"]}};n.name="ConsumerApplication$EditMessage";n.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],message:[2,h.TYPES.MESSAGE,d.MessageTextSpec],timestampMs:[3,h.TYPES.INT64]};o.name="ConsumerApplication$PollAddOptionMessage";o.internalSpec={pollOption:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t]};p.name="ConsumerApplication$PollVoteMessage";p.internalSpec={selectedOptions:[1,h.FLAGS.REPEATED|h.TYPES.BYTES],senderTimestampMs:[2,h.TYPES.INT64]};q.name="ConsumerApplication$PollEncValue";q.internalSpec={encPayload:[1,h.TYPES.BYTES],encIv:[2,h.TYPES.BYTES]};r.name="ConsumerApplication$PollUpdateMessage";r.internalSpec={pollCreationMessageKey:[1,h.TYPES.MESSAGE,d.MessageKeySpec],vote:[2,h.TYPES.MESSAGE,q],addOption:[3,h.TYPES.MESSAGE,q]};s.name="ConsumerApplication$PollCreationMessage";s.internalSpec={encKey:[1,h.TYPES.BYTES],name:[2,h.TYPES.STRING],options:[3,h.FLAGS.REPEATED|h.TYPES.MESSAGE,t],selectableOptionsCount:[4,h.TYPES.UINT32]};t.name="ConsumerApplication$Option";t.internalSpec={optionName:[1,h.TYPES.STRING]};u.name="ConsumerApplication$ReactionMessage";u.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec],text:[2,h.TYPES.STRING],groupingKey:[3,h.TYPES.STRING],senderTimestampMs:[4,h.TYPES.INT64],reactionMetadataDataclassData:[5,h.TYPES.STRING],style:[6,h.TYPES.INT32]};v.name="ConsumerApplication$RevokeMessage";v.internalSpec={key:[1,h.TYPES.MESSAGE,d.MessageKeySpec]};w.name="ConsumerApplication$ViewOnceMessage";w.internalSpec={imageMessage:[1,h.TYPES.MESSAGE,I],videoMessage:[2,h.TYPES.MESSAGE,G],__oneofs__:{viewOnceContent:["imageMessage","videoMessage"]}};x.name="ConsumerApplication$GroupInviteMessage";x.internalSpec={groupJid:[1,h.TYPES.STRING],inviteCode:[2,h.TYPES.STRING],inviteExpiration:[3,h.TYPES.INT64],groupName:[4,h.TYPES.STRING],jpegThumbnail:[5,h.TYPES.BYTES],caption:[6,h.TYPES.MESSAGE,d.MessageTextSpec]};y.name="ConsumerApplication$LiveLocationMessage";y.internalSpec={location:[1,h.TYPES.MESSAGE,L],accuracyInMeters:[2,h.TYPES.UINT32],speedInMps:[3,h.TYPES.FLOAT],degreesClockwiseFromMagneticNorth:[4,h.TYPES.UINT32],caption:[5,h.TYPES.MESSAGE,d.MessageTextSpec],sequenceNumber:[6,h.TYPES.INT64],timeOffset:[7,h.TYPES.UINT32]};z.name="ConsumerApplication$ContactsArrayMessage";z.internalSpec={displayName:[1,h.TYPES.STRING],contacts:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,A]};A.name="ConsumerApplication$ContactMessage";A.internalSpec={contact:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};B.name="ConsumerApplication$StatusTextMesage";B.internalSpec={text:[1,h.TYPES.MESSAGE,C],textArgb:[6,h.TYPES.FIXED32],backgroundArgb:[7,h.TYPES.FIXED32],font:[8,h.TYPES.ENUM,b]};C.name="ConsumerApplication$ExtendedTextMessage";C.internalSpec={text:[1,h.TYPES.MESSAGE,d.MessageTextSpec],matchedText:[2,h.TYPES.STRING],canonicalUrl:[3,h.TYPES.STRING],description:[4,h.TYPES.STRING],title:[5,h.TYPES.STRING],thumbnail:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],previewType:[7,h.TYPES.ENUM,c]};D.name="ConsumerApplication$LocationMessage";D.internalSpec={location:[1,h.TYPES.MESSAGE,L],address:[2,h.TYPES.STRING]};E.name="ConsumerApplication$StickerMessage";E.internalSpec={sticker:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};F.name="ConsumerApplication$DocumentMessage";F.internalSpec={document:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],fileName:[2,h.TYPES.STRING]};G.name="ConsumerApplication$VideoMessage";G.internalSpec={video:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};H.name="ConsumerApplication$AudioMessage";H.internalSpec={audio:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],ptt:[2,h.TYPES.BOOL]};I.name="ConsumerApplication$ImageMessage";I.internalSpec={image:[1,h.TYPES.MESSAGE,d.SubProtocolSpec],caption:[2,h.TYPES.MESSAGE,d.MessageTextSpec]};J.name="ConsumerApplication$InteractiveAnnotation";J.internalSpec={polygonVertices:[1,h.FLAGS.REPEATED|h.TYPES.MESSAGE,K],location:[2,h.TYPES.MESSAGE,L],__oneofs__:{action:["location"]}};K.name="ConsumerApplication$Point";K.internalSpec={x:[1,h.TYPES.DOUBLE],y:[2,h.TYPES.DOUBLE]};L.name="ConsumerApplication$Location";L.internalSpec={degreesLatitude:[1,h.TYPES.DOUBLE],degreesLongitude:[2,h.TYPES.DOUBLE],name:[3,h.TYPES.STRING]};M.name="ConsumerApplication$MediaPayload";M.internalSpec={protocol:[1,h.TYPES.MESSAGE,d.SubProtocolSpec]};g.CONSUMER_APPLICATION_METADATA_SPECIAL_TEXT_SIZE=a;g.CONSUMER_APPLICATION_STATUS_TEXT_MESAGE_FONT_TYPE=b;g.CONSUMER_APPLICATION_EXTENDED_TEXT_MESSAGE_PREVIEW_TYPE=c;g.ConsumerApplicationSpec=e;g.ConsumerApplication$PayloadSpec=f;g.ConsumerApplication$SubProtocolPayloadSpec=i;g.ConsumerApplication$MetadataSpec=j;g.ConsumerApplication$SignalSpec=k;g.ConsumerApplication$ApplicationDataSpec=l;g.ConsumerApplication$ContentSpec=m;g.ConsumerApplication$EditMessageSpec=n;g.ConsumerApplication$PollAddOptionMessageSpec=o;g.ConsumerApplication$PollVoteMessageSpec=p;g.ConsumerApplication$PollEncValueSpec=q;g.ConsumerApplication$PollUpdateMessageSpec=r;g.ConsumerApplication$PollCreationMessageSpec=s;g.ConsumerApplication$OptionSpec=t;g.ConsumerApplication$ReactionMessageSpec=u;g.ConsumerApplication$RevokeMessageSpec=v;g.ConsumerApplication$ViewOnceMessageSpec=w;g.ConsumerApplication$GroupInviteMessageSpec=x;g.ConsumerApplication$LiveLocationMessageSpec=y;g.ConsumerApplication$ContactsArrayMessageSpec=z;g.ConsumerApplication$ContactMessageSpec=A;g.ConsumerApplication$StatusTextMesageSpec=B;g.ConsumerApplication$ExtendedTextMessageSpec=C;g.ConsumerApplication$LocationMessageSpec=D;g.ConsumerApplication$StickerMessageSpec=E;g.ConsumerApplication$DocumentMessageSpec=F;g.ConsumerApplication$VideoMessageSpec=G;g.ConsumerApplication$AudioMessageSpec=H;g.ConsumerApplication$ImageMessageSpec=I;g.ConsumerApplication$InteractiveAnnotationSpec=J;g.ConsumerApplication$PointSpec=K;g.ConsumerApplication$LocationSpec=L;g.ConsumerApplication$MediaPayloadSpec=M}),98);
__d("WAMediaTransport.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={NONE:0,LQ_4K:1,HQ_4K:2};b={NONE:0,GIPHY:1,TENOR:2};c={TALKING_A:0,IDLE_A:1,TALKING_B:2,IDLE_B:3,BACKGROUND:4};e={UNKNOWN:0,OPUS:1};f={};var i={},j={},k={},l={},m={},n={},o={},p={},q={},r={},s={},t={},u={},v={},w={},x={},y={},z={},A={},B={},C={},D={},E={},F={};f.name="WAMediaTransport";f.internalSpec={integral:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,l],ancillary:[2,h.TYPES.MESSAGE,i]};i.name="WAMediaTransport$Ancillary";i.internalSpec={fileLength:[1,h.TYPES.UINT64],mimetype:[2,h.TYPES.STRING],thumbnail:[3,h.TYPES.MESSAGE,j],objectId:[4,h.TYPES.STRING]};j.name="WAMediaTransport$Ancillary$Thumbnail";j.internalSpec={jpegThumbnail:[1,h.TYPES.BYTES],downloadableThumbnail:[2,h.TYPES.MESSAGE,k],thumbnailWidth:[3,h.TYPES.UINT32],thumbnailHeight:[4,h.TYPES.UINT32]};k.name="WAMediaTransport$Ancillary$Thumbnail$DownloadableThumbnail";k.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],thumbnailScansSidecar:[7,h.TYPES.BYTES],thumbnailScanLengths:[8,h.FLAGS.REPEATED|h.TYPES.UINT32]};l.name="WAMediaTransport$Integral";l.internalSpec={fileSha256:[1,h.TYPES.BYTES],mediaKey:[2,h.TYPES.BYTES],fileEncSha256:[3,h.TYPES.BYTES],directPath:[4,h.TYPES.STRING],mediaKeyTimestamp:[5,h.TYPES.INT64]};m.name="ImageTransport";m.internalSpec={integral:[1,h.TYPES.MESSAGE,o],ancillary:[2,h.TYPES.MESSAGE,n]};n.name="ImageTransport$Ancillary";n.internalSpec={height:[1,h.TYPES.UINT32],width:[2,h.TYPES.UINT32],scansSidecar:[3,h.TYPES.BYTES],scanLengths:[4,h.FLAGS.REPEATED|h.TYPES.UINT32],midQualityFileSha256:[5,h.TYPES.BYTES],hdType:[6,h.TYPES.ENUM,a],memoriesConceptScores:[7,h.FLAGS.REPEATED|h.FLAGS.PACKED|h.TYPES.FLOAT],memoriesConceptIds:[8,h.FLAGS.REPEATED|h.FLAGS.PACKED|h.TYPES.UINT32]};o.name="ImageTransport$Integral";o.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};p.name="VideoTransport";p.internalSpec={integral:[1,h.TYPES.MESSAGE,r],ancillary:[2,h.TYPES.MESSAGE,q]};q.name="VideoTransport$Ancillary";q.internalSpec={seconds:[1,h.TYPES.UINT32],caption:[2,h.TYPES.MESSAGE,d("WACommon.pb").MessageTextSpec],gifPlayback:[3,h.TYPES.BOOL],height:[4,h.TYPES.UINT32],width:[5,h.TYPES.UINT32],sidecar:[6,h.TYPES.BYTES],gifAttribution:[7,h.TYPES.ENUM,b],accessibilityLabel:[8,h.TYPES.STRING],isHd:[9,h.TYPES.BOOL]};r.name="VideoTransport$Integral";r.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};s.name="AudioTransport";s.internalSpec={integral:[1,h.TYPES.MESSAGE,w],ancillary:[2,h.TYPES.MESSAGE,t]};t.name="AudioTransport$Ancillary";t.internalSpec={seconds:[1,h.TYPES.UINT32],avatarAudio:[2,h.TYPES.MESSAGE,u]};u.name="AudioTransport$Ancillary$AvatarAudio";u.internalSpec={poseId:[1,h.TYPES.UINT32],avatarAnimations:[2,h.FLAGS.REPEATED|h.TYPES.MESSAGE,v]};v.name="AudioTransport$Ancillary$AvatarAudio$DownloadableAvatarAnimations";v.internalSpec={fileSha256:[1,h.TYPES.BYTES],fileEncSha256:[2,h.TYPES.BYTES],directPath:[3,h.TYPES.STRING],mediaKey:[4,h.TYPES.BYTES],mediaKeyTimestamp:[5,h.TYPES.INT64],objectId:[6,h.TYPES.STRING],animationsType:[7,h.TYPES.ENUM,c]};w.name="AudioTransport$Integral";w.internalSpec={transport:[1,h.TYPES.MESSAGE,f],audioFormat:[2,h.TYPES.ENUM,e]};x.name="DocumentTransport";x.internalSpec={integral:[1,h.TYPES.MESSAGE,z],ancillary:[2,h.TYPES.MESSAGE,y]};y.name="DocumentTransport$Ancillary";y.internalSpec={pageCount:[1,h.TYPES.UINT32]};z.name="DocumentTransport$Integral";z.internalSpec={transport:[1,h.TYPES.MESSAGE,f]};A.name="StickerTransport";A.internalSpec={integral:[1,h.TYPES.MESSAGE,C],ancillary:[2,h.TYPES.MESSAGE,B]};B.name="StickerTransport$Ancillary";B.internalSpec={pageCount:[1,h.TYPES.UINT32],height:[2,h.TYPES.UINT32],width:[3,h.TYPES.UINT32],firstFrameLength:[4,h.TYPES.UINT32],firstFrameSidecar:[5,h.TYPES.BYTES],mustacheText:[6,h.TYPES.STRING],isThirdParty:[7,h.TYPES.BOOL],receiverFetchId:[8,h.TYPES.STRING],accessibilityLabel:[9,h.TYPES.STRING]};C.name="StickerTransport$Integral";C.internalSpec={transport:[1,h.TYPES.MESSAGE,f],isAnimated:[2,h.TYPES.BOOL],receiverFetchId:[3,h.TYPES.STRING]};D.name="ContactTransport";D.internalSpec={integral:[1,h.TYPES.MESSAGE,F],ancillary:[2,h.TYPES.MESSAGE,E]};E.name="ContactTransport$Ancillary";E.internalSpec={displayName:[1,h.TYPES.STRING]};F.name="ContactTransport$Integral";F.internalSpec={vcard:[1,h.TYPES.STRING],downloadableVcard:[2,h.TYPES.MESSAGE,f],__oneofs__:{contact:["vcard","downloadableVcard"]}};g.IMAGE_TRANSPORT_ANCILLARY_HD_TYPE=a;g.VIDEO_TRANSPORT_ANCILLARY_ATTRIBUTION=b;g.AUDIO_TRANSPORT_ANCILLARY_AVATAR_AUDIO_ANIMATIONS_TYPE=c;g.AUDIO_TRANSPORT_INTEGRAL_AUDIO_FORMAT=e;g.WAMediaTransportSpec=f;g.WAMediaTransport$AncillarySpec=i;g.WAMediaTransport$Ancillary$ThumbnailSpec=j;g.WAMediaTransport$Ancillary$Thumbnail$DownloadableThumbnailSpec=k;g.WAMediaTransport$IntegralSpec=l;g.ImageTransportSpec=m;g.ImageTransport$AncillarySpec=n;g.ImageTransport$IntegralSpec=o;g.VideoTransportSpec=p;g.VideoTransport$AncillarySpec=q;g.VideoTransport$IntegralSpec=r;g.AudioTransportSpec=s;g.AudioTransport$AncillarySpec=t;g.AudioTransport$Ancillary$AvatarAudioSpec=u;g.AudioTransport$Ancillary$AvatarAudio$DownloadableAvatarAnimationsSpec=v;g.AudioTransport$IntegralSpec=w;g.DocumentTransportSpec=x;g.DocumentTransport$AncillarySpec=y;g.DocumentTransport$IntegralSpec=z;g.StickerTransportSpec=A;g.StickerTransport$AncillarySpec=B;g.StickerTransport$IntegralSpec=C;g.ContactTransportSpec=D;g.ContactTransport$AncillarySpec=E;g.ContactTransport$IntegralSpec=F}),98);
__d("WAMsgApplication.pb",["WACommon.pb","WAProtoConst"],(function(a,b,c,d,e,f,g){var h;a={DEFAULT:0,VANISH_MODE:1,DISAPPEARING_MESSAGES:2};b={UNKNOWN:0,SEEN_ONCE:1,SEEN_BASED_WITH_TIMER:2,SEND_BASED_WITH_TIMER:3};c={};e={};f={};var i={},j={},k={},l={},m={},n={},o={};c.name="MessageApplication";c.internalSpec={payload:[1,(h=d("WAProtoConst")).TYPES.MESSAGE,j],metadata:[2,h.TYPES.MESSAGE,e]};e.name="MessageApplication$Metadata";e.internalSpec={forwardingScore:[5,h.TYPES.UINT32],isForwarded:[6,h.TYPES.BOOL],businessMetadata:[7,h.TYPES.MESSAGE,(d=d("WACommon.pb")).SubProtocolSpec],frankingKey:[8,h.TYPES.BYTES],frankingVersion:[9,h.TYPES.INT32],quotedMessage:[10,h.TYPES.MESSAGE,f],threadType:[11,h.TYPES.ENUM,a],readonlyMetadataDataclass:[12,h.TYPES.STRING],groupId:[13,h.TYPES.STRING],groupSize:[14,h.TYPES.UINT32],groupIndex:[15,h.TYPES.UINT32],botResponseId:[16,h.TYPES.STRING],collapsibleId:[17,h.TYPES.STRING],secondaryOtid:[18,h.TYPES.STRING],chatEphemeralSetting:[1,h.TYPES.MESSAGE,o],ephemeralSettingList:[2,h.TYPES.MESSAGE,i],ephemeralSharedSecret:[3,h.TYPES.BYTES],__oneofs__:{ephemeral:["chatEphemeralSetting","ephemeralSettingList","ephemeralSharedSecret"]}};f.name="MessageApplication$Metadata$QuotedMessage";f.internalSpec={stanzaId:[1,h.TYPES.STRING],remoteJid:[2,h.TYPES.STRING],participant:[3,h.TYPES.STRING],payload:[4,h.TYPES.MESSAGE,j]};i.name="MessageApplication$Metadata$EphemeralSettingMap";i.internalSpec={chatJid:[1,h.TYPES.STRING],ephemeralSetting:[2,h.TYPES.MESSAGE,o]};j.name="MessageApplication$Payload";j.internalSpec={coreContent:[1,h.TYPES.MESSAGE,n],signal:[2,h.TYPES.MESSAGE,m],applicationData:[3,h.TYPES.MESSAGE,l],subProtocol:[4,h.TYPES.MESSAGE,k],__oneofs__:{content:["coreContent","signal","applicationData","subProtocol"]}};k.name="MessageApplication$SubProtocolPayload";k.internalSpec={futureProof:[1,h.TYPES.ENUM,d.FUTURE_PROOF_BEHAVIOR],consumerMessage:[2,h.TYPES.MESSAGE,d.SubProtocolSpec],businessMessage:[3,h.TYPES.MESSAGE,d.SubProtocolSpec],paymentMessage:[4,h.TYPES.MESSAGE,d.SubProtocolSpec],multiDevice:[5,h.TYPES.MESSAGE,d.SubProtocolSpec],voip:[6,h.TYPES.MESSAGE,d.SubProtocolSpec],armadillo:[7,h.TYPES.MESSAGE,d.SubProtocolSpec],__oneofs__:{subProtocol:["consumerMessage","businessMessage","paymentMessage","multiDevice","voip","armadillo"]}};l.name="MessageApplication$ApplicationData";l.internalSpec={};m.name="MessageApplication$Signal";m.internalSpec={};n.name="MessageApplication$Content";n.internalSpec={};o.name="MessageApplication$EphemeralSetting";o.internalSpec={ephemeralExpiration:[2,h.TYPES.UINT32],ephemeralSettingTimestamp:[3,h.TYPES.INT64],ephemeralityType:[5,h.TYPES.ENUM,b],isEphemeralSettingReset:[4,h.TYPES.BOOL]};g.MESSAGE_APPLICATION_METADATA_THREAD_TYPE=a;g.MESSAGE_APPLICATION_EPHEMERAL_SETTING_EPHEMERALITY_TYPE=b;g.MessageApplicationSpec=c;g.MessageApplication$MetadataSpec=e;g.MessageApplication$Metadata$QuotedMessageSpec=f;g.MessageApplication$Metadata$EphemeralSettingMapSpec=i;g.MessageApplication$PayloadSpec=j;g.MessageApplication$SubProtocolPayloadSpec=k;g.MessageApplication$ApplicationDataSpec=l;g.MessageApplication$SignalSpec=m;g.MessageApplication$ContentSpec=n;g.MessageApplication$EphemeralSettingSpec=o}),98);
__d("WAParseMessageApplication",["decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,c,e=a.payload;if(e==null)return{version:"v3",type:"error",error:"The messageApplication has no payload"};if(d("decodeProtobuf").getUnknownFields(a.payload)!=null)return{version:"v3",type:"error",error:"There are unknown fields in the message application payload"};e=e.subProtocol;if(e==null)return{version:"v3",type:"error",error:"The messageApplication payload has no subProtocol"};if(d("decodeProtobuf").getUnknownFields(e)!=null)return{version:"v3",type:"error",error:"messageApplication subProtocol has unknown fields",futureProof:e.futureProof};e=[];b=(b=a.payload)==null?void 0:(b=b.subProtocol)==null?void 0:b.consumerMessage;c=(c=a.payload)==null?void 0:(c=c.subProtocol)==null?void 0:c.armadillo;a=(a=a.payload)==null?void 0:(a=a.subProtocol)==null?void 0:a.multiDevice;if(b!=null){if(b.payload==null)return{version:"v3",type:"error",error:"subprotocol of type consumerMessage has no payload"};e.push({payload:new Uint8Array(b.payload),type:"success",subprotocolType:"consumerMessage"})}if(c!=null){if(c.payload==null)return{version:"v3",type:"error",error:"subprotocol of type armadillo has no payload"};e.push({payload:new Uint8Array(c.payload),type:"success",subprotocolType:"armadillo"})}if(a!=null){if(a.payload==null)return{version:"v3",type:"error",error:"subprotocol of type multiDevice has no payload"};e.push({payload:new Uint8Array(a.payload),type:"success",subprotocolType:"multiDevice"})}return e.length!==1?{version:"v3",type:"error",error:"Wrong number of subprotocols: "+e.length}:e[0]}g.parseMessageApplication=a}),98);
__d("lastx",["invariant"],(function(a,b,c,d,e,f,g,h){"use strict";function a(a){var b=null;if(Array.isArray(a))a.length&&(b={value:a[a.length-1]});else for(a of a)b=b||{},b.value=a;if(b)return b.value;h(0,1145)}g["default"]=a}),98);
__d("MultiKeyMap",["invariant","lastx"],(function(a,b,c,d,e,f,g,h){"use strict";var i=typeof WeakMap==="function";a=function(){function a(){this.$1=this.$2(),this.$3=null}var b=a.prototype;b.set=function(a,b){this.$4(a);var c=this.$1;for(var d=0;d<a.length-1;d++){var e=a[d],f=this.$5(c,e).get(e);f==null&&(f=this.$2(),this.$5(c,e).set(e,f));f.type==="map"||h(0,1732);c=f}e=a[a.length-1];this.$5(c,e).set(e,{type:"value",value:b})};b.get=function(a){this.$4(a);var b=this.$6(a);b=b&&b.get(c("lastx")(a));return b==null||b.type!=="value"?void 0:b.value};b["delete"]=function(a){this.$4(a);var b=this.$6(a);return b?b["delete"](c("lastx")(a)):!1};b.$5=function(a,b){return j(b)?a.cache:a.weakCache};b.$6=function(a){var b=this.$1;for(var d=0;d<a.length-1;d++){var e,f=a[d];if(((e=b)==null?void 0:e.type)==="map")b=this.$5(b,f).get(f);else return void 0}e=c("lastx")(a);f=b&&this.$5(b,e);return f};b.$2=function(){return{type:"map",cache:new Map(),weakCache:i?new WeakMap():new Map()}};b.$4=function(a){this.$3==null&&(this.$3=a.length);if(this.$3!==a.length)throw new Error("MultiKeyMap called with different number of keys");if(a.length<1)throw new Error("MultiKeyMap called with empty array of keys")};return a}();function j(a){var b=typeof a;return b==="number"||b==="string"||b==="boolean"||a==null}g["default"]=a}),98);
__d("memoizeWithArgsWeak",["MultiKeyMap"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b===void 0;var d=new(c("MultiKeyMap"))();return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];var f=d.get(c);if(f!==void 0)return f;var g=a.apply(void 0,c);d.set(c,g);return g}}g["default"]=a}),98);
__d("MAWProtobufDeserializers",["FBLogger","WAArmadilloApplication.pb","WAArmadilloBackupMessage.pb","WAArmadilloLocallyTransformedMessage.pb","WAArmadilloMiTransportAdminMessage.pb","WAArmadilloTransportEvent.pb","WAByteArray","WAConsumerApplication.pb","WAMediaTransport.pb","WAMsgApplication.pb","WAParseMessageApplication","decodeProtobuf","memoize","memoizeWithArgsWeak","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(a){if(a instanceof ArrayBuffer)return a;else return d("WAByteArray").uint8ArrayToBuffer(a)}var i=function(a){var b;this.kind="imageTransport";this.payload=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(b=a.image)==null?void 0:b.payload);this.caption=a.caption},j=function(a){var b;this.kind="audioTransport";this.payload=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").AudioTransportSpec,(b=a.audio)==null?void 0:b.payload);this.ptt=a.ptt},k=function(a){var b;this.kind="videoTransport";this.payload=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,(b=a.video)==null?void 0:b.payload);this.caption=a.caption},l=function(a){var b;this.kind="documentTransport";this.payload=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").DocumentTransportSpec,(b=a.document)==null?void 0:b.payload);this.fileName=a.fileName},m=function(a){this.kind="stickerTransport";this.payload=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,(a=a.sticker)==null?void 0:a.payload)},n=function(a){var b=this;this.kind="extendedContentMessage";this.favicon=c("memoize")(function(){var a;return((a=b.payload)==null?void 0:(a=a.favicon)==null?void 0:a.payload)==null?null:d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(a=b.payload)==null?void 0:(a=a.favicon)==null?void 0:a.payload)});this.headerImage=c("memoize")(function(){var a;return((a=b.payload)==null?void 0:(a=a.headerImage)==null?void 0:a.payload)==null?null:d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,(a=b.payload)==null?void 0:(a=a.headerImage)==null?void 0:a.payload)});this.previews=c("memoize")(function(){var a;return(a=(a=b.payload)==null?void 0:(a=a.previews)==null?void 0:a.map(function(a){return d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").ImageTransportSpec,a.payload)}))!=null?a:[]});this.payload=a},o=function(){function a(a){this.kind="armadillo",this.bytes=h(a),this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloApplication.pb").ArmadilloSpec,a),this.payload=this.proto.payload,this.metadata=this.proto.metadata}var b=a.prototype;b.extendedContentMessage=function(){var a;a=(a=this.payload)==null?void 0:(a=a.content)==null?void 0:a.extendedContentMessage;return a==null?null:new n(a)};return a}(),p=function(a){var b=this,e;this.kind="consumerApplication";this.imageMessage=(e=c("memoize"))(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.imageMessage;if(a==null)return;return new i(a)});this.audioMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.audioMessage;if(a==null)return;return new j(a)});this.videoMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.videoMessage;if(a==null)return;return new k(a)});this.documentMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.documentMessage;if(a==null)return;return new l(a)});this.stickerMessage=e(function(){var a;a=(a=b.payload)==null?void 0:(a=a.content)==null?void 0:a.stickerMessage;if(a==null)return;return new m(a)});this.bytes=h(a);this.proto=d("decodeProtobuf").decodeProtobuf(d("WAConsumerApplication.pb").ConsumerApplicationSpec,a);this.payload=this.proto.payload;this.metadata=this.proto.metadata},q=function(){function a(a){var b=this;this.kind="messageApplication";this.subProtocol=c("memoize")(function(){var a=d("WAParseMessageApplication").parseMessageApplication(b.proto);if(a.payload!=null){var c=a.payload;switch(a.subprotocolType){case"consumerMessage":return new p(c);case"armadillo":return new o(c);case"businessMessage":case"paymentMessage":case"multiDevice":case"voip":break;default:a.subprotocolType}}});this.bytes=h(a);this.proto=d("decodeProtobuf").decodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a)}var b=a.prototype;b.consumerMessage=function(){var a=this.subProtocol();return(a==null?void 0:a.kind)!=="consumerApplication"?null:a};b.armadillo=function(){var a=this.subProtocol();return(a==null?void 0:a.kind)!=="armadillo"?null:a};return a}(),r=function(a){this.kind="transportEvent",this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloTransportEvent.pb").TransportEventSpec,a)},s=function(a){this.kind="locallyTransformedMessage",this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloLocallyTransformedMessage.pb").LocallyTransformedMessageSpec,a)},t=function(a){this.kind="adminMessage",this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloMiTransportAdminMessage.pb").MiTransportAdminMessageSpec,a)},u="SKIP_CACHE",v=function(){function a(a,b){var e=this;this.payload=c("memoize")(function(){if(e.proto.encryptedTransportEvent!=null)return new r(c("nullthrows")(e.proto.encryptedTransportEvent.payload));else if(e.proto.encryptedTransportLocallyTransformedMessage!=null)return new s(c("nullthrows")(e.proto.encryptedTransportLocallyTransformedMessage.payload));else if(e.proto.encryptedTransportMessage!=null)return new q(c("nullthrows")(e.proto.encryptedTransportMessage));else if(e.proto.miTransportAdminMessage!=null)return new t(c("nullthrows")(e.proto.miTransportAdminMessage.payload));throw c("FBLogger")("messenger_web").mustfixThrow("BackupMessage proto has no payload")});this.proto=d("decodeProtobuf").decodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,a)}var b=a.prototype;b.encryptedTransportMessage=function(){var a=this.payload();if(a.kind!=="messageApplication")return;return a};b.encryptedTransportEvent=function(){var a=this.payload();if(a.kind!=="transportEvent")return;return a};b.locallyTransformedMessage=function(){var a=this.payload();if(a.kind!=="locallyTransformedMessage")return;return a};b.adminMessage=function(){var a=this.payload();if(a.kind!=="adminMessage")return;return a};return a}();v.create=c("memoizeWithArgsWeak")(function(a){return new v(a,u)});g.DeserializedExtendedContentMessage=n;g.DeserializedConsumerApplication=p;g.DeserializedMessageApplication=q;g.DeserializedTransportEvent=r;g.DeserializedLocallyTransformedMessage=s;g.DeserializedAdminMessage=t;g.DeserializedBackupMessage=v}),98);
__d("RavenMessagingState",[],(function(a,b,c,d,e,f){a=Object.freeze({PERMANENT:0,UNSEEN:1,SEEN:2,REPLAYED:3,EXPIRED:4});f["default"]=a}),66);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}},i=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};b=function(a,b){return{ephemeralMediaState:b,ephemeralMediaViewMode:i(a)}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=i;g.deriveRavenSettings=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("MAWThreadBumpType",[],(function(a,b,c,d,e,f){"use strict";a="NO_UPDATE";b="LOCAL_ONLY";c="LOCAL_AND_SERVER";d=Object.freeze({LOCAL_AND_SERVER:c,LOCAL_ONLY:b,NO_UPDATE:a});f.THREAD_BUMP_TYPE=d}),66);
__d("MAWThreadUpdateType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;c=2;d=3;e=Object.freeze({BUMP_THREAD:c,MARK_THREAD_AS_UNREAD:d,NO_SNIPPET_OR_ACTIVITY_TS_UPDATE:a,SNIPPET_ONLY:b});f.THREAD_UPDATE_TYPE=e}),66);
__d("MAWVaultMaterialsStorage",["FBLogger","MAWVaultMaterials","Promise","WebAsyncStorage"],(function(a,b,c,d,e,f,g){"use strict";var h,i="mw_exchange_vm";function j(){var a=d("MAWVaultMaterials").generateNewVaultMaterials(),e="newly-generated";return new(h||(h=b("Promise")))(function(b){c("WebAsyncStorage").getOrSetItem(i,a,function(f,g){if(f!=null){var h=c("FBLogger")("messenger_web");if(f instanceof Error)throw h.catching(f).mustfixThrow("Failed to store Vaulting Materials. %s",f.toString());else h.mustfix("Failed to store Vaulting Materials.")}g!==null&&(a=g,e="storage");b(d("MAWVaultMaterials").initializeVaultMaterials(a,e))})})}function a(){return d("MAWVaultMaterials").hasVaultBeenSetup()?(h||(h=b("Promise"))).resolve(d("MAWVaultMaterials").getVaultMaterials()):j()}g.setupVaultMaterials=a}),98);
__d("MWSetupDBEncryption",["BrowserLockManager","ExecutionEnvironment","FBLogger","MAWEncryptionIndexedDbV2","MAWKeychain","MWEARKeychainV3","Promise","WAResultOrError","asyncToGeneratorRuntime","getErrorSafe","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=function(a,b){return b()};function a(a){j=a}var k="mw_ear_db";function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{yield d("MAWEncryptionIndexedDbV2").makeEncryptionDB(a);return yield j("init_setup_keychain",function(){return c("MAWKeychain").init("global_ear",a)})}catch(e){var b=e instanceof Error?e:c("getErrorSafe")(e);c("FBLogger")("messenger_web").catching(b).mustfix("[%s] EAR setup error",String(a));return d("WAResultOrError").DEPRECATED_makeError("keychain-setup-failure",b)}});return m.apply(this,arguments)}function n(a){if(d("MAWEncryptionIndexedDbV2").getEncryptionDB()!=null&&d("MWEARKeychainV3").isKeychainInitialised("global_ear"))return(i||(i=b("Promise"))).resolve(d("WAResultOrError").makeResult(d("MWEARKeychainV3").getLatestVersion("global_ear")));if(c("BrowserLockManager")!=null)return new(i||(i=b("Promise")))(function(d,e){c("promiseDone")(c("BrowserLockManager").request(k,b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var b=(yield l(a));d(b)}catch(a){e(a)}})),function(a){},function(a){e(a)})});else return l(a)}function e(a,c){c===void 0&&(c=function(a){return!0});var d=null;return function(e){d==null&&(d=a(e).then(function(a){d=c(a)?(i||(i=b("Promise"))).resolve(a):null;return a})["catch"](function(a){d=null;throw a}));return d}}f=e(function(a){return n(a)},function(a){return(a==null?void 0:a.success)===!0});e=c("justknobx")._("2804")||(h||(h=c("ExecutionEnvironment"))).isInWorker?f:n;g.setPerformanceMeasurementTool=a;g.init=e}),98);
__d("MpsTypes",["$InternalEnum","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function c(a){return a}function e(a){return a}function f(a){return d("WAStanzaUtils").toStanzaId(a)}function h(a){return a}function i(a){return a}function j(a){return a}var k=b("$InternalEnum").Mirrored(["Send","Receive"]);b=b("$InternalEnum")({Unknown:0,Noop:1,UpsertTopLevel:2,UpsertSupplemental:3,DeleteTopLevel:4,DeleteTopLevelWithPlaceholder:5,Preprocess:6,DeleteSupplemental:7,DeleteThread:8});g.toBytes=a;g.toTimestamp=c;g.toMessageId=e;g.messageIdToStanzaId=f;g.toThreadId=h;g.toSupplementalKey=i;g.fromSupplementalKey=j;g.InsertionSource=k;g.ActionType=b}),98);
__d("MpsToBridgeMessageId",["MAWDbMsg","MpsTypes","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("nullthrows")(d("MAWDbMsg").toMsgId(a+"_"+b+"_m"))}function b(a){a=a.split("_");var b=a[0];a=a[1];return{messageId:d("MpsTypes").toMessageId(a),threadId:d("MpsTypes").toThreadId(b)}}g.mpsToBridgeMsgId=a;g.bridgeMsgIdToMps=b}),98);
__d("MpsMessageToBridgeWrapper",["MAWProtobufDeserializers","MAWUserJidWrapper","MpsToBridgeMessageId","WAJids","WATimeUtils","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WAJids").createJidUtils({platform:"msgr"});a=function(){function a(a,b){this.message=a,this.topLevel=b}a.fromTopLevel=function(b){return new a(b,b)};a.fromSupplemental=function(b,e){var f=d("MAWProtobufDeserializers").DeserializedBackupMessage.create(b.payload);f={messageId:b.messageId,payload:b.payload,senderId:c("nullthrows")((f=f.proto.metadata)==null?void 0:f.senderId),threadId:e.threadId,timestampMs:b.timestampMs};return new a(f,e)};var b=a.prototype;b.getChatJid=function(){return d("WAJids").unsafeCoerceToChatJid(this.message.threadId)};b.getExternalId=function(){return this.message.messageId};b.getMsgId=function(){return d("MpsToBridgeMessageId").mpsToBridgeMsgId(this.message.threadId,this.message.messageId)};b.getSenderJid=function(){return h.toUserJid(this.message.senderId)};b.topLevelMetadata=function(){return a.fromTopLevel(this.topLevel)};b.isAuthorMe=function(){return d("WAJids").userIdFromJid(d("MAWUserJidWrapper").getMyUserJid())===this.message.senderId};b.getAuthor=function(){return this.isAuthorMe()?d("WAJids").AUTHOR_ME:this.getSenderJid()};b.getUnixTs=function(){return d("WATimeUtils").castMilliSecondsToUnixTime(this.message.timestampMs)};b.deserialize=function(){return d("MAWProtobufDeserializers").DeserializedBackupMessage.create(this.message.payload)};return a}();g.MpsMessageToBridgeWrapper=a}),98);
__d("MpsOverBridge",["MAWBridgeSendAndReceive"],(function(a,b,c,d,e,f,g){"use strict";var h=function(){this.loadMessage=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("mps","mpsLoadMessage",a)},this.loadMessages=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("mps","mpsLoadMessages",a)},this.batchLoadMessages=function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("mps","mpsBatchLoadMessages",a)}},i;function a(){i==null&&(i=new h());return i}g.mps=a}),98);
__d("WAMapWithDefault",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a,b){this.$1=a,b!=null?this.$2=new Map(b):this.$2=new Map()}var b=a.prototype;b.size=function(){return this.$2.size};b.clear=function(){this.$2.clear()};b["delete"]=function(a){return this.$2["delete"](a)};b.get=function(a){var b=this.$2.get(a);if(b!=null)return b;else{b=this.$1(a);this.$2.set(a,b);return b}};b.keys=function(){return this.$2.keys()};b.entries=function(){return this.$2.entries()};b.update=function(b,c){c=new Map(this.$2).set(b,c(this.get(b)));return new a(this.$1,c)};b.toMap=function(){return new Map(this.$2)};return a}();f.MapWithDefault=a}),66);
__d("WAMediaHdType",[],(function(a,b,c,d,e,f,g){"use strict";a=0;b=1;c=2;d={HD_TYPE_NONE:a,HD_TYPE_LQ_4K:b,HD_TYPE_HQ_4K:c};g.HD_TYPE_NONE=a;g.HD_TYPE_LQ_4K=b;g.HD_TYPE_HQ_4K=c;g.HD_TYPE=d}),98);
__d("WAMediaQplHelper",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(a==null||a<0||a>1e3*1024*1024)return"invalid_size";else if(a===0)return"size equal to 0KB";else if(a<=1*1024)return"size lower than 1 KB";else if(a<=50*1024)return"size between 1 KB and 50 KB";else if(a<=100*1024)return"size between 50 KB and 100 KB";else if(a<=500*1024)return"size between 100 KB and 500 KB";else if(a<=1*1024*1024)return"size between 500 KB and 1 MB";else if(a<=2*1024*1024)return"size between 1 MB and 2 MB";else if(a<=5*1024*1024)return"size between 2 MB and 5 MB";else if(a<=10*1024*1024)return"size between 5 MB and 10 MB";else if(a<=20*1024*1024)return"size between 10 MB and 20 MB";else if(a<=25*1024*1024)return"size between 20 MB and 25 MB";else if(a<=30*1024*1024)return"size between 25 MB and 30 MB";else if(a<=50*1024*1024)return"size between 30 MB and 50 MB";else if(a<=75*1024*1024)return"size between 50 MB and 75 MB";else if(a<=100*1024*1024)return"size between 75 MB and 100 MB";else return"size above 100 MB"}f.convertIntegerSizeToStringBucket=a}),66);
__d("getMediaTypeFromConsumerMessage",["WAMediaTransport.pb","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a==null?void 0:(a=a.payload)==null?void 0:a.content;if((a==null?void 0:a.audioMessage)!=null)return"ptt";if((a==null?void 0:a.videoMessage)!=null){var b,c;b=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,a==null?void 0:(b=a.videoMessage)==null?void 0:(b=b.video)==null?void 0:b.payload);return(b==null?void 0:(c=b.ancillary)==null?void 0:c.gifPlayback)===!0||(b==null?void 0:(c=b.ancillary)==null?void 0:c.gifAttribution)!=null?"gif":"video"}if((a==null?void 0:a.documentMessage)!=null)return"document";if((a==null?void 0:a.stickerMessage)!=null)return"sticker";if((a==null?void 0:a.imageMessage)!=null)return"image";return}g.getMediaTypeFromConsumerMessage=a}),98);
__d("isInstamadilloEB",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("670")===!0}g["default"]=a}),98);
__d("maybeConvertMessageTextMentionsV2ToV1",["WACommon.pb"],(function(a,b,c,d,e,f,g){function a(a){if(a==null||a.text==null||a.mentions==null||a.mentions.length===0)return a;var b=a.text,c=[],e=[],f=0;for(var g of a.mentions){var h=g.offset,i=g.length,j=g.mentionedJid,k=g.mentionType;if(k!==d("WACommon.pb").MENTION_MENTION_TYPE.PROFILE||h==null||i==null||j==null)continue;e.push(j+"@msgr");c.push(b.substring(f,h));c.push("@"+j+"@msgr");f=h+i}if(e.length===0)return a;c.push(b.substring(f));return babelHelpers["extends"]({},a,{text:c.join(""),mentionedJid:e,mentions:[]})}g["default"]=a}),98);
__d("updateAndFlushLSDataTrace",["FBLogger","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","Promise","ReQLTable","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("LSDataTraceFlush").__setRef("updateAndFlushLSDataTrace");function a(a,e){return e==null?(j||(j=b("Promise"))).resolve():c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").CLIENT_READY_TO_FLUSH),dataTraceId:e,syncChannel:(i||(i=d("I64"))).neg_one}).then(function(){return d("ReQLTable").update(a.data_trace_meta,[e],function(a){if(a!=null)return{contextOne:a.contextOne,contextThree:a.contextThree,contextTwo:a.contextTwo,foregroundTimestampMs:a.foregroundTimestampMs,initTimestampMs:a.initTimestampMs,predefinedId:a.predefinedId,shouldFlush:!0,traceId:a.traceId,traceType:a.traceType};else throw c("FBLogger")("messenger_web").mustfixThrow('Data trace is missing, id: "%s"',e)}).then(function(){return k.load().then(function(b){return b.flush(a,e)})})})}g["default"]=a}),98);/*FB_PKG_DELIM*/
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("core-util-is-1.0.2",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){function a(a){return Array.isArray?Array.isArray(a):p(a)==="[object Array]"}g.isArray=a;function b(a){return typeof a==="boolean"}g.isBoolean=b;function c(a){return a===null}g.isNull=c;function d(a){return a==null}g.isNullOrUndefined=d;function e(a){return typeof a==="number"}g.isNumber=e;function f(a){return typeof a==="string"}g.isString=f;function h(a){return typeof a==="symbol"}g.isSymbol=h;function i(a){return a===void 0}g.isUndefined=i;function j(a){return p(a)==="[object RegExp]"}g.isRegExp=j;function k(a){return typeof a==="object"&&a!==null}g.isObject=k;function l(a){return p(a)==="[object Date]"}g.isDate=l;function m(a){return p(a)==="[object Error]"||a instanceof Error}g.isError=m;function n(a){return typeof a==="function"}g.isFunction=n;function o(a){return a===null||typeof a==="boolean"||typeof a==="number"||typeof a==="string"||typeof a==="symbol"||typeof a==="undefined"}g.isPrimitive=o;g.isBuffer=Buffer.isBuffer;function p(a){return Object.prototype.toString.call(a)}}var j=!1;function k(){j||(j=!0,i());return h.exports}function a(a){switch(a){case void 0:return k()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("immediate-3.0.6",[],(function(a,b,c,d,e,f){"use strict";c={};var g={exports:c};function h(){var b=a.MutationObserver||a.WebKitMutationObserver,c;if(process.browser)if(b){var d=0;b=new b(j);var e=a.document.createTextNode("");b.observe(e,{characterData:!0});c=function(){e.data=d=++d%2}}else if(!a.setImmediate&&typeof a.MessageChannel!=="undefined"){var f=new a.MessageChannel();f.port1.onmessage=j;c=function(){f.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?c=function(){var b=a.document.createElement("script");b.onreadystatechange=function(){j(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null};a.document.documentElement.appendChild(b)}:c=function(){setTimeout(j,0)};else c=function(){process.nextTick(j)};var h,i=[];function j(){h=!0;var a,b,c=i.length;while(c){b=i;i=[];a=-1;while(++a<c)b[a]();c=i.length}h=!1}g.exports=k;function k(a){i.push(a)===1&&!h&&c()}}var i=!1;function j(){i||(i=!0,h());return g.exports}function b(a){switch(a){case void 0:return j()}}e.exports=b}),null);
/**
 * License: https://www.facebook.com/legal/license/Hnt8PzozZpk/
 */
__d("inherits-2.0.3",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){typeof Object.create==="function"?g.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:g.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype;a.prototype=new c();a.prototype.constructor=a}}var i=!1;function j(){i||(i=!0,h());return g.exports}c={};var k={exports:c};function l(){try{var a={};if(typeof a.inherits!=="function")throw"";k.exports=a.inherits}catch(a){k.exports=j()}}var m=!1;function n(){m||(m=!0,l());return k.exports}function a(a){switch(a){case void 0:return n()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("isarray-1.0.0",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){var a={}.toString;g.exports=Array.isArray||function(b){return a.call(b)=="[object Array]"}}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("lie-3.3.0",["immediate-3.0.6"],(function(a,b,c,d,e,f){"use strict";function a(a){return a&&typeof a==="object"&&"default"in a?a["default"]:a}var g=a(b("immediate-3.0.6"));d={};var h={exports:d};function i(){var a=g();function b(){}var c={},d=["REJECTED"],e=["FULFILLED"],f=["PENDING"];if(!process.browser)var i=["UNHANDLED"];h.exports=j;function j(a){if(typeof a!=="function")throw new TypeError("resolver must be a function");this.state=f;this.queue=[];this.outcome=void 0;process.browser||(this.handled=i);a!==b&&n(this,a)}j.prototype["finally"]=function(c){if(typeof c!=="function")return this;var d=this.constructor;return this.then(a,b);function a(a){function b(){return a}return d.resolve(c()).then(b)}function b(a){function b(){throw a}return d.resolve(c()).then(b)}};j.prototype["catch"]=function(a){return this.then(null,a)};j.prototype.then=function(a,c){if(typeof a!=="function"&&this.state===e||typeof c!=="function"&&this.state===d)return this;var g=new this.constructor(b);process.browser||this.handled===i&&(this.handled=null);if(this.state!==f){var h=this.state===e?a:c;l(g,h,this.outcome)}else this.queue.push(new k(g,a,c));return g};function k(a,b,c){this.promise=a,typeof b==="function"&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),typeof c==="function"&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}k.prototype.callFulfilled=function(a){c.resolve(this.promise,a)};k.prototype.otherCallFulfilled=function(a){l(this.promise,this.onFulfilled,a)};k.prototype.callRejected=function(a){c.reject(this.promise,a)};k.prototype.otherCallRejected=function(a){l(this.promise,this.onRejected,a)};function l(b,d,e){a(function(){var a;try{a=d(e)}catch(a){return c.reject(b,a)}a===b?c.reject(b,new TypeError("Cannot resolve promise with itself")):c.resolve(b,a)})}c.resolve=function(a,b){var d=o(m,b);if(d.status==="error")return c.reject(a,d.value);d=d.value;if(d)n(a,d);else{a.state=e;a.outcome=b;d=-1;var f=a.queue.length;while(++d<f)a.queue[d].callFulfilled(b)}return a};c.reject=function(b,c){b.state=d;b.outcome=c;process.browser||b.handled===i&&a(function(){b.handled===i&&process.emit("unhandledRejection",c,b)});var e=-1,f=b.queue.length;while(++e<f)b.queue[e].callRejected(c);return b};function m(a){var b=a&&a.then;if(a&&(typeof a==="object"||typeof a==="function")&&typeof b==="function")return function(){b.apply(a,arguments)}}function n(a,b){var d=!1;function e(b){if(d)return;d=!0;c.reject(a,b)}function f(b){if(d)return;d=!0;c.resolve(a,b)}function g(){b(f,e)}g=o(g);g.status==="error"&&e(g.value)}function o(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}j.resolve=p;function p(a){return a instanceof this?a:c.resolve(new this(b),a)}j.reject=q;function q(a){var d=new this(b);return c.reject(d,a)}j.all=r;function r(a){var d=this;if(Object.prototype.toString.call(a)!=="[object Array]")return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);var g=new Array(e),h=0,i=-1,j=new this(b);while(++i<e)k(a[i],i);return j;function k(b,a){d.resolve(b).then(i,function(a){f||(f=!0,c.reject(j,a))});function i(b){g[a]=b,++h===e&&!f&&(f=!0,c.resolve(j,g))}}}j.race=s;function s(a){var d=this;if(Object.prototype.toString.call(a)!=="[object Array]")return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);var g=-1,h=new this(b);while(++g<e)i(a[g]);return h;function i(a){d.resolve(a).then(function(a){f||(f=!0,c.resolve(h,a))},function(a){f||(f=!0,c.reject(h,a))})}}}var j=!1;function k(){j||(j=!0,i());return h.exports}function c(a){switch(a){case void 0:return k()}}e.exports=c}),null);
/**
 * License: https://www.facebook.com/legal/license/cr2jmG-CdKo/
 */
__d("pako-1.0.8",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";function b(a,b){return Object.prototype.hasOwnProperty.call(a,b)}g.assign=function(a){var c=Array.prototype.slice.call(arguments,1);while(c.length){var d=c.shift();if(!d)continue;if(typeof d!=="object")throw new TypeError(d+"must be non-object");for(var e in d)b(d,e)&&(a[e]=d[e])}return a};g.shrinkBuf=function(a,b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a};var c={arraySet:function(a,b,c,d,e){if(b.subarray&&a.subarray){a.set(b.subarray(c,c+d),e);return}for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){var b,c,d,e,f;d=0;for(b=0,c=a.length;b<c;b++)d+=a[b].length;d=new Uint8Array(d);e=0;for(b=0,c=a.length;b<c;b++)f=a[b],d.set(f,e),e+=f.length;return d}},d={arraySet:function(a,b,c,d,e){for(var f=0;f<d;f++)a[e+f]=b[c+f]},flattenChunks:function(a){return[].concat.apply([],a)}};g.setTyped=function(a){a?(g.Buf8=Uint8Array,g.Buf16=Uint16Array,g.Buf32=Int32Array,g.assign(g,c)):(g.Buf8=Array,g.Buf16=Array,g.Buf32=Array,g.assign(g,d))};g.setTyped(a)}var j=!1;function k(){j||(j=!0,i());return h.exports}var l={},m={exports:l};function n(){var a=k(),b=4,c=0,d=1,e=2;function f(a){var b=a.length;while(--b>=0)a[b]=0}var g=0,h=1,i=2,j=3,m=258,n=29,o=256,p=o+1+n,q=30,r=19,aa=2*p+1,s=15,t=16,u=7,v=256,w=16,x=17,y=18,z=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],B=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ba=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ca=512,C=new Array((p+2)*2);f(C);var da=new Array(q*2);f(da);var D=new Array(ca);f(D);var ea=new Array(m-j+1);f(ea);var fa=new Array(n);f(fa);var E=new Array(q);f(E);function ga(a,b,c,d,e){this.static_tree=a,this.extra_bits=b,this.extra_base=c,this.elems=d,this.max_length=e,this.has_stree=a&&a.length}var ha,F,G;function H(a,b){this.dyn_tree=a,this.max_code=0,this.stat_desc=b}function ia(a){return a<256?D[a]:D[256+(a>>>7)]}function ja(a,b){a.pending_buf[a.pending++]=b&255,a.pending_buf[a.pending++]=b>>>8&255}function I(a,b,c){a.bi_valid>t-c?(a.bi_buf|=b<<a.bi_valid&65535,ja(a,a.bi_buf),a.bi_buf=b>>t-a.bi_valid,a.bi_valid+=c-t):(a.bi_buf|=b<<a.bi_valid&65535,a.bi_valid+=c)}function J(a,b,c){I(a,c[b*2],c[b*2+1])}function ka(a,b){var c=0;do c|=a&1,a>>>=1,c<<=1;while(--b>0);return c>>>1}function la(a){a.bi_valid===16?(ja(a,a.bi_buf),a.bi_buf=0,a.bi_valid=0):a.bi_valid>=8&&(a.pending_buf[a.pending++]=a.bi_buf&255,a.bi_buf>>=8,a.bi_valid-=8)}function ma(a,b){var c=b.dyn_tree,d=b.max_code,e=b.stat_desc.static_tree,f=b.stat_desc.has_stree,g=b.stat_desc.extra_bits,h=b.stat_desc.extra_base;b=b.stat_desc.max_length;var i,j,k,l,m,n=0;for(k=0;k<=s;k++)a.bl_count[k]=0;c[a.heap[a.heap_max]*2+1]=0;for(i=a.heap_max+1;i<aa;i++){j=a.heap[i];k=c[c[j*2+1]*2+1]+1;k>b&&(k=b,n++);c[j*2+1]=k;if(j>d)continue;a.bl_count[k]++;l=0;j>=h&&(l=g[j-h]);m=c[j*2];a.opt_len+=m*(k+l);f&&(a.static_len+=m*(e[j*2+1]+l))}if(n===0)return;do{k=b-1;while(a.bl_count[k]===0)k--;a.bl_count[k]--;a.bl_count[k+1]+=2;a.bl_count[b]--;n-=2}while(n>0);for(k=b;k!==0;k--){j=a.bl_count[k];while(j!==0){m=a.heap[--i];if(m>d)continue;c[m*2+1]!==k&&(a.opt_len+=(k-c[m*2+1])*c[m*2],c[m*2+1]=k);j--}}}function na(a,b,c){var d=new Array(s+1),e=0,f;for(f=1;f<=s;f++)d[f]=e=e+c[f-1]<<1;for(f=0;f<=b;f++){c=a[f*2+1];if(c===0)continue;a[f*2]=ka(d[c]++,c)}}function K(){var a,b,c,d=new Array(s+1);b=0;for(c=0;c<n-1;c++){fa[c]=b;for(a=0;a<1<<z[c];a++)ea[b++]=c}ea[b-1]=c;b=0;for(c=0;c<16;c++){E[c]=b;for(a=0;a<1<<A[c];a++)D[b++]=c}b>>=7;for(;c<q;c++){E[c]=b<<7;for(a=0;a<1<<A[c]-7;a++)D[256+b++]=c}for(c=0;c<=s;c++)d[c]=0;a=0;while(a<=143)C[a*2+1]=8,a++,d[8]++;while(a<=255)C[a*2+1]=9,a++,d[9]++;while(a<=279)C[a*2+1]=7,a++,d[7]++;while(a<=287)C[a*2+1]=8,a++,d[8]++;na(C,p+1,d);for(a=0;a<q;a++)da[a*2+1]=5,da[a*2]=ka(a,5);ha=new ga(C,z,o+1,p,s);F=new ga(da,A,0,q,s);G=new ga(new Array(0),B,0,r,u)}function oa(a){var b;for(b=0;b<p;b++)a.dyn_ltree[b*2]=0;for(b=0;b<q;b++)a.dyn_dtree[b*2]=0;for(b=0;b<r;b++)a.bl_tree[b*2]=0;a.dyn_ltree[v*2]=1;a.opt_len=a.static_len=0;a.last_lit=a.matches=0}function L(a){a.bi_valid>8?ja(a,a.bi_buf):a.bi_valid>0&&(a.pending_buf[a.pending++]=a.bi_buf),a.bi_buf=0,a.bi_valid=0}function pa(b,c,d,e){L(b),e&&(ja(b,d),ja(b,~d)),a.arraySet(b.pending_buf,b.window,c,d,b.pending),b.pending+=d}function qa(a,b,c,d){var e=b*2,f=c*2;return a[e]<a[f]||a[e]===a[f]&&d[b]<=d[c]}function M(a,b,c){var d=a.heap[c],e=c<<1;while(e<=a.heap_len){e<a.heap_len&&qa(b,a.heap[e+1],a.heap[e],a.depth)&&e++;if(qa(b,d,a.heap[e],a.depth))break;a.heap[c]=a.heap[e];c=e;e<<=1}a.heap[c]=d}function ra(a,b,c){var d,e,f=0,g,h;if(a.last_lit!==0)do d=a.pending_buf[a.d_buf+f*2]<<8|a.pending_buf[a.d_buf+f*2+1],e=a.pending_buf[a.l_buf+f],f++,d===0?J(a,e,b):(g=ea[e],J(a,g+o+1,b),h=z[g],h!==0&&(e-=fa[g],I(a,e,h)),d--,g=ia(d),J(a,g,c),h=A[g],h!==0&&(d-=E[g],I(a,d,h)));while(f<a.last_lit);J(a,v,b)}function N(a,b){var c=b.dyn_tree,d=b.stat_desc.static_tree,e=b.stat_desc.has_stree,f=b.stat_desc.elems,g,h=-1,i;a.heap_len=0;a.heap_max=aa;for(g=0;g<f;g++)c[g*2]!==0?(a.heap[++a.heap_len]=h=g,a.depth[g]=0):c[g*2+1]=0;while(a.heap_len<2)i=a.heap[++a.heap_len]=h<2?++h:0,c[i*2]=1,a.depth[i]=0,a.opt_len--,e&&(a.static_len-=d[i*2+1]);b.max_code=h;for(g=a.heap_len>>1;g>=1;g--)M(a,c,g);i=f;do g=a.heap[1],a.heap[1]=a.heap[a.heap_len--],M(a,c,1),e=a.heap[1],a.heap[--a.heap_max]=g,a.heap[--a.heap_max]=e,c[i*2]=c[g*2]+c[e*2],a.depth[i]=(a.depth[g]>=a.depth[e]?a.depth[g]:a.depth[e])+1,c[g*2+1]=c[e*2+1]=i,a.heap[1]=i++,M(a,c,1);while(a.heap_len>=2);a.heap[--a.heap_max]=a.heap[1];ma(a,b);na(c,h,a.bl_count)}function O(a,b,c){var d,e=-1,f,g=b[0*2+1],h=0,i=7,j=4;g===0&&(i=138,j=3);b[(c+1)*2+1]=65535;for(d=0;d<=c;d++){f=g;g=b[(d+1)*2+1];if(++h<i&&f===g)continue;else h<j?a.bl_tree[f*2]+=h:f!==0?(f!==e&&a.bl_tree[f*2]++,a.bl_tree[w*2]++):h<=10?a.bl_tree[x*2]++:a.bl_tree[y*2]++;h=0;e=f;g===0?(i=138,j=3):f===g?(i=6,j=3):(i=7,j=4)}}function P(a,b,c){var d,e=-1,f,g=b[0*2+1],h=0,i=7,j=4;g===0&&(i=138,j=3);for(d=0;d<=c;d++){f=g;g=b[(d+1)*2+1];if(++h<i&&f===g)continue;else if(h<j)do J(a,f,a.bl_tree);while(--h!==0);else f!==0?(f!==e&&(J(a,f,a.bl_tree),h--),J(a,w,a.bl_tree),I(a,h-3,2)):h<=10?(J(a,x,a.bl_tree),I(a,h-3,3)):(J(a,y,a.bl_tree),I(a,h-11,7));h=0;e=f;g===0?(i=138,j=3):f===g?(i=6,j=3):(i=7,j=4)}}function Q(a){var b;O(a,a.dyn_ltree,a.l_desc.max_code);O(a,a.dyn_dtree,a.d_desc.max_code);N(a,a.bl_desc);for(b=r-1;b>=3;b--)if(a.bl_tree[ba[b]*2+1]!==0)break;a.opt_len+=3*(b+1)+5+5+4;return b}function sa(a,b,c,d){var e;I(a,b-257,5);I(a,c-1,5);I(a,d-4,4);for(e=0;e<d;e++)I(a,a.bl_tree[ba[e]*2+1],3);P(a,a.dyn_ltree,b-1);P(a,a.dyn_dtree,c-1)}function R(a){var b=4093624447,e;for(e=0;e<=31;e++,b>>>=1)if(b&1&&a.dyn_ltree[e*2]!==0)return c;if(a.dyn_ltree[9*2]!==0||a.dyn_ltree[10*2]!==0||a.dyn_ltree[13*2]!==0)return d;for(e=32;e<o;e++)if(a.dyn_ltree[e*2]!==0)return d;return c}var ta=!1;function S(a){ta||(K(),ta=!0),a.l_desc=new H(a.dyn_ltree,ha),a.d_desc=new H(a.dyn_dtree,F),a.bl_desc=new H(a.bl_tree,G),a.bi_buf=0,a.bi_valid=0,oa(a)}function T(a,b,c,d){I(a,(g<<1)+(d?1:0),3),pa(a,b,c,!0)}function U(a){I(a,h<<1,3),J(a,v,C),la(a)}function V(a,c,d,f){var g,j,k=0;a.level>0?(a.strm.data_type===e&&(a.strm.data_type=R(a)),N(a,a.l_desc),N(a,a.d_desc),k=Q(a),g=a.opt_len+3+7>>>3,j=a.static_len+3+7>>>3,j<=g&&(g=j)):g=j=d+5;d+4<=g&&c!==-1?T(a,c,d,f):a.strategy===b||j===g?(I(a,(h<<1)+(f?1:0),3),ra(a,C,da)):(I(a,(i<<1)+(f?1:0),3),sa(a,a.l_desc.max_code+1,a.d_desc.max_code+1,k+1),ra(a,a.dyn_ltree,a.dyn_dtree));oa(a);f&&L(a)}function W(a,b,c){a.pending_buf[a.d_buf+a.last_lit*2]=b>>>8&255;a.pending_buf[a.d_buf+a.last_lit*2+1]=b&255;a.pending_buf[a.l_buf+a.last_lit]=c&255;a.last_lit++;b===0?a.dyn_ltree[c*2]++:(a.matches++,b--,a.dyn_ltree[(ea[c]+o+1)*2]++,a.dyn_dtree[ia(b)*2]++);return a.last_lit===a.lit_bufsize-1}l._tr_init=S;l._tr_stored_block=T;l._tr_flush_block=V;l._tr_tally=W;l._tr_align=U}var o=!1;function p(){o||(o=!0,n());return m.exports}b={};var q={exports:b};function r(){function a(a,b,c,d){var e=a&65535|0;a=a>>>16&65535|0;var f;while(c!==0){f=c>2e3?2e3:c;c-=f;do e=e+b[d++]|0,a=a+e|0;while(--f);e%=65521;a%=65521}return e|a<<16|0}q.exports=a}var aa=!1;function s(){aa||(aa=!0,r());return q.exports}c={};var t={exports:c};function u(){function a(){var a,b=[];for(var c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}var b=a();function c(a,c,d,e){var f=b;d=e+d;a^=-1;for(e=e;e<d;e++)a=a>>>8^f[(a^c[e])&255];return a^-1}t.exports=c}var v=!1;function w(){v||(v=!0,u());return t.exports}d={};var x={exports:d};function y(){x.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}var z=!1;function A(){z||(z=!0,y());return x.exports}var B={},ba={exports:B};function ca(){var a=k(),b=p(),c=s(),d=w(),e=A(),f=0,g=1,h=3,i=4,j=5,l=0,m=1,n=-2,o=-3,q=-5,r=-1,aa=1,t=2,u=3,v=4,x=0,y=2,z=8,ba=9,ca=15,C=8,da=29,D=256,ea=D+1+da,fa=30,E=19,ga=2*ea+1,ha=15,F=3,G=258,H=G+F+1,ia=32,ja=42,I=69,J=73,ka=91,la=103,ma=113,na=666,K=1,oa=2,L=3,pa=4,qa=3;function M(a,b){a.msg=e[b];return b}function ra(a){return(a<<1)-(a>4?9:0)}function N(a){var b=a.length;while(--b>=0)a[b]=0}function O(b){var c=b.state,d=c.pending;d>b.avail_out&&(d=b.avail_out);if(d===0)return;a.arraySet(b.output,c.pending_buf,c.pending_out,d,b.next_out);b.next_out+=d;c.pending_out+=d;b.total_out+=d;b.avail_out-=d;c.pending-=d;c.pending===0&&(c.pending_out=0)}function P(a,c){b._tr_flush_block(a,a.block_start>=0?a.block_start:-1,a.strstart-a.block_start,c),a.block_start=a.strstart,O(a.strm)}function Q(a,b){a.pending_buf[a.pending++]=b}function sa(a,b){a.pending_buf[a.pending++]=b>>>8&255,a.pending_buf[a.pending++]=b&255}function R(b,e,f,g){var h=b.avail_in;h>g&&(h=g);if(h===0)return 0;b.avail_in-=h;a.arraySet(e,b.input,b.next_in,h,f);b.state.wrap===1?b.adler=c(b.adler,e,h,f):b.state.wrap===2&&(b.adler=d(b.adler,e,h,f));b.next_in+=h;b.total_in+=h;return h}function ta(a,b){var c=a.max_chain_length,d=a.strstart,e,f=a.prev_length,g=a.nice_match,h=a.strstart>a.w_size-H?a.strstart-(a.w_size-H):0,i=a.window,j=a.w_mask,k=a.prev,l=a.strstart+G,m=i[d+f-1],n=i[d+f];a.prev_length>=a.good_match&&(c>>=2);g>a.lookahead&&(g=a.lookahead);do{e=b;if(i[e+f]!==n||i[e+f-1]!==m||i[e]!==i[d]||i[++e]!==i[d+1])continue;d+=2;e++;do;while(i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&i[++d]===i[++e]&&d<l);e=G-(l-d);d=l-G;if(e>f){a.match_start=b;f=e;if(e>=g)break;m=i[d+f-1];n=i[d+f]}}while((b=k[b&j])>h&&--c!==0);return f<=a.lookahead?f:a.lookahead}function S(b){var c=b.w_size,d,e,f,g;do{g=b.window_size-b.lookahead-b.strstart;if(b.strstart>=c+(c-H)){a.arraySet(b.window,b.window,c,c,0);b.match_start-=c;b.strstart-=c;b.block_start-=c;e=b.hash_size;d=e;do f=b.head[--d],b.head[d]=f>=c?f-c:0;while(--e);e=c;d=e;do f=b.prev[--d],b.prev[d]=f>=c?f-c:0;while(--e);g+=c}if(b.strm.avail_in===0)break;e=R(b.strm,b.window,b.strstart+b.lookahead,g);b.lookahead+=e;if(b.lookahead+b.insert>=F){f=b.strstart-b.insert;b.ins_h=b.window[f];b.ins_h=(b.ins_h<<b.hash_shift^b.window[f+1])&b.hash_mask;while(b.insert){b.ins_h=(b.ins_h<<b.hash_shift^b.window[f+F-1])&b.hash_mask;b.prev[f&b.w_mask]=b.head[b.ins_h];b.head[b.ins_h]=f;f++;b.insert--;if(b.lookahead+b.insert<F)break}}}while(b.lookahead<H&&b.strm.avail_in!==0)}function T(a,b){var c=65535;c>a.pending_buf_size-5&&(c=a.pending_buf_size-5);for(;;){if(a.lookahead<=1){S(a);if(a.lookahead===0&&b===f)return K;if(a.lookahead===0)break}a.strstart+=a.lookahead;a.lookahead=0;var d=a.block_start+c;if(a.strstart===0||a.strstart>=d){a.lookahead=a.strstart-d;a.strstart=d;P(a,!1);if(a.strm.avail_out===0)return K}if(a.strstart-a.block_start>=a.w_size-H){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=0;if(b===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.strstart>a.block_start){P(a,!1);if(a.strm.avail_out===0)return K}return K}function U(a,c){var d;for(;;){if(a.lookahead<H){S(a);if(a.lookahead<H&&c===f)return K;if(a.lookahead===0)break}d=0;a.lookahead>=F&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);d!==0&&a.strstart-d<=a.w_size-H&&(a.match_length=ta(a,d));if(a.match_length>=F){d=b._tr_tally(a,a.strstart-a.match_start,a.match_length-F);a.lookahead-=a.match_length;if(a.match_length<=a.max_lazy_match&&a.lookahead>=F){a.match_length--;do a.strstart++,a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart;while(--a.match_length!==0);a.strstart++}else a.strstart+=a.match_length,a.match_length=0,a.ins_h=a.window[a.strstart],a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+1])&a.hash_mask}else d=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++;if(d){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=a.strstart<F-1?a.strstart:F-1;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function V(a,c){var d,e;for(;;){if(a.lookahead<H){S(a);if(a.lookahead<H&&c===f)return K;if(a.lookahead===0)break}d=0;a.lookahead>=F&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,d=a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);a.prev_length=a.match_length;a.prev_match=a.match_start;a.match_length=F-1;d!==0&&a.prev_length<a.max_lazy_match&&a.strstart-d<=a.w_size-H&&(a.match_length=ta(a,d),a.match_length<=5&&(a.strategy===aa||a.match_length===F&&a.strstart-a.match_start>4096)&&(a.match_length=F-1));if(a.prev_length>=F&&a.match_length<=a.prev_length){d=a.strstart+a.lookahead-F;e=b._tr_tally(a,a.strstart-1-a.prev_match,a.prev_length-F);a.lookahead-=a.prev_length-1;a.prev_length-=2;do++a.strstart<=d&&(a.ins_h=(a.ins_h<<a.hash_shift^a.window[a.strstart+F-1])&a.hash_mask,a.prev[a.strstart&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=a.strstart);while(--a.prev_length!==0);a.match_available=0;a.match_length=F-1;a.strstart++;if(e){P(a,!1);if(a.strm.avail_out===0)return K}}else if(a.match_available){e=b._tr_tally(a,0,a.window[a.strstart-1]);e&&P(a,!1);a.strstart++;a.lookahead--;if(a.strm.avail_out===0)return K}else a.match_available=1,a.strstart++,a.lookahead--}a.match_available&&(b._tr_tally(a,0,a.window[a.strstart-1]),a.match_available=0);a.insert=a.strstart<F-1?a.strstart:F-1;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function W(a,c){var d,e,g,h=a.window;for(;;){if(a.lookahead<=G){S(a);if(a.lookahead<=G&&c===f)return K;if(a.lookahead===0)break}a.match_length=0;if(a.lookahead>=F&&a.strstart>0){e=a.strstart-1;d=h[e];if(d===h[++e]&&d===h[++e]&&d===h[++e]){g=a.strstart+G;do;while(d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&d===h[++e]&&e<g);a.match_length=G-(g-e);a.match_length>a.lookahead&&(a.match_length=a.lookahead)}}a.match_length>=F?(d=b._tr_tally(a,1,a.match_length-F),a.lookahead-=a.match_length,a.strstart+=a.match_length,a.match_length=0):(d=b._tr_tally(a,0,a.window[a.strstart]),a.lookahead--,a.strstart++);if(d){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=0;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function X(a,c){var d;for(;;){if(a.lookahead===0){S(a);if(a.lookahead===0){if(c===f)return K;break}}a.match_length=0;d=b._tr_tally(a,0,a.window[a.strstart]);a.lookahead--;a.strstart++;if(d){P(a,!1);if(a.strm.avail_out===0)return K}}a.insert=0;if(c===i){P(a,!0);return a.strm.avail_out===0?L:pa}if(a.last_lit){P(a,!1);if(a.strm.avail_out===0)return K}return oa}function ua(a,b,c,d,e){this.good_length=a,this.max_lazy=b,this.nice_length=c,this.max_chain=d,this.func=e}var va;va=[new ua(0,0,0,0,T),new ua(4,4,8,4,U),new ua(4,5,16,8,U),new ua(4,6,32,32,U),new ua(4,4,16,16,V),new ua(8,16,32,32,V),new ua(8,16,128,128,V),new ua(8,32,128,256,V),new ua(32,128,258,1024,V),new ua(32,258,258,4096,V)];function wa(a){a.window_size=2*a.w_size,N(a.head),a.max_lazy_match=va[a.level].max_lazy,a.good_match=va[a.level].good_length,a.nice_match=va[a.level].nice_length,a.max_chain_length=va[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=F-1,a.match_available=0,a.ins_h=0}function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(ga*2),this.dyn_dtree=new a.Buf16((2*fa+1)*2),this.bl_tree=new a.Buf16((2*E+1)*2),N(this.dyn_ltree),N(this.dyn_dtree),N(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(ha+1),this.heap=new a.Buf16(2*ea+1),N(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*ea+1),N(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function xa(a){var c;if(!a||!a.state)return M(a,n);a.total_in=a.total_out=0;a.data_type=y;c=a.state;c.pending=0;c.pending_out=0;c.wrap<0&&(c.wrap=-c.wrap);c.status=c.wrap?ja:ma;a.adler=c.wrap===2?0:1;c.last_flush=f;b._tr_init(c);return l}function Z(a){var b=xa(a);b===l&&wa(a.state);return b}function $(a,b){if(!a||!a.state)return n;if(a.state.wrap!==2)return n;a.state.gzhead=b;return l}function ya(b,c,d,e,f,g){if(!b)return n;var h=1;c===r&&(c=6);e<0?(h=0,e=-e):e>15&&(h=2,e-=16);if(f<1||f>ba||d!==z||e<8||e>15||c<0||c>9||g<0||g>v)return M(b,n);e===8&&(e=9);var i=new Y();b.state=i;i.strm=b;i.wrap=h;i.gzhead=null;i.w_bits=e;i.w_size=1<<i.w_bits;i.w_mask=i.w_size-1;i.hash_bits=f+7;i.hash_size=1<<i.hash_bits;i.hash_mask=i.hash_size-1;i.hash_shift=~~((i.hash_bits+F-1)/F);i.window=new a.Buf8(i.w_size*2);i.head=new a.Buf16(i.hash_size);i.prev=new a.Buf16(i.w_size);i.lit_bufsize=1<<f+6;i.pending_buf_size=i.lit_bufsize*4;i.pending_buf=new a.Buf8(i.pending_buf_size);i.d_buf=1*i.lit_bufsize;i.l_buf=(1+2)*i.lit_bufsize;i.level=c;i.strategy=g;i.method=d;return Z(b)}function za(a,b){return ya(a,b,z,ca,C,x)}function Aa(a,c){var e,k;if(!a||!a.state||c>j||c<0)return a?M(a,n):n;k=a.state;if(!a.output||!a.input&&a.avail_in!==0||k.status===na&&c!==i)return M(a,a.avail_out===0?q:n);k.strm=a;e=k.last_flush;k.last_flush=c;if(k.status===ja)if(k.wrap===2)a.adler=0,Q(k,31),Q(k,139),Q(k,8),!k.gzhead?(Q(k,0),Q(k,0),Q(k,0),Q(k,0),Q(k,0),Q(k,k.level===9?2:k.strategy>=t||k.level<2?4:0),Q(k,qa),k.status=ma):(Q(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),Q(k,k.gzhead.time&255),Q(k,k.gzhead.time>>8&255),Q(k,k.gzhead.time>>16&255),Q(k,k.gzhead.time>>24&255),Q(k,k.level===9?2:k.strategy>=t||k.level<2?4:0),Q(k,k.gzhead.os&255),k.gzhead.extra&&k.gzhead.extra.length&&(Q(k,k.gzhead.extra.length&255),Q(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(a.adler=d(a.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=I);else{var o=z+(k.w_bits-8<<4)<<8,p;k.strategy>=t||k.level<2?p=0:k.level<6?p=1:k.level===6?p=2:p=3;o|=p<<6;k.strstart!==0&&(o|=ia);o+=31-o%31;k.status=ma;sa(k,o);k.strstart!==0&&(sa(k,a.adler>>>16),sa(k,a.adler&65535));a.adler=1}if(k.status===I)if(k.gzhead.extra){p=k.pending;while(k.gzindex<(k.gzhead.extra.length&65535)){if(k.pending===k.pending_buf_size){k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));O(a);p=k.pending;if(k.pending===k.pending_buf_size)break}Q(k,k.gzhead.extra[k.gzindex]&255);k.gzindex++}k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=J)}else k.status=J;if(k.status===J)if(k.gzhead.name){p=k.pending;do{if(k.pending===k.pending_buf_size){k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));O(a);p=k.pending;if(k.pending===k.pending_buf_size){o=1;break}}k.gzindex<k.gzhead.name.length?o=k.gzhead.name.charCodeAt(k.gzindex++)&255:o=0;Q(k,o)}while(o!==0);k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));o===0&&(k.gzindex=0,k.status=ka)}else k.status=ka;if(k.status===ka)if(k.gzhead.comment){p=k.pending;do{if(k.pending===k.pending_buf_size){k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));O(a);p=k.pending;if(k.pending===k.pending_buf_size){o=1;break}}k.gzindex<k.gzhead.comment.length?o=k.gzhead.comment.charCodeAt(k.gzindex++)&255:o=0;Q(k,o)}while(o!==0);k.gzhead.hcrc&&k.pending>p&&(a.adler=d(a.adler,k.pending_buf,k.pending-p,p));o===0&&(k.status=la)}else k.status=la;k.status===la&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&O(a),k.pending+2<=k.pending_buf_size&&(Q(k,a.adler&255),Q(k,a.adler>>8&255),a.adler=0,k.status=ma)):k.status=ma);if(k.pending!==0){O(a);if(a.avail_out===0){k.last_flush=-1;return l}}else if(a.avail_in===0&&ra(c)<=ra(e)&&c!==i)return M(a,q);if(k.status===na&&a.avail_in!==0)return M(a,q);if(a.avail_in!==0||k.lookahead!==0||c!==f&&k.status!==na){p=k.strategy===t?X(k,c):k.strategy===u?W(k,c):va[k.level].func(k,c);(p===L||p===pa)&&(k.status=na);if(p===K||p===L){a.avail_out===0&&(k.last_flush=-1);return l}if(p===oa){c===g?b._tr_align(k):c!==j&&(b._tr_stored_block(k,0,0,!1),c===h&&(N(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0)));O(a);if(a.avail_out===0){k.last_flush=-1;return l}}}if(c!==i)return l;if(k.wrap<=0)return m;k.wrap===2?(Q(k,a.adler&255),Q(k,a.adler>>8&255),Q(k,a.adler>>16&255),Q(k,a.adler>>24&255),Q(k,a.total_in&255),Q(k,a.total_in>>8&255),Q(k,a.total_in>>16&255),Q(k,a.total_in>>24&255)):(sa(k,a.adler>>>16),sa(k,a.adler&65535));O(a);k.wrap>0&&(k.wrap=-k.wrap);return k.pending!==0?l:m}function Ba(a){var b;if(!a||!a.state)return n;b=a.state.status;if(b!==ja&&b!==I&&b!==J&&b!==ka&&b!==la&&b!==ma&&b!==na)return M(a,n);a.state=null;return b===ma?M(a,o):l}function Ca(b,d){var e=d.length,f,g,h,i,j;if(!b||!b.state)return n;f=b.state;g=f.wrap;if(g===2||g===1&&f.status!==ja||f.lookahead)return n;g===1&&(b.adler=c(b.adler,d,e,0));f.wrap=0;e>=f.w_size&&(g===0&&(N(f.head),f.strstart=0,f.block_start=0,f.insert=0),j=new a.Buf8(f.w_size),a.arraySet(j,d,e-f.w_size,f.w_size,0),d=j,e=f.w_size);j=b.avail_in;h=b.next_in;i=b.input;b.avail_in=e;b.next_in=0;b.input=d;S(f);while(f.lookahead>=F){e=f.strstart;d=f.lookahead-(F-1);do f.ins_h=(f.ins_h<<f.hash_shift^f.window[e+F-1])&f.hash_mask,f.prev[e&f.w_mask]=f.head[f.ins_h],f.head[f.ins_h]=e,e++;while(--d);f.strstart=e;f.lookahead=F-1;S(f)}f.strstart+=f.lookahead;f.block_start=f.strstart;f.insert=f.lookahead;f.lookahead=0;f.match_length=f.prev_length=F-1;f.match_available=0;b.next_in=h;b.input=i;b.avail_in=j;f.wrap=g;return l}B.deflateInit=za;B.deflateInit2=ya;B.deflateReset=Z;B.deflateResetKeep=xa;B.deflateSetHeader=$;B.deflate=Aa;B.deflateEnd=Ba;B.deflateSetDictionary=Ca;B.deflateInfo="pako deflate (from Nodeca project)"}var C=!1;function da(){C||(C=!0,ca());return ba.exports}var D={},ea={exports:D};function fa(){var a=k(),b=!0,c=!0;try{String.fromCharCode.apply(null,[0])}catch(a){b=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(a){c=!1}var d=new a.Buf8(256);for(var e=0;e<256;e++)d[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;d[254]=d[254]=1;D.string2buf=function(b){var c,d,e,f,g,h=b.length,i=0;for(f=0;f<h;f++)d=b.charCodeAt(f),(d&64512)===55296&&f+1<h&&(e=b.charCodeAt(f+1),(e&64512)===56320&&(d=65536+(d-55296<<10)+(e-56320),f++)),i+=d<128?1:d<2048?2:d<65536?3:4;c=new a.Buf8(i);for(g=0,f=0;g<i;f++)d=b.charCodeAt(f),(d&64512)===55296&&f+1<h&&(e=b.charCodeAt(f+1),(e&64512)===56320&&(d=65536+(d-55296<<10)+(e-56320),f++)),d<128?c[g++]=d:d<2048?(c[g++]=192|d>>>6,c[g++]=128|d&63):d<65536?(c[g++]=224|d>>>12,c[g++]=128|d>>>6&63,c[g++]=128|d&63):(c[g++]=240|d>>>18,c[g++]=128|d>>>12&63,c[g++]=128|d>>>6&63,c[g++]=128|d&63);return c};function f(d,e){if(e<65534&&(d.subarray&&c||!d.subarray&&b))return String.fromCharCode.apply(null,a.shrinkBuf(d,e));var f="";for(var g=0;g<e;g++)f+=String.fromCharCode(d[g]);return f}D.buf2binstring=function(a){return f(a,a.length)};D.binstring2buf=function(b){var c=new a.Buf8(b.length);for(var d=0,e=c.length;d<e;d++)c[d]=b.charCodeAt(d);return c};D.buf2string=function(a,b){var c,e,g,h;b=b||a.length;var i=new Array(b*2);for(e=0,c=0;c<b;){g=a[c++];if(g<128){i[e++]=g;continue}h=d[g];if(h>4){i[e++]=65533;c+=h-1;continue}g&=h===2?31:h===3?15:7;while(h>1&&c<b)g=g<<6|a[c++]&63,h--;if(h>1){i[e++]=65533;continue}g<65536?i[e++]=g:(g-=65536,i[e++]=55296|g>>10&1023,i[e++]=56320|g&1023)}return f(i,e)};D.utf8border=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);c=b-1;while(c>=0&&(a[c]&192)===128)c--;if(c<0)return b;return c===0?b:c+d[a[c]]>b?c:b}}var E=!1;function ga(){E||(E=!0,fa());return ea.exports}f={};var ha={exports:f};function F(){function a(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}ha.exports=a}var G=!1;function H(){G||(G=!0,F());return ha.exports}var ia={},ja={exports:ia};function I(){var a=da(),b=k(),c=ga(),d=A(),e=H(),f=Object.prototype.toString,g=0,h=4,i=0,j=1,l=2,m=-1,n=0,o=8;function p(g){if(!(this instanceof p))return new p(g);this.options=b.assign({level:m,method:o,chunkSize:16384,windowBits:15,memLevel:8,strategy:n,to:""},g||{});g=this.options;g.raw&&g.windowBits>0?g.windowBits=-g.windowBits:g.gzip&&g.windowBits>0&&g.windowBits<16&&(g.windowBits+=16);this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new e();this.strm.avail_out=0;var h=a.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(h!==i)throw new Error(d[h]);g.header&&a.deflateSetHeader(this.strm,g.header);if(g.dictionary){var j;typeof g.dictionary==="string"?j=c.string2buf(g.dictionary):f.call(g.dictionary)==="[object ArrayBuffer]"?j=new Uint8Array(g.dictionary):j=g.dictionary;h=a.deflateSetDictionary(this.strm,j);if(h!==i)throw new Error(d[h]);this._dict_set=!0}}p.prototype.push=function(d,e){var k=this.strm,m=this.options.chunkSize;if(this.ended)return!1;e=e===~~e?e:e===!0?h:g;typeof d==="string"?k.input=c.string2buf(d):f.call(d)==="[object ArrayBuffer]"?k.input=new Uint8Array(d):k.input=d;k.next_in=0;k.avail_in=k.input.length;do{k.avail_out===0&&(k.output=new b.Buf8(m),k.next_out=0,k.avail_out=m);d=a.deflate(k,e);if(d!==j&&d!==i){this.onEnd(d);this.ended=!0;return!1}(k.avail_out===0||k.avail_in===0&&(e===h||e===l))&&(this.options.to==="string"?this.onData(c.buf2binstring(b.shrinkBuf(k.output,k.next_out))):this.onData(b.shrinkBuf(k.output,k.next_out)))}while((k.avail_in>0||k.avail_out===0)&&d!==j);if(e===h){d=a.deflateEnd(this.strm);this.onEnd(d);this.ended=!0;return d===i}if(e===l){this.onEnd(i);k.avail_out=0;return!0}return!0};p.prototype.onData=function(a){this.chunks.push(a)};p.prototype.onEnd=function(a){a===i&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function q(a,b){b=new p(b);b.push(a,!0);if(b.err)throw b.msg||d[b.err];return b.result}function r(a,b){b=b||{};b.raw=!0;return q(a,b)}function aa(a,b){b=b||{};b.gzip=!0;return q(a,b)}ia.Deflate=p;ia.deflate=q;ia.deflateRaw=r;ia.gzip=aa}var J=!1;function ka(){J||(J=!0,I());return ja.exports}b={};var la={exports:b};function ma(){var a=30,b=12;la.exports=function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,aa,s,t,u,v,w,x,y,z,A;e=c.state;f=c.next_in;z=c.input;g=f+(c.avail_in-5);h=c.next_out;A=c.output;d=h-(d-c.avail_out);i=h+(c.avail_out-257);j=e.dmax;k=e.wsize;l=e.whave;m=e.wnext;n=e.window;o=e.hold;p=e.bits;q=e.lencode;r=e.distcode;aa=(1<<e.lenbits)-1;s=(1<<e.distbits)-1;top:do{p<15&&(o+=z[f++]<<p,p+=8,o+=z[f++]<<p,p+=8);t=q[o&aa];dolen:for(;;){u=t>>>24;o>>>=u;p-=u;u=t>>>16&255;if(u===0)A[h++]=t&65535;else if(u&16){v=t&65535;u&=15;u&&(p<u&&(o+=z[f++]<<p,p+=8),v+=o&(1<<u)-1,o>>>=u,p-=u);p<15&&(o+=z[f++]<<p,p+=8,o+=z[f++]<<p,p+=8);t=r[o&s];dodist:for(;;){u=t>>>24;o>>>=u;p-=u;u=t>>>16&255;if(u&16){w=t&65535;u&=15;p<u&&(o+=z[f++]<<p,p+=8,p<u&&(o+=z[f++]<<p,p+=8));w+=o&(1<<u)-1;if(w>j){c.msg="invalid distance too far back";e.mode=a;break top}o>>>=u;p-=u;u=h-d;if(w>u){u=w-u;if(u>l&&e.sane){c.msg="invalid distance too far back";e.mode=a;break top}x=0;y=n;if(m===0){x+=k-u;if(u<v){v-=u;do A[h++]=n[x++];while(--u);x=h-w;y=A}}else if(m<u){x+=k+m-u;u-=m;if(u<v){v-=u;do A[h++]=n[x++];while(--u);x=0;if(m<v){u=m;v-=u;do A[h++]=n[x++];while(--u);x=h-w;y=A}}}else{x+=m-u;if(u<v){v-=u;do A[h++]=n[x++];while(--u);x=h-w;y=A}}while(v>2)A[h++]=y[x++],A[h++]=y[x++],A[h++]=y[x++],v-=3;v&&(A[h++]=y[x++],v>1&&(A[h++]=y[x++]))}else{x=h-w;do A[h++]=A[x++],A[h++]=A[x++],A[h++]=A[x++],v-=3;while(v>2);v&&(A[h++]=A[x++],v>1&&(A[h++]=A[x++]))}}else if((u&64)===0){t=r[(t&65535)+(o&(1<<u)-1)];continue dodist}else{c.msg="invalid distance code";e.mode=a;break top}break}}else if((u&64)===0){t=q[(t&65535)+(o&(1<<u)-1)];continue dolen}else if(u&32){e.mode=b;break top}else{c.msg="invalid literal/length code";e.mode=a;break top}break}}while(f<g&&h<i);v=p>>3;f-=v;p-=v<<3;o&=(1<<p)-1;c.next_in=f;c.next_out=h;c.avail_in=f<g?5+(g-f):5-(f-g);c.avail_out=h<i?257+(i-h):257-(h-i);e.hold=o;e.bits=p;return}}var na=!1;function K(){na||(na=!0,ma());return la.exports}c={};var oa={exports:c};function L(){var a=k(),b=15,c=852,d=592,e=0,f=1,g=2,h=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],i=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];oa.exports=function(k,m,n,o,p,q,r,aa){var s=aa.bits,t,u,v,w,x,y,z,A,B,ba,ca,C,da,D,ea=0,fa,E=new a.Buf16(b+1),ga=new a.Buf16(b+1),ha=0,F,G,H;for(t=0;t<=b;t++)E[t]=0;for(u=0;u<o;u++)E[m[n+u]]++;s=s;for(w=b;w>=1;w--)if(E[w]!==0)break;s>w&&(s=w);if(w===0){p[q++]=1<<24|64<<16|0;p[q++]=1<<24|64<<16|0;aa.bits=1;return 0}for(v=1;v<w;v++)if(E[v]!==0)break;s<v&&(s=v);z=1;for(t=1;t<=b;t++){z<<=1;z-=E[t];if(z<0)return-1}if(z>0&&(k===e||w!==1))return-1;ga[1]=0;for(t=1;t<b;t++)ga[t+1]=ga[t]+E[t];for(u=0;u<o;u++)m[n+u]!==0&&(r[ga[m[n+u]]++]=u);k===e?(ga=o=r,fa=19):k===f?(ga=h,ea-=257,o=i,ha-=257,fa=256):(ga=j,o=l,fa=-1);B=0;u=0;t=v;D=q;x=s;y=0;C=-1;A=1<<s;da=A-1;if(k===f&&A>c||k===g&&A>d)return 1;for(;;){F=t-y;r[u]<fa?(G=0,H=r[u]):r[u]>fa?(G=o[ha+r[u]],H=ga[ea+r[u]]):(G=32+64,H=0);ba=1<<t-y;ca=1<<x;v=ca;do ca-=ba,p[D+(B>>y)+ca]=F<<24|G<<16|H|0;while(ca!==0);ba=1<<t-1;while(B&ba)ba>>=1;ba!==0?(B&=ba-1,B+=ba):B=0;u++;if(--E[t]===0){if(t===w)break;t=m[n+r[u]]}if(t>s&&(B&da)!==C){y===0&&(y=s);D+=v;x=t-y;z=1<<x;while(x+y<w){z-=E[x+y];if(z<=0)break;x++;z<<=1}A+=1<<x;if(k===f&&A>c||k===g&&A>d)return 1;C=B&da;p[C]=s<<24|x<<16|D-q|0}}B!==0&&(p[D+B]=t-y<<24|64<<16|0);aa.bits=s;return 0}}var pa=!1;function qa(){pa||(pa=!0,L());return oa.exports}var M={},ra={exports:M};function N(){var a=k(),b=s(),c=w(),d=K(),e=qa(),f=0,g=1,h=2,i=4,j=5,l=6,m=0,n=1,o=2,p=-2,q=-3,r=-4,aa=-5,t=8,u=1,v=2,x=3,y=4,z=5,A=6,B=7,ba=8,ca=9,C=10,da=11,D=12,ea=13,fa=14,E=15,ga=16,ha=17,F=18,G=19,H=20,ia=21,ja=22,I=23,J=24,ka=25,la=26,ma=27,na=28,oa=29,L=30,pa=31,ra=32,N=852,O=592,P=15,Q=P;function sa(a){return(a>>>24&255)+(a>>>8&65280)+((a&65280)<<8)+((a&255)<<24)}function R(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ta(b){var c;if(!b||!b.state)return p;c=b.state;b.total_in=b.total_out=c.total=0;b.msg="";c.wrap&&(b.adler=c.wrap&1);c.mode=u;c.last=0;c.havedict=0;c.dmax=32768;c.head=null;c.hold=0;c.bits=0;c.lencode=c.lendyn=new a.Buf32(N);c.distcode=c.distdyn=new a.Buf32(O);c.sane=1;c.back=-1;return m}function S(a){var b;if(!a||!a.state)return p;b=a.state;b.wsize=0;b.whave=0;b.wnext=0;return ta(a)}function T(a,b){var c,d;if(!a||!a.state)return p;d=a.state;b<0?(c=0,b=-b):(c=(b>>4)+1,b<48&&(b&=15));if(b&&(b<8||b>15))return p;d.window!==null&&d.wbits!==b&&(d.window=null);d.wrap=c;d.wbits=b;return S(a)}function U(a,b){var c;if(!a)return p;c=new R();a.state=c;c.window=null;c=T(a,b);c!==m&&(a.state=null);return c}function V(a){return U(a,Q)}var W=!0,X,ua;function va(b){if(W){var c;X=new a.Buf32(512);ua=new a.Buf32(32);c=0;while(c<144)b.lens[c++]=8;while(c<256)b.lens[c++]=9;while(c<280)b.lens[c++]=7;while(c<288)b.lens[c++]=8;e(g,b.lens,0,288,X,0,b.work,{bits:9});c=0;while(c<32)b.lens[c++]=5;e(h,b.lens,0,32,ua,0,b.work,{bits:5});W=!1}b.lencode=X;b.lenbits=9;b.distcode=ua;b.distbits=5}function wa(b,c,d,e){var f;b=b.state;b.window===null&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new a.Buf8(b.wsize));e>=b.wsize?(a.arraySet(b.window,c,d-b.wsize,b.wsize,0),b.wnext=0,b.whave=b.wsize):(f=b.wsize-b.wnext,f>e&&(f=e),a.arraySet(b.window,c,d-e,f,b.wnext),e-=f,e?(a.arraySet(b.window,c,d-e,e,0),b.wnext=e,b.whave=b.wsize):(b.wnext+=f,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=f)));return 0}function Y(k,s){var w,K,qa,M,N,O,P,Q,R,ta,S,T,U,V,W,X,ua,Y,xa,Z=new a.Buf8(4),$,ya,za=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return p;w=k.state;w.mode===D&&(w.mode=ea);N=k.next_out;qa=k.output;P=k.avail_out;M=k.next_in;K=k.input;O=k.avail_in;Q=w.hold;R=w.bits;ta=O;S=P;xa=m;inf_leave:for(;;)switch(w.mode){case u:if(w.wrap===0){w.mode=ea;break}while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(w.wrap&2&&Q===35615){w.check=0;Z[0]=Q&255;Z[1]=Q>>>8&255;w.check=c(w.check,Z,2,0);Q=0;R=0;w.mode=v;break}w.flags=0;w.head&&(w.head.done=!1);if(!(w.wrap&1)||(((Q&255)<<8)+(Q>>8))%31){k.msg="incorrect header check";w.mode=L;break}if((Q&15)!==t){k.msg="unknown compression method";w.mode=L;break}Q>>>=4;R-=4;Y=(Q&15)+8;if(w.wbits===0)w.wbits=Y;else if(Y>w.wbits){k.msg="invalid window size";w.mode=L;break}w.dmax=1<<Y;k.adler=w.check=1;w.mode=Q&512?C:D;Q=0;R=0;break;case v:while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.flags=Q;if((w.flags&255)!==t){k.msg="unknown compression method";w.mode=L;break}if(w.flags&57344){k.msg="unknown header flags set";w.mode=L;break}w.head&&(w.head.text=Q>>8&1);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,w.check=c(w.check,Z,2,0));Q=0;R=0;w.mode=x;case x:while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.head&&(w.head.time=Q);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,Z[2]=Q>>>16&255,Z[3]=Q>>>24&255,w.check=c(w.check,Z,4,0));Q=0;R=0;w.mode=y;case y:while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.head&&(w.head.xflags=Q&255,w.head.os=Q>>8);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,w.check=c(w.check,Z,2,0));Q=0;R=0;w.mode=z;case z:if(w.flags&1024){while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.length=Q;w.head&&(w.head.extra_len=Q);w.flags&512&&(Z[0]=Q&255,Z[1]=Q>>>8&255,w.check=c(w.check,Z,2,0));Q=0;R=0}else w.head&&(w.head.extra=null);w.mode=A;case A:if(w.flags&1024){T=w.length;T>O&&(T=O);T&&(w.head&&(Y=w.head.extra_len-w.length,w.head.extra||(w.head.extra=new Array(w.head.extra_len)),a.arraySet(w.head.extra,K,M,T,Y)),w.flags&512&&(w.check=c(w.check,K,T,M)),O-=T,M+=T,w.length-=T);if(w.length)break inf_leave}w.length=0;w.mode=B;case B:if(w.flags&2048){if(O===0)break inf_leave;T=0;do Y=K[M+T++],w.head&&Y&&w.length<65536&&(w.head.name+=String.fromCharCode(Y));while(Y&&T<O);w.flags&512&&(w.check=c(w.check,K,T,M));O-=T;M+=T;if(Y)break inf_leave}else w.head&&(w.head.name=null);w.length=0;w.mode=ba;case ba:if(w.flags&4096){if(O===0)break inf_leave;T=0;do Y=K[M+T++],w.head&&Y&&w.length<65536&&(w.head.comment+=String.fromCharCode(Y));while(Y&&T<O);w.flags&512&&(w.check=c(w.check,K,T,M));O-=T;M+=T;if(Y)break inf_leave}else w.head&&(w.head.comment=null);w.mode=ca;case ca:if(w.flags&512){while(R<16){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(Q!==(w.check&65535)){k.msg="header crc mismatch";w.mode=L;break}Q=0;R=0}w.head&&(w.head.hcrc=w.flags>>9&1,w.head.done=!0);k.adler=w.check=0;w.mode=D;break;case C:while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}k.adler=w.check=sa(Q);Q=0;R=0;w.mode=da;case da:if(w.havedict===0){k.next_out=N;k.avail_out=P;k.next_in=M;k.avail_in=O;w.hold=Q;w.bits=R;return o}k.adler=w.check=1;w.mode=D;case D:if(s===j||s===l)break inf_leave;case ea:if(w.last){Q>>>=R&7;R-=R&7;w.mode=ma;break}while(R<3){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.last=Q&1;Q>>>=1;R-=1;switch(Q&3){case 0:w.mode=fa;break;case 1:va(w);w.mode=H;if(s===l){Q>>>=2;R-=2;break inf_leave}break;case 2:w.mode=ha;break;case 3:k.msg="invalid block type",w.mode=L}Q>>>=2;R-=2;break;case fa:Q>>>=R&7;R-=R&7;while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if((Q&65535)!==(Q>>>16^65535)){k.msg="invalid stored block lengths";w.mode=L;break}w.length=Q&65535;Q=0;R=0;w.mode=E;if(s===l)break inf_leave;case E:w.mode=ga;case ga:T=w.length;if(T){T>O&&(T=O);T>P&&(T=P);if(T===0)break inf_leave;a.arraySet(qa,K,M,T,N);O-=T;M+=T;P-=T;N+=T;w.length-=T;break}w.mode=D;break;case ha:while(R<14){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.nlen=(Q&31)+257;Q>>>=5;R-=5;w.ndist=(Q&31)+1;Q>>>=5;R-=5;w.ncode=(Q&15)+4;Q>>>=4;R-=4;if(w.nlen>286||w.ndist>30){k.msg="too many length or distance symbols";w.mode=L;break}w.have=0;w.mode=F;case F:while(w.have<w.ncode){while(R<3){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.lens[za[w.have++]]=Q&7;Q>>>=3;R-=3}while(w.have<19)w.lens[za[w.have++]]=0;w.lencode=w.lendyn;w.lenbits=7;$={bits:w.lenbits};xa=e(f,w.lens,0,19,w.lencode,0,w.work,$);w.lenbits=$.bits;if(xa){k.msg="invalid code lengths set";w.mode=L;break}w.have=0;w.mode=G;case G:while(w.have<w.nlen+w.ndist){for(;;){U=w.lencode[Q&(1<<w.lenbits)-1];V=U>>>24;W=U>>>16&255;X=U&65535;if(V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(X<16)Q>>>=V,R-=V,w.lens[w.have++]=X;else{if(X===16){ya=V+2;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=V;R-=V;if(w.have===0){k.msg="invalid bit length repeat";w.mode=L;break}Y=w.lens[w.have-1];T=3+(Q&3);Q>>>=2;R-=2}else if(X===17){ya=V+3;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=V;R-=V;Y=0;T=3+(Q&7);Q>>>=3;R-=3}else{ya=V+7;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=V;R-=V;Y=0;T=11+(Q&127);Q>>>=7;R-=7}if(w.have+T>w.nlen+w.ndist){k.msg="invalid bit length repeat";w.mode=L;break}while(T--)w.lens[w.have++]=Y}}if(w.mode===L)break;if(w.lens[256]===0){k.msg="invalid code -- missing end-of-block";w.mode=L;break}w.lenbits=9;$={bits:w.lenbits};xa=e(g,w.lens,0,w.nlen,w.lencode,0,w.work,$);w.lenbits=$.bits;if(xa){k.msg="invalid literal/lengths set";w.mode=L;break}w.distbits=6;w.distcode=w.distdyn;$={bits:w.distbits};xa=e(h,w.lens,w.nlen,w.ndist,w.distcode,0,w.work,$);w.distbits=$.bits;if(xa){k.msg="invalid distances set";w.mode=L;break}w.mode=H;if(s===l)break inf_leave;case H:w.mode=ia;case ia:if(O>=6&&P>=258){k.next_out=N;k.avail_out=P;k.next_in=M;k.avail_in=O;w.hold=Q;w.bits=R;d(k,S);N=k.next_out;qa=k.output;P=k.avail_out;M=k.next_in;K=k.input;O=k.avail_in;Q=w.hold;R=w.bits;w.mode===D&&(w.back=-1);break}w.back=0;for(;;){U=w.lencode[Q&(1<<w.lenbits)-1];V=U>>>24;W=U>>>16&255;X=U&65535;if(V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(W&&(W&240)===0){Y=V;$=W;ua=X;for(;;){U=w.lencode[ua+((Q&(1<<Y+$)-1)>>Y)];V=U>>>24;W=U>>>16&255;X=U&65535;if(Y+V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=Y;R-=Y;w.back+=Y}Q>>>=V;R-=V;w.back+=V;w.length=X;if(W===0){w.mode=la;break}if(W&32){w.back=-1;w.mode=D;break}if(W&64){k.msg="invalid literal/length code";w.mode=L;break}w.extra=W&15;w.mode=ja;case ja:if(w.extra){ya=w.extra;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.length+=Q&(1<<w.extra)-1;Q>>>=w.extra;R-=w.extra;w.back+=w.extra}w.was=w.length;w.mode=I;case I:for(;;){U=w.distcode[Q&(1<<w.distbits)-1];V=U>>>24;W=U>>>16&255;X=U&65535;if(V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if((W&240)===0){Y=V;$=W;ua=X;for(;;){U=w.distcode[ua+((Q&(1<<Y+$)-1)>>Y)];V=U>>>24;W=U>>>16&255;X=U&65535;if(Y+V<=R)break;if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}Q>>>=Y;R-=Y;w.back+=Y}Q>>>=V;R-=V;w.back+=V;if(W&64){k.msg="invalid distance code";w.mode=L;break}w.offset=X;w.extra=W&15;w.mode=J;case J:if(w.extra){ya=w.extra;while(R<ya){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}w.offset+=Q&(1<<w.extra)-1;Q>>>=w.extra;R-=w.extra;w.back+=w.extra}if(w.offset>w.dmax){k.msg="invalid distance too far back";w.mode=L;break}w.mode=ka;case ka:if(P===0)break inf_leave;T=S-P;if(w.offset>T){T=w.offset-T;if(T>w.whave&&w.sane){k.msg="invalid distance too far back";w.mode=L;break}T>w.wnext?(T-=w.wnext,U=w.wsize-T):U=w.wnext-T;T>w.length&&(T=w.length);$=w.window}else $=qa,U=N-w.offset,T=w.length;T>P&&(T=P);P-=T;w.length-=T;do qa[N++]=$[U++];while(--T);w.length===0&&(w.mode=ia);break;case la:if(P===0)break inf_leave;qa[N++]=w.length;P--;w.mode=ia;break;case ma:if(w.wrap){while(R<32){if(O===0)break inf_leave;O--;Q|=K[M++]<<R;R+=8}S-=P;k.total_out+=S;w.total+=S;S&&(k.adler=w.check=w.flags?c(w.check,qa,S,N-S):b(w.check,qa,S,N-S));S=P;if((w.flags?Q:sa(Q))!==w.check){k.msg="incorrect data check";w.mode=L;break}Q=0;R=0}w.mode=na;case na:if(w.wrap&&w.flags){while(R<32){if(O===0)break inf_leave;O--;Q+=K[M++]<<R;R+=8}if(Q!==(w.total&4294967295)){k.msg="incorrect length check";w.mode=L;break}Q=0;R=0}w.mode=oa;case oa:xa=n;break inf_leave;case L:xa=q;break inf_leave;case pa:return r;case ra:default:return p}k.next_out=N;k.avail_out=P;k.next_in=M;k.avail_in=O;w.hold=Q;w.bits=R;if((w.wsize||S!==k.avail_out&&w.mode<L&&(w.mode<ma||s!==i))&&wa(k,k.output,k.next_out,S-k.avail_out)){w.mode=pa;return r}ta-=k.avail_in;S-=k.avail_out;k.total_in+=ta;k.total_out+=S;w.total+=S;w.wrap&&S&&(k.adler=w.check=w.flags?c(w.check,qa,S,k.next_out-S):b(w.check,qa,S,k.next_out-S));k.data_type=w.bits+(w.last?64:0)+(w.mode===D?128:0)+(w.mode===H||w.mode===E?256:0);(ta===0&&S===0||s===i)&&xa===m&&(xa=aa);return xa}function xa(a){if(!a||!a.state)return p;var b=a.state;b.window&&(b.window=null);a.state=null;return m}function Z(a,b){if(!a||!a.state)return p;a=a.state;if((a.wrap&2)===0)return p;a.head=b;b.done=!1;return m}function $(a,c){var d=c.length,e,f;if(!a||!a.state)return p;e=a.state;if(e.wrap!==0&&e.mode!==da)return p;if(e.mode===da){f=1;f=b(f,c,d,0);if(f!==e.check)return q}f=wa(a,c,d,d);if(f){e.mode=pa;return r}e.havedict=1;return m}M.inflateReset=S;M.inflateReset2=T;M.inflateResetKeep=ta;M.inflateInit=V;M.inflateInit2=U;M.inflate=Y;M.inflateEnd=xa;M.inflateGetHeader=Z;M.inflateSetDictionary=$;M.inflateInfo="pako inflate (from Nodeca project)"}var O=!1;function P(){O||(O=!0,N());return ra.exports}d={};var Q={exports:d};function sa(){Q.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}var R=!1;function ta(){R||(R=!0,sa());return Q.exports}f={};var S={exports:f};function T(){function a(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}S.exports=a}var U=!1;function V(){U||(U=!0,T());return S.exports}var W={},X={exports:W};function ua(){var a=P(),b=k(),c=ga(),d=ta(),e=A(),f=H(),g=V(),h=Object.prototype.toString;function i(j){if(!(this instanceof i))return new i(j);this.options=b.assign({chunkSize:16384,windowBits:0,to:""},j||{});var k=this.options;k.raw&&k.windowBits>=0&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15));k.windowBits>=0&&k.windowBits<16&&!(j&&j.windowBits)&&(k.windowBits+=32);k.windowBits>15&&k.windowBits<48&&((k.windowBits&15)===0&&(k.windowBits|=15));this.err=0;this.msg="";this.ended=!1;this.chunks=[];this.strm=new f();this.strm.avail_out=0;j=a.inflateInit2(this.strm,k.windowBits);if(j!==d.Z_OK)throw new Error(e[j]);this.header=new g();a.inflateGetHeader(this.strm,this.header);if(k.dictionary){typeof k.dictionary==="string"?k.dictionary=c.string2buf(k.dictionary):h.call(k.dictionary)==="[object ArrayBuffer]"&&(k.dictionary=new Uint8Array(k.dictionary));if(k.raw){j=a.inflateSetDictionary(this.strm,k.dictionary);if(j!==d.Z_OK)throw new Error(e[j])}}}i.prototype.push=function(e,f){var g=this.strm,i=this.options.chunkSize,j=this.options.dictionary,k,l,m,n=!1;if(this.ended)return!1;f=f===~~f?f:f===!0?d.Z_FINISH:d.Z_NO_FLUSH;typeof e==="string"?g.input=c.binstring2buf(e):h.call(e)==="[object ArrayBuffer]"?g.input=new Uint8Array(e):g.input=e;g.next_in=0;g.avail_in=g.input.length;do{g.avail_out===0&&(g.output=new b.Buf8(i),g.next_out=0,g.avail_out=i);e=a.inflate(g,d.Z_NO_FLUSH);e===d.Z_NEED_DICT&&j&&(e=a.inflateSetDictionary(this.strm,j));e===d.Z_BUF_ERROR&&n===!0&&(e=d.Z_OK,n=!1);if(e!==d.Z_STREAM_END&&e!==d.Z_OK){this.onEnd(e);this.ended=!0;return!1}g.next_out&&((g.avail_out===0||e===d.Z_STREAM_END||g.avail_in===0&&(f===d.Z_FINISH||f===d.Z_SYNC_FLUSH))&&(this.options.to==="string"?(k=c.utf8border(g.output,g.next_out),l=g.next_out-k,m=c.buf2string(g.output,k),g.next_out=l,g.avail_out=i-l,l&&b.arraySet(g.output,g.output,k,l,0),this.onData(m)):this.onData(b.shrinkBuf(g.output,g.next_out))));g.avail_in===0&&g.avail_out===0&&(n=!0)}while((g.avail_in>0||g.avail_out===0)&&e!==d.Z_STREAM_END);e===d.Z_STREAM_END&&(f=d.Z_FINISH);if(f===d.Z_FINISH){e=a.inflateEnd(this.strm);this.onEnd(e);this.ended=!0;return e===d.Z_OK}if(f===d.Z_SYNC_FLUSH){this.onEnd(d.Z_OK);g.avail_out=0;return!0}return!0};i.prototype.onData=function(a){this.chunks.push(a)};i.prototype.onEnd=function(a){a===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=b.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg};function j(a,b){b=new i(b);b.push(a,!0);if(b.err)throw b.msg||e[b.err];return b.result}function l(a,b){b=b||{};b.raw=!0;return j(a,b)}W.Inflate=i;W.inflate=j;W.inflateRaw=l;W.ungzip=j}var va=!1;function wa(){va||(va=!0,ua());return X.exports}b={};var Y={exports:b};function xa(){var a=k().assign,b=ka(),c=wa(),d=ta(),e={};a(e,b,c,d);Y.exports=e}var Z=!1;function $(){Z||(Z=!0,xa());return Y.exports}function a(a){switch(a){case void 0:return $()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("process-nextick-args-2.0.0",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?g.exports={nextTick:a}:g.exports=process;function a(a,b,c,d){if(typeof a!=="function")throw new TypeError('"callback" argument must be a function');var e=arguments.length,f,g;switch(e){case 0:case 1:return process.nextTick(a);case 2:return process.nextTick(function(){a.call(null,b)});case 3:return process.nextTick(function(){a.call(null,b,c)});case 4:return process.nextTick(function(){a.call(null,b,c,d)});default:f=new Array(e-1);g=0;while(g<f.length)f[g++]=arguments[g];return process.nextTick(function(){a.apply(null,f)})}}}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("safe-buffer-5.1.2",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a={},b=a.Buffer;function c(a,b){for(var c in a)b[c]=a[c]}b.from&&b.alloc&&b.allocUnsafe&&b.allocUnsafeSlow?h.exports=a:(c(a,g),g.Buffer=d);function d(a,c,d){return b(a,c,d)}c(b,d);d.from=function(a,c,d){if(typeof a==="number")throw new TypeError("Argument must not be a number");return b(a,c,d)};d.alloc=function(a,c,d){if(typeof a!=="number")throw new TypeError("Argument must be a number");a=b(a);c!==void 0?typeof d==="string"?a.fill(c,d):a.fill(c):a.fill(0);return a};d.allocUnsafe=function(a){if(typeof a!=="number")throw new TypeError("Argument must be a number");return b(a)};d.allocUnsafeSlow=function(b){if(typeof b!=="number")throw new TypeError("Argument must be a number");return a.SlowBuffer(b)}}var j=!1;function k(){j||(j=!0,i());return h.exports}function a(a){switch(a){case void 0:return k()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("util-deprecate-1.0.2",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){g.exports={}.deprecate}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("readable-stream-2.3.6",["safe-buffer-5.1.2","process-nextick-args-2.0.0","core-util-is-1.0.2","inherits-2.0.3","util-deprecate-1.0.2","isarray-1.0.0"],(function(a,b,c,d,e,f){"use strict";function c(a){return a&&typeof a==="object"&&"default"in a?a["default"]:a}var g=c(b("safe-buffer-5.1.2")),h=c(b("process-nextick-args-2.0.0")),i=c(b("core-util-is-1.0.2")),j=c(b("inherits-2.0.3")),k=c(b("util-deprecate-1.0.2")),l=c(b("isarray-1.0.0"));c={};var m={exports:c};function n(){m.exports={}}var o=!1;function p(){o||(o=!0,n());return m.exports}b={};var q={exports:b};function r(){function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var b=g().Buffer,c={};function d(a,b,c){a.copy(b,c)}q.exports=function(){function c(){a(this,c),this.head=null,this.tail=null,this.length=0}c.prototype.push=function(a){a={data:a,next:null};this.length>0?this.tail.next=a:this.head=a;this.tail=a;++this.length};c.prototype.unshift=function(a){a={data:a,next:this.head};this.length===0&&(this.tail=a);this.head=a;++this.length};c.prototype.shift=function(){if(this.length===0)return;var a=this.head.data;this.length===1?this.head=this.tail=null:this.head=this.head.next;--this.length;return a};c.prototype.clear=function(){this.head=this.tail=null,this.length=0};c.prototype.join=function(a){if(this.length===0)return"";var b=this.head,c=""+b.data;while(b=b.next)c+=a+b.data;return c};c.prototype.concat=function(a){if(this.length===0)return b.alloc(0);if(this.length===1)return this.head.data;a=b.allocUnsafe(a>>>0);var c=this.head,e=0;while(c)d(c.data,a,e),e+=c.data.length,c=c.next;return a};return c}();c&&c.inspect&&c.inspect.custom&&(q.exports.prototype[c.inspect.custom]=function(){var a=c.inspect({length:this.length});return this.constructor.name+" "+a})}var s=!1;function t(){s||(s=!0,r());return q.exports}c={};var u={exports:c};function v(){var a=h();function b(b,c){var e=this,f=this._readableState&&this._readableState.destroyed,g=this._writableState&&this._writableState.destroyed;if(f||g){c?c(b):b&&(!this._writableState||!this._writableState.errorEmitted)&&a.nextTick(d,this,b);return this}this._readableState&&(this._readableState.destroyed=!0);this._writableState&&(this._writableState.destroyed=!0);this._destroy(b||null,function(b){!c&&b?(a.nextTick(d,e,b),e._writableState&&(e._writableState.errorEmitted=!0)):c&&c(b)});return this}function c(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function d(a,b){a.emit("error",b)}u.exports={destroy:b,undestroy:c}}var w=!1;function x(){w||(w=!0,v());return u.exports}b={};var y={exports:b};function z(){var b=h();y.exports=w;function c(a){var b=this;this.next=null;this.entry=null;this.finish=function(){Q(b,a)}}var d=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:b.nextTick,e;w.WritableState=u;var f=i();f.inherits=j();var l={deprecate:k()},m=p(),n=g().Buffer,o=a.Uint8Array||function(){};function q(a){return n.from(a)}function r(a){return n.isBuffer(a)||a instanceof o}var s=x();f.inherits(w,m);function t(){}function u(a,b){e=e||F();a=a||{};var d=b instanceof e;this.objectMode=!!a.objectMode;d&&(this.objectMode=this.objectMode||!!a.writableObjectMode);var f=a.highWaterMark,g=a.writableHighWaterMark,h=this.objectMode?16:16*1024;f||f===0?this.highWaterMark=f:d&&(g||g===0)?this.highWaterMark=g:this.highWaterMark=h;this.highWaterMark=Math.floor(this.highWaterMark);this.finalCalled=!1;this.needDrain=!1;this.ending=!1;this.ended=!1;this.finished=!1;this.destroyed=!1;f=a.decodeStrings===!1;this.decodeStrings=!f;this.defaultEncoding=a.defaultEncoding||"utf8";this.length=0;this.writing=!1;this.corked=0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(a){H(b,a)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=!1;this.errorEmitted=!1;this.bufferedRequestCount=0;this.corkedRequestsFree=new c(this)}u.prototype.getBuffer=function(){var a=this.bufferedRequest,b=[];while(a)b.push(a),a=a.next;return b};(function(){try{Object.defineProperty(u.prototype,"buffer",{get:l.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(a){}})();var v;typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"?(v=Function.prototype[Symbol.hasInstance],Object.defineProperty(w,Symbol.hasInstance,{value:function(a){if(v.call(this,a))return!0;return this!==w?!1:a&&a._writableState instanceof u}})):v=function(a){return a instanceof this};function w(a){e=e||F();if(!v.call(w,this)&&!(this instanceof e))return new w(a);this._writableState=new u(a,this);this.writable=!0;a&&(typeof a.write==="function"&&(this._write=a.write),typeof a.writev==="function"&&(this._writev=a.writev),typeof a.destroy==="function"&&(this._destroy=a.destroy),typeof a["final"]==="function"&&(this._final=a["final"]));m.call(this)}w.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function z(a,c){var d=new Error("write after end");a.emit("error",d);b.nextTick(c,d)}function A(a,c,d,e){var f=!0,g=!1;d===null?g=new TypeError("May not write null values to stream"):typeof d!=="string"&&d!==void 0&&!c.objectMode&&(g=new TypeError("Invalid non-string/buffer chunk"));g&&(a.emit("error",g),b.nextTick(e,g),f=!1);return f}w.prototype.write=function(a,b,c){var d=this._writableState,e=!1,f=!d.objectMode&&r(a);f&&!n.isBuffer(a)&&(a=q(a));typeof b==="function"&&(c=b,b=null);f?b="buffer":b||(b=d.defaultEncoding);typeof c!=="function"&&(c=t);d.ended?z(this,c):(f||A(this,d,a,c))&&(d.pendingcb++,e=C(this,d,f,a,b,c));return e};w.prototype.cork=function(){var a=this._writableState;a.corked++};w.prototype.uncork=function(){var a=this._writableState;a.corked&&(a.corked--,!a.writing&&!a.corked&&!a.finished&&!a.bufferProcessing&&a.bufferedRequest&&K(this,a))};w.prototype.setDefaultEncoding=function(a){typeof a==="string"&&(a=a.toLowerCase());if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((a+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+a);this._writableState.defaultEncoding=a;return this};function B(a,b,c){!a.objectMode&&a.decodeStrings!==!1&&typeof b==="string"&&(b=n.from(b,c));return b}Object.defineProperty(w.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function C(a,b,c,d,e,f){if(!c){var g=B(b,d,e);d!==g&&(c=!0,e="buffer",d=g)}g=b.objectMode?1:d.length;b.length+=g;var h=b.length<b.highWaterMark;h||(b.needDrain=!0);if(b.writing||b.corked){var i=b.lastBufferedRequest;b.lastBufferedRequest={chunk:d,encoding:e,isBuf:c,callback:f,next:null};i?i.next=b.lastBufferedRequest:b.bufferedRequest=b.lastBufferedRequest;b.bufferedRequestCount+=1}else D(a,b,!1,g,d,e,f);return h}function D(a,b,c,d,e,f,g){b.writelen=d,b.writecb=g,b.writing=!0,b.sync=!0,c?a._writev(e,b.onwrite):a._write(e,f,b.onwrite),b.sync=!1}function E(a,c,d,e,f){--c.pendingcb,d?(b.nextTick(f,e),b.nextTick(O,a,c),a._writableState.errorEmitted=!0,a.emit("error",e)):(f(e),a._writableState.errorEmitted=!0,a.emit("error",e),O(a,c))}function G(a){a.writing=!1,a.writecb=null,a.length-=a.writelen,a.writelen=0}function H(a,b){var c=a._writableState,e=c.sync,f=c.writecb;G(c);if(b)E(a,c,e,b,f);else{b=L(c);!b&&!c.corked&&!c.bufferProcessing&&c.bufferedRequest&&K(a,c);e?d(I,a,c,b,f):I(a,c,b,f)}}function I(a,b,c,d){c||J(a,b),b.pendingcb--,d(),O(a,b)}function J(a,b){b.length===0&&b.needDrain&&(b.needDrain=!1,a.emit("drain"))}function K(a,b){b.bufferProcessing=!0;var d=b.bufferedRequest;if(a._writev&&d&&d.next){var e=b.bufferedRequestCount;e=new Array(e);var f=b.corkedRequestsFree;f.entry=d;var g=0,h=!0;while(d)e[g]=d,d.isBuf||(h=!1),d=d.next,g+=1;e.allBuffers=h;D(a,b,!0,b.length,e,"",f.finish);b.pendingcb++;b.lastBufferedRequest=null;f.next?(b.corkedRequestsFree=f.next,f.next=null):b.corkedRequestsFree=new c(b);b.bufferedRequestCount=0}else{while(d){g=d.chunk;h=d.encoding;e=d.callback;f=b.objectMode?1:g.length;D(a,b,!1,f,g,h,e);d=d.next;b.bufferedRequestCount--;if(b.writing)break}d===null&&(b.lastBufferedRequest=null)}b.bufferedRequest=d;b.bufferProcessing=!1}w.prototype._write=function(a,b,c){c(new Error("_write() is not implemented"))};w.prototype._writev=null;w.prototype.end=function(a,b,c){var d=this._writableState;typeof a==="function"?(c=a,a=null,b=null):typeof b==="function"&&(c=b,b=null);a!==null&&a!==void 0&&this.write(a,b);d.corked&&(d.corked=1,this.uncork());!d.ending&&!d.finished&&P(this,d,c)};function L(a){return a.ending&&a.length===0&&a.bufferedRequest===null&&!a.finished&&!a.writing}function M(a,b){a._final(function(c){b.pendingcb--,c&&a.emit("error",c),b.prefinished=!0,a.emit("prefinish"),O(a,b)})}function N(a,c){!c.prefinished&&!c.finalCalled&&(typeof a._final==="function"?(c.pendingcb++,c.finalCalled=!0,b.nextTick(M,a,c)):(c.prefinished=!0,a.emit("prefinish")))}function O(a,b){var c=L(b);c&&(N(a,b),b.pendingcb===0&&(b.finished=!0,a.emit("finish")));return c}function P(a,c,d){c.ending=!0,O(a,c),d&&(c.finished?b.nextTick(d):a.once("finish",d)),c.ended=!0,a.writable=!1}function Q(a,b,c){var d=a.entry;a.entry=null;while(d){var e=d.callback;b.pendingcb--;e(c);d=d.next}b.corkedRequestsFree?b.corkedRequestsFree.next=a:b.corkedRequestsFree=a}Object.defineProperty(w.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(a){if(!this._writableState)return;this._writableState.destroyed=a}});w.prototype.destroy=s.destroy;w.prototype._undestroy=s.undestroy;w.prototype._destroy=function(a,b){this.end(),b(a)}}var A=!1;function B(){A||(A=!0,z());return y.exports}c={};var C={exports:c};function D(){var a=h(),b=Object.keys||function(a){var b=[];for(a in a)b.push(a);return b};C.exports=g;var c=i();c.inherits=j();var d=O(),e=B();c.inherits(g,d);c=b(e.prototype);for(b=0;b<c.length;b++){var f=c[b];g.prototype[f]||(g.prototype[f]=e.prototype[f])}function g(a){if(!(this instanceof g))return new g(a);d.call(this,a);e.call(this,a);a&&a.readable===!1&&(this.readable=!1);a&&a.writable===!1&&(this.writable=!1);this.allowHalfOpen=!0;a&&a.allowHalfOpen===!1&&(this.allowHalfOpen=!1);this.once("end",k)}Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function k(){if(this.allowHalfOpen||this._writableState.ended)return;a.nextTick(l,this)}function l(a){a.end()}Object.defineProperty(g.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(a){if(this._readableState===void 0||this._writableState===void 0)return;this._readableState.destroyed=a;this._writableState.destroyed=a}});g.prototype._destroy=function(b,c){this.push(null),this.end(),a.nextTick(c,b)}}var E=!1;function F(){E||(E=!0,D());return C.exports}var G={},H={exports:G};function I(){var a=g().Buffer,b=a.isEncoding||function(a){a=""+a;switch(a&&a.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function c(a){if(!a)return"utf8";var b;while(!0)switch(a){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return a;default:if(b)return;a=(""+a).toLowerCase();b=!0}}function d(d){var e=c(d);if(typeof e!=="string"&&(a.isEncoding===b||!b(d)))throw new Error("Unknown encoding: "+d);return e||d}G.StringDecoder=e;function e(b){this.encoding=d(b);var c;switch(this.encoding){case"utf16le":this.text=m;this.end=n;c=4;break;case"utf8":this.fillLast=j;c=4;break;case"base64":this.text=o;this.end=p;c=3;break;default:this.write=q;this.end=r;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=a.allocUnsafe(c)}e.prototype.write=function(a){if(a.length===0)return"";var b,c;if(this.lastNeed){b=this.fillLast(a);if(b===void 0)return"";c=this.lastNeed;this.lastNeed=0}else c=0;return c<a.length?b?b+this.text(a,c):this.text(a,c):b||""};e.prototype.end=l;e.prototype.text=k;e.prototype.fillLast=function(a){if(this.lastNeed<=a.length){a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}a.copy(this.lastChar,this.lastTotal-this.lastNeed,0,a.length);this.lastNeed-=a.length};function f(a){if(a<=127)return 0;else if(a>>5===6)return 2;else if(a>>4===14)return 3;else if(a>>3===30)return 4;return a>>6===2?-1:-2}function h(a,b,c){var d=b.length-1;if(d<c)return 0;var e=f(b[d]);if(e>=0){e>0&&(a.lastNeed=e-1);return e}if(--d<c||e===-2)return 0;e=f(b[d]);if(e>=0){e>0&&(a.lastNeed=e-2);return e}if(--d<c||e===-2)return 0;e=f(b[d]);if(e>=0){e>0&&(e===2?e=0:a.lastNeed=e-3);return e}return 0}function i(a,b,c){if((b[0]&192)!==128){a.lastNeed=0;return"\ufffd"}if(a.lastNeed>1&&b.length>1){if((b[1]&192)!==128){a.lastNeed=1;return"\ufffd"}if(a.lastNeed>2&&b.length>2&&(b[2]&192)!==128){a.lastNeed=2;return"\ufffd"}}}function j(a){var b=this.lastTotal-this.lastNeed,c=i(this,a,b);if(c!==void 0)return c;if(this.lastNeed<=a.length){a.copy(this.lastChar,b,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}a.copy(this.lastChar,b,0,a.length);this.lastNeed-=a.length}function k(a,b){var c=h(this,a,b);if(!this.lastNeed)return a.toString("utf8",b);this.lastTotal=c;c=a.length-(c-this.lastNeed);a.copy(this.lastChar,0,c);return a.toString("utf8",b,c)}function l(a){a=a&&a.length?this.write(a):"";return this.lastNeed?a+"\ufffd":a}function m(a,b){if((a.length-b)%2===0){var c=a.toString("utf16le",b);if(c){var d=c.charCodeAt(c.length-1);if(d>=55296&&d<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=a[a.length-2];this.lastChar[1]=a[a.length-1];return c.slice(0,-1)}}return c}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=a[a.length-1];return a.toString("utf16le",b,a.length-1)}function n(a){a=a&&a.length?this.write(a):"";if(this.lastNeed){var b=this.lastTotal-this.lastNeed;return a+this.lastChar.toString("utf16le",0,b)}return a}function o(a,b){var c=(a.length-b)%3;if(c===0)return a.toString("base64",b);this.lastNeed=3-c;this.lastTotal=3;c===1?this.lastChar[0]=a[a.length-1]:(this.lastChar[0]=a[a.length-2],this.lastChar[1]=a[a.length-1]);return a.toString("base64",b,a.length-c)}function p(a){a=a&&a.length?this.write(a):"";return this.lastNeed?a+this.lastChar.toString("base64",0,3-this.lastNeed):a}function q(a){return a.toString(this.encoding)}function r(a){return a&&a.length?this.write(a):""}}var J=!1;function K(){J||(J=!0,I());return H.exports}b={};var L={exports:b};function M(){var b=h();L.exports=A;var c=l(),d;A.ReadableState=z;var e=function(a,b){return a.listeners(b).length},f=p(),k=g().Buffer,m=a.Uint8Array||function(){};function n(a){return k.from(a)}function o(a){return k.isBuffer(a)||a instanceof m}var q=i();q.inherits=j();var r={},s=void 0;r&&r.debuglog?s=r.debuglog("stream"):s=function(){};var u=t();r=x();var v;q.inherits(A,f);var w=["error","close","destroy","pause","resume"];function y(a,b,d){if(typeof a.prependListener==="function")return a.prependListener(b,d);!a._events||!a._events[b]?a.on(b,d):c(a._events[b])?a._events[b].unshift(d):a._events[b]=[d,a._events[b]]}function z(a,b){d=d||F();a=a||{};b=b instanceof d;this.objectMode=!!a.objectMode;b&&(this.objectMode=this.objectMode||!!a.readableObjectMode);var c=a.highWaterMark,e=a.readableHighWaterMark,f=this.objectMode?16:16*1024;c||c===0?this.highWaterMark=c:b&&(e||e===0)?this.highWaterMark=e:this.highWaterMark=f;this.highWaterMark=Math.floor(this.highWaterMark);this.buffer=new u();this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=!1;this.endEmitted=!1;this.reading=!1;this.sync=!0;this.needReadable=!1;this.emittedReadable=!1;this.readableListening=!1;this.resumeScheduled=!1;this.destroyed=!1;this.defaultEncoding=a.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=!1;this.decoder=null;this.encoding=null;a.encoding&&(v||(v=K("/").StringDecoder),this.decoder=new v(a.encoding),this.encoding=a.encoding)}function A(a){d=d||F();if(!(this instanceof A))return new A(a);this._readableState=new z(a,this);this.readable=!0;a&&(typeof a.read==="function"&&(this._read=a.read),typeof a.destroy==="function"&&(this._destroy=a.destroy));f.call(this)}Object.defineProperty(A.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(a){if(!this._readableState)return;this._readableState.destroyed=a}});A.prototype.destroy=r.destroy;A.prototype._undestroy=r.undestroy;A.prototype._destroy=function(a,b){this.push(null),b(a)};A.prototype.push=function(a,b){var c=this._readableState,d;!c.objectMode?typeof a==="string"&&(b=b||c.defaultEncoding,b!==c.encoding&&(a=k.from(a,b),b=""),d=!0):d=!0;return B(this,a,b,!1,d)};A.prototype.unshift=function(a){return B(this,a,null,!0,!1)};function B(a,b,c,d,e){var f=a._readableState;if(b===null)f.reading=!1,J(a,f);else{var g;e||(g=D(f,b));g?a.emit("error",g):f.objectMode||b&&b.length>0?(typeof b!=="string"&&!f.objectMode&&Object.getPrototypeOf(b)!==k.prototype&&(b=n(b)),d?f.endEmitted?a.emit("error",new Error("stream.unshift() after end event")):C(a,f,b,!0):f.ended?a.emit("error",new Error("stream.push() after EOF")):(f.reading=!1,f.decoder&&!c?(b=f.decoder.write(b),f.objectMode||b.length!==0?C(a,f,b,!1):O(a,f)):C(a,f,b,!1))):d||(f.reading=!1)}return E(f)}function C(a,b,c,d){b.flowing&&b.length===0&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,d?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&M(a)),O(a,b)}function D(a,b){var c;!o(b)&&typeof b!=="string"&&b!==void 0&&!a.objectMode&&(c=new TypeError("Invalid non-string/buffer chunk"));return c}function E(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||a.length===0)}A.prototype.isPaused=function(){return this._readableState.flowing===!1};A.prototype.setEncoding=function(a){v||(v=K("/").StringDecoder);this._readableState.decoder=new v(a);this._readableState.encoding=a;return this};var G=8388608;function H(a){a>=G?a=G:(a--,a|=a>>>1,a|=a>>>2,a|=a>>>4,a|=a>>>8,a|=a>>>16,a++);return a}function I(a,b){if(a<=0||b.length===0&&b.ended)return 0;if(b.objectMode)return 1;if(a!==a)if(b.flowing&&b.length)return b.buffer.head.data.length;else return b.length;a>b.highWaterMark&&(b.highWaterMark=H(a));if(a<=b.length)return a;if(!b.ended){b.needReadable=!0;return 0}return b.length}A.prototype.read=function(a){s("read",a);a=parseInt(a,10);var b=this._readableState,c=a;a!==0&&(b.emittedReadable=!1);if(a===0&&b.needReadable&&(b.length>=b.highWaterMark||b.ended)){s("read: emitReadable",b.length,b.ended);b.length===0&&b.ended?Z(this):M(this);return null}a=I(a,b);if(a===0&&b.ended){b.length===0&&Z(this);return null}var d=b.needReadable;s("need readable",d);(b.length===0||b.length-a<b.highWaterMark)&&(d=!0,s("length less than watermark",d));b.ended||b.reading?(d=!1,s("reading or ended",d)):d&&(s("do read"),b.reading=!0,b.sync=!0,b.length===0&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1,b.reading||(a=I(c,b)));a>0?d=V(a,b):d=null;d===null?(b.needReadable=!0,a=0):b.length-=a;b.length===0&&(b.ended||(b.needReadable=!0),c!==a&&b.ended&&Z(this));d!==null&&this.emit("data",d);return d};function J(a,b){if(b.ended)return;if(b.decoder){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0;M(a)}function M(a){var c=a._readableState;c.needReadable=!1;c.emittedReadable||(s("emitReadable",c.flowing),c.emittedReadable=!0,c.sync?b.nextTick(N,a):N(a))}function N(a){s("emit readable"),a.emit("readable"),U(a)}function O(a,c){c.readingMore||(c.readingMore=!0,b.nextTick(P,a,c))}function P(a,b){var c=b.length;while(!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark){s("maybeReadMore read 0");a.read(0);if(c===b.length)break;else c=b.length}b.readingMore=!1}A.prototype._read=function(a){this.emit("error",new Error("_read() is not implemented"))};A.prototype.pipe=function(a,c){var d=this,f=this._readableState;switch(f.pipesCount){case 0:f.pipes=a;break;case 1:f.pipes=[f.pipes,a];break;default:f.pipes.push(a);break}f.pipesCount+=1;s("pipe count=%d opts=%j",f.pipesCount,c);c=(!c||c.end!==!1)&&a!==process.stdout&&a!==process.stderr;c=c?h:q;f.endEmitted?b.nextTick(c):d.once("end",c);a.on("unpipe",g);function g(a,b){s("onunpipe"),a===d&&(b&&b.hasUnpiped===!1&&(b.hasUnpiped=!0,k()))}function h(){s("onend"),a.end()}var i=Q(d);a.on("drain",i);var j=!1;function k(){s("cleanup"),a.removeListener("close",o),a.removeListener("finish",p),a.removeListener("drain",i),a.removeListener("error",n),a.removeListener("unpipe",g),d.removeListener("end",h),d.removeListener("end",q),d.removeListener("data",m),j=!0,f.awaitDrain&&(!a._writableState||a._writableState.needDrain)&&i()}var l=!1;d.on("data",m);function m(b){s("ondata");l=!1;b=a.write(b);!1===b&&!l&&((f.pipesCount===1&&f.pipes===a||f.pipesCount>1&&aa(f.pipes,a)!==-1)&&!j&&(s("false write response, pause",d._readableState.awaitDrain),d._readableState.awaitDrain++,l=!0),d.pause())}function n(b){s("onerror",b),q(),a.removeListener("error",n),e(a,"error")===0&&a.emit("error",b)}y(a,"error",n);function o(){a.removeListener("finish",p),q()}a.once("close",o);function p(){s("onfinish"),a.removeListener("close",o),q()}a.once("finish",p);function q(){s("unpipe"),d.unpipe(a)}a.emit("pipe",d);f.flowing||(s("pipe resume"),d.resume());return a};function Q(a){return function(){var b=a._readableState;s("pipeOnDrain",b.awaitDrain);b.awaitDrain&&b.awaitDrain--;b.awaitDrain===0&&e(a,"data")&&(b.flowing=!0,U(a))}}A.prototype.unpipe=function(a){var b=this._readableState,c={hasUnpiped:!1};if(b.pipesCount===0)return this;if(b.pipesCount===1){if(a&&a!==b.pipes)return this;a||(a=b.pipes);b.pipes=null;b.pipesCount=0;b.flowing=!1;a&&a.emit("unpipe",this,c);return this}if(!a){var d=b.pipes,e=b.pipesCount;b.pipes=null;b.pipesCount=0;b.flowing=!1;for(var f=0;f<e;f++)d[f].emit("unpipe",this,c);return this}d=aa(b.pipes,a);if(d===-1)return this;b.pipes.splice(d,1);b.pipesCount-=1;b.pipesCount===1&&(b.pipes=b.pipes[0]);a.emit("unpipe",this,c);return this};A.prototype.on=function(a,c){c=f.prototype.on.call(this,a,c);if(a==="data")this._readableState.flowing!==!1&&this.resume();else if(a==="readable"){a=this._readableState;!a.endEmitted&&!a.readableListening&&(a.readableListening=a.needReadable=!0,a.emittedReadable=!1,!a.reading?b.nextTick(R,this):a.length&&M(this))}return c};A.prototype.addListener=A.prototype.on;function R(a){s("readable nexttick read 0"),a.read(0)}A.prototype.resume=function(){var a=this._readableState;a.flowing||(s("resume"),a.flowing=!0,S(this,a));return this};function S(a,c){c.resumeScheduled||(c.resumeScheduled=!0,b.nextTick(T,a,c))}function T(a,b){b.reading||(s("resume read 0"),a.read(0)),b.resumeScheduled=!1,b.awaitDrain=0,a.emit("resume"),U(a),b.flowing&&!b.reading&&a.read(0)}A.prototype.pause=function(){s("call pause flowing=%j",this._readableState.flowing);!1!==this._readableState.flowing&&(s("pause"),this._readableState.flowing=!1,this.emit("pause"));return this};function U(a){var b=a._readableState;s("flow",b.flowing);while(b.flowing&&a.read()!==null);}A.prototype.wrap=function(a){var b=this,c=this._readableState,d=!1;a.on("end",function(){s("wrapped end");if(c.decoder&&!c.ended){var a=c.decoder.end();a&&a.length&&b.push(a)}b.push(null)});a.on("data",function(e){s("wrapped data");c.decoder&&(e=c.decoder.write(e));if(c.objectMode&&(e===null||e===void 0))return;else if(!c.objectMode&&(!e||!e.length))return;e=b.push(e);e||(d=!0,a.pause())});for(var e in a)this[e]===void 0&&typeof a[e]==="function"&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));for(e=0;e<w.length;e++)a.on(w[e],this.emit.bind(this,w[e]));this._read=function(b){s("wrapped _read",b),d&&(d=!1,a.resume())};return this};Object.defineProperty(A.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});A._fromList=V;function V(a,b){if(b.length===0)return null;var c;b.objectMode?c=b.buffer.shift():!a||a>=b.length?(b.decoder?c=b.buffer.join(""):b.buffer.length===1?c=b.buffer.head.data:c=b.buffer.concat(b.length),b.buffer.clear()):c=W(a,b.buffer,b.decoder);return c}function W(a,b,c){var d;a<b.head.data.length?(d=b.head.data.slice(0,a),b.head.data=b.head.data.slice(a)):a===b.head.data.length?d=b.shift():d=c?X(a,b):Y(a,b);return d}function X(a,b){var c=b.head,d=1,e=c.data;a-=e.length;while(c=c.next){var f=c.data,g=a>f.length?f.length:a;g===f.length?e+=f:e+=f.slice(0,a);a-=g;if(a===0){g===f.length?(++d,c.next?b.head=c.next:b.head=b.tail=null):(b.head=c,c.data=f.slice(g));break}++d}b.length-=d;return e}function Y(a,b){var c=k.allocUnsafe(a),d=b.head,e=1;d.data.copy(c);a-=d.data.length;while(d=d.next){var f=d.data,g=a>f.length?f.length:a;f.copy(c,c.length-a,0,g);a-=g;if(a===0){g===f.length?(++e,d.next?b.head=d.next:b.head=b.tail=null):(b.head=d,d.data=f.slice(g));break}++e}b.length-=e;return c}function Z(a){var c=a._readableState;if(c.length>0)throw new Error('"endReadable()" called on non-empty stream');c.endEmitted||(c.ended=!0,b.nextTick($,c,a))}function $(a,b){!a.endEmitted&&a.length===0&&(a.endEmitted=!0,b.readable=!1,b.emit("end"))}function aa(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1}}var N=!1;function O(){N||(N=!0,M());return L.exports}c={};var P={exports:c};function Q(){P.exports=d;var a=F(),b=i();b.inherits=j();b.inherits(d,a);function c(a,b){var c=this._transformState;c.transforming=!1;var d=c.writecb;if(!d)return this.emit("error",new Error("write callback called multiple times"));c.writechunk=null;c.writecb=null;b!=null&&this.push(b);d(a);c=this._readableState;c.reading=!1;(c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}function d(b){if(!(this instanceof d))return new d(b);a.call(this,b);this._transformState={afterTransform:c.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=!0;this._readableState.sync=!1;b&&(typeof b.transform==="function"&&(this._transform=b.transform),typeof b.flush==="function"&&(this._flush=b.flush));this.on("prefinish",e)}function e(){var a=this;typeof this._flush==="function"?this._flush(function(b,c){f(a,b,c)}):f(this,null,null)}d.prototype.push=function(b,c){this._transformState.needTransform=!1;return a.prototype.push.call(this,b,c)};d.prototype._transform=function(a,b,c){throw new Error("_transform() is not implemented")};d.prototype._write=function(a,b,c){var d=this._transformState;d.writecb=c;d.writechunk=a;d.writeencoding=b;if(!d.transforming){c=this._readableState;(d.needTransform||c.needReadable||c.length<c.highWaterMark)&&this._read(c.highWaterMark)}};d.prototype._read=function(a){a=this._transformState;a.writechunk!==null&&a.writecb&&!a.transforming?(a.transforming=!0,this._transform(a.writechunk,a.writeencoding,a.afterTransform)):a.needTransform=!0};d.prototype._destroy=function(b,c){var d=this;a.prototype._destroy.call(this,b,function(a){c(a),d.emit("close")})};function f(a,b,c){if(b)return a.emit("error",b);c!=null&&a.push(c);if(a._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(a._transformState.transforming)throw new Error("Calling transform done when still transforming");return a.push(null)}}var R=!1;function S(){R||(R=!0,Q());return P.exports}b={};var T={exports:b};function U(){T.exports=c;var a=S(),b=i();b.inherits=j();b.inherits(c,a);function c(b){if(!(this instanceof c))return new c(b);a.call(this,b)}c.prototype._transform=function(a,b,c){c(null,a)}}var V=!1;function W(){V||(V=!0,U());return T.exports}d={};var X={exports:d};function Y(){var a={};process.env.READABLE_STREAM==="disable"&&a?(X.exports=a,d=X.exports=a.Readable,d.Readable=a.Readable,d.Writable=a.Writable,d.Duplex=a.Duplex,d.Transform=a.Transform,d.PassThrough=a.PassThrough,d.Stream=a):(d=X.exports=O(),d.Stream=a||d,d.Readable=d,d.Writable=B(),d.Duplex=F(),d.Transform=S(),d.PassThrough=W())}var Z=!1;function $(){Z||(Z=!0,Y());return X.exports}function f(a){switch(a){case void 0:return $()}}e.exports=f}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("set-immediate-shim-1.0.1",[],(function(a,b,c,d,e,f){"use strict";b={};var g={exports:b};function h(){g.exports=typeof setImmediate==="function"?setImmediate:function(){var a=[].slice.apply(arguments);a.splice(1,0,0);setTimeout.apply(null,a)}}var i=!1;function j(){i||(i=!0,h());return g.exports}function a(a){switch(a){case void 0:return j()}}e.exports=a}),null);
/**
 * License: https://www.facebook.com/legal/license/cr2jmG-CdKo/
 */
__d("jszip-3.2.0",["readable-stream-2.3.6","set-immediate-shim-1.0.1","lie-3.3.0","pako-1.0.8"],(function(a,b,c,d,e,f){"use strict";var g=b("readable-stream-2.3.6"),h=b("set-immediate-shim-1.0.1"),i=b("lie-3.3.0"),j=b("pako-1.0.8"),k={},l={exports:k};function m(){k.base64=!0;k.array=!0;k.string=!0;k.arraybuffer=typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined";k.nodebuffer=typeof Buffer!=="undefined";k.uint8array=typeof Uint8Array!=="undefined";if(typeof ArrayBuffer==="undefined")k.blob=!1;else{var a=new ArrayBuffer(0);try{k.blob=new Blob([a],{type:"application/zip"}).size===0}catch(c){try{var b=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;b=new b();b.append(a);k.blob=b.getBlob("application/zip").size===0}catch(a){k.blob=!1}}}try{k.nodestream=!!g().Readable}catch(a){k.nodestream=!1}}var n=!1;function o(){n||(n=!0,m());return l.exports}var p={},q={exports:p};function r(){var a=E(),b=o(),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";p.encode=function(b){var d=[],e,f,g,h,i=0,j=b.length,k=j,l=a.getTypeOf(b)!=="string";while(i<b.length)k=j-i,!l?(e=b.charCodeAt(i++),f=i<j?b.charCodeAt(i++):0,g=i<j?b.charCodeAt(i++):0):(e=b[i++],f=i<j?b[i++]:0,g=i<j?b[i++]:0),h=e>>2,e=(e&3)<<4|f>>4,f=k>1?(f&15)<<2|g>>6:64,g=k>2?g&63:64,d.push(c.charAt(h)+c.charAt(e)+c.charAt(f)+c.charAt(g));return d.join("")};p.decode=function(a){var d,e,f,g,h=0,i=0,j="data:";if(a.substr(0,j.length)===j)throw new Error("Invalid base64 input, it looks like a data url.");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j=a.length*3/4;a.charAt(a.length-1)===c.charAt(64)&&j--;a.charAt(a.length-2)===c.charAt(64)&&j--;if(j%1!==0)throw new Error("Invalid base64 input, bad content length.");var k;b.uint8array?k=new Uint8Array(j|0):k=new Array(j|0);while(h<a.length)j=c.indexOf(a.charAt(h++)),e=c.indexOf(a.charAt(h++)),f=c.indexOf(a.charAt(h++)),g=c.indexOf(a.charAt(h++)),j=j<<2|e>>4,e=(e&15)<<4|f>>2,d=(f&3)<<6|g,k[i++]=j,f!==64&&(k[i++]=e),g!==64&&(k[i++]=d);return k}}var s=!1;function t(){s||(s=!0,r());return q.exports}c={};var u={exports:c};function v(){u.exports={isNode:typeof Buffer!=="undefined",newBufferFrom:function(a,b){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,b);else{if(typeof a==="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,b)}},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);else{a=new Buffer(a);a.fill(0);return a}},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on==="function"&&typeof a.pause==="function"&&typeof a.resume==="function"}}}var w=!1;function x(){w||(w=!0,v());return u.exports}d={};var y={exports:d};function z(){var a;typeof Promise!=="undefined"?a=Promise:a=i();y.exports={Promise:a}}var A=!1;function B(){A||(A=!0,z());return y.exports}var C={},aa={exports:C};function ba(){var a=o(),b=t(),c=x(),d=h(),e=B();function f(b){var c;a.uint8array?c=new Uint8Array(b.length):c=new Array(b.length);return i(b,c)}C.newBlob=function(a,b){C.checkSupport("blob");try{return new Blob([a],{type:b})}catch(d){try{var c=self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder;c=new c();c.append(a);return c.getBlob(b)}catch(a){throw new Error("Bug : can't construct the Blob.")}}};function g(a){return a}function i(a,b){for(var c=0;c<a.length;++c)b[c]=a.charCodeAt(c)&255;return b}var j={stringifyByChunk:function(a,b,c){var d=[],e=0,f=a.length;if(f<=c)return String.fromCharCode.apply(null,a);while(e<f)b==="array"||b==="nodebuffer"?d.push(String.fromCharCode.apply(null,a.slice(e,Math.min(e+c,f)))):d.push(String.fromCharCode.apply(null,a.subarray(e,Math.min(e+c,f)))),e+=c;return d.join("")},stringifyByChar:function(a){var b="";for(var c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b},applyCanBeUsed:{uint8array:function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch(a){return!1}}(),nodebuffer:function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,c.allocBuffer(1)).length===1}catch(a){return!1}}()}};function k(a){var b=65536,c=C.getTypeOf(a),d=!0;c==="uint8array"?d=j.applyCanBeUsed.uint8array:c==="nodebuffer"&&(d=j.applyCanBeUsed.nodebuffer);if(d)while(b>1)try{return j.stringifyByChunk(a,c,b)}catch(a){b=Math.floor(b/2)}return j.stringifyByChar(a)}C.applyFromCharCode=k;function l(a,b){for(var c=0;c<a.length;c++)b[c]=a[c];return b}var m={};m.string={string:g,array:function(a){return i(a,new Array(a.length))},arraybuffer:function(a){return m.string.uint8array(a).buffer},uint8array:function(a){return i(a,new Uint8Array(a.length))},nodebuffer:function(a){return i(a,c.allocBuffer(a.length))}};m.array={string:k,array:g,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return c.newBufferFrom(a)}};m.arraybuffer={string:function(a){return k(new Uint8Array(a))},array:function(a){return l(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:g,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return c.newBufferFrom(new Uint8Array(a))}};m.uint8array={string:k,array:function(a){return l(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:g,nodebuffer:function(a){return c.newBufferFrom(a)}};m.nodebuffer={string:k,array:function(a){return l(a,new Array(a.length))},arraybuffer:function(a){return m.nodebuffer.uint8array(a).buffer},uint8array:function(a){return l(a,new Uint8Array(a.length))},nodebuffer:g};C.transformTo=function(a,b){b||(b="");if(!a)return b;C.checkSupport(a);var c=C.getTypeOf(b);c=m[c][a](b);return c};C.getTypeOf=function(b){if(typeof b==="string")return"string";if(Object.prototype.toString.call(b)==="[object Array]")return"array";if(a.nodebuffer&&c.isBuffer(b))return"nodebuffer";if(a.uint8array&&b instanceof Uint8Array)return"uint8array";if(a.arraybuffer&&b instanceof ArrayBuffer)return"arraybuffer"};C.checkSupport=function(b){var c=a[b.toLowerCase()];if(!c)throw new Error(b+" is not supported by this platform")};C.MAX_VALUE_16BITS=65535;C.MAX_VALUE_32BITS=-1;C.pretty=function(a){var b="",c,d;for(d=0;d<(a||"").length;d++)c=a.charCodeAt(d),b+="\\x"+(c<16?"0":"")+c.toString(16).toUpperCase();return b};C.delay=function(a,b,c){d(function(){a.apply(c||null,b||[])})};C.inherits=function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c()};C.extend=function(){var a={},b,c;for(b=0;b<arguments.length;b++)for(c in arguments[b])arguments[b].hasOwnProperty(c)&&typeof a[c]==="undefined"&&(a[c]=arguments[b][c]);return a};C.prepareContent=function(c,d,g,h,i){d=e.Promise.resolve(d).then(function(b){var c=a.blob&&(b instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b))!==-1);if(c&&typeof FileReader!=="undefined")return new e.Promise(function(a,c){var d=new FileReader();d.onload=function(b){a(b.target.result)};d.onerror=function(a){c(a.target.error)};d.readAsArrayBuffer(b)});else return b});return d.then(function(a){var d=C.getTypeOf(a);if(!d)return e.Promise.reject(new Error("Can't read the data of '"+c+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"));d==="arraybuffer"?a=C.transformTo("uint8array",a):d==="string"&&(i?a=b.decode(a):g&&(h!==!0&&(a=f(a))));return a})}}var D=!1;function E(){D||(D=!0,ba());return aa.exports}f={};var F={exports:f};function ca(){function a(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){if(this.isFinished)return!1;this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp());return!0},on:function(a,b){this._listeners[a].push(b);return this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,b)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo;this.mergeStreamInfo();this.previous=a;var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.end()});a.on("error",function(a){b.error(a)});return this},pause:function(){if(this.isPaused||this.isFinished)return!1;this.isPaused=!0;this.previous&&this.previous.pause();return!0},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var a=!1;this.generatedError&&(this.error(this.generatedError),a=!0);this.previous&&this.previous.resume();return!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,b){this.extraStreamInfo[a]=b;this.mergeStreamInfo();return this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo){if(!this.extraStreamInfo.hasOwnProperty(a))continue;this.streamInfo[a]=this.extraStreamInfo[a]}},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0;this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;if(this.previous)return this.previous+" -> "+a;else return a}};F.exports=a}var G=!1;function H(){G||(G=!0,ca());return F.exports}var I={},da={exports:I};function ea(){var a=E(),b=o(),c=x(),d=H(),e=new Array(256);for(var f=0;f<256;f++)e[f]=f>=252?6:f>=248?5:f>=240?4:f>=224?3:f>=192?2:1;e[254]=e[254]=1;var g=function(c){var d,e,f,g,a,h=c.length,i=0;for(g=0;g<h;g++)e=c.charCodeAt(g),(e&64512)===55296&&g+1<h&&(f=c.charCodeAt(g+1),(f&64512)===56320&&(e=65536+(e-55296<<10)+(f-56320),g++)),i+=e<128?1:e<2048?2:e<65536?3:4;b.uint8array?d=new Uint8Array(i):d=new Array(i);for(a=0,g=0;a<i;g++)e=c.charCodeAt(g),(e&64512)===55296&&g+1<h&&(f=c.charCodeAt(g+1),(f&64512)===56320&&(e=65536+(e-55296<<10)+(f-56320),g++)),e<128?d[a++]=e:e<2048?(d[a++]=192|e>>>6,d[a++]=128|e&63):e<65536?(d[a++]=224|e>>>12,d[a++]=128|e>>>6&63,d[a++]=128|e&63):(d[a++]=240|e>>>18,d[a++]=128|e>>>12&63,d[a++]=128|e>>>6&63,d[a++]=128|e&63);return d},h=function(a,b){var c;b=b||a.length;b>a.length&&(b=a.length);c=b-1;while(c>=0&&(a[c]&192)===128)c--;if(c<0)return b;return c===0?b:c+e[a[c]]>b?c:b},i=function(c){var b,d,f,g,h=c.length,i=new Array(h*2);for(d=0,b=0;b<h;){f=c[b++];if(f<128){i[d++]=f;continue}g=e[f];if(g>4){i[d++]=65533;b+=g-1;continue}f&=g===2?31:g===3?15:7;while(g>1&&b<h)f=f<<6|c[b++]&63,g--;if(g>1){i[d++]=65533;continue}f<65536?i[d++]=f:(f-=65536,i[d++]=55296|f>>10&1023,i[d++]=56320|f&1023)}i.length!==d&&(i.subarray?i=i.subarray(0,d):i.length=d);return a.applyFromCharCode(i)};I.utf8encode=function(a){return b.nodebuffer?c.newBufferFrom(a,"utf-8"):g(a)};I.utf8decode=function(c){if(b.nodebuffer)return a.transformTo("nodebuffer",c).toString("utf-8");c=a.transformTo(b.uint8array?"uint8array":"array",c);return i(c)};function j(){d.call(this,"utf-8 decode"),this.leftOver=null}a.inherits(j,d);j.prototype.processChunk=function(c){var d=a.transformTo(b.uint8array?"uint8array":"array",c.data);if(this.leftOver&&this.leftOver.length){if(b.uint8array){var e=d;d=new Uint8Array(e.length+this.leftOver.length);d.set(this.leftOver,0);d.set(e,this.leftOver.length)}else d=this.leftOver.concat(d);this.leftOver=null}e=h(d);var f=d;e!==d.length&&(b.uint8array?(f=d.subarray(0,e),this.leftOver=d.subarray(e,d.length)):(f=d.slice(0,e),this.leftOver=d.slice(e,d.length)));this.push({data:I.utf8decode(f),meta:c.meta})};j.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:I.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)};I.Utf8DecodeWorker=j;function k(){d.call(this,"utf-8 encode")}a.inherits(k,d);k.prototype.processChunk=function(a){this.push({data:I.utf8encode(a.data),meta:a.meta})};I.Utf8EncodeWorker=k}var J=!1;function K(){J||(J=!0,ea());return da.exports}b={};var L={exports:b};function fa(){var a=H(),b=E();function c(b){a.call(this,"ConvertWorker to "+b),this.destType=b}b.inherits(c,a);c.prototype.processChunk=function(a){this.push({data:b.transformTo(this.destType,a.data),meta:a.meta})};L.exports=c}var M=!1;function ga(){M||(M=!0,fa());return L.exports}c={};var N={exports:c};function ha(){var a=g().Readable,b=E();b.inherits(c,a);function c(b,c,d){a.call(this,c);this._helper=b;var e=this;b.on("data",function(a,b){e.push(a)||e._helper.pause(),d&&d(b)}).on("error",function(a){e.emit("error",a)}).on("end",function(){e.push(null)})}c.prototype._read=function(){this._helper.resume()};N.exports=c}var O=!1;function ia(){O||(O=!0,ha());return N.exports}d={};var P={exports:d};function ja(){var a=E(),b=ga(),c=H(),d=t(),e=o(),f=B(),g=null;if(e.nodestream)try{g=ia()}catch(a){}function h(b,c,e){switch(b){case"blob":return a.newBlob(a.transformTo("arraybuffer",c),e);case"base64":return d.encode(c);default:return a.transformTo(b,c)}}function i(a,b){var c,d=0,e=null,f=0;for(c=0;c<b.length;c++)f+=b[c].length;switch(a){case"string":return b.join("");case"array":return Array.prototype.concat.apply([],b);case"uint8array":e=new Uint8Array(f);for(c=0;c<b.length;c++)e.set(b[c],d),d+=b[c].length;return e;case"nodebuffer":return Buffer.concat(b);default:throw new Error("concat : unsupported type '"+a+"'")}}function j(a,b){return new f.Promise(function(c,d){var e=[],f=a._internalType,g=a._outputType,j=a._mimeType;a.on("data",function(a,c){e.push(a),b&&b(c)}).on("error",function(a){e=[],d(a)}).on("end",function(){try{var a=h(g,i(f,e),j);c(a)}catch(a){d(a)}e=[]}).resume()})}function k(d,e,f){var g=e;switch(e){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string";break}try{this._internalType=g,this._outputType=e,this._mimeType=f,a.checkSupport(g),this._worker=d.pipe(new b(g)),d.lock()}catch(a){this._worker=new c("error"),this._worker.error(a)}}k.prototype={accumulate:function(a){return j(this,a)},on:function(b,c){var d=this;b==="data"?this._worker.on(b,function(a){c.call(d,a.data,a.meta)}):this._worker.on(b,function(){a.delay(c,arguments,d)});return this},resume:function(){a.delay(this._worker.resume,[],this._worker);return this},pause:function(){this._worker.pause();return this},toNodejsStream:function(b){a.checkSupport("nodestream");if(this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},b)}};P.exports=k}var Q=!1;function R(){Q||(Q=!0,ja());return P.exports}var S={},ka={exports:S};function la(){S.base64=!1,S.binary=!1,S.dir=!1,S.createFolders=!0,S.date=null,S.compression=null,S.compressionOptions=null,S.comment=null,S.unixPermissions=null,S.dosPermissions=null}var T=!1;function U(){T||(T=!0,la());return ka.exports}f={};var V={exports:f};function ma(){var a=E(),b=H(),c=16*1024;function d(c){b.call(this,"DataWorker");var d=this;this.dataIsReady=!1;this.index=0;this.max=0;this.data=null;this.type="";this._tickScheduled=!1;c.then(function(b){d.dataIsReady=!0,d.data=b,d.max=b&&b.length||0,d.type=a.getTypeOf(b),d.isPaused||d._tickAndRepeat()},function(a){d.error(a)})}a.inherits(d,b);d.prototype.cleanUp=function(){b.prototype.cleanUp.call(this),this.data=null};d.prototype.resume=function(){if(!b.prototype.resume.call(this))return!1;!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this));return!0};d.prototype._tickAndRepeat=function(){this._tickScheduled=!1;if(this.isPaused||this.isFinished)return;this._tick();this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0)};d.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=c,b=null;a=Math.min(this.max,this.index+a);if(this.index>=this.max)return this.end();else{switch(this.type){case"string":b=this.data.substring(this.index,a);break;case"uint8array":b=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":b=this.data.slice(this.index,a);break}this.index=a;return this.push({data:b,meta:{percent:this.max?this.index/this.max*100:0}})}};V.exports=d}var na=!1;function oa(){na||(na=!0,ma());return V.exports}b={};var pa={exports:b};function qa(){var a=E(),b=H();function c(a){b.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}a.inherits(c,b);c.prototype.processChunk=function(a){if(a){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+a.data.length}b.prototype.processChunk.call(this,a)};pa.exports=c}var ra=!1;function sa(){ra||(ra=!0,qa());return pa.exports}c={};var ta={exports:c};function ua(){var a=E();function b(){var a,b=[];for(var c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=a&1?3988292384^a>>>1:a>>>1;b[c]=a}return b}var c=b();function d(a,b,d,e){var f=c;d=e+d;a=a^-1;for(e=e;e<d;e++)a=a>>>8^f[(a^b[e])&255];return a^-1}function e(a,b,d,e){var f=c;d=e+d;a=a^-1;for(e=e;e<d;e++)a=a>>>8^f[(a^b.charCodeAt(e))&255];return a^-1}ta.exports=function(b,c){if(typeof b==="undefined"||!b.length)return 0;var f=a.getTypeOf(b)!=="string";if(f)return d(c|0,b,b.length,0);else return e(c|0,b,b.length,0)}}var va=!1;function W(){va||(va=!0,ua());return ta.exports}d={};var wa={exports:d};function xa(){var a=H(),b=W(),c=E();function d(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}c.inherits(d,a);d.prototype.processChunk=function(a){this.streamInfo.crc32=b(a.data,this.streamInfo.crc32||0),this.push(a)};wa.exports=d}var ya=!1;function za(){ya||(ya=!0,xa());return wa.exports}f={};var Aa={exports:f};function Ba(){var a=B(),b=oa(),c=sa(),d=za(),c=sa();function e(a,b,c,d,e){this.compressedSize=a,this.uncompressedSize=b,this.crc32=c,this.compression=d,this.compressedContent=e}e.prototype={getContentWorker:function(){var d=new b(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),e=this;d.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")});return d},getCompressedWorker:function(){return new b(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}};e.createWorkerFrom=function(a,b,e){return a.pipe(new d()).pipe(new c("uncompressedSize")).pipe(b.compressWorker(e)).pipe(new c("compressedSize")).withStreamInfo("compression",b)};Aa.exports=e}var Ca=!1;function X(){Ca||(Ca=!0,Ba());return Aa.exports}b={};var Da={exports:b};function Ea(){var a=R(),b=oa(),c=K(),d=X(),e=H(),f=function(a,b,c){this.name=a,this.dir=c.dir,this.date=c.date,this.comment=c.comment,this.unixPermissions=c.unixPermissions,this.dosPermissions=c.dosPermissions,this._data=b,this._dataBinary=c.binary,this.options={compression:c.compression,compressionOptions:c.compressionOptions}};f.prototype={internalStream:function(b){var d=null,f="string";try{if(!b)throw new Error("No output type specified.");f=b.toLowerCase();b=f==="string"||f==="text";(f==="binarystring"||f==="text")&&(f="string");d=this._decompressWorker();var g=!this._dataBinary;g&&!b&&(d=d.pipe(new c.Utf8EncodeWorker()));!g&&b&&(d=d.pipe(new c.Utf8DecodeWorker()))}catch(a){d=new e("error"),d.error(a)}return new a(d,f,"")},async:function(a,b){return this.internalStream(a).accumulate(b)},nodeStream:function(a,b){return this.internalStream(a||"nodebuffer").toNodejsStream(b)},_compressWorker:function(a,b){if(this._data instanceof d&&this._data.compression.magic===a.magic)return this._data.getCompressedWorker();else{var e=this._decompressWorker();this._dataBinary||(e=e.pipe(new c.Utf8EncodeWorker()));return d.createWorkerFrom(e,a,b)}},_decompressWorker:function(){if(this._data instanceof d)return this._data.getContentWorker();else if(this._data instanceof e)return this._data;else return new b(this._data)}};var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")};for(var i=0;i<g.length;i++)f.prototype[g[i]]=h;Da.exports=f}var Fa=!1;function Ga(){Fa||(Fa=!0,Ea());return Da.exports}var Y={},Ha={exports:Y};function Ia(){var a=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Uint32Array!=="undefined",b=j(),c=E(),d=H(),e=a?"uint8array":"array";Y.magic="\b\0";function f(a,b){d.call(this,"FlateWorker/"+a),this._pako=null,this._pakoAction=a,this._pakoOptions=b,this.meta={}}c.inherits(f,d);f.prototype.processChunk=function(a){this.meta=a.meta,this._pako===null&&this._createPako(),this._pako.push(c.transformTo(e,a.data),!1)};f.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)};f.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null};f.prototype._createPako=function(){this._pako=new b[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var a=this;this._pako.onData=function(b){a.push({data:b,meta:a.meta})}};Y.compressWorker=function(a){return new f("Deflate",a)};Y.uncompressWorker=function(){return new f("Inflate",{})}}var Ja=!1;function Ka(){Ja||(Ja=!0,Ia());return Ha.exports}var Z={},La={exports:Z};function Ma(){var a=H();Z.STORE={magic:"\0\0",compressWorker:function(b){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}};Z.DEFLATE=Ka()}var Na=!1;function Oa(){Na||(Na=!0,Ma());return La.exports}var $={},Pa={exports:$};function Qa(){$.LOCAL_FILE_HEADER="PK\x03\x04",$.CENTRAL_FILE_HEADER="PK\x01\x02",$.CENTRAL_DIRECTORY_END="PK\x05\x06",$.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",$.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",$.DATA_DESCRIPTOR="PK\x07\b"}var Ra=!1;function Sa(){Ra||(Ra=!0,Qa());return Pa.exports}c={};var Ta={exports:c};function Ua(){var a=E(),b=H(),c=K(),d=W(),e=Sa(),f=function(a,b){var c="",d;for(d=0;d<b;d++)c+=String.fromCharCode(a&255),a=a>>>8;return c},g=function(a,b){var c=a;a||(c=b?16893:33204);return(c&65535)<<16},h=function(a,b){return(a||0)&63},i=function(b,i,j,k,l,m){var n=b.file,o=b.compression,p=m!==c.utf8encode,q=a.transformTo("string",m(n.name)),r=a.transformTo("string",c.utf8encode(n.name)),s=n.comment;m=a.transformTo("string",m(s));var t=a.transformTo("string",c.utf8encode(s)),u=r.length!==n.name.length;s=t.length!==s.length;var v="",w="",x="",y=n.dir,z=n.date,A={crc32:0,compressedSize:0,uncompressedSize:0};(!i||j)&&(A.crc32=b.crc32,A.compressedSize=b.compressedSize,A.uncompressedSize=b.uncompressedSize);j=0;i&&(j|=8);!p&&(u||s)&&(j|=2048);b=0;i=0;y&&(b|=16);l==="UNIX"?(i=798,b|=g(n.unixPermissions,y)):(i=20,b|=h(n.dosPermissions));p=z.getUTCHours();p=p<<6;p=p|z.getUTCMinutes();p=p<<5;p=p|z.getUTCSeconds()/2;l=z.getUTCFullYear()-1980;l=l<<4;l=l|z.getUTCMonth()+1;l=l<<5;l=l|z.getUTCDate();u&&(w=f(1,1)+f(d(q),4)+r,v+="up"+f(w.length,2)+w);s&&(x=f(1,1)+f(d(m),4)+t,v+="uc"+f(x.length,2)+x);y="";y+="\n\0";y+=f(j,2);y+=o.magic;y+=f(p,2);y+=f(l,2);y+=f(A.crc32,4);y+=f(A.compressedSize,4);y+=f(A.uncompressedSize,4);y+=f(q.length,2);y+=f(v.length,2);n=e.LOCAL_FILE_HEADER+y+q+v;z=e.CENTRAL_FILE_HEADER+f(i,2)+y+f(m.length,2)+"\0\0\0\0"+f(b,4)+f(k,4)+q+v+m;return{fileRecord:n,dirRecord:z}},j=function(b,c,d,g,h){h=a.transformTo("string",h(g));g=e.CENTRAL_DIRECTORY_END+"\0\0\0\0"+f(b,2)+f(b,2)+f(c,4)+f(d,4)+f(h.length,2)+h;return g},k=function(a){a=e.DATA_DESCRIPTOR+f(a.crc32,4)+f(a.compressedSize,4)+f(a.uncompressedSize,4);return a};function l(a,c,d,e){b.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=c,this.zipPlatform=d,this.encodeFileName=e,this.streamFiles=a,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(l,b);l.prototype.push=function(a){var c=a.meta.percent||0,d=this.entriesCount,e=this._sources.length;this.accumulate?this.contentBuffer.push(a):(this.bytesWritten+=a.data.length,b.prototype.push.call(this,{data:a.data,meta:{currentFile:this.currentFile,percent:d?(c+100*(d-e-1))/d:100}}))};l.prototype.openedSource=function(a){this.currentSourceOffset=this.bytesWritten;this.currentFile=a.file.name;var b=this.streamFiles&&!a.file.dir;if(b){a=i(a,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:a.fileRecord,meta:{percent:0}})}else this.accumulate=!0};l.prototype.closedSource=function(a){this.accumulate=!1;var b=this.streamFiles&&!a.file.dir,c=i(a,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.dirRecords.push(c.dirRecord);if(b)this.push({data:k(a),meta:{percent:100}});else{this.push({data:c.fileRecord,meta:{percent:0}});while(this.contentBuffer.length)this.push(this.contentBuffer.shift())}this.currentFile=null};l.prototype.flush=function(){var a=this.bytesWritten;for(var b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});b=this.bytesWritten-a;b=j(this.dirRecords.length,b,a,this.zipComment,this.encodeFileName);this.push({data:b,meta:{percent:100}})};l.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()};l.prototype.registerPrevious=function(a){this._sources.push(a);var b=this;a.on("data",function(a){b.processChunk(a)});a.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()});a.on("error",function(a){b.error(a)});return this};l.prototype.resume=function(){if(!b.prototype.resume.call(this))return!1;if(!this.previous&&this._sources.length){this.prepareNextSource();return!0}if(!this.previous&&!this._sources.length&&!this.generatedError){this.end();return!0}};l.prototype.error=function(a){var c=this._sources;if(!b.prototype.error.call(this,a))return!1;for(var d=0;d<c.length;d++)try{c[d].error(a)}catch(a){}return!0};l.prototype.lock=function(){b.prototype.lock.call(this);var a=this._sources;for(var c=0;c<a.length;c++)a[c].lock()};Ta.exports=l}var Va=!1;function Wa(){Va||(Va=!0,Ua());return Ta.exports}var Xa={},Ya={exports:Xa};function Za(){var a=Oa(),b=Wa(),c=function(b,c){b=b||c;c=a[b];if(!c)throw new Error(b+" is not a valid compression method !");return c};Xa.generateWorker=function(a,d,e){var f=new b(d.streamFiles,e,d.platform,d.encodeFileName),g=0;try{a.forEach(function(a,b){g++;var e=c(b.options.compression,d.compression),h=b.options.compressionOptions||d.compressionOptions||{},i=b.dir,j=b.date;b._compressWorker(e,h).withStreamInfo("file",{name:a,dir:i,date:j,comment:b.comment||"",unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions}).pipe(f)}),f.entriesCount=g}catch(a){f.error(a)}return f}}var $a=!1;function ab(){$a||($a=!0,Za());return Ya.exports}d={};var bb={exports:d};function cb(){var a=E(),b=H();function c(a,c){b.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(c)}a.inherits(c,b);c.prototype._bindStream=function(a){var b=this;this._stream=a;a.pause();a.on("data",function(a){b.push({data:a,meta:{percent:0}})}).on("error",function(a){b.isPaused?this.generatedError=a:b.error(a)}).on("end",function(){b.isPaused?b._upstreamEnded=!0:b.end()})};c.prototype.pause=function(){if(!b.prototype.pause.call(this))return!1;this._stream.pause();return!0};c.prototype.resume=function(){if(!b.prototype.resume.call(this))return!1;this._upstreamEnded?this.end():this._stream.resume();return!0};bb.exports=c}var db=!1;function eb(){db||(db=!0,cb());return bb.exports}f={};var fb={exports:f};function gb(){var a=K(),b=E(),c=H(),d=R(),e=U(),f=X(),g=Ga(),h=ab(),i=x(),j=eb(),k=function(a,d,h){var k=b.getTypeOf(d),o,p=b.extend(h||{},e);p.date=p.date||new Date();p.compression!==null&&(p.compression=p.compression.toUpperCase());typeof p.unixPermissions==="string"&&(p.unixPermissions=parseInt(p.unixPermissions,8));p.unixPermissions&&p.unixPermissions&16384&&(p.dir=!0);p.dosPermissions&&p.dosPermissions&16&&(p.dir=!0);p.dir&&(a=m(a));p.createFolders&&(o=l(a))&&n.call(this,o,!0);var q=k==="string"&&p.binary===!1&&p.base64===!1;(!h||typeof h.binary==="undefined")&&(p.binary=!q);h=d instanceof f&&d.uncompressedSize===0;(h||p.dir||!d||d.length===0)&&(p.base64=!1,p.binary=!0,d="",p.compression="STORE",k="string");d instanceof f||d instanceof c?q=d:i.isNode&&i.isStream(d)?q=new j(a,d):q=b.prepareContent(a,d,p.binary,p.optimizedBinaryString,p.base64);h=new g(a,q,p);this.files[a]=h},l=function(a){a.slice(-1)==="/"&&(a=a.substring(0,a.length-1));var b=a.lastIndexOf("/");return b>0?a.substring(0,b):""},m=function(a){a.slice(-1)!=="/"&&(a+="/");return a},n=function(a,b){b=typeof b!=="undefined"?b:e.createFolders;a=m(a);this.files[a]||k.call(this,a,null,{dir:!0,createFolders:b});return this.files[a]};function o(a){return Object.prototype.toString.call(a)==="[object RegExp]"}var p={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(a){var b,c,d;for(b in this.files){if(!this.files.hasOwnProperty(b))continue;d=this.files[b];c=b.slice(this.root.length,b.length);c&&b.slice(0,this.root.length)===this.root&&a(c,d)}},filter:function(a){var b=[];this.forEach(function(c,d){a(c,d)&&b.push(d)});return b},file:function(a,b,c){if(arguments.length===1)if(o(a)){var d=a;return this.filter(function(a,b){return!b.dir&&d.test(a)})}else{var e=this.files[this.root+a];if(e&&!e.dir)return e;else return null}else a=this.root+a,k.call(this,a,b,c);return this},folder:function(a){if(!a)return this;if(o(a))return this.filter(function(b,c){return c.dir&&a.test(b)});var b=this.root+a;b=n.call(this,b);var c=this.clone();c.root=b.name;return c},remove:function(a){a=this.root+a;var b=this.files[a];b||(a.slice(-1)!=="/"&&(a+="/"),b=this.files[a]);if(b&&!b.dir)delete this.files[a];else{b=this.filter(function(c,b){return b.name.slice(0,a.length)===a});for(var c=0;c<b.length;c++)delete this.files[b[c].name]}return this},generate:function(a){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var f,g={};try{g=b.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode});g.type=g.type.toLowerCase();g.compression=g.compression.toUpperCase();g.type==="binarystring"&&(g.type="string");if(!g.type)throw new Error("No output type specified.");b.checkSupport(g.type);(g.platform==="darwin"||g.platform==="freebsd"||g.platform==="linux"||g.platform==="sunos")&&(g.platform="UNIX");g.platform==="win32"&&(g.platform="DOS");e=g.comment||this.comment||"";f=h.generateWorker(this,g,e)}catch(a){f=new c("error"),f.error(a)}return new d(f,g.type||"string",g.mimeType)},generateAsync:function(a,b){return this.generateInternalStream(a).accumulate(b)},generateNodeStream:function(a,b){a=a||{};a.type||(a.type="nodebuffer");return this.generateInternalStream(a).toNodejsStream(b)}};fb.exports=p}var hb=!1;function ib(){hb||(hb=!0,gb());return fb.exports}b={};var jb={exports:b};function kb(){var a=E();function b(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}b.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(a){},readInt:function(a){var b=0,c;this.checkOffset(a);for(c=this.index+a-1;c>=this.index;c--)b=(b<<8)+this.byteAt(c);this.index+=a;return b},readString:function(b){return a.transformTo("string",this.readData(b))},readData:function(a){},lastIndexOfSignature:function(a){},readAndCheckSignature:function(a){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(a&31)<<1))}};jb.exports=b}var lb=!1;function mb(){lb||(lb=!0,kb());return jb.exports}c={};var nb={exports:c};function ob(){var a=mb(),b=E();function c(b){a.call(this,b);for(var c=0;c<this.data.length;c++)b[c]=b[c]&255}b.inherits(c,a);c.prototype.byteAt=function(a){return this.data[this.zero+a]};c.prototype.lastIndexOfSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2);a=a.charCodeAt(3);for(var e=this.length-4;e>=0;--e)if(this.data[e]===b&&this.data[e+1]===c&&this.data[e+2]===d&&this.data[e+3]===a)return e-this.zero;return-1};c.prototype.readAndCheckSignature=function(a){var b=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2);a=a.charCodeAt(3);var e=this.readData(4);return b===e[0]&&c===e[1]&&d===e[2]&&a===e[3]};c.prototype.readData=function(a){this.checkOffset(a);if(a===0)return[];var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};nb.exports=c}var pb=!1;function qb(){pb||(pb=!0,ob());return nb.exports}d={};var rb={exports:d};function sb(){var a=mb(),b=E();function c(b){a.call(this,b)}b.inherits(c,a);c.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)};c.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero};c.prototype.readAndCheckSignature=function(a){var b=this.readData(4);return a===b};c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};rb.exports=c}var tb=!1;function ub(){tb||(tb=!0,sb());return rb.exports}f={};var vb={exports:f};function wb(){var a=qb(),b=E();function c(b){a.call(this,b)}b.inherits(c,a);c.prototype.readData=function(a){this.checkOffset(a);if(a===0)return new Uint8Array(0);var b=this.data.subarray(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};vb.exports=c}var xb=!1;function yb(){xb||(xb=!0,wb());return vb.exports}b={};var zb={exports:b};function Ab(){var a=yb(),b=E();function c(b){a.call(this,b)}b.inherits(c,a);c.prototype.readData=function(a){this.checkOffset(a);var b=this.data.slice(this.zero+this.index,this.zero+this.index+a);this.index+=a;return b};zb.exports=c}var Bb=!1;function Cb(){Bb||(Bb=!0,Ab());return zb.exports}c={};var Db={exports:c};function Eb(){var a=E(),b=o(),c=qb(),d=ub(),e=Cb(),f=yb();Db.exports=function(g){var h=a.getTypeOf(g);a.checkSupport(h);if(h==="string"&&!b.uint8array)return new d(g);if(h==="nodebuffer")return new e(g);return b.uint8array?new f(a.transformTo("uint8array",g)):new c(a.transformTo("array",g))}}var Fb=!1;function Gb(){Fb||(Fb=!0,Eb());return Db.exports}d={};var Hb={exports:d};function Ib(){var a=Gb(),b=E(),c=X(),d=W(),e=K(),f=Oa(),g=o(),h=0,i=3,j=function(a){for(var b in f){if(!f.hasOwnProperty(b))continue;if(f[b].magic===a)return f[b]}return null};function k(a,b){this.options=a,this.loadOptions=b}k.prototype={isEncrypted:function(){return(this.bitFlag&1)===1},useUTF8:function(){return(this.bitFlag&2048)===2048},readLocalPart:function(a){var d;a.skip(22);this.fileNameLength=a.readInt(2);d=a.readInt(2);this.fileName=a.readData(this.fileNameLength);a.skip(d);if(this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");d=j(this.compressionMethod);if(d===null)throw new Error("Corrupted zip : compression "+b.pretty(this.compressionMethod)+" unknown (inner file : "+b.transformTo("string",this.fileName)+")");this.decompressed=new c(this.compressedSize,this.uncompressedSize,this.crc32,d,a.readData(this.compressedSize))},readCentralPart:function(a){this.versionMadeBy=a.readInt(2);a.skip(2);this.bitFlag=a.readInt(2);this.compressionMethod=a.readString(2);this.date=a.readDate();this.crc32=a.readInt(4);this.compressedSize=a.readInt(4);this.uncompressedSize=a.readInt(4);var b=a.readInt(2);this.extraFieldsLength=a.readInt(2);this.fileCommentLength=a.readInt(2);this.diskNumberStart=a.readInt(2);this.internalFileAttributes=a.readInt(2);this.externalFileAttributes=a.readInt(4);this.localHeaderOffset=a.readInt(4);if(this.isEncrypted())throw new Error("Encrypted zip are not supported");a.skip(b);this.readExtraFields(a);this.parseZIP64ExtraField(a);this.fileComment=a.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null;this.dosPermissions=null;var a=this.versionMadeBy>>8;this.dir=this.externalFileAttributes&16?!0:!1;a===h&&(this.dosPermissions=this.externalFileAttributes&63);a===i&&(this.unixPermissions=this.externalFileAttributes>>16&65535);!this.dir&&this.fileNameStr.slice(-1)==="/"&&(this.dir=!0)},parseZIP64ExtraField:function(c){if(!this.extraFields[1])return;c=a(this.extraFields[1].value);this.uncompressedSize===b.MAX_VALUE_32BITS&&(this.uncompressedSize=c.readInt(8));this.compressedSize===b.MAX_VALUE_32BITS&&(this.compressedSize=c.readInt(8));this.localHeaderOffset===b.MAX_VALUE_32BITS&&(this.localHeaderOffset=c.readInt(8));this.diskNumberStart===b.MAX_VALUE_32BITS&&(this.diskNumberStart=c.readInt(4))},readExtraFields:function(a){var b=a.index+this.extraFieldsLength,c,d,e;this.extraFields||(this.extraFields={});while(a.index<b)c=a.readInt(2),d=a.readInt(2),e=a.readData(d),this.extraFields[c]={id:c,length:d,value:e}},handleUTF8:function(){var a=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=e.utf8decode(this.fileName),this.fileCommentStr=e.utf8decode(this.fileComment);else{var c=this.findExtraFieldUnicodePath();if(c!==null)this.fileNameStr=c;else{c=b.transformTo(a,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(c)}c=this.findExtraFieldUnicodeComment();if(c!==null)this.fileCommentStr=c;else{c=b.transformTo(a,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(c)}}},findExtraFieldUnicodePath:function(){var b=this.extraFields[28789];if(b){var c=a(b.value);if(c.readInt(1)!==1)return null;return d(this.fileName)!==c.readInt(4)?null:e.utf8decode(c.readData(b.length-5))}return null},findExtraFieldUnicodeComment:function(){var b=this.extraFields[25461];if(b){var c=a(b.value);if(c.readInt(1)!==1)return null;return d(this.fileComment)!==c.readInt(4)?null:e.utf8decode(c.readData(b.length-5))}return null}};Hb.exports=k}var Jb=!1;function Kb(){Jb||(Jb=!0,Ib());return Hb.exports}f={};var Lb={exports:f};function Mb(){var a=Gb(),b=E(),c=Sa(),d=Kb();K();var e=o();function f(a){this.files=[],this.loadOptions=a}f.prototype={checkSignature:function(a){if(!this.reader.readAndCheckSignature(a)){this.reader.index-=4;var c=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+b.pretty(c)+", expected "+b.pretty(a)+")")}},isSignature:function(a,b){var c=this.reader.index;this.reader.setIndex(a);a=this.reader.readString(4);a=a===b;this.reader.setIndex(c);return a},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2);this.diskWithCentralDirStart=this.reader.readInt(2);this.centralDirRecordsOnThisDisk=this.reader.readInt(2);this.centralDirRecords=this.reader.readInt(2);this.centralDirSize=this.reader.readInt(4);this.centralDirOffset=this.reader.readInt(4);this.zipCommentLength=this.reader.readInt(2);var a=this.reader.readData(this.zipCommentLength),c=e.uint8array?"uint8array":"array";c=b.transformTo(c,a);this.zipComment=this.loadOptions.decodeFileName(c)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8);this.reader.skip(4);this.diskNumber=this.reader.readInt(4);this.diskWithCentralDirStart=this.reader.readInt(4);this.centralDirRecordsOnThisDisk=this.reader.readInt(8);this.centralDirRecords=this.reader.readInt(8);this.centralDirSize=this.reader.readInt(8);this.centralDirOffset=this.reader.readInt(8);this.zip64ExtensibleData={};var a=this.zip64EndOfCentralSize-44,b=0,c,d,e;while(b<a)c=this.reader.readInt(2),d=this.reader.readInt(4),e=this.reader.readData(d),this.zip64ExtensibleData[c]={id:c,length:d,value:e}},readBlockZip64EndOfCentralLocator:function(){this.diskWithZip64CentralDirStart=this.reader.readInt(4);this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8);this.disksCount=this.reader.readInt(4);if(this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var a,b;for(a=0;a<this.files.length;a++)b=this.files[a],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(c.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var a;this.reader.setIndex(this.centralDirOffset);while(this.reader.readAndCheckSignature(c.CENTRAL_FILE_HEADER))a=new d({zip64:this.zip64},this.loadOptions),a.readCentralPart(this.reader),this.files.push(a);if(this.centralDirRecords!==this.files.length&&(this.centralDirRecords!==0&&this.files.length===0))throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var a=this.reader.lastIndexOfSignature(c.CENTRAL_DIRECTORY_END);if(a<0){var d=!this.isSignature(0,c.LOCAL_FILE_HEADER);if(d)throw new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");else throw new Error("Corrupted zip: can't find end of central directory")}this.reader.setIndex(a);d=a;this.checkSignature(c.CENTRAL_DIRECTORY_END);this.readBlockEndOfCentral();if(this.diskNumber===b.MAX_VALUE_16BITS||this.diskWithCentralDirStart===b.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===b.MAX_VALUE_16BITS||this.centralDirRecords===b.MAX_VALUE_16BITS||this.centralDirSize===b.MAX_VALUE_32BITS||this.centralDirOffset===b.MAX_VALUE_32BITS){this.zip64=!0;a=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR);if(a<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");this.reader.setIndex(a);this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_LOCATOR);this.readBlockZip64EndOfCentralLocator();if(!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,c.ZIP64_CENTRAL_DIRECTORY_END)){this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(c.ZIP64_CENTRAL_DIRECTORY_END);if(this.relativeOffsetEndOfZip64CentralDir<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory")}this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir);this.checkSignature(c.ZIP64_CENTRAL_DIRECTORY_END);this.readBlockZip64EndOfCentral()}a=this.centralDirOffset+this.centralDirSize;this.zip64&&(a+=20,a+=12+this.zip64EndOfCentralSize);a=d-a;if(a>0)this.isSignature(d,c.CENTRAL_FILE_HEADER)||(this.reader.zero=a);else if(a<0)throw new Error("Corrupted zip: missing "+Math.abs(a)+" bytes.")},prepareReader:function(b){this.reader=a(b)},load:function(a){this.prepareReader(a),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}};Lb.exports=f}var Nb=!1;function Ob(){Nb||(Nb=!0,Mb());return Lb.exports}b={};var Pb={exports:b};function Qb(){var a=E(),b=B(),c=K(),a=E(),d=Ob(),e=za(),f=x();function g(a){return new b.Promise(function(b,c){var d=a.decompressed.getContentWorker().pipe(new e());d.on("error",function(a){c(a)}).on("end",function(){d.streamInfo.crc32!==a.decompressed.crc32?c(new Error("Corrupted zip : CRC32 mismatch")):b()}).resume()})}Pb.exports=function(e,h){var i=this;h=a.extend(h||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:c.utf8decode});return f.isNode&&f.isStream(e)?b.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",e,!0,h.optimizedBinaryString,h.base64).then(function(a){var b=new d(h);b.load(a);return b}).then(function(a){var c=[b.Promise.resolve(a)];a=a.files;if(h.checkCRC32)for(var d=0;d<a.length;d++)c.push(g(a[d]));return b.Promise.all(c)}).then(function(a){a=a.shift();var b=a.files;for(var c=0;c<b.length;c++){var d=b[c];i.file(d.fileNameStr,d.decompressed,{binary:!0,optimizedBinaryString:!0,date:d.date,dir:d.dir,comment:d.fileCommentStr.length?d.fileCommentStr:null,unixPermissions:d.unixPermissions,dosPermissions:d.dosPermissions,createFolders:h.createFolders})}a.zipComment.length&&(i.comment=a.zipComment);return i})}}var Rb=!1;function Sb(){Rb||(Rb=!0,Qb());return Pb.exports}c={};var Tb={exports:c};function Ub(){function a(){if(!(this instanceof a))return new a();if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={};this.comment=null;this.root="";this.clone=function(){var b=new a();for(var c in this)typeof this[c]!=="function"&&(b[c]=this[c]);return b}}a.prototype=ib();a.prototype.loadAsync=Sb();a.support=o();a.defaults=U();a.version="3.2.0";a.loadAsync=function(b,c){return new a().loadAsync(b,c)};a.external=B();Tb.exports=a}var Vb=!1;function Wb(){Vb||(Vb=!0,Ub());return Tb.exports}function a(a){switch(a){case void 0:return Wb()}}e.exports=a}),null);
__d("jszip",["jszip-3.2.0"],(function(a,b,c,d,e,f){e.exports=b("jszip-3.2.0")()}),null);
/**
 * License: https://www.facebook.com/legal/license/CCT5pM3qiNk/
 */
__d("tweetnacl-auth-1.0.1",["tweetnacl-1.0.3"],(function(a,b,c,d,e,f){"use strict";var g=b("tweetnacl-1.0.3");c={};var h={exports:c};function i(){(function(a,b){typeof h!=="undefined"&&h.exports?h.exports=b(g()):a.nacl.auth=b(a.nacl)})(this,function(a){if(!a)throw new Error("tweetnacl not loaded");var b=128,c=64;function d(d,e){var f=new Uint8Array(b+Math.max(c,d.length)),g;e.length>b&&(e=a.hash(e));for(g=0;g<b;g++)f[g]=54;for(g=0;g<e.length;g++)f[g]^=e[g];f.set(d,b);d=a.hash(f.subarray(0,b+d.length));for(g=0;g<b;g++)f[g]=92;for(g=0;g<e.length;g++)f[g]^=e[g];f.set(d,b);return a.hash(f.subarray(0,b+d.length))}function e(a,b){var c=new Uint8Array(32);c.set(d(a,b).subarray(0,32));return c}e.full=function(a,b){return d(a,b)};e.authLength=32;e.authFullLength=64;e.keyLength=32;return e})}var j=!1;function k(){j||(j=!0,i());return h.exports}function a(a){switch(a){case void 0:return k()}}e.exports=a}),null);
__d("tweetnacl-auth",["tweetnacl-auth-1.0.1"],(function(a,b,c,d,e,f){e.exports=b("tweetnacl-auth-1.0.1")()}),null);/*FB_PKG_DELIM*/
__d("BaseToastContentWrapper.react",["BaseTheme.react","BaseView.react","Dsp2BaseThemeContext.react","Dsp2BaseThemeGated.react","XPlatReactFocusRegion.react","basePushToast","focusScopeQueries","react","useCurrentDisplayMode"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useContext,k={dark:"__fb-dark-mode ",light:"__fb-light-mode ",type:"CLASSNAMES"};function a(a){var b=a.ariaLabelledBy,e=a.children,f=a.ref,g=a.role,h=a.testid;h=a.themeConfig;var l=a.useInvertedDisplayMode;a=a.xstyle;var m=c("useCurrentDisplayMode")();m=m==="dark"?"light":"dark";var n=j(c("Dsp2BaseThemeContext.react"));l=l?c("Dsp2BaseThemeGated.react")?i.jsx(c("Dsp2BaseThemeGated.react"),{"aria-labelledby":b,displayMode:m,ref:f,role:g,testid:void 0,themes:n,xstyle:a,children:e}):i.jsx(c("BaseTheme.react"),{"aria-labelledby":b,config:h!=null?h:k,displayMode:m,ref:f,role:g,testid:void 0,xstyle:a,children:e}):i.jsx(c("BaseView.react"),{"aria-labelledby":b,ref:f,role:g,testid:void 0,xstyle:a,children:e});return d("basePushToast").passesNewToastAPIGK()?i.jsx(c("XPlatReactFocusRegion.react"),{containFocusQuery:d("focusScopeQueries").tabbableScopeQuery,children:l}):l}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("BaseToast.react",["BaseInlinePressable.react","BaseToastContentWrapper.react","BaseView.react","XPlatReactFocusRegion.react","basePushToast","focusScopeQueries","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useId,k=b.useMemo,l={item:{display:"x78zum5",flexDirection:"xdt5ytf",paddingBottom:"x19yoh24",paddingInlineStart:"xa6w9w1",paddingInlineEnd:"x7jv1k3",paddingLeft:null,paddingRight:null,paddingTop:"x6enp1t",$$css:!0},itemText:{flexGrow:"x1iyjqo2",$$css:!0},link:{wordBreak:"xdnwjd9",$$css:!0},root:{alignItems:"x6s0dn4",backgroundColor:"x1wkzo03",borderTopColor:"xlnzwam",borderInlineEndColor:"xuc4ihs",borderBottomColor:"xm9qwu6",borderInlineStartColor:"x38i1re",borderStartStartRadius:"x1ghonvh",borderStartEndRadius:"x1c2sbsd",borderEndEndRadius:"x8tb1rc",borderEndStartRadius:"x609f4j",borderTopStyle:"xhf2mca",borderInlineEndStyle:"xaau5u0",borderBottomStyle:"x13y0ya8",borderInlineStartStyle:"xv6865q",borderTopWidth:"xmqxc35",borderInlineEndWidth:"x1a32di2",borderBottomWidth:"x21fg80",borderInlineStartWidth:"xyi7q43",boxShadow:"xi1c1fh",display:"x78zum5",flexShrink:"x2lah0s",maxWidth:"x1cs6qxi",minWidth:"x1hqenl9",paddingTop:"x192rfv7",paddingBottom:"x13jxccy",paddingInlineStart:"x1rcnc7e",paddingInlineEnd:"x1e7pf15",paddingLeft:null,paddingRight:null,$$css:!0},rootDense:{minWidth:"xktpd3l",$$css:!0},rootFullWidth:{width:"xh8yej3",$$css:!0}};function a(a){var b,e,f=a.action,g=a.addOnStart,h=a.closeButton,m=a.density,n=a.linkWrapper,o=a.message,p=a.offsetStyles,q=a.onDismiss,r=a.size;r=r===void 0?"full-width":r;var s=a.testid;s=a.themeConfigOverride;var t=a.toastRef,u=a.useInvertedDisplayMode;u=u===void 0?!0:u;a=a.variant;var v=j(),w=k(function(){return f!=null?{}:{"aria-atomic":!0,role:"alert"}},[f]);b=f!=null?i.jsx(c("BaseView.react"),{xstyle:[l.item,a==null?void 0:(b=a.xstyleConfig)==null?void 0:b.item],children:f.element!=null?f.element:f.labelRenderer&&i.jsx(c("BaseInlinePressable.react"),{onPress:function(a){q(),f.onPress(a)},testid:void 0,xstyle:l.link,children:f.labelRenderer(f.label)})}):null;e=i.jsxs(i.Fragment,{children:[g!=null&&i.jsx(c("BaseView.react"),{xstyle:[l.item,a==null?void 0:(e=a.xstyleConfig)==null?void 0:e.item],children:g}),i.jsx(c("BaseView.react"),babelHelpers["extends"]({xstyle:[l.item,l.itemText,a==null?void 0:(e=a.xstyleConfig)==null?void 0:e.item]},w,{children:o({toastMessageId:v})})),b!=null&&(d("basePushToast").passesNewToastAPIGK()?b:i.jsx(c("XPlatReactFocusRegion.react"),{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,children:b})),Boolean(h)&&i.jsx(c("BaseView.react"),{xstyle:[l.item,a==null?void 0:(g=a.xstyleConfig)==null?void 0:g.item],children:h})]});e=n!=null?n(e):e;return i.jsx(c("BaseToastContentWrapper.react"),{ariaLabelledBy:f!=null&&d("basePushToast").passesNewToastAPIGK?v:void 0,ref:t,role:d("basePushToast").passesNewToastAPIGK()&&(f!=null||Boolean(h))?"dialog":void 0,testid:void 0,themeConfig:s,useInvertedDisplayMode:u,xstyle:[l.root,r==="full-width"&&l.rootFullWidth,m==="dense"&&l.rootDense,p,a==null?void 0:(w=a.xstyleConfig)==null?void 0:w.container],children:e})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("CacheStorage",["ErrorGuard","ExecutionEnvironment","WebStorage","cr:6943","cr:8958","emptyFunction","err"],(function(a,b,c,d,e,f,g){var h,i,j,k="_@_",l="3b",m="CacheStorageVersion",n={length:0,getItem:a=c("emptyFunction"),setItem:a,clear:a,removeItem:a,key:a};d=function(){function a(a){this._store=a}var b=a.prototype;b.getStore=function(){return this._store};b.keys=function(){var a=[];for(var b=0;b<this._store.length;b++){var c=this._store.key(b);c!=null&&a.push(c)}return a};b.get=function(a){return this._store.getItem(a)};b.set=function(a,b){this._store.setItem(a,b)};b.remove=function(a){this._store.removeItem(a)};b.clear=function(){this._store.clear()};b.clearWithPrefix=function(a){a=a||"";var b=this.keys();for(var c=0;c<b.length;c++){var d=b[c];d!=null&&d.startsWith(a)&&this.remove(d)}};return a}();e=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;return a.call(this,(b=(h||(h=c("WebStorage"))).getLocalStorage())!=null?b:n)||this}b.available=function(){return!!(h||(h=c("WebStorage"))).getLocalStorage()};return b}(d);g=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b;return a.call(this,(b=(h||(h=c("WebStorage"))).getSessionStorage())!=null?b:n)||this}b.available=function(){return!!(h||(h=c("WebStorage"))).getSessionStorage()};return b}(d);var o=function(){function a(){this._store={}}var b=a.prototype;b.getStore=function(){return this._store};b.keys=function(){return Object.keys(this._store)};b.get=function(a){return this._store[a]===void 0?null:this._store[a]};b.set=function(a,b){this._store[a]=b};b.remove=function(a){a in this._store&&delete this._store[a]};b.clear=function(){this._store={}};b.clearWithPrefix=function(a){a=a||"";var b=this.keys();for(var c=0;c<b.length;c++){var d=b[c];d.startsWith(a)&&this.remove(d)}};a.available=function(){return!0};return a}(),p={memory:o,localstorage:e,sessionstorage:g};a=function(){function a(a,d){this._changeCallbacks=[];this._key_prefix="_cs_";this._exception=null;d&&(this._key_prefix=d);a==="AUTO"||!a?d="memory":d=a;d&&(!p[d]||!p[d].available()?((i||(i=c("ExecutionEnvironment"))).canUseDOM,this._backend=new o()):this._backend=new p[d]());a=this.useBrowserStorage();a&&b("cr:6943").listen(window,"storage",this._onBrowserValueChanged.bind(this));d=a?this._backend.getStore().getItem(m):this._backend.getStore()[m];d!==l&&this.clearOwnKeys()}var d=a.prototype;d.useBrowserStorage=function(){return this._backend.getStore()===(h||(h=c("WebStorage"))).getLocalStorage()||this._backend.getStore()===(h||(h=c("WebStorage"))).getSessionStorage()};d.addValueChangeCallback=function(a){var b=this;this._changeCallbacks.push(a);return{remove:function(){b._changeCallbacks.slice(b._changeCallbacks.indexOf(a),1)}}};d._onBrowserValueChanged=function(a){this._changeCallbacks&&String(a.key).startsWith(this._key_prefix)&&this._changeCallbacks.forEach(function(b){b(a.key,a.oldValue,a.newValue)})};d.keys=function(){var a=this,b=[];(j||(j=c("ErrorGuard"))).guard(function(){if(a._backend){var c=a._backend.keys(),d=a._key_prefix.length;for(var e=0;e<c.length;e++)c[e].substr(0,d)==a._key_prefix&&b.push(c[e].substr(d))}},{name:"CacheStorage"})();return b};d.set=function(d,e,f){if(this._backend){if(this.useBrowserStorage()&&a._persistentWritesDisabled){this._exception=c("err")("writes disabled");return!1}var g;typeof e==="string"?g=k+e:!f?(g={__t:Date.now(),__v:e},g=b("cr:8958").stringify(g)):g=b("cr:8958").stringify(e);f=this._backend;e=this._key_prefix+d;d=!0;var h=null;while(d)try{h=null,f.set(e,g),d=!1}catch(a){h=a;var i=f.keys().length;this._evictCacheEntries();d=f.keys().length<i}if(h!==null){this._exception=h;return!1}else{this._exception=null;return!0}}this._exception=c("err")("no back end");return!1};d.getLastSetExceptionMessage=function(){return this._exception?this._exception.message:null};d.getLastSetException=function(){return this._exception};d.getStorageKeyCount=function(){var a=this._backend;return a?a.keys().length:0};d._evictCacheEntries=function(){var c=[],d=this._backend;d.keys().forEach(function(e){if(e===m)return;var g=d.get(e);if(g===void 0){d.remove(e);return}if(a._hasMagicPrefix(g))return;try{g=b("cr:8958").parse(g,f.id)}catch(a){d.remove(e);return}g&&g.__t!==void 0&&g.__v!==void 0&&c.push([e,g.__t])});c.sort(function(a,b){return a[1]-b[1]});for(var e=0;e<Math.ceil(c.length/2);e++)d.remove(c[e][0])};d.get=function(d,e){var g;if(this._backend){(j||(j=c("ErrorGuard"))).applyWithGuard(function(){g=this._backend.get(this._key_prefix+d)},this,[],{onError:function(){g=null},name:"CacheStorage:get"});if(g!=null)if(a._hasMagicPrefix(g))g=g.substr(k.length);else try{g=b("cr:8958").parse(g,f.id),g&&g.__t!==void 0&&g.__v!==void 0&&(g=g.__v)}catch(a){g=void 0}else g=void 0}g===void 0&&e!==void 0&&(g=e,this.set(d,g));return g};d.remove=function(a){this._backend&&(j||(j=c("ErrorGuard"))).applyWithGuard(this._backend.remove,this._backend,[this._key_prefix+a],{name:"CacheStorage:remove"})};d._setVersion=function(){var a=this;(j||(j=c("ErrorGuard"))).applyWithGuard(function(){a.useBrowserStorage()?a._backend.getStore().setItem(m,l):a._backend.getStore()[m]=l},this,[],{name:"CacheStorage:setVersion"})};d.clear=function(){this._backend&&((j||(j=c("ErrorGuard"))).applyWithGuard(this._backend.clear,this._backend,[],{name:"CacheStorage:clear"}),this._setVersion())};d.clearOwnKeys=function(){this._backend&&((j||(j=c("ErrorGuard"))).applyWithGuard(this._backend.clearWithPrefix,this._backend,[this._key_prefix],{name:"CacheStorage:clearOwnKeys"}),this._setVersion())};a.getAllStorageTypes=function(){return Object.keys(p)};a._hasMagicPrefix=function(a){return a.substr(0,k.length)===k};a.disablePersistentWrites=function(){a._persistentWritesDisabled=!0};return a}();a._persistentWritesDisabled=!1;f.exports=a}),34);
__d("CometFocusTableContext",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext({FocusCell:null,FocusRow:null,FocusTable:null});g["default"]=b}),98);
__d("CometSuspenseFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1828945");b=d("FalcoLoggerInternal").create("comet_suspense",a);e=b;g["default"]=e}),98);
__d("TWriteBuffer",[],(function(a,b,c,d,e,f){a=function(){function a(b){b===void 0&&(b=a.DEFAULT_BYTE_BUFFER_SIZE),this.$1=new DataView(new ArrayBuffer(b)),this.$2=0}var b=a.prototype;b.write=function(a){this.$2+a.length>this.$1.byteLength&&this.$3(this.$2+a.length);for(var b=0;b<a.length;b++)this.$1.setUint8(this.$2+b,a[b]);this.$2+=a.length;return a.length};b.writeByte=function(a){this.$2+1>this.$1.byteLength&&this.$3(this.$2+1);this.$1.setUint8(this.$2,a);this.$2++;return 1};b.writeFloatBE=function(a){this.$2+Float32Array.BYTES_PER_ELEMENT>this.$1.byteLength&&this.$3(this.$2+Float32Array.BYTES_PER_ELEMENT);this.$1.setFloat32(this.$2,a);this.$2+=Float32Array.BYTES_PER_ELEMENT;return Float32Array.BYTES_PER_ELEMENT};b.writeDoubleBE=function(a){this.$2+Float64Array.BYTES_PER_ELEMENT>this.$1.byteLength&&this.$3(this.$2+Float64Array.BYTES_PER_ELEMENT);this.$1.setFloat64(this.$2,a);this.$2+=Float64Array.BYTES_PER_ELEMENT;return Float64Array.BYTES_PER_ELEMENT};b.toByteArray=function(){var a=new Uint8Array(this.$1.buffer,0,this.$2);return a};b.currentSize=function(){return this.$2};b.getUnderlyingDataView=function(){return this.$1};b.$3=function(a){a=a*2;if(!Number.isSafeInteger(a))throw new Error("unable to resize");a=new DataView(new ArrayBuffer(a));for(var b=0;b<this.$2;b++)a.setUint8(b,this.$1.getUint8(b));this.$1=a};b.readByte=function(){throw new Error("operation not supported")};b.readBytes=function(a){throw new Error("operation not supported")};b.readFloatBE=function(){throw new Error("operation not supported")};b.readDoubleBE=function(){throw new Error("operation not supported")};return a}();a.DEFAULT_BYTE_BUFFER_SIZE=16;f["default"]=a}),66);
__d("StringToUtf8",["TWriteBuffer"],(function(a,b,c,d,e,f,g){a=function(a){var b=new(c("TWriteBuffer"))(a.length),d;for(var e=0;e<a.length;e++){d=a.charCodeAt(e);if(d<128)b.writeByte(d);else if(d<2048)b.writeByte(d>>6|192),b.writeByte(d&63|128);else if((d&64512)==55296){if(e+1>=a.length)throw new Error("UTF-16 string is truncated: ["+d.toString(16)+"]");if((a.charCodeAt(e+1)&64512)!==56320)throw new Error("Invalid UTF-16 string: ["+d.toString(16)+", "+a.charCodeAt(e+1).toString(16)+"]");d=65536+((d&1023)<<10)+(a.charCodeAt(++e)&1023);b.writeByte(d>>18|240);b.writeByte(d>>12&63|128);b.writeByte(d>>6&63|128);b.writeByte(d&63|128)}else b.writeByte(d>>12|224),b.writeByte(d>>6&63|128),b.writeByte(d&63|128)}return b.toByteArray()};g.StringToUtf8=a}),98);
__d("ThriftTypes",[],(function(a,b,c,d,e,f){a=Object.freeze({STOP:0,VOID:1,BOOL:2,BYTE:3,I08:3,DOUBLE:4,I16:6,I32:8,I64:10,STRING:11,STRUCT:12,MAP:13,SET:14,LIST:15,FLOAT:19});b=a;f["default"]=b}),66);
__d("Utf8ToString",[],(function(a,b,c,d,e,f){var g=function(a,b){throw new Error(a+": ["+b.map(function(a){return a.toString(16)}).toString()+"]")},h=function(a){g("Invalid UTF-8 sequence",a)},i=function(a,b){g("Not enough bytes for "+a+"-byte sequence",b)};a=function(a){var b=0,c=[];while(b<a.length){var d=a[b++];if(d<128)c.push(String.fromCharCode(d));else if(d>=128&&d<194)h([d]);else if(d>=194&&d<224){b>=a.length&&i(2,[d]);var e=a[b++];(e&192)!==128&&h([d,e]);c.push(String.fromCharCode((d&31)<<6|e&63))}else if(d>=240&&d<245){b+2>=a.length&&i(4,[d]);e=a[b++];var f=a[b++],g=a[b++];(d==240&&(!(e>=144&&e<192)||(f&192)!==128||(g&192)!==128)||d>=241&&d<244&&((e&192)!==128||(f&192)!==128||(g&192)!==128)||d==244&&(!(e>=128&&e<144)||(f&192)!==128||(g&192)!==128))&&h([d,e,f,g]);e=((d&7)<<18|(e&63)<<12|(f&63)<<6|g&63)-65536;c.push(String.fromCharCode(55296+(e>>10)));c.push(String.fromCharCode(56320+(e&1023)))}else if(d>=245)h([d]);else{b+1>=a.length&&i(3,[d]);f=a[b++];g=a[b++];d==224?f>=160&&f<192||h([d,f,g]):d>=225&&d<237?f>=128&&f<192||h([d,f,g]):d==237?f>=128&&f<160||h([d,f,g]):d>=238&&d<240&&(f>=128&&f<192||h([d,f,g]));g>=128&&g<192||h([d,f,g]);c.push(String.fromCharCode((d&15)<<12|(f&63)<<6|g&63))}}return c.join("")};f.Utf8ToString=a}),66);
__d("jsbi",[],(function(a,b,c,d,e,f){(function(a,b){"object"==typeof f&&"undefined"!=typeof e?e.exports=b():"function"==typeof define&&define.amd?define(b):a.JSBI=b()})(this,function(){"use strict";function a(b){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(b)}function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function c(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function d(a,b,d){return b&&c(a.prototype,b),d&&c(a,d),a}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&g(a,b)}function f(a){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},f(a)}function g(a,b){return g=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},g(a,b)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function i(){return i=h()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);b=Function.bind.apply(a,d);a=new b;return c&&g(a,c.prototype),a},i.apply(null,arguments)}function j(a){return-1!==Function.toString.call(a).indexOf("[native code]")}function k(a){var b="function"==typeof Map?new Map:void 0;return k=function(a){function c(){return i(a,arguments,f(this).constructor)}if(null===a||!j(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),g(c,a)},k(a)}function l(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function m(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:l(a)}var n=function(c){var h=Math.abs,i=Math.max,j=Math.imul,k=Math.clz32;function g(a,c){if(b(this,g),a>g.__kMaxLength)throw new RangeError("Maximum BigInt size exceeded");return a=m(this,f(g).call(this,a)),a.sign=c,a}return e(g,c),d(g,[{key:"toDebugString",value:function(){var a=["BigInt["],b=!0,c=!1,d=void 0;try{for(var e,e,f=this[Symbol.iterator]();!(b=(e=f.next()).done);b=!0)e=e.value,a.push((e?(e>>>0).toString(16):e)+", ")}catch(a){c=!0,d=a}finally{try{b||null==f["return"]||f["return"]()}finally{if(c)throw d}}return a.push("]"),a.join("")}},{key:"toString",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;if(2>a||36<a)throw new RangeError("toString() radix argument must be between 2 and 36");return 0===this.length?"0":0==(a&a-1)?g.__toStringBasePowerOfTwo(this,a):g.__toStringGeneric(this,a,!1)}},{key:"__copy",value:function(){for(var a=new g(this.length,this.sign),b=0;b<this.length;b++)a[b]=this[b];return a}},{key:"__trim",value:function(){for(var a=this.length,b=this[a-1];0===b;)a--,b=this[a-1],this.pop();return 0===a&&(this.sign=!1),this}},{key:"__initializeDigits",value:function(){for(var a=0;a<this.length;a++)this[a]=0}},{key:"__clzmsd",value:function(){return k(this[this.length-1])}},{key:"__inplaceMultiplyAdd",value:function(a,b,c){c>this.length&&(c=this.length);for(var d=65535&a,a=a>>>16,e=0,f=65535&b,b=b>>>16,i=0;i<c;i++){var n=this.__digit(i),m=65535&n;n=n>>>16;var o=j(m,d);m=j(m,a);var p=j(n,d);n=j(n,a);var q=f+(65535&o);o=b+e+(q>>>16)+(o>>>16)+(65535&m)+(65535&p);f=(m>>>16)+(p>>>16)+(65535&n)+(o>>>16),e=f>>>16,f&=65535,b=n>>>16;this.__setDigit(i,65535&q|o<<16)}if(0!==e||0!==f||0!==b)throw new Error("implementation bug")}},{key:"__inplaceAdd",value:function(a,b,c){for(var d,e=0,f=0;f<c;f++)d=this.__halfDigit(b+f)+a.__halfDigit(f)+e,e=d>>>16,this.__setHalfDigit(b+f,d);return e}},{key:"__inplaceSub",value:function(a,b,c){var d=0;if(1&b){b>>=1;for(var e=this.__digit(b),f=65535&e,k=0;k<c-1>>>1;k++){var l=a.__digit(k),m=(e>>>16)-(65535&l)-d;d=1&m>>>16,this.__setDigit(b+k,m<<16|65535&f),e=this.__digit(b+k+1),f=(65535&e)-(l>>>16)-d,d=1&f>>>16}m=a.__digit(k);l=(e>>>16)-(65535&m)-d;d=1&l>>>16,this.__setDigit(b+k,l<<16|65535&f);if(b+k+1>=this.length)throw new RangeError("out of bounds");0==(1&c)&&(e=this.__digit(b+k+1),f=(65535&e)-(m>>>16)-d,d=1&f>>>16,this.__setDigit(b+a.length,4294901760&e|65535&f))}else{b>>=1;for(l=0;l<a.length-1;l++){k=this.__digit(b+l);m=a.__digit(l);e=(65535&k)-(65535&m)-d;d=1&e>>>16;f=(k>>>16)-(m>>>16)-d;d=1&f>>>16,this.__setDigit(b+l,f<<16|65535&e)}k=this.__digit(b+l);m=a.__digit(l);f=(65535&k)-(65535&m)-d;d=1&f>>>16;e=0;0==(1&c)&&(e=(k>>>16)-(m>>>16)-d,d=1&e>>>16),this.__setDigit(b+l,e<<16|65535&f)}return d}},{key:"__inplaceRightShift",value:function(a){if(0!==a){for(var b,c=this.__digit(0)>>>a,d=this.length-1,e=0;e<d;e++)b=this.__digit(e+1),this.__setDigit(e,b<<32-a|c),c=b>>>a;this.__setDigit(d,c)}}},{key:"__digit",value:function(a){return this[a]}},{key:"__unsignedDigit",value:function(a){return this[a]>>>0}},{key:"__setDigit",value:function(a,b){this[a]=0|b}},{key:"__setDigitGrow",value:function(a,b){this[a]=0|b}},{key:"__halfDigitLength",value:function(){var a=this.length;return 65535>=this.__unsignedDigit(a-1)?2*a-1:2*a}},{key:"__halfDigit",value:function(a){return 65535&this[a>>>1]>>>((1&a)<<4)}},{key:"__setHalfDigit",value:function(a,b){var c=a>>>1,d=this.__digit(c);a=1&a?65535&d|b<<16:4294901760&d|65535&b;this.__setDigit(c,a)}}],[{key:"BigInt",value:function(b){var c=Math.floor,d=Number.isFinite;if("number"==typeof b){if(0===b)return g.__zero();if((0|b)===b)return 0>b?g.__oneDigit(-b,!0):g.__oneDigit(b,!1);if(!d(b)||c(b)!==b)throw new RangeError("The number "+b+" cannot be converted to BigInt because it is not an integer");return g.__fromDouble(b)}if("string"==typeof b){d=g.__fromString(b);if(null===d)throw new SyntaxError("Cannot convert "+b+" to a BigInt");return d}if("boolean"==typeof b)return!0===b?g.__oneDigit(1,!1):g.__zero();if("object"===a(b)){if(b.constructor===g)return b;c=g.__toPrimitive(b);return g.BigInt(c)}throw new TypeError("Cannot convert "+b+" to a BigInt")}},{key:"toNumber",value:function(a){var b=a.length;if(0===b)return 0;if(1===b){var c=a.__unsignedDigit(0);return a.sign?-c:c}c=a.__digit(b-1);var d=k(c),e=32*b-d;if(1024<e)return a.sign?-Infinity:1/0;e=e-1;c=c;b=b-1;d=d+1;var f=32===d?0:c<<d;f>>>=12;var h=d-12,i=12<=d?0:c<<20+d;d=20+d;0<h&&0<b&&(b--,c=a.__digit(b),f|=c>>>32-h,i=c<<h,d=h),0<d&&0<b&&(b--,c=a.__digit(b),i|=c>>>32-d,d-=32);h=g.__decideRounding(a,d,b,c);if((1===h||0===h&&1==(1&i))&&(i=i+1>>>0,0===i&&(f++,0!=f>>>20&&(f=0,e++,1023<e))))return a.sign?-Infinity:1/0;d=a.sign?-2147483648:0;return e=e+1023<<20,g.__kBitConversionInts[1]=d|e|f,g.__kBitConversionInts[0]=i,g.__kBitConversionDouble[0]}},{key:"unaryMinus",value:function(a){if(0===a.length)return a;var b=a.__copy();return b.sign=!a.sign,b}},{key:"bitwiseNot",value:function(a){return a.sign?g.__absoluteSubOne(a).__trim():g.__absoluteAddOne(a,!0)}},{key:"exponentiate",value:function(a,b){if(b.sign)throw new RangeError("Exponent must be positive");if(0===b.length)return g.__oneDigit(1,!1);if(0===a.length)return a;if(1===a.length&&1===a.__digit(0))return a.sign&&0==(1&b.__digit(0))?g.unaryMinus(a):a;if(1<b.length)throw new RangeError("BigInt too big");b=b.__unsignedDigit(0);if(1===b)return a;if(b>=g.__kMaxLengthBits)throw new RangeError("BigInt too big");if(1===a.length&&2===a.__digit(0)){var c=1+(b>>>5),d=a.sign&&0!=(1&b);d=new g(c,d);d.__initializeDigits();var e=1<<(31&b);return d.__setDigit(c-1,e),d}c=null;e=a;for(0!=(1&b)&&(c=a),b>>=1;0!==b;b>>=1)e=g.multiply(e,e),0!=(1&b)&&(null===c?c=e:c=g.multiply(c,e));return c}},{key:"multiply",value:function(a,b){if(0===a.length)return a;if(0===b.length)return b;var c=a.length+b.length;32<=a.__clzmsd()+b.__clzmsd()&&c--;c=new g(c,a.sign!==b.sign);c.__initializeDigits();for(var d=0;d<a.length;d++)g.__multiplyAccumulate(b,a.__digit(d),c,d);return c.__trim()}},{key:"divide",value:function(a,b){if(0===b.length)throw new RangeError("Division by zero");if(0>g.__absoluteCompare(a,b))return g.__zero();var c=a.sign!==b.sign,d=b.__unsignedDigit(0);if(1===b.length&&65535>=d){if(1===d)return c===a.sign?a:g.unaryMinus(a);d=g.__absoluteDivSmall(a,d,null)}else d=g.__absoluteDivLarge(a,b,!0,!1);return d.sign=c,d.__trim()}},{key:"remainder",value:function(a,b){if(0===b.length)throw new RangeError("Division by zero");if(0>g.__absoluteCompare(a,b))return a;var c=b.__unsignedDigit(0);if(1===b.length&&65535>=c){if(1===c)return g.__zero();c=g.__absoluteModSmall(a,c);return 0===c?g.__zero():g.__oneDigit(c,a.sign)}c=g.__absoluteDivLarge(a,b,!1,!0);return c.sign=a.sign,c.__trim()}},{key:"add",value:function(a,b){var c=a.sign;return c===b.sign?g.__absoluteAdd(a,b,c):0<=g.__absoluteCompare(a,b)?g.__absoluteSub(a,b,c):g.__absoluteSub(b,a,!c)}},{key:"subtract",value:function(a,b){var c=a.sign;return c===b.sign?0<=g.__absoluteCompare(a,b)?g.__absoluteSub(a,b,c):g.__absoluteSub(b,a,!c):g.__absoluteAdd(a,b,c)}},{key:"leftShift",value:function(a,b){return 0===b.length||0===a.length?a:b.sign?g.__rightShiftByAbsolute(a,b):g.__leftShiftByAbsolute(a,b)}},{key:"signedRightShift",value:function(a,b){return 0===b.length||0===a.length?a:b.sign?g.__leftShiftByAbsolute(a,b):g.__rightShiftByAbsolute(a,b)}},{key:"unsignedRightShift",value:function(){throw new TypeError("BigInts have no unsigned right shift; use >> instead")}},{key:"lessThan",value:function(a,b){return 0>g.__compareToBigInt(a,b)}},{key:"lessThanOrEqual",value:function(a,b){return 0>=g.__compareToBigInt(a,b)}},{key:"greaterThan",value:function(a,b){return 0<g.__compareToBigInt(a,b)}},{key:"greaterThanOrEqual",value:function(a,b){return 0<=g.__compareToBigInt(a,b)}},{key:"equal",value:function(a,b){if(a.sign!==b.sign)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a.__digit(c)!==b.__digit(c))return!1;return!0}},{key:"notEqual",value:function(a,b){return!g.equal(a,b)}},{key:"bitwiseAnd",value:function(a,b){if(!a.sign&&!b.sign)return g.__absoluteAnd(a,b).__trim();if(a.sign&&b.sign){var c=i(a.length,b.length)+1;c=g.__absoluteSubOne(a,c);var d=g.__absoluteSubOne(b);return c=g.__absoluteOr(c,d,c),g.__absoluteAddOne(c,!0,c).__trim()}if(a.sign){d=[b,a];a=d[0],b=d[1]}return g.__absoluteAndNot(a,g.__absoluteSubOne(b)).__trim()}},{key:"bitwiseXor",value:function(a,b){if(!a.sign&&!b.sign)return g.__absoluteXor(a,b).__trim();if(a.sign&&b.sign){var c=i(a.length,b.length);c=g.__absoluteSubOne(a,c);var d=g.__absoluteSubOne(b);return g.__absoluteXor(c,d,c).__trim()}d=i(a.length,b.length)+1;if(a.sign){c=[b,a];a=c[0],b=c[1]}c=g.__absoluteSubOne(b,d);return c=g.__absoluteXor(c,a,c),g.__absoluteAddOne(c,!0,c).__trim()}},{key:"bitwiseOr",value:function(a,b){var c=i(a.length,b.length);if(!a.sign&&!b.sign)return g.__absoluteOr(a,b).__trim();if(a.sign&&b.sign){var d=g.__absoluteSubOne(a,c),e=g.__absoluteSubOne(b);return d=g.__absoluteAnd(d,e,d),g.__absoluteAddOne(d,!0,d).__trim()}if(a.sign){e=[b,a];a=e[0],b=e[1]}d=g.__absoluteSubOne(b,c);return d=g.__absoluteAndNot(d,a,d),g.__absoluteAddOne(d,!0,d).__trim()}},{key:"asIntN",value:function(a,b){if(0===b.length)return b;if(0===a)return g.__zero();if(a>=g.__kMaxLengthBits)return b;var c=a+31>>>5;if(b.length<c)return b;var d=b.__unsignedDigit(c-1),e=1<<(31&a-1);if(b.length===c&&d<e)return b;if(!((d&e)===e))return g.__truncateToNBits(a,b);if(!b.sign)return g.__truncateAndSubFromPowerOfTwo(a,b,!0);if(0==(d&e-1)){for(var f=c-2;0<=f;f--)if(0!==b.__digit(f))return g.__truncateAndSubFromPowerOfTwo(a,b,!1);return b.length===c&&d===e?b:g.__truncateToNBits(a,b)}return g.__truncateAndSubFromPowerOfTwo(a,b,!1)}},{key:"asUintN",value:function(a,b){if(0===b.length)return b;if(0===a)return g.__zero();if(b.sign){if(a>g.__kMaxLengthBits)throw new RangeError("BigInt too big");return g.__truncateAndSubFromPowerOfTwo(a,b,!1)}if(a>=g.__kMaxLengthBits)return b;var c=a+31>>>5;if(b.length<c)return b;var d=31&a;if(b.length==c){if(0==d)return b;c=b.__digit(c-1);if(0==c>>>d)return b}return g.__truncateToNBits(a,b)}},{key:"ADD",value:function(a,b){if(a=g.__toPrimitive(a),b=g.__toPrimitive(b),"string"==typeof a)return"string"!=typeof b&&(b=b.toString()),a+b;if("string"==typeof b)return a.toString()+b;if(a=g.__toNumeric(a),b=g.__toNumeric(b),g.__isBigInt(a)&&g.__isBigInt(b))return g.add(a,b);if("number"==typeof a&&"number"==typeof b)return a+b;throw new TypeError("Cannot mix BigInt and other types, use explicit conversions")}},{key:"LT",value:function(a,b){return g.__compare(a,b,0)}},{key:"LE",value:function(a,b){return g.__compare(a,b,1)}},{key:"GT",value:function(a,b){return g.__compare(a,b,2)}},{key:"GE",value:function(a,b){return g.__compare(a,b,3)}},{key:"EQ",value:function(b,c){for(;;){if(g.__isBigInt(b))return g.__isBigInt(c)?g.equal(b,c):g.EQ(c,b);if("number"==typeof b){if(g.__isBigInt(c))return g.__equalToNumber(c,b);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("string"==typeof b){if(g.__isBigInt(c))return b=g.__fromString(b),null!==b&&g.equal(b,c);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("boolean"==typeof b){if(g.__isBigInt(c))return g.__equalToNumber(c,+b);if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("symbol"===a(b)){if(g.__isBigInt(c))return!1;if("object"!==a(c))return b==c;c=g.__toPrimitive(c)}else if("object"===a(b)){if("object"===a(c)&&c.constructor!==g)return b==c;b=g.__toPrimitive(b)}else return b==c}}},{key:"NE",value:function(a,b){return!g.EQ(a,b)}},{key:"__zero",value:function(){return new g(0,!1)}},{key:"__oneDigit",value:function(a,b){b=new g(1,b);return b.__setDigit(0,a),b}},{key:"__decideRounding",value:function(a,b,c,d){if(0<b)return-1;if(0>b)b=-b-1;else{if(0===c)return-1;c--,d=a.__digit(c),b=31}b=1<<b;if(0==(d&b))return-1;if(b-=1,0!=(d&b))return 1;for(;0<c;)if(c--,0!==a.__digit(c))return 1;return 0}},{key:"__fromDouble",value:function(a){g.__kBitConversionDouble[0]=a;var b,c=2047&g.__kBitConversionInts[1]>>>20;c=c-1023;var d=(c>>>5)+1;a=new g(d,0>a);var e=1048575&g.__kBitConversionInts[1]|1048576,f=g.__kBitConversionInts[0],k=20;c=31&c;var n=0;if(c<k){var m=k-c;n=m+32,b=e>>>m,e=e<<32-m|f>>>m,f<<=32-m}else if(c===k)n=32,b=e,e=f;else{m=c-k;n=32-m,b=e<<m|f>>>32-m,e=f<<m}a.__setDigit(d-1,b);for(c=d-2;0<=c;c--)0<n?(n-=32,b=e,e=f):b=0,a.__setDigit(c,b);return a.__trim()}},{key:"__isWhitespace",value:function(a){return!!(13>=a&&9<=a)||(159>=a?32==a:131071>=a?160==a||5760==a:196607>=a?(a&=131071,10>=a||40==a||41==a||47==a||95==a||4096==a):65279==a)}},{key:"__fromString",value:function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,c=0,d=a.length,e=0;if(e===d)return g.__zero();for(var f=a.charCodeAt(e);g.__isWhitespace(f);){if(++e===d)return g.__zero();f=a.charCodeAt(e)}if(43===f){if(++e===d)return null;f=a.charCodeAt(e),c=1}else if(45===f){if(++e===d)return null;f=a.charCodeAt(e),c=-1}if(0===b){if(b=10,48===f){if(++e===d)return g.__zero();if(f=a.charCodeAt(e),88===f||120===f){if(b=16,++e===d)return null;f=a.charCodeAt(e)}else if(79===f||111===f){if(b=8,++e===d)return null;f=a.charCodeAt(e)}else if(66===f||98===f){if(b=2,++e===d)return null;f=a.charCodeAt(e)}}}else if(16===b&&48===f){if(++e===d)return g.__zero();if(f=a.charCodeAt(e),88===f||120===f){if(++e===d)return null;f=a.charCodeAt(e)}}for(;48===f;){if(++e===d)return g.__zero();f=a.charCodeAt(e)}var m=d-e,i=g.__kMaxBitsPerChar[b],j=g.__kBitsPerCharTableMultiplier-1;if(m>1073741824/i)return null;var k=i*m+j>>>g.__kBitsPerCharTableShift,l=new g(k+31>>>5,!1),n=10>b?b:10,o=10<b?b-10:0;if(0==(b&b-1)){i>>=g.__kBitsPerCharTableShift;var p=[],q=[],r=!1;do{for(var s,t=0,u=0;;){if(void 0,f-48>>>0<n)s=f-48;else if((32|f)-97>>>0<o)s=(32|f)-87;else{r=!0;break}if(u+=i,t=t<<i|s,++e===d){r=!0;break}if(f=a.charCodeAt(e),32<u+i)break}p.push(t),q.push(u)}while(!r);g.__fillFromParts(l,p,q)}else{l.__initializeDigits();var v=!1,w=0;do{for(var x,y=0,z=1;;){if(void 0,f-48>>>0<n)x=f-48;else if((32|f)-97>>>0<o)x=(32|f)-87;else{v=!0;break}var A=z*b;if(4294967295<A)break;if(z=A,y=y*b+x,w++,++e===d){v=!0;break}f=a.charCodeAt(e)}j=32*g.__kBitsPerCharTableMultiplier-1;var B=i*w+j>>>g.__kBitsPerCharTableShift+5;l.__inplaceMultiplyAdd(z,y,B)}while(!v)}if(e!==d){if(!g.__isWhitespace(f))return null;for(e++;e<d;e++)if(f=a.charCodeAt(e),!g.__isWhitespace(f))return null}return 0!==c&&10!==b?null:(l.sign=-1===c,l.__trim())}},{key:"__fillFromParts",value:function(a,b,c){for(var d=0,e=0,f=0,k=b.length-1;0<=k;k--){var l=b[k],m=c[k];e|=l<<f,f+=m,32===f?(a.__setDigit(d++,e),f=0,e=0):32<f&&(a.__setDigit(d++,e),f-=32,e=l>>>m-f)}if(0!==e){if(d>=a.length)throw new Error("implementation bug");a.__setDigit(d++,e)}for(;d<a.length;d++)a.__setDigit(d,0)}},{key:"__toStringBasePowerOfTwo",value:function(a,b){var c=a.length,d=b-1;d=(85&d>>>1)+(85&d),d=(51&d>>>2)+(51&d),d=(15&d>>>4)+(15&d);d=d;b=b-1;var e=a.__digit(c-1),f=k(e);f=0|(32*c-f+d-1)/d;if(a.sign&&f++,268435456<f)throw new Error("string too long");for(var h=Array(f),f=f-1,l=0,n=0,o=0;o<c-1;o++){var p=a.__digit(o),q=(l|p<<n)&b;h[f--]=g.__kConversionChars[q];q=d-n;for(l=p>>>q,n=32-q;n>=d;)h[f--]=g.__kConversionChars[l&b],l>>>=d,n-=d}p=(l|e<<n)&b;for(h[f--]=g.__kConversionChars[p],l=e>>>d-n;0!==l;)h[f--]=g.__kConversionChars[l&b],l>>>=d;if(a.sign&&(h[f--]="-"),-1!==f)throw new Error("implementation bug");return h.join("")}},{key:"__toStringGeneric",value:function(a,b,c){var d=a.length;if(0===d)return"";if(1===d){var e=a.__unsignedDigit(0).toString(b);return!1===c&&a.sign&&(e="-"+e),e}e=32*d-k(a.__digit(d-1));d=g.__kMaxBitsPerChar[b];d=d-1;e=e*g.__kBitsPerCharTableMultiplier;e+=d-1,e=0|e/d;var f;d=e+1>>1;e=g.exponentiate(g.__oneDigit(b,!1),g.__oneDigit(d,!1));var h=e.__unsignedDigit(0);if(1===e.length&&65535>=h){f=new g(a.length,!1),f.__initializeDigits();for(var i,j=0,l=2*a.length-1;0<=l;l--)i=j<<16|a.__halfDigit(l),f.__setHalfDigit(l,0|i/h),j=0|i%h;i=j.toString(b)}else{h=g.__absoluteDivLarge(a,e,!0,!0);f=h.quotient;l=h.remainder.__trim();i=g.__toStringGeneric(l,b,!0)}f.__trim();for(j=g.__toStringGeneric(f,b,!0);i.length<d;)i="0"+i;return!1===c&&a.sign&&(j="-"+j),j+i}},{key:"__unequalSign",value:function(a){return a?-1:1}},{key:"__absoluteGreater",value:function(a){return a?-1:1}},{key:"__absoluteLess",value:function(a){return a?1:-1}},{key:"__compareToBigInt",value:function(a,b){var c=a.sign;if(c!==b.sign)return g.__unequalSign(c);a=g.__absoluteCompare(a,b);return 0<a?g.__absoluteGreater(c):0>a?g.__absoluteLess(c):0}},{key:"__compareToNumber",value:function(a,b){if(!0|b){var c=a.sign,d=0>b;if(c!==d)return g.__unequalSign(c);if(0===a.length){if(d)throw new Error("implementation bug");return 0===b?0:-1}if(1<a.length)return g.__absoluteGreater(c);d=h(b);var e=a.__unsignedDigit(0);return e>d?g.__absoluteGreater(c):e<d?g.__absoluteLess(c):0}return g.__compareToDouble(a,b)}},{key:"__compareToDouble",value:function(a,b){if(b!==b)return b;if(b===1/0)return-1;if(b===-Infinity)return 1;var c=a.sign;if(c!==0>b)return g.__unequalSign(c);if(0===b)throw new Error("implementation bug: should be handled elsewhere");if(0===a.length)return-1;g.__kBitConversionDouble[0]=b;b=2047&g.__kBitConversionInts[1]>>>20;if(2047==b)throw new Error("implementation bug: handled elsewhere");b=b-1023;if(0>b)return g.__absoluteGreater(c);var d=a.length,e=a.__digit(d-1),f=k(e),l=32*d-f;b=b+1;if(l<b)return g.__absoluteLess(c);if(l>b)return g.__absoluteGreater(c);b=1048576|1048575&g.__kBitConversionInts[1];var m=g.__kBitConversionInts[0],o=20;f=31-f;if(f!==(l-1)%31)throw new Error("implementation bug");var p;l=0;if(f<o){var q=o-f;l=q+32,p=b>>>q,b=b<<32-q|m>>>q,m<<=32-q}else if(f===o)l=32,p=b,b=m;else{q=f-o;l=32-q,p=b<<q|m>>>32-q,b=m<<q}if(e>>>=0,p>>>=0,e>p)return g.__absoluteGreater(c);if(e<p)return g.__absoluteLess(c);for(f=d-2;0<=f;f--){0<l?(l-=32,p=b>>>0,b=m,m=0):p=0;o=a.__unsignedDigit(f);if(o>p)return g.__absoluteGreater(c);if(o<p)return g.__absoluteLess(c)}if(0!==b||0!==m){if(0===l)throw new Error("implementation bug");return g.__absoluteLess(c)}return 0}},{key:"__equalToNumber",value:function(a,b){return b|0===b?0===b?0===a.length:1===a.length&&a.sign===0>b&&a.__unsignedDigit(0)===h(b):0===g.__compareToDouble(a,b)}},{key:"__comparisonResultToBool",value:function(a,b){switch(b){case 0:return 0>a;case 1:return 0>=a;case 2:return 0<a;case 3:return 0<=a}throw new Error("unreachable")}},{key:"__compare",value:function(a,b,c){if(a=g.__toPrimitive(a),b=g.__toPrimitive(b),"string"==typeof a&&"string"==typeof b)switch(c){case 0:return a<b;case 1:return a<=b;case 2:return a>b;case 3:return a>=b}if(g.__isBigInt(a)&&"string"==typeof b)return b=g.__fromString(b),null!==b&&g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if("string"==typeof a&&g.__isBigInt(b))return a=g.__fromString(a),null!==a&&g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if(a=g.__toNumeric(a),b=g.__toNumeric(b),g.__isBigInt(a)){if(g.__isBigInt(b))return g.__comparisonResultToBool(g.__compareToBigInt(a,b),c);if("number"!=typeof b)throw new Error("implementation bug");return g.__comparisonResultToBool(g.__compareToNumber(a,b),c)}if("number"!=typeof a)throw new Error("implementation bug");if(g.__isBigInt(b))return g.__comparisonResultToBool(g.__compareToNumber(b,a),2^c);if("number"!=typeof b)throw new Error("implementation bug");return 0===c?a<b:1===c?a<=b:2===c?a>b:3===c?a>=b:void 0}},{key:"__absoluteAdd",value:function(a,b,c){if(a.length<b.length)return g.__absoluteAdd(b,a,c);if(0===a.length)return a;if(0===b.length)return a.sign===c?a:g.unaryMinus(a);var d=a.length;(0===a.__clzmsd()||b.length===a.length&&0===b.__clzmsd())&&d++;for(var d=new g(d,c),c=0,e=0;e<b.length;e++){var f=b.__digit(e),h=a.__digit(e),m=(65535&h)+(65535&f)+c;h=(h>>>16)+(f>>>16)+(m>>>16);c=h>>>16,d.__setDigit(e,65535&m|h<<16)}for(;e<a.length;e++){f=a.__digit(e);m=(65535&f)+c;h=(f>>>16)+(m>>>16);c=h>>>16,d.__setDigit(e,65535&m|h<<16)}return e<d.length&&d.__setDigit(e,c),d.__trim()}},{key:"__absoluteSub",value:function(a,b,c){if(0===a.length)return a;if(0===b.length)return a.sign===c?a:g.unaryMinus(a);for(var c=new g(a.length,c),d=0,e=0;e<b.length;e++){var f=a.__digit(e),l=b.__digit(e),m=(65535&f)-(65535&l)-d;d=1&m>>>16;f=(f>>>16)-(l>>>16)-d;d=1&f>>>16,c.__setDigit(e,65535&m|f<<16)}for(;e<a.length;e++){l=a.__digit(e);m=(65535&l)-d;d=1&m>>>16;f=(l>>>16)-d;d=1&f>>>16,c.__setDigit(e,65535&m|f<<16)}return c.__trim()}},{key:"__absoluteAddOne",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length;null===c?c=new g(d,b):c.sign=b;for(var e=!0,f=0;f<d;f++){var k=a.__digit(f),l=-1===k;e&&(k=0|k+1),e=l,c.__setDigit(f,k)}return e&&c.__setDigitGrow(d,1),c}},{key:"__absoluteSubOne",value:function(a,b){var c=a.length;b=b||c;for(var d=new g(b,!1),e=!0,f=0;f<c;f++){var k=a.__digit(f),l=0===k;e&&(k=0|k-1),e=l,d.__setDigit(f,k)}for(l=c;l<b;l++)d.__setDigit(l,0);return d}},{key:"__absoluteAnd",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,e,b=m,n}var k=f;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)&b.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteAndNot",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;d<e&&(f=d);var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)&~b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteOr",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,d=e,b=m,n}var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)|b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteXor",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,d=a.length,e=b.length,f=e;if(d<e){f=d;var m=a,n=d;a=b,d=e,b=m,n}var k=d;null===c?c=new g(k,!1):k=c.length;for(var l=0;l<f;l++)c.__setDigit(l,a.__digit(l)^b.__digit(l));for(;l<d;l++)c.__setDigit(l,a.__digit(l));for(;l<k;l++)c.__setDigit(l,0);return c}},{key:"__absoluteCompare",value:function(a,b){var c=a.length-b.length;if(0!=c)return c;for(c=a.length-1;0<=c&&a.__digit(c)===b.__digit(c);)c--;return 0>c?0:a.__unsignedDigit(c)>b.__unsignedDigit(c)?1:-1}},{key:"__multiplyAccumulate",value:function(a,b,c,d){if(0!==b){for(var e=65535&b,b=b>>>16,f=0,g=0,k=0,l=0;l<a.length;l++,d++){var m=c.__digit(d),n=65535&m,o=m>>>16,p=a.__digit(l),q=65535&p;p=p>>>16;var r=j(q,e);q=j(q,b);var s=j(p,e);p=j(p,b);n+=g+(65535&r),o+=k+f+(n>>>16)+(r>>>16)+(65535&q)+(65535&s),f=o>>>16,g=(q>>>16)+(s>>>16)+(65535&p)+f,f=g>>>16,g&=65535,k=p>>>16,m=65535&n|o<<16,c.__setDigit(d,m)}for(;0!==f||0!==g||0!==k;d++){r=c.__digit(d);q=(65535&r)+g;s=(r>>>16)+(q>>>16)+k+f;g=0,k=0,f=s>>>16,r=65535&q|s<<16,c.__setDigit(d,r)}}}},{key:"__internalMultiplyAdd",value:function(a,b,c,d,e){for(var c=c,f=0,h=0;h<d;h++){var l=a.__digit(h),m=j(65535&l,b),n=(65535&m)+f+c;c=n>>>16;l=j(l>>>16,b);m=(65535&l)+(m>>>16)+c;c=m>>>16,f=l>>>16,e.__setDigit(h,m<<16|65535&n)}if(e.length>d)for(e.__setDigit(d++,c+f);d<e.length;)e.__setDigit(d++,0);else if(0!==c+f)throw new Error("implementation bug")}},{key:"__absoluteDivSmall",value:function(a,b,c){null===c&&(c=new g(a.length,!1));for(var d=0,e=2*a.length-1;0<=e;e-=2){var f=(d<<16|a.__halfDigit(e))>>>0,k=0|f/b;d=0|f%b,f=(d<<16|a.__halfDigit(e-1))>>>0;var l=0|f/b;d=0|f%b,c.__setDigit(e>>>1,k<<16|l)}return c}},{key:"__absoluteModSmall",value:function(a,b){for(var c,d=0,e=2*a.length-1;0<=e;e--)c=(d<<16|a.__halfDigit(e))>>>0,d=0|c%b;return d}},{key:"__absoluteDivLarge",value:function(a,b,c,d){var f=b.__halfDigitLength(),e=b.length,n=a.__halfDigitLength()-f,i=null;c&&(i=new g(n+2>>>1,!1),i.__initializeDigits());var l=new g(f+2>>>1,!1);l.__initializeDigits();var m=g.__clz16(b.__halfDigit(f-1));0<m&&(b=g.__specialLeftShift(b,m,0));for(var a=g.__specialLeftShift(a,m,1),k=b.__halfDigit(f-1),o=0,n=n;0<=n;n--){var p=65535,q=a.__halfDigit(n+f);if(q!==k){q=(q<<16|a.__halfDigit(n+f-1))>>>0;p=0|q/k;for(var q=0|q%k,r=b.__halfDigit(f-2),s=a.__halfDigit(n+f-2);j(p,r)>>>0>(q<<16|s)>>>0&&(p--,q+=k,!(65535<q)););}g.__internalMultiplyAdd(b,p,0,e,l);r=a.__inplaceSub(l,n,f+1);0!==r&&(r=a.__inplaceAdd(b,n,f),a.__setHalfDigit(n+f,a.__halfDigit(n+f)+r),p--),c&&(1&n?o=p<<16:i.__setDigit(n>>>1,o|p))}return d?(a.__inplaceRightShift(m),c?{quotient:i,remainder:a}:a):c?i:void 0}},{key:"__clz16",value:function(a){return k(a)-16}},{key:"__specialLeftShift",value:function(a,b,c){var e=a.length,d=new g(e+c,!1);if(0===b){for(var f=0;f<e;f++)d.__setDigit(f,a.__digit(f));return 0<c&&d.__setDigit(e,0),d}for(var j,f=0,l=0;l<e;l++)j=a.__digit(l),d.__setDigit(l,j<<b|f),f=j>>>32-b;return 0<c&&d.__setDigit(e,f),d}},{key:"__leftShiftByAbsolute",value:function(a,b){b=g.__toShiftAmount(b);if(0>b)throw new RangeError("BigInt too big");var c=b>>>5;b=31&b;var d=a.length,e=0!==b&&0!=a.__digit(d-1)>>>32-b,f=d+c+(e?1:0),m=new g(f,a.sign);if(0===b){for(var n=0;n<c;n++)m.__setDigit(n,0);for(;n<f;n++)m.__setDigit(n,a.__digit(n-c))}else{for(n=0,f=0;f<c;f++)m.__setDigit(f,0);for(var o,f=0;f<d;f++)o=a.__digit(f),m.__setDigit(f+c,o<<b|n),n=o>>>32-b;if(e)m.__setDigit(d+c,n);else if(0!==n)throw new Error("implementation bug")}return m.__trim()}},{key:"__rightShiftByAbsolute",value:function(a,b){var c=a.length,d=a.sign;b=g.__toShiftAmount(b);if(0>b)return g.__rightShiftByMaximum(d);var e=b>>>5;b=31&b;var f=c-e;if(0>=f)return g.__rightShiftByMaximum(d);var i=!1;if(d)if(0!=(a.__digit(e)&(1<<b)-1))i=!0;else for(var m=0;m<e;m++)if(0!==a.__digit(m)){i=!0;break}if(i&&0===b){m=a.__digit(c-1);0==~m&&f++}m=new g(f,d);if(0===b)for(f=e;f<c;f++)m.__setDigit(f-e,a.__digit(f));else{for(var n,d=a.__digit(e)>>>b,f=c-e-1,c=0;c<f;c++)n=a.__digit(c+e+1),m.__setDigit(c,n<<32-b|d),d=n>>>b;m.__setDigit(f,d)}return i&&(m=g.__absoluteAddOne(m,!0,m)),m.__trim()}},{key:"__rightShiftByMaximum",value:function(a){return a?g.__oneDigit(1,!0):g.__zero()}},{key:"__toShiftAmount",value:function(a){if(1<a.length)return-1;a=a.__unsignedDigit(0);return a>g.__kMaxLengthBits?-1:a}},{key:"__toPrimitive",value:function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"default";if("object"!==a(b))return b;if(b.constructor===g)return b;var d=b[Symbol.toPrimitive];if(d){var e=d(c);if("object"!==a(e))return e;throw new TypeError("Cannot convert object to primitive value")}var f=b.valueOf;if(f){var k=f.call(b);if("object"!==a(k))return k}var l=b.toString;if(l){var m=l.call(b);if("object"!==a(m))return m}throw new TypeError("Cannot convert object to primitive value")}},{key:"__toNumeric",value:function(a){return g.__isBigInt(a)?a:+a}},{key:"__isBigInt",value:function(b){return"object"===a(b)&&b.constructor===g}},{key:"__truncateToNBits",value:function(a,b){for(var c=a+31>>>5,d=new g(c,b.sign),c=c-1,e=0;e<c;e++)d.__setDigit(e,b.__digit(e));e=b.__digit(c);if(0!=(31&a)){b=32-(31&a);e=e<<b>>>b}return d.__setDigit(c,e),d.__trim()}},{key:"__truncateAndSubFromPowerOfTwo",value:function(a,b,c){for(var d=Math.min,e=a+31>>>5,c=new g(e,c),f=0,e=e-1,h=0,d=d(e,b.length);f<d;f++){var j=b.__digit(f),l=0-(65535&j)-h;h=1&l>>>16;j=0-(j>>>16)-h;h=1&j>>>16,c.__setDigit(f,65535&l|j<<16)}for(;f<e;f++)c.__setDigit(f,0|-h);l=e<b.length?b.__digit(e):0;j=31&a;if(0===j){d=0-(65535&l)-h;h=1&d>>>16;f=0-(l>>>16)-h;b=65535&d|f<<16}else{a=32-j;l=l<<a>>>a;d=1<<32-a;f=(65535&d)-(65535&l)-h;h=1&f>>>16;j=(d>>>16)-(l>>>16)-h;b=65535&f|j<<16,b&=d-1}return c.__setDigit(e,b),c.__trim()}},{key:"__digitPow",value:function(a,b){for(var c=1;0<b;)1&b&&(c*=a),b>>>=1,a*=a;return c}}]),g}(k(Array));return n.__kMaxLength=33554432,n.__kMaxLengthBits=n.__kMaxLength<<5,n.__kMaxBitsPerChar=[0,0,32,51,64,75,83,90,96,102,107,111,115,119,122,126,128,131,134,136,139,141,143,145,147,149,151,153,154,156,158,159,160,162,163,165,166],n.__kBitsPerCharTableShift=5,n.__kBitsPerCharTableMultiplier=1<<n.__kBitsPerCharTableShift,n.__kConversionChars=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],n.__kBitConversionBuffer=new ArrayBuffer(8),n.__kBitConversionDouble=new Float64Array(n.__kBitConversionBuffer),n.__kBitConversionInts=new Int32Array(n.__kBitConversionBuffer),n})}),null);
__d("TCompactProtocolPolyfill",["StringToUtf8","ThriftTypes","Utf8ToString","jsbi"],(function(a,b,c,d,e,f,g){var h,i=Object.freeze({CT_STOP:0,CT_BOOLEAN_TRUE:1,CT_BOOLEAN_FALSE:2,CT_BYTE:3,CT_I16:4,CT_I32:5,CT_I64:6,CT_DOUBLE:7,CT_BINARY:8,CT_LIST:9,CT_SET:10,CT_MAP:11,CT_STRUCT:12,CT_FLOAT:13}),j=Object.freeze({NONE:-1,CT_BOOLEAN_TRUE:i.CT_BOOLEAN_TRUE,CT_BOOLEAN_FALSE:i.CT_BOOLEAN_FALSE}),k=[i.CT_STOP,0,i.CT_BOOLEAN_TRUE,i.CT_BYTE,i.CT_DOUBLE,0,i.CT_I16,0,i.CT_I32,0,i.CT_I64,i.CT_BINARY,i.CT_STRUCT,i.CT_MAP,i.CT_SET,i.CT_LIST,0,0,0,i.CT_FLOAT],l=Math.pow(2,7)-1,m=-1*Math.pow(2,7),n=Math.pow(2,15)-1,o=-1*Math.pow(2,15),p=Math.pow(2,31)-1,q=-1*Math.pow(2,31),r=Math.pow(2,32)-1,s=(a=c("jsbi")).BigInt("9223372036854775807"),t=a.BigInt("-9223372036854775808"),u=a.BigInt("18446744073709551615"),v=a.BigInt(63),w=a.BigInt(1),x=a.BigInt(0),y=a.BigInt(7),z=a.BigInt(70),A=a.BigInt(127),B=a.BigInt(128),C=Math.pow(2,4);b=function(){function a(a){this.$4=null,this.$5=null,this.$1=a,this.$2=[],this.$3=0,this.$6=new DataView(new ArrayBuffer(1))}var b=a.prototype;b.readStructBegin=function(){this.$2.push(this.$3),this.$3=0};b.readStructEnd=function(){this.$3=this.$2.pop();return 0};b.writeStructBegin=function(a){this.$2.push(this.$3);this.$3=0;return 0};b.writeStructEnd=function(){this.$3=this.$2.pop();return 0};b.writeFieldBegin=function(a){if(a.ftype===(h||(h=c("ThriftTypes"))).BOOL){this.$4={fid:a.fid,fname:a.fname,ftype:a.ftype};return 0}else return this.$7(a,j.NONE)};b.writeListBegin=function(a){return this.$8(a)};b.writeListEnd=function(){return 0};b.writeSetBegin=function(a){return this.$8(a)};b.writeSetEnd=function(){return 0};b.writeMapBegin=function(a){var b=0;if(a.size===0)b+=this.$1.writeByte(0);else{b+=this.writeVarint32(a.size);if(a.ktype!=null&&a.vtype!=null)b+=this.$1.writeByte(this.$9(a.ktype)<<4|this.$9(a.vtype));else throw new Error("received invalid map info: "+JSON.stringify(a))}return b};b.writeMapEnd=function(){return 0};b.$7=function(a,b){var c=0;b=b===j.NONE?this.$9(a.ftype):b;a.fid>this.$3&&a.fid-this.$3<=C-1?c+=this.$1.writeByte(a.fid-this.$3<<4|b):(c+=this.$1.writeByte(b),c+=this.writeI16(a.fid));this.$3=a.fid;return c};b.$8=function(a){var b=0,c=this.$9(a.etype);a.size<=C-2?b+=this.$1.writeByte(a.size<<4|c):(b+=this.$1.writeByte(240|c),b+=this.writeVarint32(a.size));return b};b.readFieldBegin=function(){var a=this.$1.readByte(),b=a&15;if(b===(h||(h=c("ThriftTypes"))).STOP)return{ftype:(h||(h=c("ThriftTypes"))).STOP,fid:0};a=(a&240)>>>4;var d;a===0?d=this.readI16():d=this.$3+a;a=this.$10(b);(b===i.CT_BOOLEAN_TRUE||b===i.CT_BOOLEAN_FALSE)&&(this.$5=b===i.CT_BOOLEAN_TRUE);this.$3=d;return{ftype:a,fid:d}};b.readListBegin=function(){return this.$11()};b.readListEnd=function(){return 0};b.readSetBegin=function(){return this.$11()};b.readSetEnd=function(){return 0};b.readMapBegin=function(){var a=this.readVarint32();if(a>0){var b=this.$1.readByte(),c=this.$12(b>>4,"readMapBegin:key");b=this.$12(b&15,"readMapBegin:value");return{ktype:this.$10(c),vtype:this.$10(b),size:a}}return{size:a}};b.readMapEnd=function(){return 0};b.$12=function(a,b){if(a<0||a>13)throw new Error(b+" read invalid compact type: "+a);return a};b.$11=function(){var a=this.$1.readByte(),b=this.$12(a&15,"_readListOrSetBegin");b=this.$10(b);a=a>>4&15;a===15&&(a=this.readVarint32());return{etype:b,size:a}};b.readFieldEnd=function(){return 0};b.readByte=function(){this.$6.setUint8(0,this.$1.readByte());return this.$6.getInt8(0)};b.writeByte=function(a){if(a<m||a>l)throw new Error("byte to write is out of range: "+a);this.$6.setInt8(0,a);return this.$1.writeByte(this.$6.getUint8(0))};b.readFloat=function(){return this.$1.readFloatBE()};b.writeFloat=function(a){return this.$1.writeFloatBE(a)};b.readDouble=function(){return this.$1.readDoubleBE()};b.writeDouble=function(a){return this.$1.writeDoubleBE(a)};b.writeString=function(a){return this.writeBinary(d("StringToUtf8").StringToUtf8(a))};b.skip=function(a){switch(a){case(h||(h=c("ThriftTypes"))).STOP:return;case(h||(h=c("ThriftTypes"))).BOOL:this.readBool();break;case(h||(h=c("ThriftTypes"))).BYTE:this.readByte();break;case(h||(h=c("ThriftTypes"))).DOUBLE:this.readDouble();break;case(h||(h=c("ThriftTypes"))).I16:this.readI16();break;case(h||(h=c("ThriftTypes"))).I32:this.readI32();break;case(h||(h=c("ThriftTypes"))).I64:this.readI64();break;case(h||(h=c("ThriftTypes"))).STRING:this.readString();break;case(h||(h=c("ThriftTypes"))).STRUCT:this.readStructBegin();var b;while(!0){b=this.readFieldBegin();if(b.ftype===(h||(h=c("ThriftTypes"))).STOP)break;this.skip(b.ftype)}this.readStructEnd();break;case(h||(h=c("ThriftTypes"))).MAP:b=this.readMapBegin();if(b.size>0&&b.ktype!=null&&b.vtype!=null){var d=b.ktype,e=b.vtype;for(var f=0;f<b.size;f++)this.skip(d),this.skip(e)}break;case(h||(h=c("ThriftTypes"))).SET:case(h||(h=c("ThriftTypes"))).LIST:f=this.$11();for(d=0;d<f.size;d++)this.skip(f.etype);break;case(h||(h=c("ThriftTypes"))).FLOAT:this.readFloat();break;default:throw new Error("encoutered unknow thrift type: "+a+" in skip")}};b.toByteArray=function(){return this.$1.toByteArray()};b.writeFieldEnd=function(){return 0};b.writeFieldStop=function(){return this.$1.writeByte((h||(h=c("ThriftTypes"))).STOP)};b.writeI16=function(a){if(a<o||a>n)throw new Error("trying to write i16 out of range: "+a);return this.writeVarint32(this.i32ToZigzag(a))};b.readI16=function(){var a=this.zigzagToI32(this.readVarint32());if(a<o||a>n)throw new Error("read invalid i16: "+a);return a};b.writeI32=function(a){if(a<q||a>p)throw new Error("i32 out of range: "+a);return this.writeVarint32(this.i32ToZigzag(a))};b.readI32=function(){return this.zigzagToI32(this.readVarint32())};b.writeI64=function(a){return this.writeVarint64(this.i64ToZigzag(a))};b.readI64=function(){return this.zigzagToI64(this.readVarint64())};b.readBool=function(){var a;this.$5!=null?(a=this.$5,this.$5=null):a=this.$1.readByte()===i.CT_BOOLEAN_TRUE;return a};b.writeBool=function(a){var b=0;this.$4!=null?(b+=this.$7(this.$4,a?j.CT_BOOLEAN_TRUE:j.CT_BOOLEAN_FALSE),this.$4=null):b+=this.$1.writeByte(a?i.CT_BOOLEAN_TRUE:i.CT_BOOLEAN_FALSE);return b};b.readBinary=function(){var a=this.readVarint32();return a===0?new Uint8Array(0):this.$1.readBytes(a)};b.writeBinary=function(a){var b=0;b+=this.writeVarint32(a.length);b+=this.$1.write(a);return b};b.i32ToZigzag=function(a){if(a<q||a>p)throw new Error("number: "+a+" is out of range of i32");return(a<<1^(a<0?4294967295:0))>>>0};b.zigzagToI32=function(a){if(a<0||a>r)throw new Error("number: "+a+" is out of range of uint32");return a>>>1^-1*(a&1)};b.i64ToZigzag=function(a){if(c("jsbi").greaterThan(a,s)||c("jsbi").lessThan(a,t))throw new Error("i64 out of range: "+a.toString());return c("jsbi").bitwiseXor(c("jsbi").signedRightShift(a,v),c("jsbi").leftShift(a,w))};b.zigzagToI64=function(a){if(c("jsbi").lessThan(a,0)||c("jsbi").greaterThan(a,u))throw new Error("invalid uint64: "+a.toString());return c("jsbi").equal(c("jsbi").bitwiseAnd(a,w),w)?c("jsbi").bitwiseNot(c("jsbi").signedRightShift(a,w)):c("jsbi").signedRightShift(a,w)};b.writeVarint32=function(a){if(a<0||a>r)throw new Error("writeVarint32 received out of range uint32: "+a);a=a;var b=0;while(!0)if(a>>>7===0){this.$1.writeByte(a);b++;break}else this.$1.writeByte(a&127|128),b++,a>>>=7;return b};b.readVarint32=function(){var a=0,b=0,c;while(!0){c=this.$1.readByte();a=(a|(c&127)<<b)>>>0;b+=7;if((c&128)==0){if(b===35&&(c&240)!=0)throw new Error("result exceeded 32 bit limit");break}if(b>28)throw new Error("result exceeded 32 bit limit")}return a};b.writeVarint64=function(a){if(c("jsbi").lessThan(a,x)||c("jsbi").greaterThan(a,u))throw new Error("invalid uint64: "+a.toString());a=a;var b=0;while(!0)if(c("jsbi").equal(c("jsbi").signedRightShift(a,y),x)){this.$1.writeByte(c("jsbi").toNumber(a));b++;break}else{var d,e=(d=c("jsbi")).toNumber(d.bitwiseOr(d.bitwiseAnd(a,A),B));this.$1.writeByte(e);b++;a=d.signedRightShift(a,y)}return b};b.readVarint64=function(){var a=x,b=x,d;while(!0){var e;d=(e=c("jsbi")).BigInt(this.$1.readByte());a=e.bitwiseOr(a,e.leftShift(e.bitwiseAnd(d,A),b));b=e.add(b,y);if(c("jsbi").equal(c("jsbi").bitwiseAnd(d,B),x)){if(c("jsbi").equal(b,z)&&c("jsbi").notEqual(d,w))throw new Error("result exceeded 64 bit limit");break}if(c("jsbi").greaterThan(b,v))throw new Error("result exceeded 64 bit limit")}return a};b.readString=function(){return d("Utf8ToString").Utf8ToString(this.readBinary())};b.getLastFieldId=function(){return this.$3};b.getLastField=function(){return this.$2};b.getBooleanFieldInfo=function(){return this.$4};b.getBooleanValue=function(){return this.$5};b.$9=function(a){return k[a]};b.$10=function(a){switch(a){case i.CT_STOP:return(h||(h=c("ThriftTypes"))).STOP;case i.CT_BOOLEAN_FALSE:case i.CT_BOOLEAN_TRUE:return(h||(h=c("ThriftTypes"))).BOOL;case i.CT_BYTE:return(h||(h=c("ThriftTypes"))).BYTE;case i.CT_I16:return(h||(h=c("ThriftTypes"))).I16;case i.CT_I32:return(h||(h=c("ThriftTypes"))).I32;case i.CT_I64:return(h||(h=c("ThriftTypes"))).I64;case i.CT_DOUBLE:return(h||(h=c("ThriftTypes"))).DOUBLE;case i.CT_FLOAT:return(h||(h=c("ThriftTypes"))).FLOAT;case i.CT_BINARY:return(h||(h=c("ThriftTypes"))).STRING;case i.CT_LIST:return(h||(h=c("ThriftTypes"))).LIST;case i.CT_SET:return(h||(h=c("ThriftTypes"))).SET;case i.CT_MAP:return(h||(h=c("ThriftTypes"))).MAP;case i.CT_STRUCT:return(h||(h=c("ThriftTypes"))).STRUCT;default:throw new Error("don't know what type")}};return a}();g["default"]=b}),98);
__d("TNoOpWriteBuffer",[],(function(a,b,c,d,e,f){a=function(){function a(){this.$1=0}var b=a.prototype;b.write=function(a){this.$1+=a.length;return a.length};b.writeByte=function(a){this.$1++;return 1};b.writeFloatBE=function(a){this.$1+=Float32Array.BYTES_PER_ELEMENT;return Float32Array.BYTES_PER_ELEMENT};b.writeDoubleBE=function(a){this.$1+=Float64Array.BYTES_PER_ELEMENT;return Float64Array.BYTES_PER_ELEMENT};b.toByteArray=function(){throw new Error("operation not supported")};b.currentSize=function(){return this.$1};b.readByte=function(){throw new Error("operation not supported")};b.readBytes=function(a){throw new Error("operation not supported")};b.readFloatBE=function(){throw new Error("operation not supported")};b.readDoubleBE=function(){throw new Error("operation not supported")};return a}();f["default"]=a}),66);
__d("TReadBuffer",[],(function(a,b,c,d,e,f){a=function(){function a(a){this.$1=a,this.$2=0}var b=a.prototype;b.readByte=function(){if(this.$2<this.$1.length)return this.$1[this.$2++];throw new Error("no available byte to read")};b.readBytes=function(a){if(a<0)throw new Error("cannot readBytes of negative length: "+a);if(a+this.$2>this.$1.length)throw new Error("not enough bytes to read");var b=new Uint8Array(this.$1.buffer,this.$3(),a);this.$2+=a;return b};b.readFloatBE=function(){if(Float32Array.BYTES_PER_ELEMENT+this.$2>this.$1.length)throw new Error("not enough bytes to read");var a=new DataView(this.$1.buffer).getFloat32(this.$3());this.$2+=Float32Array.BYTES_PER_ELEMENT;return a};b.readDoubleBE=function(){if(Float64Array.BYTES_PER_ELEMENT+this.$2>this.$1.length)throw new Error("not enough bytes to read");var a=new DataView(this.$1.buffer).getFloat64(this.$3());this.$2+=Float64Array.BYTES_PER_ELEMENT;return a};b.$3=function(){return this.$2+this.$1.byteOffset};b.getCurrentCursor=function(){return this.$2};b.writeByte=function(a){throw new Error("operation not supported")};b.write=function(a){throw new Error("operation not supported")};b.toByteArray=function(){throw new Error("operation not supported")};b.writeFloatBE=function(a){throw new Error("operation not supported")};b.writeDoubleBE=function(a){throw new Error("operation not supported")};return a}();f["default"]=a}),66);
__d("CompactSerializerPolyfill",["TCompactProtocolPolyfill","TNoOpWriteBuffer","TReadBuffer","TWriteBuffer"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a=new(c("TReadBuffer"))(a);a=new(c("TCompactProtocolPolyfill"))(a);return b(a)}function a(a,b,c){try{return h(a,b)}catch(a){c!=null&&c(a)}return null}function i(a,b,d){d===void 0&&(d=!1);if(d){d=new(c("TNoOpWriteBuffer"))();var e=new(c("TCompactProtocolPolyfill"))(d);b(a,e);e=new(c("TWriteBuffer"))(d.currentSize())}else e=new(c("TWriteBuffer"))();d=new(c("TCompactProtocolPolyfill"))(e);b(a,d);return d.toByteArray()}function b(a,b,c,d){c===void 0&&(c=!1);try{return i(a,b,c)}catch(a){d!=null&&d(a)}return null}g.deserialize=h;g.deserializeNoThrow=a;g.serialize=i;g.serializeNoThrow=b}),98);
__d("CrossWindowEventEmitter",["CacheStorage","EventEmitter","cr:8958"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){babelHelpers.inheritsLoose(d,a);function d(d){var e;e=a.call(this)||this;e.$CrossWindowEventEmitter$p_2=d;e.$CrossWindowEventEmitter$p_1=new(c("CacheStorage"))("localstorage",d+":");e.$CrossWindowEventEmitter$p_1.addValueChangeCallback(function(c,d,f){d=c.split(":")[1];try{c=b("cr:8958").parse(f)}catch(a){c=void 0}if(c&&c.__v){(f=a.prototype.emit).call.apply(f,[babelHelpers.assertThisInitialized(e),d].concat(c.__v))}});return e}var e=d.prototype;e.emit=function(b){var c;for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];this.emitRemote.apply(this,[b].concat(e));(c=a.prototype.emit).call.apply(c,[this,b].concat(e))};e.emitRemote=function(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];this.$CrossWindowEventEmitter$p_1.set(a,c)};return d}(c("EventEmitter"));g["default"]=a}),98);
__d("EventListenerImplForCacheStorage",["CometEventListener"],(function(a,b,c,d,e,f){"use strict";f["default"]=b("CometEventListener")}),66);
__d("IrisSubscribeCheckerUtils",[],(function(a,b,c,d,e,f){"use strict";function a(){if(typeof window!=="undefined"){var a;a=(a=window.location)==null?void 0:a.hostname;if(a==="m.facebook.com"||a==="mobile.facebook.com"||a==="mtouch.facebook.com")return!1}return!0}f.getIrisSubscribeCheckerInitialRunningState=a}),66);
__d("MqttEnvWebSocket",[],(function(a,b,c,d,e,f){"use strict";function a(a){return new WebSocket(a)}f.createWebSocket=a}),66);
__d("MqttEnv",["MqttEnvWebSocket","clearTimeout","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";b=Object.freeze({mqtt_waterfall_log_client_sampling:1,mqtt_ws_polling_enabled:3,mqtt_lp_use_fetch:9,mqtt_fast_lp:11,mqtt_lp_no_delay:12,mqtt_enable_publish_over_polling:13,mqttweb_global_connection_counter:15});e=function(){var a=b.prototype;a.random=function(){return this.$1!=null?this.$1():Math.random()};a.isUserLoggedInNow=function(){return this.$2!=null?this.$2():!0};a.setIsUserLoggedInNow=function(a){this.$2=a};a.clearTimeout=function(a){if(this.$3!=null){this.$3(a);return}c("clearTimeout")(a)};a.setTimeout=function(a,b){for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];return this.$4!=null?this.$4.apply(null,arguments):c("setTimeout").apply(null,arguments)};a.getLoggerInstance=function(){return this.$5!=null?this.$5():h.getInstance()};a.genGk=function(a){return this.$6!=null?this.$6(a):!1};a.createSocket=function(a,b){return this.$7!=null?this.$7(a,b):d("MqttEnvWebSocket").createWebSocket(a)};a.scheduleCallback=function(a){return this.$8!=null?this.$8(a):a()};a.scheduleLoggingCallback=function(a){return this.$9!=null?this.$9(a):a()};a.configRead=function(a,b){return this.$10!=null?this.$10(a,b):b};a.configWrite=function(a,b){this.$11!=null&&this.$11(a,b)};function b(){this.$1=null,this.$2=null,this.$3=null,this.$4=null,this.$5=null,this.$6=null,this.$7=null,this.$8=null,this.$9=null,this.$10=null,this.$11=null}a.initialize=function(a,b,c,d,e,f,g,h,i,j,k){this.$1=a,this.$2=b,this.$3=c,this.$4=d,this.$5=e,this.$6=f,this.$7=g,this.$8=h,this.$9=i,this.$10=j,this.$11=k};return b}();var h=function(){function a(){}a.getInstance=function(){return new a()};var b=a.prototype;b.setAppId=function(a){};b.eventLogConnect=function(a){};b.eventLogPull=function(a){};b.eventLogPullFinish=function(a){};b.eventLogDisconnect=function(a){};b.eventLogOutgoingPublish=function(a){};b.eventLogIncomingPublish=function(a){};b.eventLogPublishTimeout=function(a){};b.eventLogMiscellaneousError=function(a){};b.logIfLoggedOut=function(){};b.logError=function(a){};b.logErrorWarn=function(a){};b.logWarn=function(a){};b.debugTrace=function(a){};b.bumpCounter=function(a){};b.getBrowserConnectivity=function(){return!0};return a}(),i=new e();function a(a){i.setIsUserLoggedInNow(a)}g.MqttGkNames=b;g.Env=i;g.setIsUserLoggedInNow=a}),98);
__d("IrisSubscribeChecker",["IrisSubscribeCheckerUtils","MqttEnv"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){this.$1=d("MqttEnv").Env.getLoggerInstance(),this.$2=null,this.$3=!1,this.$4=!1,this.$5=!1,this.$6=d("IrisSubscribeCheckerUtils").getIrisSubscribeCheckerInitialRunningState(),this.$7=0,this.$8=a}var b=a.prototype;b.start=function(){this.$6=!0};b.stop=function(){this.$6=!1,this.$9()};b.onConnectAttempt=function(){};b.onConnectFailure=function(){this.$9()};b.onConnected=function(){var a=this;this.$7++;this.$9();this.$3=!1;this.$4=!1;this.$5=!1;this.$6&&(this.$2=d("MqttEnv").Env.setTimeout(function(){a.$10()},8e3))};b.onConnectSuccess=function(){};b.onConnectionLost=function(){this.$9()};b.onConnectionDisconnect=function(){};b.onSubscribe=function(a){a==="/t_ms"&&(this.$3=!0)};b.onUnsubscribe=function(a){};b.onPublish=function(a){(a==="/messenger_sync_get_diffs"||a==="/messenger_sync_create_queue")&&(this.$4=!0,this.$3&&(this.$5=!0,this.$9()))};b.onMessage=function(a){};b.onWSFatal=function(){};b.$9=function(){this.$2&&(d("MqttEnv").Env.clearTimeout(this.$2),this.$2=null)};b.$10=function(){if(this.$4===!1){var a=this.$7==1?"no_iris_session_initialConnect":"no_iris_session";this.$1.bumpCounter(a);this.$8()?this.$1.bumpCounter(a+".withProvider"):this.$1.bumpCounter(a+".withoutProvider");this.$3===!0?this.$1.bumpCounter(a+".withTopicSubscribe"):this.$1.bumpCounter(a+".withoutTopicSubscribe")}this.$3===!1&&this.$1.bumpCounter("no_iris_topic_subscribe");this.$3===!0&&this.$4===!0&&this.$5===!1&&this.$1.bumpCounter("session_before_topic_subscribe")};return a}();g["default"]=a}),98);
__d("MqttGlobalStreamCounter",["CrossWindowEventEmitter","MqttEnv","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){var a=this;this.isTabClosed=!1;this.otherTabs=new Map();this.thisTab={totalConnectionStreams:0};this.broadcastChannel=new(c("CrossWindowEventEmitter"))("MqttGlobalStreamCounter");this.broadcastChannel.addListener("count-updated",function(b){b=JSON.parse(String(b));var c=!1;a.otherTabs.has(b.key)||(c=!0);b.event==="DELETE"?a.otherTabs["delete"](b.key):b.event==="UPDATE"&&b.value!=null&&(a.otherTabs.set(b.key,b.value),c&&a.$1())});this.tabID=c("uuidv4")()}var b=a.prototype;b.streamRequested=function(){this.thisTab.totalConnectionStreams++,this.$1()};b.streamClosed=function(){this.thisTab.totalConnectionStreams>0&&(this.thisTab.totalConnectionStreams--,this.$1())};b.tabClosed=function(){if(this.isTabClosed)return;this.isTabClosed=!0;var a={key:this.tabID,event:"DELETE"};this.broadcastChannel.emitRemote("count-updated",JSON.stringify(a))};b.getGlobalState=function(){var a={totalConnectionStreams:this.thisTab.totalConnectionStreams};this.otherTabs.forEach(function(b){a.totalConnectionStreams+=b.totalConnectionStreams});return a};b.$1=function(){var a={key:this.tabID,event:"UPDATE",value:this.thisTab};this.broadcastChannel.emitRemote("count-updated",JSON.stringify(a))};b.isEnabled=function(){return!0};return a}();var h=d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter)?new a():{streamRequested:function(){},streamClosed:function(){},tabClosed:function(){},getGlobalState:function(){return{totalConnectionStreams:-1}},isEnabled:function(){return!1}};b=function(){return h};g.getInstance=b}),98);
__d("MqttAnalyticsHook",["MqttEnv","MqttGlobalStreamCounter"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.$1=d("MqttEnv").Env.getLoggerInstance(),this.$2=d("MqttGlobalStreamCounter").getInstance(),this.$3=0,this.$4=0,this.$5=0,this.$6=0,this.$1.bumpCounter("session_start"),d("MqttEnv").Env.isUserLoggedInNow()||this.$1.bumpCounter("session_start.logout")}var b=a.prototype;b.onConnectAttempt=function(){this.$1.bumpCounter("ws_connect_attempt"),this.$2.streamRequested()};b.onConnectFailure=function(){this.$4++,this.$1.bumpCounter("ws_connect_failure"),this.$1.debugTrace("connect","Connect failed existing streams count "+this.$2.getGlobalState().totalConnectionStreams),this.$2.streamClosed()};b.onConnected=function(){this.$1.bumpCounter("ws_connect_connected")};b.onConnectSuccess=function(){this.$3===0&&this.$1.bumpCounter("ws_connect_first_success"),this.$3++,this.$1.bumpCounter("ws_connect_success")};b.onConnectionLost=function(){this.$1.bumpCounter("ws_disconnect")};b.onConnectionDisconnect=function(){this.$2.streamClosed()};b.onSubscribe=function(a){};b.onUnsubscribe=function(a){};b.onPublish=function(a){this.$1.bumpCounter("ws_publish."+a)};b.onMessage=function(a){this.$1.bumpCounter("message_arrived."+a)};b.onWSFatal=function(){this.$1.bumpCounter("ws_fatal")};b.onPollRequestSent=function(){this.$1.bumpCounter("polling_request_send"),this.$2.streamRequested()};b.onPollRequestSuccess=function(){this.$1.bumpCounter("polling_request_succeed"),this.$5===0&&this.$1.bumpCounter("polling_first_success"),this.$5++};b.onPollResponse=function(a){this.$1.bumpCounter("lp.message_arrived."+a)};b.onPollFinish=function(){this.$1.bumpCounter("polling_request_finish"),this.$2.streamRequested()};b.onPollRequestFailed=function(a){this.$1.bumpCounter("polling_request_failed"),this.$1.bumpCounter("polling_request_failed_"+a),this.$6++,this.$1.debugTrace("PollRequest","Request failed existing streams count "+this.$2.getGlobalState().totalConnectionStreams),this.$2.streamClosed()};b.onPollShutdownAbort=function(){this.$2.streamClosed()};b.onTabClose=function(){this.$2.tabClosed()};return a}();g["default"]=a}),98);
__d("MqttConnectionHookCollection",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.addHook=function(a){this.$1.add(a)};b.removeHook=function(a){this.$1["delete"](a)};b.onConnectAttempt=function(){this.$1.forEach(function(a){a.onConnectAttempt==null?void 0:a.onConnectAttempt()})};b.onConnectFailure=function(){this.$1.forEach(function(a){a.onConnectFailure==null?void 0:a.onConnectFailure()})};b.onConnected=function(){this.$1.forEach(function(a){a.onConnected==null?void 0:a.onConnected()})};b.onConnectSuccess=function(){this.$1.forEach(function(a){a.onConnectSuccess==null?void 0:a.onConnectSuccess()})};b.onConnectionLost=function(){this.$1.forEach(function(a){a.onConnectionLost==null?void 0:a.onConnectionLost()})};b.onConnectionDisconnect=function(){this.$1.forEach(function(a){a.onConnectionDisconnect==null?void 0:a.onConnectionDisconnect()})};b.onSubscribe=function(a){this.$1.forEach(function(b){b.onSubscribe==null?void 0:b.onSubscribe(a)})};b.onUnsubscribe=function(a){this.$1.forEach(function(b){b.onUnsubscribe==null?void 0:b.onUnsubscribe(a)})};b.onPublish=function(a){this.$1.forEach(function(b){b.onPublish==null?void 0:b.onPublish(a)})};b.onMessage=function(a){this.$1.forEach(function(b){b.onMessage==null?void 0:b.onMessage(a)})};b.onWSFatal=function(){this.$1.forEach(function(a){a.onWSFatal==null?void 0:a.onWSFatal()})};return a}();f["default"]=a}),66);
__d("MqttProtocolUtils",["MqttEnv"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==null)return b;var c=new Uint8Array(a.length+b.length);c.set(a);c.set(b,a.length);return c}function b(a,b){b=b;var c=0,d=1,e;do{if(b===a.length)return null;e=a[b++];c+=(e&127)*d;d*=128}while((e&128)!==0);return{offset:b,value:c}}function c(a){a=a;var b=new Array(1);for(var c=0;c<4;c++){var d=a%128;a>>=7;if(a>0)b[c]=d|128;else{b[c]=d;break}}return b}function h(a,b,c){c=c;b[c++]=a>>8;b[c++]=a%256;return c}function e(a,b){return 256*a[b]+a[b+1]}function f(a){var b=0;for(var c=0,d=a.length;c<d;c++){var e=a.charCodeAt(c);e<128?b+=1:e<2048?b+=2:e>=55296&&e<=56319?(b+=4,c++):b+=3}return b}function i(a,b,c,d){d=h(b,c,d);j(a,c,d);return d+b}function j(a,b,c){c=c;for(var d=0,e=a.length;d<e;d++){var f=a.charCodeAt(d);f<128?b[c++]=f:f<2048?(b[c++]=192|f>>6,b[c++]=128|f&63):f<55296||f>=57344?(b[c++]=224|f>>12,b[c++]=128|f>>6&63,b[c++]=128|f&63):(f=65536+((f&1023)<<10|a.charCodeAt(++d)&1023),b[c++]=240|f>>18,b[c++]=128|f>>12&63,b[c++]=128|f>>6&63,b[c++]=128|f&63)}}function k(a,b,c){var d=[],e=b,f=0;while(e<b+c){var g=a[e++];if(g<128)d[f++]=String.fromCharCode(g);else if(g>191&&g<224){var h=a[e++];d[f++]=String.fromCharCode((g&31)<<6|h&63)}else if(g>239&&g<365){h=a[e++];var i=a[e++],j=a[e++];h=((g&7)<<18|(h&63)<<12|(i&63)<<6|j&63)-65536;d[f++]=String.fromCharCode(55296+(h>>10));d[f++]=String.fromCharCode(56320+(h&1023))}else{i=a[e++];j=a[e++];d[f++]=String.fromCharCode((g&15)<<12|(i&63)<<6|j&63)}}return d.join("")}var l=function(){function a(a,b,c,d){this.$1=a,this.$2=b,this.$5=c,this.$6=d,this.$4=!1}var b=a.prototype;b.$7=function(){var a=this;this.$4?(this.$4=!1,this.$5(),this.$3=d("MqttEnv").Env.setTimeout(function(){a.$7()},this.$2()*1e3)):this.$6()};b.reset=function(){var a=this;this.$4=!0;this.$3&&(d("MqttEnv").Env.clearTimeout(this.$3),this.$3=null);var b=this.$1()*1e3;b>0&&(this.$3=d("MqttEnv").Env.setTimeout(function(){a.$7()},b))};b.cancel=function(){this.$3&&(d("MqttEnv").Env.clearTimeout(this.$3),this.$3=null)};return a}();g.UTF8Length=f;g.convertStringToUTF8=j;g.concatBuffers=a;g.decodeMultiByteInt=b;g.convertUTF8ToString=k;g.encodeMultiByteInt=c;g.writeUInt16BE=h;g.readUInt16BE=e;g.writeString=i;g.Pinger=l}),98);
__d("MqttUtils",["MqttEnv"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,"sid",b.toString())}function b(a,b){var c=a;b.forEach(function(a,b){c=h(c,b,a)});return c}function h(a,b,c){if(a.indexOf("?")>0)return a+"&"+b+"="+c;else return a+"?"+b+"="+c}function c(){return Math.floor(d("MqttEnv").Env.random()*Number.MAX_SAFE_INTEGER)}function i(a,b,c){var e=arguments.length>1?a.then(b,c):a;e.then(null,function(a){d("MqttEnv").Env.setTimeout(function(){if(a instanceof Error)throw a;else throw new Error("promiseDone")},0)})}function e(a,b,c,e){var f=!1;d("MqttEnv").Env.setTimeout(function(){f||(f=!0,c(new Error("promise timeout")))},e);i(a,function(a){f||(f=!0,b(a))},function(a){f||(f=!0,c(a))})}function f(a){for(var b=arguments.length,c=new Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=0;return a.replace(/%s/g,function(){return String(c[e++])})}g.endpointWithSessionId=a;g.endpointWithExtraParameters=b;g.endpointWithExtraParameter=h;g.generateSessionId=c;g.promiseDone=i;g.promiseDoneWithTimeout=e;g.sprintf=f}),98);
__d("MqttProtocolCodec",["MqttProtocolUtils","MqttUtils","err"],(function(a,b,c,d,e,f,g){"use strict";var h=Object.freeze({CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14}),i=[0,6,77,81,73,115,100,112,3];function j(a,b){b=b;var e=b,f=a[b],g=f>>4;b+=1;var i=d("MqttProtocolUtils").decodeMultiByteInt(a,b);if(i==null)return{position:e,wireMessage:null};b=i.offset;i=b+i.value;if(i>a.length)return{position:e,wireMessage:null};var j;switch(g){case h.CONNACK:e=a[b++];e=!!(e&1);var o=a[b++];j=new m(e,o);break;case h.PUBLISH:e=f&15;o=e>>1&3;f=d("MqttProtocolUtils").readUInt16BE(a,b);b+=2;var r=d("MqttProtocolUtils").convertUTF8ToString(a,b,f);b+=f;f=null;o===1&&(f=d("MqttProtocolUtils").readUInt16BE(a,b),b+=2);var s=p.createWithBytes(a.subarray(b,i)),t=(e&1)===1;e=(e&8)===8;j=new q(r,s,o,f,t,e);break;case h.PINGREQ:j=new k("PINGREQ");break;case h.PINGRESP:j=new k("PINGRESP");break;case h.PUBACK:case h.UNSUBACK:r=d("MqttProtocolUtils").readUInt16BE(a,b);j=new n(g===h.PUBACK?"PUBACK":"UNSUBACK",r);break;case h.SUBACK:s=d("MqttProtocolUtils").readUInt16BE(a,b);b+=2;o=a.subarray(b,i);j=new l(s,o);break;default:throw c("err")(d("MqttUtils").sprintf("Invalid MQTT message type %s.",g))}return{position:i,wireMessage:j}}function a(a){var b=[],c=0;while(c<a.length){var d=j(a,c),e=d.wireMessage;c=d.position;if(e)b.push(e);else break}d=null;c<a.length&&(d=a.subarray(c));return{messages:b,remaining:d}}b=function(){function a(a){this.messageType=h[a]}var b=a.prototype;b.encode=function(){throw new TypeError("Cannot abstract class WireMessage")};return a}();var k=function(b){babelHelpers.inheritsLoose(a,b);function a(a){return b.call(this,a)||this}var c=a.prototype;c.encode=function(){var a=new ArrayBuffer(2),b=new Uint8Array(a);b[0]=(this.messageType&15)<<4;return a};return a}(b);e=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.call(this,"DISCONNECT")||this}var c=b.prototype;c.encode=function(){var a=(this.messageType&15)<<4,b=new ArrayBuffer(2),c=new Uint8Array(b);c[0]=a;c.set(d("MqttProtocolUtils").encodeMultiByteInt(0),1);return b};return b}(b);var l=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"SUBACK")||this;d.messageIdentifier=a;d.returnCode=c;return d}return a}(b),m=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){var d;d=b.call(this,"CONNACK")||this;d.sessionPresent=a;d.returnCode=c;return d}return a}(b),n=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c){a=b.call(this,a)||this;a.messageIdentifier=c;return a}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4,b=2,c=d("MqttProtocolUtils").encodeMultiByteInt(b),e=c.length+1;b=new ArrayBuffer(b+e);var f=new Uint8Array(b);f[0]=a;f.set(c,1);e=d("MqttProtocolUtils").writeUInt16BE(this.messageIdentifier,f,e);return b};return a}(b);f=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var d;d=a.call(this,"CONNECT")||this;d.clientId=b;d.connectOptions=c;return d}var c=b.prototype;c.encode=function(){var a,b=(this.messageType&15)<<4,c=i.length+3;c+=(a=d("MqttProtocolUtils")).UTF8Length(this.clientId)+2;c+=a.UTF8Length(this.connectOptions.userName)+2;var e=a.encodeMultiByteInt(c);c=new ArrayBuffer(1+e.length+c);var f=new Uint8Array(c);f[0]=b;b=1;f.set(e,1);b+=e.length;f.set(i,b);b+=i.length;e=2|128;f[b++]=e;b=a.writeUInt16BE(this.connectOptions.getKeepAliveIntervalSeconds(),f,b);b=a.writeString(this.clientId,a.UTF8Length(this.clientId),f,b);b=a.writeString(this.connectOptions.userName,a.UTF8Length(this.connectOptions.userName),f,b);return c};return b}(b);var o=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,e,f){var g;g=b.call(this,a)||this;g.topic=c;if(e<0&&e>1||e===1&&f==null)throw new TypeError(d("MqttUtils").sprintf("Argument Invalid. qos: %s messageType: %s.",e,a));g.qos=e;g.messageIdentifier=f;return g}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4;a|=2;var b=d("MqttProtocolUtils").UTF8Length(this.topic),c=2+b+2;this.messageType===h.SUBSCRIBE&&(c+=1);var e=d("MqttProtocolUtils").encodeMultiByteInt(c);c=new ArrayBuffer(1+e.length+c);var f=new Uint8Array(c);f[0]=a;a=1;f.set(e,1);a+=e.length;this.messageIdentifier!=null&&(a=d("MqttProtocolUtils").writeUInt16BE(this.messageIdentifier,f,a));a=d("MqttProtocolUtils").writeString(this.topic,b,f,a);this.messageType===h.SUBSCRIBE&&this.qos!=null&&(f[a++]=this.qos);return c};return a}(b),p=function(){function a(a,b){this.payloadString=a,this.payloadBytes=b}a.createWithString=function(b){var c=new Uint8Array(new ArrayBuffer(d("MqttProtocolUtils").UTF8Length(b)));d("MqttProtocolUtils").convertStringToUTF8(b,c,0);return new a(b,c)};a.createWithBytes=function(b){var c=d("MqttProtocolUtils").convertUTF8ToString(b,0,b.length);return new a(c,b)};var b=a.prototype;b.string=function(){return this.payloadString};b.bytes=function(){return this.payloadBytes};return a}(),q=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d,e,f,g){var h;h=b.call(this,"PUBLISH")||this;h.topic=a;h.payloadMessage=c;h.qos=d;h.messageIdentifier=e;h.retained=f!=null?f:!1;h.duplicate=g!=null?g:!1;if(h.qos===1&&h.messageIdentifier==null)throw new TypeError("Argument Invalid. messageIdentifier: null and qos: 1");return h}var c=a.prototype;c.encode=function(){var a=(this.messageType&15)<<4;this.duplicate&&(a|=8);a=a|=this.qos<<1;this.retained&&a!=1;var b=d("MqttProtocolUtils").UTF8Length(this.topic),c=b+2,e=this.qos===0?0:2;c+=e;e=this.payloadMessage.bytes();c+=e.byteLength;var f=d("MqttProtocolUtils").encodeMultiByteInt(c);c=new ArrayBuffer(1+f.length+c);var g=new Uint8Array(c);g[0]=a;g.set(f,1);a=1+f.length;a=d("MqttProtocolUtils").writeString(this.topic,b,g,a);this.qos!==0&&this.messageIdentifier!=null&&(a=d("MqttProtocolUtils").writeUInt16BE(this.messageIdentifier,g,a));g.set(e,a);return c};return a}(b),r=p.createWithString,s=p.createWithBytes;b={Base:b,ConnAck:m,Connect:f,Disconnect:e,Ping:k,PubAckUnsubAck:n,Publish:q,Subscription:o};g.MESSAGE_TYPE=h;g.decodeMessage=j;g.decodeByteMessages=a;g.Message=p;g.createMessageWithString=r;g.createMessageWithBytes=s;g.WireMessage=b}),98);
__d("MqttTypes",[],(function(a,b,c,d,e,f){"use strict";a=function(a,b,c){this.errorCode=a,this.errorName=b,this.errorMessage=c};b=Object.freeze({APP_DISCONNECT:new a(7,"APP_DISCONNECT","Disconnect initiated by app"),BROWSER_CLOSE:new a(11,"BROWSER_CLOSE","Browser closed"),CONNACK_FAILURE:new a(5,"CONNACK_FAILURE","Connection failure due to connack"),CONNECT_TIMEOUT:new a(4,"CONNECT_TIMEOUT","Connect timed out"),INVALID_DATA_TYPE:new a(3,"INVALID_DATA_TYPE","Received non-arraybuffer from socket."),PING_TIMEOUT:new a(6,"PING_TIMEOUT","Ping timeout"),RECONNECT:new a(10,"RECONNECT","Reconnecting"),SERVER_DISCONNECT:new a(8,"SERVER_DISCONNECT","Disconnect message sent my server"),SOCKET_CLOSE:new a(9,"SOCKET_CLOSE","Socket connection closed"),SOCKET_ERROR:new a(1,"SOCKET_ERROR","Socket error"),SOCKET_MESSAGE:new a(2,"SOCKET_MESSAGE","Unable to parse invalid socket message")});c=function(a,b){this.mqttError=a,this.connAck=b};d=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c,d){d===void 0&&(d=null);c=a.call(this,c)||this;c.isRecoverable=b;c.originalError=d;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.MqttError=a;f.MqttErrors=b;f.ConnectFailure=c;f.MqttChannelError=d}),66);
__d("MqttProtocolClient",["ErrorSerializer","MqttEnv","MqttProtocolCodec","MqttProtocolUtils","MqttTypes","err","getErrorSafe"],(function(a,b,c,d,e,f,g){"use strict";var h=20,i=6e4;a=function(){function a(a){var b=this;this.$12=function(a,c,e){c===void 0&&(c=null);b.$9.bumpCounter("protocol.debug.disconnect.internal."+a.errorName);b.$9.bumpCounter("protocol.debug.disconnect.internal");var f=b.$5,g=b.$2,h=g.onConnectFailure,i=g.onConnectionLost;b.setConnected(!1);b.$14();f?d("MqttEnv").Env.scheduleCallback(function(){i(a,c)}):d("MqttEnv").Env.scheduleCallback(function(){h(b.$11,new(d("MqttTypes").ConnectFailure)(a,e!=null?e:-1),c)})};this.$13=function(a){var c=b.$6;if(c==null){b.$9.bumpCounter("protocol.socket_send.failed.socket_null.<message type>");return 0}if(c.readyState!==c.OPEN){b.$9.bumpCounter("protocol.socket_send.failed.socket_not_open.<message type>");return 0}a=a.encode();var d=a.byteLength;c.send(a);return d};this.$3=a;this.$2={getKeepAliveIntervalSeconds:function(){return 10},getKeepAliveTimeoutSeconds:function(){return 10},ignoreSubProtocol:!1,mqttVersion:3,onConnectFailure:function(a,b,c){},onConnection:function(){},onConnectionLost:function(a,b){},onConnectSuccess:function(a){},onMessageArrived:function(a,b,c){},onMessageDelivered:function(a){},userName:""};this.$1="mqttwsclient";this.$4=0;this.$5=!1;this.$9=d("MqttEnv").Env.getLoggerInstance();this.$11=0}var b=a.prototype;b.connect=function(a){var b=this;if(this.$5)throw c("err")("Invalid state: connect - already connected");this.$2=a;this.setConnected(!1);this.$7!=null&&(d("MqttEnv").Env.clearTimeout(this.$7),this.$7=null);this.$7=d("MqttEnv").Env.setTimeout(function(){b.$9.bumpCounter("protocol.error.connect.timeout"),b.$12(d("MqttTypes").MqttErrors.CONNECT_TIMEOUT)},h*1e3);this.$6=d("MqttEnv").Env.createSocket(this.$3);this.$6.binaryType="arraybuffer";this.$6.onopen=function(){b.setConnected(!0),b.$9.debugTrace("Socket-Open","MQTTProtocolClient Socket Open"),b.$11=b.$13(new(d("MqttProtocolCodec").WireMessage.Connect)(b.$1,a)),a.onConnection()};this.$6.onmessage=function(a){a=a.data;if(!(a instanceof ArrayBuffer)){b.$9.bumpCounter("protocol.error.onmessage.type");b.$12(d("MqttTypes").MqttErrors.INVALID_DATA_TYPE);return}try{a=new Uint8Array(a);b.$10!=null&&(a=d("MqttProtocolUtils").concatBuffers(b.$10,a),b.$9.bumpCounter("protocol.debug.usingMessagesBuffer"),delete b.$10,b.$10=null);a=d("MqttProtocolCodec").decodeByteMessages(a);var c=a.messages;b.$10=a.remaining;for(a=0;a<c.length;a++)b.handleMessage(c[a])}catch(a){b.$10=null,b.$9.logError(a,d("MqttTypes").MqttErrors.SOCKET_MESSAGE.errorMessage),b.$9.bumpCounter("protocol.error.onmessage.parse"),b.$12(d("MqttTypes").MqttErrors.SOCKET_MESSAGE,a.message)}};this.$6.onerror=function(a){b.$9.bumpCounter("protocol.error.socket");b.$9.debugTrace("Socket-Error","MQTTProtocolClient Socket Error");a=typeof a==="object"&&a!=null&&"error"in a&&!("message"in a)?a.error:a;b.$12(d("MqttTypes").MqttErrors.SOCKET_ERROR,c("ErrorSerializer").toReadableMessage(c("getErrorSafe")(a)))};this.$6.onclose=function(a){b.$9.bumpCounter("protocol.socket.close"),a.wasClean||b.$9.debugTrace("Socket-Unclean-Close","MQTTProtocolClient error code: "+a.code+" reason: "+a.reason),b.$12(d("MqttTypes").MqttErrors.SOCKET_CLOSE,a.code+" : "+a.reason)};this.$8!=null&&this.$8.cancel();this.$8=new(d("MqttProtocolUtils").Pinger)(a.getKeepAliveIntervalSeconds,a.getKeepAliveTimeoutSeconds,this.$13.bind(this,new(d("MqttProtocolCodec").WireMessage.Ping)("PINGREQ")),function(a,c){return b.$12(d("MqttTypes").MqttErrors.PING_TIMEOUT,a,c)})};b.$14=function(){var a=this;this.setConnected(!1);this.$8!=null&&this.$8.cancel();this.$7!=null&&(d("MqttEnv").Env.clearTimeout(this.$7),this.$7=null);this.$6!=null&&(this.$6.onopen=function(b){a.$9.debugTrace("Socket Open After Teardown","Socket opening after teardown")},this.$6.onmessage=function(a){},this.$6.onerror=function(a){},this.$6.onclose=function(b){a.$9.debugTrace("Socket Close After Teardown","code: "+b.code+", reason: "+b.reason)},this.$6.close(),this.$6=null);this.$2.onConnectSuccess=function(a){};this.$2.onConnectFailure=function(a,b){};this.$2.onConnection=function(){};this.$2.onConnectionLost=function(a){};this.$2.onMessageArrived=function(a,b,c){};this.$2.onMessageDelivered=function(a){}};b.disconnect=function(a){if(this.$6==null||this.$6.readyState!==this.$6.OPEN||!this.$5){this.$14();return}this.$13(new(d("MqttProtocolCodec").WireMessage.Disconnect)());this.$9.bumpCounter("protocol.debug.disconnect");this.$12(a)};b.isConnected=function(){return this.$5};b.setConnected=function(a){this.$5=a};b.subscribe=function(a){if(!this.$5){this.$9.bumpCounter("protocol.error.subscribe.notconnected");throw c("err")("Invalid state: subscribe - not connected")}this.$9.bumpCounter("protocol.subscribe."+a);a=new(d("MqttProtocolCodec").WireMessage.Subscription)("SUBSCRIBE",a,0,this.$15());this.$13(a)};b.unsubscribe=function(a){if(!this.$5){this.$9.bumpCounter("protocol.error.unsubscribe.notconnected");throw c("err")("Invalid state: unsubscribe - not connected")}this.$9.bumpCounter("protocol.unsubscribe."+a);a=new(d("MqttProtocolCodec").WireMessage.Subscription)("UNSUBSCRIBE",a,0,this.$15());this.$13(a)};b.publish=function(a,b,c){return this.$16(a,d("MqttProtocolCodec").createMessageWithString(b),c)};b.publishBinary=function(a,b,c){return this.$16(a,d("MqttProtocolCodec").createMessageWithBytes(b),c)};b.$16=function(a,b,c){this.$5||this.$9.bumpCounter("protocol.error.publish.notconnected");this.$9.bumpCounter("protocol.publish."+a);var e=this.$15();a=new(d("MqttProtocolCodec").WireMessage.Publish)(a,b,c,e);this.$13(a);return e};b.$15=function(){++this.$4===i&&(this.$4=1);return this.$4};b.handleMessage=function(a){var b=this;switch(a.messageType){case d("MqttProtocolCodec").MESSAGE_TYPE.CONNACK:this.$7!=null&&(d("MqttEnv").Env.clearTimeout(this.$7),this.$7=null);if(a instanceof d("MqttProtocolCodec").WireMessage.ConnAck){var e=a;if(e.returnCode!==0){this.$9.bumpCounter("protocol.error.connack.invalidreturncode");this.setConnected(!1);this.$12(d("MqttTypes").MqttErrors.CONNACK_FAILURE,"connack code="+e.returnCode,e.returnCode);return}d("MqttEnv").Env.scheduleCallback(function(){b.$2.onConnectSuccess(b.$11)});this.$8!=null&&this.$8.reset()}break;case d("MqttProtocolCodec").MESSAGE_TYPE.PUBLISH:if(a instanceof d("MqttProtocolCodec").WireMessage.Publish){var f=a;d("MqttEnv").Env.scheduleCallback(function(){b.$2.onMessageArrived(f.topic,f.payloadMessage,f.qos)});e=f.messageIdentifier;this.$9.bumpCounter("protocol.publish.received");if(f.qos===1&&e!=null){e=new(d("MqttProtocolCodec").WireMessage.PubAckUnsubAck)("PUBACK",e);this.$13(e)}}break;case d("MqttProtocolCodec").MESSAGE_TYPE.PUBACK:if(a instanceof d("MqttProtocolCodec").WireMessage.PubAckUnsubAck){e=a;var g=e.messageIdentifier;this.$9.bumpCounter("protocol.puback.received");d("MqttEnv").Env.scheduleCallback(function(){b.$2.onMessageDelivered(g)})}break;case d("MqttProtocolCodec").MESSAGE_TYPE.PINGRESP:this.$8!=null&&this.$8.reset();break;case d("MqttProtocolCodec").MESSAGE_TYPE.DISCONNECT:this.$12(d("MqttTypes").MqttErrors.SERVER_DISCONNECT);break;case d("MqttProtocolCodec").MESSAGE_TYPE.SUBACK:this.$9.bumpCounter("protocol.suback.received");break;case d("MqttProtocolCodec").MESSAGE_TYPE.UNSUBACK:this.$9.bumpCounter("protocol.unsuback.received");break;default:this.$9.logError(c("err")("MqttProtocolClient: Received unhandled message type: "+a.messageType),"Received unhandled message type");this.$9.bumpCounter("protocol.error.handlemessage.unsupportedtype");break}};return a}();g["default"]=a}),98);
__d("MqttPublishListener",[],(function(a,b,c,d,e,f){"use strict";a=Object.freeze({NOT_CONNECTED:"NOT_CONNECTED",PUBLISH_ERROR:"PUBLISH_ERROR",QUEUED:"QUEUED",SENT:"SENT",ACKED:"ACKED",NOT_ACKED:"NOT_ACKED"});f.MqttPublishEvent=a}),66);
__d("MqttUserNameUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a!=null?a:typeof document==="object"&&document&&document.hasFocus&&document.hasFocus()}function b(){return navigator.userAgent}f.getMqttForegroundStatus=a;f.getUserAgent=b}),66);
__d("MqttUserName",["MqttUserNameUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b,c,e,f,g,h,i,j,k,l,m){h===void 0&&(h=null),i===void 0&&(i=""),j===void 0&&(j="websocket"),k===void 0&&(k=null),l===void 0&&(l=null),m===void 0&&(m=null),this.$1=a,this.$2=b,this.$3=c,this.$4=e,this.$5=f,this.$6=g,this.$7=d("MqttUserNameUtils").getMqttForegroundStatus(),this.$8=h,this.$9=i,this.$10=j,this.$11=k,this.$12=l,this.$13=m}var b=a.prototype;b.gen=function(a,b,c,e){e===void 0&&(e=[]);var f=d("MqttUserNameUtils").getMqttForegroundStatus(this.$7);c=c.map(function(a){a={isBase64Publish:!1,messageId:a.messageId,payload:a.payload,qos:a.qos,topic:a.topic};typeof a.payload!=="string"&&(a.payload=btoa(String.fromCharCode.apply(null,a.payload)),a.isBase64Publish=!0);return a});f={a:d("MqttUserNameUtils").getUserAgent(),asi:this.$13,aid:this.$5,aids:this.$12!=null?Object.fromEntries(this.$12):null,chat_on:this.$6,cp:this.$3,ct:this.$10,d:this.$4,dc:"",ecp:this.$2,fg:f,gas:this.$8,mqtt_sid:"",no_auto_fg:!0,p:this.$11,pack:e,php_override:this.$9,pm:c,s:a,st:b,u:this.$1};return JSON.stringify(f)};b.setForegroundState=function(a){this.$7=a};b.setChatVisibility=function(a){this.$6=a};b.getEndpointCapabilities=function(){return this.$2};b.getDeviceId=function(){return this.$4};b.setEndpointCapabilities=function(a){this.$2=a};b.getIsGuestAuthStringPresent=function(){return this.$8!==null};return a}();g["default"]=a}),98);
__d("MqttConnection",["MqttConnectionHookCollection","MqttEnv","MqttProtocolClient","MqttPublishListener","MqttTypes","MqttUserName","MqttUtils","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=15,j=15,k=1,l=1,m=64,n="publish",o="subscribe",p="unsubscribe",q=function(a){},r=18e4,s=5*1e3,t=15,u=21;a=function(){function a(){var a=this;this.$38=function(){return a.$20};this.$39=function(){return a.$21};this.$8=!1;this.$10=d("MqttEnv").Env.getLoggerInstance();this.$11="Disconnected";this.$17=new Set();this.$24=new Map();this.$12=0;this.$13=0;this.$14=0;this.$15=0;this.$16=0;this.$8=!1;this.$5="";this.$6=new(c("MqttUserName"))("",0,1,"",0,!0);this.$9=0;this.$18=0;this.$19=!1;this.$7=null;var b=function(){};this.$1=b;this.$2=b;this.$3=b;this.$25=!1;this.$26=!1;this.$27=new(c("MqttConnectionHookCollection"))();this.$4=function(){return[]};this.$20=i;this.$21=j;this.$22=null;this.$23=0}var e=a.prototype;e.run=function(a){var b=this,c=a.endpoint,d=a.extraConnectMessageProvider,e=a.mqttUserName,f=a.onJSError,g=a.onMessageReceived,h=a.onStateChange;a=a.subscribedTopics;if(this.$8){this.$10.debugTrace("run","Run called while in running state.");return}this.$1=h;this.$3=g;this.$5=c;this.$6=e;this.$8=!0;this.$18=Date.now();this.$12=0;this.$13=0;this.$2=f||q;a&&a.forEach(function(a){return b.$17.add(a)});this.$4=d;this.$20=i;this.$21=j;this.$28()};e.shutdown=function(a){this.$29(a),this.$30("shutdown"),this.$8=!1,this.$10.debugTrace("shutdown","Shutdown")};e.subscribe=function(a){this.$17.add(a);this.ensureConnected(o)&&this.$31(a);return!0};e.publish=function(a,b,c,d){return this.$32(a,b,c,d)};e.publishBinary=function(a,b,c,d){return this.$32(a,b,c,d)};e.$32=function(a,e,f,g){var i={reject:function(a){},resolve:function(){}};g!=null&&(i.listener=g);var j=new(h||(h=b("Promise")))(function(a,b){i.resolve=a,i.reject=b}),k=this.ensureConnected(n);!k?(g==null?void 0:g.onEvent(d("MqttPublishListener").MqttPublishEvent.NOT_CONNECTED),i.reject(c("err")("Client disconnected"))):this.$33(a,e,f,i);return j};e.unsubscribe=function(a){this.$17["delete"](a);this.ensureConnected(p)&&this.$34(a);return!0};e.addHook=function(a){this.$27.addHook(a)};e.removeHook=function(a){this.$27.removeHook(a)};e.isRunning=function(){return this.$8};e.getSessionId=function(){return this.$9};e.hasFatal=function(){return this.$25};e.hasConnectSuccess=function(){return this.$26};e.canPublish=function(){return this.ensureConnected("canPublish")};e.ensureConnected=function(a){return!this.$8||this.$7==null||!this.$7.isConnected()?!1:!0};e.connectionState=function(){return this.$11};e.mqttStateFromConnectionState=function(a){switch(a){case"Connecting":case"TransportConnected":return"Connecting";case"Connected":return"Connected";case"Disconnected":return"Disconnected"}throw c("err")("Unknown state "+a)};e.testOnlyGetSubscribedTopics=function(){return this.$17};e.getDisconnectCount=function(){return this.$23};e.$29=function(a){this.$8&&this.$7!=null&&(this.$35("Disconnected"),this.$7!=null&&(this.$7.disconnect(a),this.$27.onConnectionDisconnect()),this.$7=null)};e.$36=function(a){if(this.$11==="Connected"&&a==="Disconnected"&&this.$18===0){this.$18=Date.now();return}if(a==="Connecting"&&this.$18!==0&&!this.$19){this.$10.bumpCounter("protocol.reconnectstarted");this.$19=!0;return}if(a==="Connected"&&this.$18!==0){a=Date.now()-this.$18;switch(Math.floor(a/3e4)){case 0:this.$10.bumpCounter("protocol.reconnectedwithin30s");break;case 1:this.$10.bumpCounter("protocol.reconnectedwithin60s");break;case 2:this.$10.bumpCounter("protocol.reconnectedwithin90s");break;case 3:this.$10.bumpCounter("protocol.reconnectedwithin120s");break;default:this.$10.bumpCounter("protocol.reconnectedmorethan120s");break}this.$18=0;this.$19=!1;return}};e.$35=function(a){a!==this.$11&&(this.$10.debugTrace("MQTTConnection-updateState","State changed to: "+a),this.$36(a),this.$11=a,this.$1(a))};e.$28=function(){var a=this;if(!this.$8)return;this.$11!=="Disconnected"&&this.$10.debugTrace("Reconnect","Current State not disconnected: "+this.$11);this.$35("Connecting");var b=Date.now(),e=this.$10.getBrowserConnectivity();this.$9=d("MqttUtils").generateSessionId();var f=Array.from(this.$17),g=d("MqttUtils").endpointWithSessionId(this.$5,this.$9);g=d("MqttUtils").endpointWithExtraParameter(g,"cid",this.$6.getDeviceId());try{this.$7=new(c("MqttProtocolClient"))(g);var h=this.$37(),i=h.map(function(a){return a.topic});g=this.$6.gen(this.$9,f,h);this.$7!=null&&(this.$13+=1,this.$7.connect({getKeepAliveIntervalSeconds:this.$38,getKeepAliveTimeoutSeconds:this.$39,ignoreSubProtocol:!0,mqttVersion:3,onConnectFailure:function(c,d,g){return a.$40(d,b,a.$18,f,i,e,c,g)},onConnection:function(){return a.$41(h,f)},onConnectionLost:function(b,c){return a.$42(b,c)},onConnectSuccess:function(c){return a.$43(b,a.$18,f,i,e,c)},onMessageArrived:function(b,c,d){return a.$44(b,c,d)},onMessageDelivered:function(b){return a.$45(b)},userName:g}),this.$10.bumpCounter("protocol.connectattempt"),this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.connectattempt"),this.$27.onConnectAttempt())}catch(a){this.$10.bumpCounter("js_error_in_init_exception"),this.$35("Disconnected"),this.$46(!1,!1,b,this.$18,f,[],e,null,14,"init error - "+a.message),a&&this.$10.logErrorWarn(a,"ws_js_error"),this.$27.onWSFatal(),this.$47(new(d("MqttTypes").MqttChannelError)(!1,"ws_js_error",a),"client_init")}};e.$37=function(){var a=this.$4(),b=65536;return a.map(function(a){a.messageId=b--;return a})};e.$31=function(a){try{if(this.$7!=null){this.$7.subscribe(a);this.$10.debugTrace("#doSubscribe","Subscribing to "+a);this.$27.onSubscribe(a);this.$10.bumpCounter("protocol.subscribe");return!0}}catch(b){this.$10.logError(b,"Exception subscribing"),this.$10.bumpCounter("subscribe_exception."+a),this.$10.bumpCounter("protocol.subscribe.error")}return!1};e.$34=function(a){try{if(this.$7!=null){this.$7.unsubscribe(a);this.$10.debugTrace("#doUnsubscribe","Unsubscribing to "+a);this.$27.onUnsubscribe(a);this.$10.bumpCounter("protocol.unsubscribe");return!0}}catch(b){this.$10.logError(b,"Exception unsubscribing"),this.$10.bumpCounter("unsubscribe_exception."+a),this.$10.bumpCounter("protocol.unsubscribe.error")}return!1};e.$33=function(a,b,c,e){if(this.$7!=null)try{var f;typeof b==="string"?f=this.$7.publish(a,b,c):f=this.$7.publishBinary(a,b,c);this.$10.bumpCounter("protocol.publish");b=f!=null?f:"null";this.$10.debugTrace("#doPublish","publish "+a+" with messageId:"+b+" qos:"+c);this.$27.onPublish(a);(b=e.listener)==null?void 0:b.onEvent(d("MqttPublishListener").MqttPublishEvent.SENT);f!=null?(this.$10.bumpCounter("publish.ack_expected"),this.$24.set(f,e)):e.resolve();return!0}catch(b){this.$10.logError(b,"Exception publishing");this.$10.bumpCounter("publish_exception."+a);e.reject(b);this.$10.bumpCounter("protocol.publish.error");return!1}else return!1};e.$48=function(a){var b=this;a===void 0&&(a=null);if(!this.$8)return;this.$29(d("MqttTypes").MqttErrors.RECONNECT);this.$30("reconnect");this.$49();this.$9=-1;this.$16=0;a=a;a==null&&(a=k*Math.pow(2,this.$12));a=Math.max(a,l);a=Math.min(a,m);a=a*(1e3+d("MqttEnv").Env.random()*200);this.$10.debugTrace("#scheduleReconnect","Reconnect in "+a+" ms");this.$22=d("MqttEnv").Env.setTimeout(function(){b.$28()},a);this.$12+=1};e.$49=function(){var a=Date.now()-this.$16,b=this.$16!==0&&a>s,c=this.$12>t;(b||c)&&(this.$12=0);this.$16!==0&&a<=s&&this.$10.bumpCounter("short_lived_session");c&&this.$10.bumpCounter("connection_attempt_limit")};e.$46=function(a,b,c,d,e,f,g,h,i,j){a?this.$14++:this.$15++;var k=Date.now();this.$10.eventLogConnect({ackReceived:b,attemptNumber:this.$13,connectionState:this.mqttStateFromConnectionState(this.$11),connectionStatus:a,disconnectCount:this.$23,duration:k-c,errorCode:i,errorMessage:j,failTotal:this.$15,hostname:this.$5,messageSizeBytes:h,osConnectivity:g,publishes:f,sessionID:this.$9,subscribedTopics:e,successTotal:this.$14,total_duration:k-d});a&&(this.$13=0)};e.$40=function(a,b,c,d,e,f,g,h){var i=a.mqttError;h=h!=null?i.errorMessage+" - "+h:i.errorMessage;this.$10.debugTrace("connect","Connect failed "+h);this.$10.bumpCounter("protocol.onconnectfailure");this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnectfailure");this.$27.onConnectFailure();this.$46(!1,a.connAck!==-1,b,c,d,e,f,g,i.errorCode,h);if(a.connAck!=null){this.$10.bumpCounter("protocol.connect_failure."+a.connAck);if(a.connAck===u){this.$48(r);return}}this.$48()};e.$41=function(a,b){var c=this;this.$10.bumpCounter("protocol.onconnection");this.$10.debugTrace("Connect","Socket established");this.$27.onConnected();this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnection");b.forEach(function(a){c.$27.onSubscribe(a)});a.forEach(function(a){c.$27.onPublish(a.topic)});this.$35("TransportConnected")};e.$43=function(a,b,c,d,e,f){this.$10.bumpCounter("protocol.onconnectsuccess"),this.$10.debugTrace("connect","Connect success"),this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnectsucess"),this.$27.onConnectSuccess(),this.$26=!0,this.$35("Connected"),this.$46(!0,!0,a,b,c,d,e,f),this.$50(c),this.$16=Date.now()};e.$42=function(a,b){this.$10.bumpCounter("protocol.onconnectionlost");this.$23++;if(a.errorCode){b=b!=null?a.errorMessage+" - "+b:a.errorMessage;this.$10.eventLogDisconnect({disconnectCount:this.$23,duration:Date.now()-this.$16,errorCode:a.errorCode,errorMessage:b,sessionID:this.$9})}this.$10.debugTrace("connect","connection lost");this.$27.onConnectionLost();this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onconnectionlost");this.$48()};e.$44=function(a,b,c){this.$10.bumpCounter("protocol.onmessagearrived");this.$6.getIsGuestAuthStringPresent()&&this.$10.bumpCounter("guestAuthentication.onmessagearrived");this.$10.debugTrace("onMessageArrived","Message received on "+a);this.$27.onMessage(a);try{this.$3(a,b,c)}catch(b){this.$10.logError(b,"Listener threw error"),this.$10.bumpCounter("listener_error."+a)}};e.$45=function(a){this.$10.bumpCounter("protocol.onmessagedelivered");var b=a!=null?a:"null";this.$10.debugTrace("onMessageDelivered","Delivered Message {ID: "+b+"}");if(a==null)return;b=this.$24.get(a);if(b==null){this.$10.bumpCounter("protocol.message_with_unknown_id");return}this.$24["delete"](a);(a=b.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.ACKED);b.resolve();this.$10.bumpCounter("publish.ack_received")};e.$30=function(a){this.$10.bumpCounter("protocol.fail_all_unacked_publishes."+a),this.$24.forEach(function(b,e,f){(e=b.listener)==null?void 0:e.onEvent(d("MqttPublishListener").MqttPublishEvent.NOT_ACKED);b.reject(c("err")(a))}),this.$24.clear()};e.$50=function(a){var b=this,c=new Set(a);c.forEach(function(a){b.$17.has(a)||b.unsubscribe(a)});a=new Set(this.$17);a.forEach(function(a){c.has(a)||b.subscribe(a)})};e.$47=function(a,b){try{this.$10.bumpCounter("js_error_in_init");this.$10.bumpCounter(b+".error");this.$25=!0;var c=a?a.message:"error";this.$10.debugTrace("onError",b+": "+c);this.$2(a)}catch(a){this.$10.bumpCounter("js_error_in_error_logging"),this.$10.logError(a,"JS error while trying to log previous error")}};e.setRunning_OnlyForTests=function(a){this.$8=a};return a}();g["default"]=a}),98);
__d("MqttWebSocketUtils",[],(function(a,b,c,d,e,f){"use strict";function b(){return"WebSocket"in a&&a.WebSocket!=null&&"CLOSING"in a.WebSocket.prototype}f.hasWSSupport=b}),66);
__d("isFastRefreshEnabledForCurrentDomain",[],(function(a,b,c,d,e,f){"use strict";function a(){return!1}f["default"]=a}),66);
__d("MqttChannel",["ChannelClientID","IrisSubscribeChecker","MetaConfig","MqttAnalyticsHook","MqttConnection","MqttEnv","MqttPublishListener","MqttTypes","MqttUserName","MqttUtils","MqttWebSocketUtils","Promise","Run","err","isFastRefreshEnabledForCurrentDomain","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=29125;a=function(){function a(a){var b=this,e=a.endpoint,f=a.pollingEndpoint,g=a.userFbid,h=a.appId,i=a.initialSubscribedTopics,j=a.capabilities,k=a.clientCapabilities,l=a.chatVisibility;l=l===void 0?!0:l;var m=a.guestAuthString;m=m===void 0?null:m;var n=a.phpOverride;n=n===void 0?"":n;var o=a.clientType;o=o===void 0?"websocket":o;var p=a.deviceId;p=p===void 0?c("ChannelClientID").getID():p;var q=a.pageId;q=q===void 0?null:q;var r=a.assetIds;r=r===void 0?null:r;a=a.appSpecificInfo;a=a===void 0?null:a;this.$11=d("MqttEnv").Env.getLoggerInstance();this.$11.setAppId(h);this.$12=new(c("MqttUserName"))(g,j,k,p,h,l,m,n,o,q,r,a);this.$1=e;this.$2=f;this.$5="Disconnected";this.$7="LPInactive";this.$6="Disconnected";this.$3=[];this.$4=new Set();this.$8=new Map();this.$9=new Map();this.$10=new(c("MqttConnection"))();this.$13=null;this.$16=new(c("MqttAnalyticsHook"))();this.$15=new Map();this.$14=[];if(!d("MqttEnv").Env.isUserLoggedInNow()&&!c("isFastRefreshEnabledForCurrentDomain")()&&(m==null||m=="")){this.$11.bumpCounter("logged_out_init");return}this.$10.addHook(this.$16);this.$10.addHook(new(c("IrisSubscribeChecker"))(function(){return b.$4.size>0}));this.$17(i);this.$18()}var e=a.prototype;e.$17=function(a){var b=this;if(this.$10.isRunning()){this.$19("run","Connection started calling run again");return}if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled))if(c("MetaConfig")._("15")){this.$19("MqttChannel","Websocket disabled, will do long polling only");return}else if(!d("MqttWebSocketUtils").hasWSSupport()){this.$19("MqttChannel","Websocket Unavailable, will do long polling only");this.$11.bumpCounter("ws_unavailable_polling");return}this.$10.run({endpoint:this.$1,extraConnectMessageProvider:function(){return b.$20()},mqttUserName:this.$12,onJSError:function(a){b.$21(a)},onMessageReceived:function(a,c,d){b.$22(a,c,d)},onStateChange:function(a){b.$23(a)},subscribedTopics:a});this.$24()};e.$24=function(){var a=this;d("Run").onUnload(function(){a.$25(d("MqttTypes").MqttErrors.BROWSER_CLOSE)})};e.shutdown=function(){this.$25(d("MqttTypes").MqttErrors.APP_DISCONNECT)};e.$25=function(a){this.$10&&this.$10.shutdown(a),this.$13&&this.$13.shutdown(),this.$16.onTabClose()};e.publish=function(a,b,c){c===void 0&&(c={qos:1,skipBuffer:!1});return this.$26(a,b,c)};e.publishBinary=function(a,b,c){c===void 0&&(c={qos:1,skipBuffer:!1});return this.$26(a,b,c)};e.$26=function(a,b,c){c===void 0&&(c={qos:1,skipBuffer:!1});var e;c.qos===0?e=this.$27(a,b,c.listener):e=this.$28(a,b,c);d("MqttUtils").promiseDone(e,function(){},function(a){(a=c.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.PUBLISH_ERROR)});return e};e.$27=function(a,b,c){return this.$29(a,b,0,c,1,null)};e.$28=function(a,c,e){var f={reject:function(a){},resolve:function(){}},g=new(h||(h=b("Promise")))(function(a,b){f.resolve=a,f.reject=b}),i=d("MqttEnv").Env.random();c={ack:f,attempt:0,options:e,payload:c,publishToken:i,startTime:Date.now(),timeoutId:null,topic:a};if(e.skipBuffer)if(this.$10.connectionState()==="Connecting"){this.$14.push(c);(a=e.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.QUEUED)}else this.$30(c);else{c.timeoutId=this.$31(i);this.$15.set(i,c);(a=e.listener)==null?void 0:a.onEvent(d("MqttPublishListener").MqttPublishEvent.QUEUED);this.$32(c)}return g};e.$30=function(a){a.attempt+=1,d("MqttUtils").promiseDone(this.$29(a.topic,a.payload,a.options.qos,a.options.listener,a.attempt,a.startTime),function(){a.ack.resolve()},function(b){a.ack.reject(b)})};e.$32=function(a){var b=this;a.attempt+=1;d("MqttUtils").promiseDone(this.$29(a.topic,a.payload,a.options.qos,a.options.listener,a.attempt,a.startTime),function(){return b.$33(a)},function(a){})};e.$29=function(a,b,e,f,g,h){var i=this,j,k,l=this.getConnectionState(),m=Date.now();!this.$10.canPublish()&&this.$13&&this.$13.canPublish()?(typeof b==="string"?j=this.$13.publish(a,b,e):j=this.$13.publishBinary(a,b,e),k="lp",f!=null&&(j=j.then(function(){return f.onEvent(d("MqttPublishListener").MqttPublishEvent.SENT)})),this.$11.bumpCounter("try_publish_lp")):(typeof b==="string"?j=this.$10.publish(a,b,e,f):j=this.$10.publishBinary(a,b,e,f),k="ws",this.$11.bumpCounter("try_publish_ws"));c("promiseDone")(j,function(){i.$11.eventLogOutgoingPublish({attempt:g,connectionState:l,disconnectCount:i.$10.getDisconnectCount(),errorMessage:null,firstAttemptStartTime:h,payloadSizeBytes:b.length*2,protocol:k,qos:e,sessionID:i.$10.getSessionId(),success:!0,thisAttemptStartTime:m,topic:a})},function(c){i.$11.eventLogOutgoingPublish({attempt:g,connectionState:l,disconnectCount:i.$10.getDisconnectCount(),errorMessage:c!=null?c.toString():null,firstAttemptStartTime:h,payloadSizeBytes:b.length*2,protocol:k,qos:e,sessionID:i.$10.getSessionId(),success:!1,thisAttemptStartTime:m,topic:a})});return j};e.subscribe=function(a,b){var c=this;this.$10.subscribe(a);var d=this.$8.get(a);!d?(d=[b],this.$8.set(a,d)):d.push(b);return function(){var d=c.$8.get(a)||[];d=d.filter(function(a){return a!==b});c.$8.set(a,d);d.length===0&&c.unsubscribeAll(a)}};e.subscribeBinary=function(a,b){var c=this;this.$10.subscribe(a);var d=this.$9.get(a);!d?(d=[b],this.$9.set(a,d)):d.push(b);return function(){var d=c.$9.get(a)||[];d=d.filter(function(a){return a!==b});c.$9.set(a,d);d.length===0&&c.unsubscribeAll(a)}};e.subscribeChannelEvents=function(a){var b=this;this.$3.push(a);return function(){b.unsubscribeChannelEvents(a)}};e.unsubscribeChannelEvents=function(a){a=this.$3.indexOf(a);a>-1&&this.$3.splice(a,1)};e.registerExtraConnectPayloadProvider=function(a){var b=this;this.$19("MqttChannel","registerExtraConnectPayloadProvider called");this.$4.add(a);if(this.$10.isRunning()){a=a.getPublishMessages();a.forEach(function(a){typeof a.payload==="string"?b.publish(a.topic,a.payload,{qos:a.qos,skipBuffer:!0}):b.publishBinary(a.topic,a.payload,{qos:a.qos,skipBuffer:!0})})}};e.unregisterExtraConnectPayloadProvider=function(a){this.$4["delete"](a)};e.unsubscribeAll=function(a){this.$10.unsubscribe(a),this.$8["delete"](a),this.$9["delete"](a)};e.getConnectionState=function(){return this.$5};e.getLongPollingStatus=function(){return this.$7};e.getEndpoint=function(){return this.$1};e.addHook=function(a){this.$10.addHook(a)};e.removeHook=function(a){this.$10.removeHook(a)};e.testOnlyMessageReceived=function(a,b){this.$22(a,b,-1)};e.$34=function(a){var b=this.$15.get(a);b!=null&&b.timeoutId!=null&&d("MqttEnv").Env.clearTimeout(b.timeoutId);this.$15["delete"](a)};e.$31=function(a){var b=this;return d("MqttEnv").Env.setTimeout(function(a){var d=b.$15.get(a);if(!d)return;var e=d.topic;b.$11.bumpCounter("publish_timeout."+e);b.$11.debugTrace("publish_timeout","Timeout publishing topic: "+e+" publishToken: "+a);b.$34(a);d.ack.reject(c("err")("Publish Timed Out"))},i,a)};e.$33=function(a){var b=a.publishToken,c=this.$15.get(b);if(!c)return;this.$34(b);a.ack.resolve();this.$11.debugTrace("publish_success","Topic: "+a.topic+" publishToken: "+a.publishToken);this.$11.bumpCounter("publish_success."+a.topic)};e.$22=function(a,b,c){var d=this.$8.get(a);this.$11.eventLogIncomingPublish({connectionState:this.getConnectionState(),disconnectCount:this.$10.getDisconnectCount(),payloadSizeBytes:b.payloadString.length*2,qos:c,sessionID:this.$10.getSessionId(),topic:a});if(!d)this.$11.debugTrace("_onMessageReceived",a+" being dropped, no listeners");else for(d of d)try{d(b.payloadString)}catch(a){this.$11.logError(a,"Listener exception"),this.$11.bumpCounter("listener_error")}d=this.$9.get(a);this.$11.eventLogIncomingPublish({connectionState:this.getConnectionState(),disconnectCount:this.$10.getDisconnectCount(),payloadSizeBytes:b.payloadBytes.length,qos:c,sessionID:this.$10.getSessionId(),topic:a});if(!d)this.$11.debugTrace("_onMessageReceived",a+" being dropped, no binary listeners");else for(c of d)try{c(b.payloadBytes)}catch(a){this.$11.logError(a,"Binary Listener exception"),this.$11.bumpCounter("listener_error")}};e.$21=function(a){if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled)){a.isRecoverable?this.$11.bumpCounter("recoverable_error_skipped"):this.$11.bumpCounter("unrecoverable_error_skipped");return}a.isRecoverable?this.$11.bumpCounter("recoverable_error_not_skipped"):this.$11.bumpCounter("unrecoverable_error_not_skipped");this.$35(a)};e.$36=function(a){this.$35(a)};e.$35=function(a){for(var b of this.$3)b.onJSError&&b.onJSError(a)};e.$37=function(){var a=this;this.$14.forEach(function(b){a.$30(b),a.$11.bumpCounter("publish_from_temp_buffer."+b.topic)});this.$14=[];this.$15.forEach(function(b,c,d){a.$32(b),a.$11.bumpCounter("publish_from_buffer."+b.topic)})};e.$23=function(a){a==="Connecting"?(this.$14.forEach(function(a){a.ack.reject(c("err")("Client Reconnecting - "+a.topic))}),this.$14=[]):a==="TransportConnected"&&this.$37(),this.$19("_changeState","Connection state = "+a),this.$38(a,this.$7)};e.$39=function(a,b){this.$13&&this.$13.canPublish()&&this.$37(),this.$19("_changeLPStatus","LP status = "+a+", LP Request status = "+b),this.$38(this.$6,a)};e.$38=function(a,b){var c=this.$10.mqttStateFromConnectionState(a);this.$13&&this.$13.canPublish()&&(c="Connected");this.$6=a;(c!==this.$5||b!=this.$7)&&(this.$5=c,this.$7=b,this.$40(c))};e.$40=function(a){for(var b of this.$3)b.onMQTTStateChanged(a)};e.$20=function(){var a=this,b=[];this.$4.forEach(function(c){try{c=c.getPublishMessages();Array.prototype.push.apply(b,c)}catch(b){a.$11.logError(b,"ConnectPayload provider exception"),a.$11.bumpCounter("connectPayloadProvider_error")}});return b};e.$18=function(){var a=this;d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled)&&this.$2&&this.$2!=""&&c("requireDeferred")("MqttLongPollingRunner").__setRef("MqttChannel").onReady(function(b){b=new b(a.$2,a.$12,a.$10.hasFatal(),a.$10.hasConnectSuccess(),function(b,c,d){return a.$22(b,c,d)},function(){var b=Array.from(a.$8.keys()),c=Array.from(a.$9.keys());return Array.from(new Set(b.concat(c)))},function(){return a.$20()},function(b){a.$36(b)},function(b,c){a.$39(b,c)});b.start();a.$10.addHook(b);b.addHook(a.$16);a.$13=b;a.$11.debugTrace("MqttChannel","longPollingRunner loaded")})};e.$19=function(a,b){this.$11.debugTrace(a,"Mqtt channel: "+b)};e.setForegroundState=function(a){this.$12&&this.$12.setForegroundState(a)};e.setChatVisibility=function(a){this.$12&&this.$12.setChatVisibility(a)};e.getEndpointCapabilities=function(){return this.$12.getEndpointCapabilities()};e.setEndpointCapabilities=function(a){this.$12.setEndpointCapabilities(a)};e.getConnection_OnlyForTests=function(){return this.$10};return a}();g["default"]=a}),98);
__d("MqttConfig",["MqttWebConfig"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("MqttWebConfig")}),98);
__d("MqttEnvConfigStorage",["WebStorage"],(function(a,b,c,d,e,f,g){var h,i="mqtt:";function a(a,b){var d=(h||(h=c("WebStorage"))).getLocalStorage();if(d){d=d.getItem(i+a);if(d!=null)return d}return b}function b(a,b){var d=(h||(h=c("WebStorage"))).getLocalStorage();d&&(b==null?d.removeItem(i+a):(h||(h=c("WebStorage"))).setItemGuarded(d,i+a,b))}g.configRead=a;g.configWrite=b}),98);
__d("MqttUnifiedClientConnectFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744057");b=d("FalcoLoggerInternal").create("mqtt_unified_client_connect",a);e=b;g["default"]=e}),98);
__d("MqttUnifiedClientDisconnectFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744058");b=d("FalcoLoggerInternal").create("mqtt_unified_client_disconnect",a);e=b;g["default"]=e}),98);
__d("MqttUnifiedClientIncomingPublishFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744059");b=d("FalcoLoggerInternal").create("mqtt_unified_client_incoming_publish",a);e=b;g["default"]=e}),98);
__d("MqttUnifiedClientOutgoingPublishFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1744060");b=d("FalcoLoggerInternal").create("mqtt_unified_client_outgoing_publish",a);e=b;g["default"]=e}),98);
__d("MqttWsClientTypedLoggerLite",["generateLiteTypedLogger"],(function(a,b,c,d,e,f){"use strict";e.exports=b("generateLiteTypedLogger")("logger:MqttWsClientLoggerConfig")}),null);
__d("MqttLogger",["ChannelClientID","FBLogger","LogHistory","MetaConfig","MqttEnv","MqttGlobalStreamCounter","MqttUnifiedClientConnectFalcoEvent","MqttUnifiedClientDisconnectFalcoEvent","MqttUnifiedClientIncomingPublishFalcoEvent","MqttUnifiedClientOutgoingPublishFalcoEvent","MqttWsClientTypedLoggerLite","NetworkStatus","ODS","Random"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("MetaConfig")._("99"),j="mqtt_client",k=100,l="WEBSOCKET",m=typeof window!=="undefined"?window:self,n=null,o={CLIENT_ERROR:"mqtt_client_error",CONNECT:"mqtt_client_connect",DISCONNECT:"mqtt_client_disconnect",PUBLISH:"mqtt_client_publish",PUBLISH_TIMEOUT:"mqtt_qos1_publish_timeout",SOCKET_DISCONNECT:"mqtt_protocol_error"},p={CONNECT:"connect",DISCONNECT:"disconnect",INCOMING_PUBLISH:"incoming_publish",OUTGOING_PUBLISH:"outgoing_publish"};a=function(){a.getInstance=function(b){n||(n=new a(b));return n};function a(a){this.$1=d("LogHistory").getInstance(j),this.$2=0,this.$3=Date.now(),this.$4=c("ChannelClientID").getID(),this.$7(),this.$5=d("MqttGlobalStreamCounter").getInstance(),this.$5.isEnabled()||(this.$5=null),this.$6=a}var b=a.prototype;b.setAppId=function(a){this.$2===0&&(this.$2=a)};b.eventLogConnect=function(a){var b=a.ackReceived,d=a.attemptNumber,e=a.connectionState,f=a.connectionStatus,g=a.disconnectCount,h=a.duration,i=a.errorMessage,j=a.failTotal,k=a.hostname,m=a.messageSizeBytes,n=a.osConnectivity,q=a.sessionID,r=a.successTotal;a=a.total_duration;var s=f?"success":"failed";this.bumpCounter(o.CONNECT+"."+s);s=r/(r+j);r=n&&this.getBrowserConnectivity();var t={acked:b,attempt_number:d.toString(),client_type:l,connection_state:e,disconnect_count:g.toString(),duration:h.toString(),error:i,event_type:p.CONNECT,extra_data:{connect_success_rate:s.toString(),device_id:this.$4,hostname:k,connectionStatus:f.toString(),exposure:(j=this.$6)!=null?j:""},os_connectivity:r,payload_size:m==null?void 0:m.toString(),session_id:q.toString(),total_duration:a.toString(),ws_count:(n=this.$5)==null?void 0:n.getGlobalState().totalConnectionStreams.toString()};this.$8(function(){c("MqttUnifiedClientConnectFalcoEvent").log(function(){return t})})};b.eventLogPull=function(a){var b=a.duration,c=a.errorMessage,e=a.hostname,f=a.pullEventName,g=a.sessionID;a=a.status;a={connection_status:a,device_id:this.$4,duration:b,error_message:c,hostname:e,href:m.location.hostname,logged_in:d("MqttEnv").Env.isUserLoggedInNow(),session_id:g};this.$9(f,a)};b.eventLogPullFinish=function(a){var b=a.duration,c=a.errorMessage,e=a.publishReceived,f=a.publishSent,g=a.pullEventName;a=a.sessionID;b={device_id:this.$4,duration:b,error_message:c,href:m.location.hostname,logged_in:d("MqttEnv").Env.isUserLoggedInNow(),publish_received:e,publish_sent:f,session_id:a};this.$9(g,b)};b.eventLogDisconnect=function(a){var b=a.disconnectCount,d=a.duration,e=a.errorMessage;a=a.sessionID;this.bumpCounter(o.DISCONNECT);var f={client_type:l,connection_state:"Disconnected",disconnect_count:b.toString(),duration:d.toString(),error:e,event_type:p.DISCONNECT,extra_data:{device_id:this.$4,exposure:(b=this.$6)!=null?b:""},os_connectivity:this.getBrowserConnectivity(),session_id:a.toString(),ws_count:(d=this.$5)==null?void 0:d.getGlobalState().totalConnectionStreams.toString()};this.$8(function(){c("MqttUnifiedClientDisconnectFalcoEvent").log(function(){return f})})};b.eventLogOutgoingPublish=function(a){var b=a.attempt,d=a.connectionState,e=a.disconnectCount,f=a.errorMessage,g=a.firstAttemptStartTime,h=a.payloadSizeBytes,i=a.protocol,j=a.qos,k=a.sessionID,m=a.success,n=a.thisAttemptStartTime;a=a.topic;this.bumpCounter(o.PUBLISH+"."+a);var q=Date.now(),r={acked:j===1?m:null,attempt_number:b.toString(),client_type:l,connection_state:d,disconnect_count:e.toString(),duration:(q-n).toString(),error:f,event_type:p.OUTGOING_PUBLISH,extra_data:{device_id:this.$4,protocol:i},os_connectivity:this.getBrowserConnectivity(),payload_size:h.toString(),qos:j.toString(),session_id:k.toString(),topic:a,total_duration:g!=null?(q-g).toString():null};this.$8(function(){c("MqttUnifiedClientIncomingPublishFalcoEvent").log(function(){return r})})};b.eventLogIncomingPublish=function(a){var b=a.connectionState,d=a.disconnectCount,e=a.payloadSizeBytes,f=a.qos,g=a.sessionID;a=a.topic;var h={client_type:l,connection_state:b,disconnect_count:d.toString(),event_type:p.INCOMING_PUBLISH,extra_data:{device_id:this.$4},os_connectivity:this.getBrowserConnectivity(),payload_size:e.toString(),qos:f.toString(),session_id:g.toString(),topic:a};b=a=="/webrtc"||a=="/rtc_multi";this.$10(function(){c("MqttUnifiedClientOutgoingPublishFalcoEvent").log(function(){return h})},50,b)};b.logError=function(a,b){d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c("FBLogger")(j).catching(a).mustfix(b)}catch(a){}})};b.logErrorWarn=function(a,b){d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c("FBLogger")(j).catching(a).warn(b)}catch(a){}})};b.logWarn=function(a,b){var c=this;d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c.$1.warn(a,b)}catch(a){}})};b.debugTrace=function(a,b){var c=this;d("MqttEnv").Env.scheduleLoggingCallback(function(){try{c.$1.debug(a,b)}catch(a){}})};b.bumpCounter=function(a){var b=this;if(!d("Random").coinflip(k))return;d("MqttEnv").Env.scheduleLoggingCallback(function(){b.$2!==0&&(h||(h=d("ODS"))).bumpEntityKey(2966,"mqtt_ws_client",b.$2+"."+a,k),(h||(h=d("ODS"))).bumpEntityKey(2966,"mqtt_ws_client",a,k)})};b.$9=function(a,b,e){var f=this;d("MqttEnv").Env.scheduleLoggingCallback(function(){b.event_type=a;b.app_id=f.$2;b.online=f.$11();var d=JSON.stringify(b);f.$1.log(a,d,{weight:e});a!==o.DISCONNECT&&c("MqttWsClientTypedLoggerLite").log(b)})};b.$10=function(a,b,c){i&&b!==0?c=c||d("Random").coinflip(b):c=!0;c&&d("MqttEnv").Env.scheduleCallback(a)};b.$8=function(a){this.$10(a,0,!1)};b.$11=function(){return m.navigator&&m.navigator.onLine!==void 0?m.navigator.onLine:!1};b.getBrowserConnectivity=function(){return c("NetworkStatus").isOnline()};b.$7=function(){var a=this;if(m.navigator&&m.navigator.onLine!==void 0){var b=function(b){b=b.online;b||a.bumpCounter("browser_disconnect")};c("NetworkStatus").onChange(b)}};return a}();g["default"]=a}),98);
__d("MqttEnvGk",["MqttEnv","MqttLogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MqttEnv").MqttGkNames.mqtt_waterfall_log_client_sampling:return c("gkx")("21119");case d("MqttEnv").MqttGkNames.mqtt_ws_polling_enabled:return!0;case d("MqttEnv").MqttGkNames.mqtt_lp_use_fetch:return c("gkx")("21120");case d("MqttEnv").MqttGkNames.mqtt_fast_lp:return c("gkx")("21121");case d("MqttEnv").MqttGkNames.mqtt_lp_no_delay:return c("gkx")("21122");case d("MqttEnv").MqttGkNames.mqtt_enable_publish_over_polling:return c("gkx")("21123");case d("MqttEnv").MqttGkNames.mqttweb_global_connection_counter:return c("gkx")("21124");default:c("MqttLogger").getInstance().logError(new Error("unknown gk"),"Unknown GK value "+a);return!1}}g["default"]=a}),98);
__d("MqttEnvInitializer",["CurrentMessengerUser","MqttEnv","MqttEnvConfigStorage","MqttEnvGk","MqttLogger","Random","clearTimeout","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("MqttEnv").Env.initialize(c("Random").random,d("CurrentMessengerUser").isLoggedInNow,c("clearTimeout"),c("setTimeoutAcrossTransitions"),function(){return c("MqttLogger").getInstance()},c("MqttEnvGk"),a!=null?a:null,null,null,d("MqttEnvConfigStorage").configRead,d("MqttEnvConfigStorage").configWrite)}b={genGk:c("MqttEnvGk"),initialize:a};g["default"]=b}),98);
__d("FBMqttChannel",["MqttChannel","MqttConfig","MqttEnvInitializer"],(function(a,b,c,d,e,f,g){"use strict";c("MqttEnvInitializer").initialize();b=new(c("MqttChannel"))({appId:(a=c("MqttConfig")).appID,capabilities:a.capabilities,chatVisibility:!1,clientCapabilities:a.clientCapabilities,endpoint:a.endpoint,initialSubscribedTopics:a.subscribedTopics,phpOverride:a.hostNameOverride,pollingEndpoint:a.pollingEndpoint,userFbid:a.fbid});g["default"]=b}),98);
__d("FbtLogging",["cr:1094907","cr:8828"],(function(a,b,c,d,e,f,g){"use strict";a=b("cr:1094907")==null?void 0:b("cr:1094907").logImpression;c=b("cr:8828")==null?void 0:b("cr:8828").logImpressionV2;g.logImpression=a;g.logImpressionV2=c}),98);
__d("InstagramODSObserver",["BaseEventEmitter"],(function(a,b,c,d,e,f,g){"use strict";a=new(c("BaseEventEmitter"))();b=a;g["default"]=b}),98);
__d("InstagramODSImpl",["InstagramODSObserver","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h,i="instagram",j={addListener:function(a){c("InstagramODSObserver").addListener("event",a)},incr:function(a,b){b===void 0&&(b=1),(h||(h=d("ODS"))).bumpEntityKey(5588,i,a,b),c("InstagramODSObserver").emit("event",{count:b,key:a})},incr_CAREFUL_WHEN_USE_DYNAMIC_KEY:function(a,b){j.incr(a,b)}};a=j;g["default"]=a}),98);
__d("IntlQtEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1848815");b=d("FalcoLoggerInternal").create("intl_qt_event",a);e=b;g["default"]=e}),98);
__d("PromiseResult",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;a=function(){function a(){var a=this;this.promise=new(g||(g=b("Promise")))(function(b,c){a.$1=b,a.$2=c})}var c=a.prototype;c.resolve=function(a){this.$1(a)};c.reject=function(a){this.$2(a)};return a}();f["default"]=a}),66);
__d("MqttFetchClient",["MqttEnv","MqttProtocolCodec","MqttUserName","MqttUtils","Promise","PromiseResult"],(function(a,b,c,d,e,f,g){"use strict";var h,i="fetch_pull",j="fetch_pull_finish",k="fetch_",l=6e4,m="action",n="chunked",o="send",p="true",q=5,r=20,s=10,t=5e3,u=typeof window!=="undefined"?window:self;a=function(){function a(){this.$1="",this.$2=d("MqttEnv").Env.getLoggerInstance(),this.$3=0,this.$4="",this.$5=new(c("MqttUserName"))("",0,1,"",0,!0),this.$6=function(){},this.$7=function(a){},this.$8=function(){},this.$9=function(a){},this.$10=0,this.$11=0,this.$12=0,this.$13=0,this.$14="Ready",this.$15=[],this.$16=[],this.$17=null,this.$18=!1,this.$19=0}a.isSupported=function(){return typeof u.fetch==="function"};var e=a.prototype;e.run=function(a,b,c,e,f,g,h,i){this.$1=d("MqttUtils").endpointWithSessionId(a,b),this.$3=b,this.$4=c,this.$5=e,this.$6=f,this.$7=g,this.$8=h,this.$9=i,this.$20()};e.isTopicSupported=function(a){return!0};e.publish=function(a,b){return this.$21(a,b)};e.publishBinary=function(a,b){return this.$21(a,b)};e.$21=function(a,d){if(this.$14!=="ReceivingData"){this.$2.bumpCounter(k+"publish."+a+".invalidstate");return(h||(h=b("Promise"))).reject("not connected")}else{this.$2.bumpCounter(k+"publish."+a+".publish");var e=new(c("PromiseResult"))();a={topic:a,payload:d,promiseResult:e};this.$15.push(a);this.$22();return e.promise}};e.abort=function(){this.$6=function(){},this.$7=function(a){},this.$8=function(){},this.$9=function(a){}};e.$23=function(a){var b=this;a.forEach(function(a){b.$2.bumpCounter(k+"publish."+a.topic+".resolved"),a.promiseResult.resolve()});this.$12+=a.length};e.$24=function(a,b){var c=this;a.forEach(function(a){c.$2.bumpCounter(k+"publish."+a.topic+".rejected"),a.promiseResult.reject(b)})};e.$25=function(a,b,c,d){var e=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request failed. Publishes:"+e+", retry:"+c);this.$2.bumpCounter(k+"publish_request_failed");this.$14!=="ReceivingData"||c===q?(this.$24(a,d),this.$18=!1,this.$2.bumpCounter(k+"publish_request_failed_final"),this.$22()):this.$26(a,b,c+1)};e.$27=function(a,b,c,d){if(!d.ok){this.$2.bumpCounter(k+"publish_request_failed.http."+d.status);if(d.status===409){this.$19++;if(this.$19>=s){this.$2.bumpCounter(k+"409_reset");this.$28(new Error("Too many 409 errors"));return}}this.$25(a,b,c,this.$29(d));return}this.$2.bumpCounter(k+"publish_request_success");b=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request success. Publishes:"+b+", retry:"+c);this.$23(a);this.$18=!1;this.$22()};e.$22=function(){if(this.$14!=="ReceivingData")return;if(this.$18)return;if(this.$15.length===0&&this.$16.length===0)return;this.$18=!0;var a=this.$15.slice(0,r);this.$15=this.$15.slice(r,this.$15.length);this.$17!=null&&d("MqttEnv").Env.clearTimeout(this.$17);this.$17=null;var b=this.$16.slice(0,r);this.$16=this.$16.slice(r,this.$16.length);this.$26(a,b,0)};e.$26=function(a,b,c){var e=this,f=a.map(function(a){return a.topic}).join(",");this.$2.debugTrace("FetchClient","Fetch publish request sent. Publishes:"+f+", retry:"+c);f=d("MqttUtils").endpointWithExtraParameter(this.$1,m,o);var g=a.map(function(a){return{topic:a.topic,payload:a.payload,qos:0,messageId:d("MqttEnv").Env.random()}});g=this.$5.gen(this.$3,[],g,b);this.$2.bumpCounter(k+"publish_request");d("MqttUtils").promiseDoneWithTimeout(u.fetch(f,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",referrer:"no-referrer",body:g,keepalive:!1}),function(d){return e.$27(a,b,c,d)},function(d){return e.$25(a,b,c,d)},l)};e.$30=function(a){a=a.message;this.$2.debugTrace("FetchClient","Fetch request failed with error:"+a);this.$9(a);this.$31(!1,a);this.$2.bumpCounter(k+"error");this.$14="Error"};e.$32=function(a){var b=this;this.$2.debugTrace("FetchClient","Fetch response data received");a=d("MqttProtocolCodec").decodeByteMessages(new Uint8Array(a));a=a.messages;var c=a.filter(function(a){return a.messageType===d("MqttProtocolCodec").MESSAGE_TYPE.PINGREQ});a=a.filter(function(a){return a.messageType===d("MqttProtocolCodec").MESSAGE_TYPE.PUBLISH}).map(function(a){if(!(a instanceof d("MqttProtocolCodec").WireMessage.Publish))return{};a=a;a.qos===1&&a.messageIdentifier!=null&&(b.$16.push(a.messageIdentifier),b.$17==null&&(b.$17=d("MqttEnv").Env.setTimeout(function(){b.$22()},t)));return{topic:a.topic,payload:a.payloadMessage,qos:a.qos}});for(var e of a){var f;this.$2.bumpCounter(k+"response_"+((f=e.topic)!=null?f:"void"))}a&&a.length>0&&(this.$13+=a.length,this.$7(a));c&&c.length>0&&this.$33()};e.$33=function(){this.$2.debugTrace("FetchClient","Got server ping request"),this.$2.bumpCounter(k+"ping")};e.$28=function(a){this.$2.debugTrace("FetchClient","Fetch request ended: "+a.toString()),this.$2.bumpCounter(k+"done"),this.$34(a.message),this.$8(),this.$14="Done"};e.$35=function(a,b,c){var e=this;if(c!=null)try{this.$32(c)}catch(a){this.$28(a);this.$2.bumpCounter(k+"dataDecodeException");return}if(b){this.$28(new Error("EOF"));return}d("MqttUtils").promiseDone(a.read(),function(c){var b=c.done;c=c.value;return e.$35(a,b,c)},function(a){return e.$28(a)})};e.$36=function(a){if(!a.ok){this.$2.bumpCounter(k+"error.http."+a.status);this.$30(this.$29(a));return}a=a.body;if(!a){this.$30(new Error("Empty body"));return}a=a.getReader();this.$6();this.$2.bumpCounter(k+"success");this.$31(!0,null);this.$11=Date.now();this.$14="ReceivingData";this.$2.debugTrace("FetchClient","Fetch request success");this.$35(a,!1,null)};e.$34=function(a){this.$2.eventLogPullFinish({pullEventName:j,sessionID:this.$3,duration:Date.now()-this.$11,errorMessage:a,publishReceived:this.$13,publishSent:this.$12})};e.$31=function(a,b){this.$2.eventLogPull({pullEventName:i,sessionID:this.$3,status:a,duration:Date.now()-this.$10,hostname:this.$1,errorMessage:b})};e.$20=function(){var a=this;if(this.$14!=="Ready")return;this.$2.debugTrace("FetchClient","Sending fetch request");this.$2.bumpCounter(k+"request");this.$10=Date.now();var b=d("MqttUtils").endpointWithExtraParameter(this.$1,n,p);d("MqttUtils").promiseDoneWithTimeout(u.fetch(b,{method:"POST",mode:"cors",cache:"no-cache",credentials:"include",referrer:"no-referrer",body:this.$4,keepalive:!1}),function(b){return a.$36(b)},function(b){return a.$30(b)},l)};e.$29=function(a){return new Error("Http error, status="+a.status)};return a}();g["default"]=a}),98);
__d("MqttLongPollingClient",["MqttEnv","MqttProtocolCodec","MqttUserName","Promise","XHRRequest","getCrossOriginTransport"],(function(a,b,c,d,e,f,g){"use strict";var h,i=120*1e3,j="simple_pull",k="longpolling_";a=function(){function a(){this.$3="",this.$4=0,this.$2=d("MqttEnv").Env.getLoggerInstance(),this.$1="Ready",this.$5="",this.$6=new(c("MqttUserName"))("",0,1,"",0,!0),this.$7=function(){},this.$8=function(a){},this.$9=function(){},this.$10=function(a){},this.$11=0,this.$12=null,this.$13=new Set(["/t_ms","/messenger_sync_get_diffs","/messenger_sync_create_queue","/webrtc","/rtc_multi"])}var e=a.prototype;e.run=function(a,b,c,d,e,f,g,h){this.$3=a,this.$4=b,this.$5=c,this.$6=d,this.$7=e,this.$8=f,this.$9=g,this.$10=h,this.$14(this.$5)};e.isTopicSupported=function(a){return this.$13.has(a)};e.publish=function(a,c){return(h||(h=b("Promise"))).reject("not supported")};e.publishBinary=function(a,c){return(h||(h=b("Promise"))).reject("not supported")};e.abort=function(){this.$12!=null&&this.$12.abort("Disconnected")};e.$15=function(a,b){if(this.$1===a)return;this.$1=a;a==="Error"&&b!=null&&this.$10(b);this.$2.debugTrace("LongPollingClient","_changeStatus : "+a)};e.$16=function(a){if(this.$1!=="RequestSend")return;if(!a){this.$17("EmptyResponse",null);return}this.$7();this.$2.bumpCounter(k+"success");this.$18(!0,null);this.$15("ResponseReceived");a=d("MqttProtocolCodec").decodeByteMessages(new Uint8Array(a));a=a.messages.filter(function(a){return a instanceof d("MqttProtocolCodec").WireMessage.Publish}).map(function(a){if(a instanceof d("MqttProtocolCodec").WireMessage.Publish){a=a;return{topic:a.topic,payload:a.payloadMessage,qos:a.qos}}else return{}});this.$8(a);this.$9()};e.$17=function(a,b){b=b!=null?b.message:"null";this.$2.debugTrace("LongPollingClient Error","Poll failed with error:"+a+", errorMsg:"+b);this.$18(!1,a+":"+b);this.$2.bumpCounter(k+"error."+a);this.$15("Error",a)};e.$18=function(a,b){this.$2.eventLogPull({pullEventName:j,sessionID:this.$4,status:a,duration:Date.now()-this.$11,hostname:this.$3,errorMessage:b})};e.$14=function(a){var b=this;if(this.$1!=="Ready"||this.$12)return;this.$2.bumpCounter(k+"request");try{this.$11=Date.now(),this.$12=new(c("XHRRequest"))(this.$3).setResponseType("arraybuffer").setRawData(a).setTransportBuilder(c("getCrossOriginTransport").withCredentials).setResponseHandler(function(a){return b.$16(a)}).setNetworkFailureHandler(function(a){b.$17("Network",a)}).setErrorHandler(function(a){b.$17("Error",a)}).setAbortHandler(function(a){b.$17("Abort",null)}).setTimeoutHandler(function(){b.$17("Timeout",null)}).setTimeout(i).send(),this.$15("RequestSend")}catch(a){this.$17("Error",a)}};return a}();g["default"]=a}),98);
__d("MqttLongPollingHookCollection",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.addHook=function(a){this.$1.add(a)};b.removeHook=function(a){this.$1["delete"](a)};b.onPollRequestSent=function(){this.$1.forEach(function(a){a.onPollRequestSent()})};b.onPollRequestSuccess=function(){this.$1.forEach(function(a){a.onPollRequestSuccess()})};b.onPollResponse=function(a){this.$1.forEach(function(b){b.onPollResponse(a)})};b.onPollFinish=function(){this.$1.forEach(function(a){a.onPollFinish()})};b.onPollRequestFailed=function(a){this.$1.forEach(function(b){b.onPollRequestFailed(a)})};b.onPollShutdownAbort=function(){this.$1.forEach(function(a){a.onPollShutdownAbort()})};return a}();f["default"]=a}),66);
__d("exponentialBackoff",["MqttEnv"],(function(a,b,c,d,e,f,g){function a(a,b){b===void 0&&(b=null);var c=null,e=0;function f(){for(var f=arguments.length,g=new Array(f),h=0;h<f;h++)g[h]=arguments[h];var i=function(){a.apply(b,g)};if(c===null){var j=Math.max(0,Math.pow(2,Math.min(e,6))*(1e3+d("MqttEnv").Env.random()*100)-2e3);c=d("MqttEnv").Env.setTimeout(function(){i(),c=null},j)}e++}f.reset=function(){e=0,c!=null&&(d("MqttEnv").Env.clearTimeout(c),c=null)};f.isPending=function(){return c!=null};return f}g["default"]=a}),98);
__d("MqttLongPollingRunner",["MqttEnv","MqttFetchClient","MqttLongPollingClient","MqttLongPollingHookCollection","MqttTypes","MqttUtils","MqttWebSocketUtils","Promise","exponentialBackoff"],(function(a,b,c,d,e,f,g){"use strict";var h,i=4,j=1e3,k=3e3,l="mqtt_should_longpoll",m="last_lp",n="yes",o="no";a=function(){function a(a,b,e,f,g,h,i,j,k){var l=this;this.$23=function(){try{if(!l.$30())return;l.$5.debugTrace("LongPollingRunner","_startPollingIfNecessary called");var a=l.$31();l.$14=a;var b=l.$9(),c=l.$10();b=b.filter(function(b){return a.isTopicSupported(b)});c=c.filter(function(b){return a.isTopicSupported(b.topic)});if(b.length===0&&c.length===0){l.$5.debugTrace("LongPollingRunner","Poll skipped, nothing to do");l.$14=null;d("MqttEnv").Env.setTimeout(function(){l.$23()},1e3);return}var e=d("MqttUtils").generateSessionId();a.run(l.$6,e,l.$7.gen(e,b,c),l.$7,function(){return l.$32()},function(a){return l.$33(a)},function(){return l.$34()},function(a){return l.$35(a)});l.$19.onPollRequestSent();e=b.join(",");b=c.map(function(a){return a.topic}).join(",");l.$5.debugTrace("LongPollingRunner","Making a poll request to "+l.$6+". SubscribedTopics:"+e+". Publishes:"+b)}catch(a){a&&l.$5.logErrorWarn(a,"lp_js_error"),l.$11(new(d("MqttTypes").MqttChannelError)(!1,"js error lp",a)),l.$35("lp_js_error")}};this.$6=a;this.$7=b;this.$1=f;this.$2=0;this.$3=e;this.$4=d("MqttWebSocketUtils").hasWSSupport();this.$5=d("MqttEnv").Env.getLoggerInstance();this.$8=g;this.$9=h;this.$10=i;this.$11=j;this.$12=k;this.$13=!1;this.$14=null;this.$15="LPInactive";this.$16="NotSent";this.$17=0;this.$19=new(c("MqttLongPollingHookCollection"))();this.$18=c("exponentialBackoff")(this.$23,this);this.$20=0;this.$21=o;a=d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_lp_use_fetch);b=c("MqttFetchClient").isSupported();a?this.$5.bumpCounter("fetch_gk_pass"):this.$5.bumpCounter("fetch_gk_fail");b?this.$5.bumpCounter("fetch_api_supported"):this.$5.bumpCounter("fetch_api_not_supported");this.$22=a&&b}var e=a.prototype;e.addHook=function(a){this.$19.addHook(a)};e.start=function(){var a=this;this.$21=d("MqttEnv").Env.configRead(m,o);this.$5.debugTrace("LongPollingRunner","Runner loaded, last status "+this.$21);this.$20=Date.now();this.$23();d("MqttEnv").Env.setTimeout(function(){a.$23()},j+100);d("MqttEnv").Env.setTimeout(function(){a.$23()},k+100)};e.shutdown=function(){this.$5.debugTrace("LongPollingRunner","Shutdown called"),this.$14&&this.$14.abort(),this.$19.onPollShutdownAbort(),this.$14=null};e.canPublish=function(){return this.$15==="LPActive"&&this.$16==="ReceivingData"};e.publish=function(a,b,c){return this.$24(a,b)};e.publishBinary=function(a,b,c){return this.$24(a,b)};e.$24=function(a,c){if(d("MqttEnv").Env.genGk(d("MqttEnv").MqttGkNames.mqtt_enable_publish_over_polling)&&(this.$14&&this.$14.isTopicSupported(a)))if(typeof c==="string")return this.$14.publish(a,c);else return this.$14.publishBinary(a,c);return(h||(h=b("Promise"))).reject()};e.onConnectAttempt=function(){};e.onConnectFailure=function(){this.$2++,this.$23()};e.onConnected=function(){};e.onConnectSuccess=function(){this.$1=!0,d("MqttEnv").Env.configWrite(m,null)};e.onConnectionLost=function(){};e.onConnectionDisconnect=function(){};e.onSubscribe=function(a){};e.onUnsubscribe=function(a){};e.onPublish=function(a){};e.onMessage=function(a){};e.onWSFatal=function(){this.$3=!0,this.$23()};e.getStatus=function(){return this.$15};e.getRequestStatus=function(){return this.$16};e.$25=function(a){a!==this.$15&&(this.$5.debugTrace("LongPollingRunner","status changed to "+a+" from "+this.$15),this.$15=a,this.$12(this.$15,this.$16))};e.$26=function(a){if(!this.$22)return;a!==this.$16&&(this.$5.debugTrace("LongPollingRunner","request status changed to "+a+" from "+this.$16),this.$16=a,this.$12(this.$15,this.$16))};e.$27=function(){this.$17=0};e.$28=function(){this.$17++,this.$17>=i&&this.$25("LPError")};e.$29=function(){var a,b=(a=d("MqttEnv")).Env.genGk(a.MqttGkNames.mqtt_lp_no_delay),c=a.Env.genGk(a.MqttGkNames.mqtt_ws_polling_enabled);a=a.Env.genGk(a.MqttGkNames.mqtt_fast_lp);this.$5.debugTrace("LongPollingRunner","_shouldPoll? pollNow:"+String(b)+" enabled:"+String(c)+" fastPoll:"+String(a)+" hasWSSupport:"+String(this.$4)+" hasWsSuccessBefore:"+String(this.$1)+" failureCount:"+this.$2+" wsFatal:"+String(this.$3));if(!c)return!1;if(b){this.$5.bumpCounter(l+".nd");return!0}if(!this.$4){this.$5.bumpCounter(l+".na");return!0}if(this.$3){this.$5.bumpCounter(l+".fatal");return!0}if(this.$1)return!1;if(a){c=Date.now()-this.$20;if(this.$21===n){if(this.$2>=1)return!0;if(c>j){this.$5.bumpCounter(l+".fastdelay");return!0}}else if(c>k){this.$5.bumpCounter(l+".regulardelay");return!0}}if(this.$2>=3){this.$5.bumpCounter(l+".failure");return!0}return!1};e.$30=function(){if(this.$14!=null)return!1;var a=this.$29();!this.$13&&a&&(this.$5.bumpCounter("polling_kickin"),this.$13=!0,this.$25("LPActive"),this.$27());this.$13&&!a&&(this.$5.bumpCounter("polling_stopped"),this.$13=!1,this.$25("LPInactive"),this.$27());return a};e.$31=function(){if(this.$22){this.$5.debugTrace("LongPollingRunner","Creating polling client using Fetch API");return new(c("MqttFetchClient"))()}else{this.$5.debugTrace("LongPollingRunner","Creating regular Polling client");return new(c("MqttLongPollingClient"))()}};e.$32=function(){this.$5.debugTrace("LongPollingRunner","Poll success"),this.$19.onPollRequestSuccess(),this.$18.reset(),this.$25("LPActive"),this.$27(),d("MqttEnv").Env.configWrite(m,n),this.$26("ReceivingData")};e.$33=function(a){var b=a.map(function(a){return a.topic}).join(",");this.$5.debugTrace("LongPollingRunner","Poll response received, message received:"+b);for(b of a)this.$19.onPollResponse(b.topic),this.$8(b.topic,b.payload,b.qos)};e.$34=function(){this.$5.debugTrace("LongPollingRunner","Poll finish"),this.$19.onPollFinish(),this.$14&&this.$14.abort(),this.$14=null,this.$23(),this.$26("NotSent")};e.$35=function(a){this.$19.onPollRequestFailed(a),this.$14&&this.$14.abort(),this.$14=null,this.$18(),this.$28(),this.$26("NotSent")};return a}();g["default"]=a}),98);
__d("VideoPlayerWithLiveVideoInterruptedOverlay.react",["fbt","FDSLoadingAnimation.react","FDSTextPairing.react","VideoPlayerHooks","VideoPlayerInteractionOverlay.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||d("react");function a(){var a=(j||(j=d("VideoPlayerHooks"))).useStreamInterrupted(),b=j.useIsLiveRewindActive();return!a||b?null:k.jsx(d("VideoPlayerInteractionOverlay.react").VideoPlayerInteractionOverlay,{children:k.jsxs("div",babelHelpers["extends"]({className:"x6s0dn4 x18l40ae x1ey2m1c x9f619 x78zum5 xdt5ytf xtijo5x x1o0tod xl56j7k x10l6tqk x13vifvy"},{children:[k.jsx("div",{children:k.jsx(c("FDSTextPairing.react"),{body:h._(/*BTDS*/"The broadcast is waiting for a signal. It should resume shortly."),bodyColor:"white",headline:h._(/*BTDS*/"Waiting for Live Video Signal"),headlineColor:"white",level:2,textAlign:"center"})}),k.jsx("div",babelHelpers["extends"]({className:"xc9qbxq x1sy10c2 x1n2onr6 x14qfxbe"},{children:k.jsx(c("FDSLoadingAnimation.react"),{size:36})}))]}))})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("XAsyncRequest",["cr:1042"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:1042")}),98);
__d("XAsyncRequestWWW",["AsyncRequest"],(function(a,b,c,d,e,f,g){a=function(){function a(a){var b=this;this.setAllowCrossPageTransition=function(a){b.$1.setAllowCrossPageTransition(a);return b};this.$1=new(c("AsyncRequest"))(a)}var b=a.prototype;b.setURI=function(a){this.$1.setURI(a);return this};b.setTimeoutHandler=function(a,b){this.$1.setTimeoutHandler(a,b);return this};b.setOption=function(a,b){this.$1.setOption(a,b);return this};b.setMethod=function(a){this.$1.setMethod(a);return this};b.setAutoProcess=function(a){this.$1.setOption("suppressEvaluation",a);return this};b.setData=function(a){this.$1.setData(a);return this};b.setHandler=function(a){this.$1.setHandler(a);return this};b.setPayloadHandler=function(a){this.setHandler(function(b){return a(b.payload)});return this};b.setErrorHandler=function(a){this.$1.setErrorHandler(a);return this};b.send=function(){this.$1.send();return this};b.abort=function(){this.$1.abort()};b.setReadOnly=function(a){this.$1.setReadOnly(a);return this};b.setAllowCrossOrigin=function(a){this.$1.setAllowCrossOrigin(a);return this};b.setAllowCredentials=function(a){this.$1.setAllowCredentials(a);return this};return a}();g["default"]=a}),98);
__d("bumpVultureJSHash",["ODS"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){(h||(h=d("ODS"))).bumpEntityKey(7506,"vulture_js",a,b)}g["default"]=a}),98);/*FB_PKG_DELIM*/
/**
 * License: https://www.facebook.com/legal/license/yKsQCAUqcFZ/
 */
__d("dexie-4.0.1",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){(function(b,c){typeof g==="object"&&typeof h!=="undefined"?h.exports=c():(b=typeof globalThis!=="undefined"?globalThis:b||self,b.Dexie=c())})(this,function(){var b=function(a,c){b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};return b(a,c)};function c(a,c){if(typeof c!=="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");b(a,c);function d(){this.constructor=a}a.prototype=c===null?Object.create(c):(d.prototype=c.prototype,new d())}var d=function(){d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return d.apply(this,arguments)};function e(a,b,c){if(c||arguments.length===2)for(var d=0,e=b.length,f;d<e;d++)(f||!(d in b))&&(f||(f=Array.prototype.slice.call(b,0,d)),f[d]=b[d]);return a.concat(f||Array.prototype.slice.call(b))}var f=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:a,g=Object.keys,h=Array.isArray;typeof Promise!=="undefined"&&!f.Promise&&(f.Promise=Promise);function i(a,b){if(typeof b!=="object")return a;g(b).forEach(function(c){a[c]=b[c]});return a}var j=Object.getPrototypeOf,k={}.hasOwnProperty;function l(a,b){return k.call(a,b)}function m(a,b){typeof b==="function"&&(b=b(j(a))),(typeof Reflect==="undefined"?g:Reflect.ownKeys)(b).forEach(function(c){o(a,c,b[c])})}var n=Object.defineProperty;function o(a,b,c,d){n(a,b,i(c&&l(c,"get")&&typeof c.get==="function"?{get:c.get,set:c.set,configurable:!0}:{value:c,configurable:!0,writable:!0},d))}function p(a){return{from:function(b){a.prototype=Object.create(b.prototype);o(a.prototype,"constructor",a);return{extend:m.bind(null,a.prototype)}}}}var q=Object.getOwnPropertyDescriptor;function r(a,b){var c=q(a,b);return c||(c=j(a))&&r(c,b)}var s=[].slice;function t(a,b,c){return s.call(a,b,c)}function u(a,b){return b(a)}function v(a){if(!a)throw new Error("Assertion Failed")}function aa(a){f.setImmediate?setImmediate(a):setTimeout(a,0)}function ba(a,b){return a.reduce(function(a,c,d){c=b(c,d);c&&(a[c[0]]=c[1]);return a},{})}function w(a,b){if(typeof b==="string"&&l(a,b))return a[b];if(!b)return a;if(typeof b!=="string"){var c=[];for(var d=0,e=b.length;d<e;++d){var f=w(a,b[d]);c.push(f)}return c}f=b.indexOf(".");if(f!==-1){d=a[b.substr(0,f)];return d==null?void 0:w(d,b.substr(f+1))}return void 0}function x(a,b,c){if(!a||b===void 0)return;if("isFrozen"in Object&&Object.isFrozen(a))return;if(typeof b!=="string"&&"length"in b){v(typeof c!=="string"&&"length"in c);for(var d=0,e=b.length;d<e;++d)x(a,b[d],c[d])}else{d=b.indexOf(".");if(d!==-1){e=b.substr(0,d);d=b.substr(d+1);if(d==="")c===void 0?h(a)&&!isNaN(parseInt(e))?a.splice(e,1):delete a[e]:a[e]=c;else{var f=a[e];(!f||!l(a,e))&&(f=a[e]={});x(f,d,c)}}else c===void 0?h(a)&&!isNaN(parseInt(b))?a.splice(b,1):delete a[b]:a[b]=c}}function ca(a,b){typeof b==="string"?x(a,b,void 0):"length"in b&&[].map.call(b,function(b){x(a,b,void 0)})}function da(a){var b={};for(var c in a)l(a,c)&&(b[c]=a[c]);return b}var ea=[].concat;function fa(a){return ea.apply([],a)}var y="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(fa([8,16,32,64].map(function(a){return["Int","Uint","Float"].map(function(b){return b+a+"Array"})}))).filter(function(a){return f[a]}),ga=new Set(y.map(function(a){return f[a]}));function ha(a){var b={};for(var c in a)if(l(a,c)){var d=a[c];b[c]=!d||typeof d!=="object"||ga.has(d.constructor)?d:ha(d)}return b}function ia(a){for(var b in a)if(l(a,b))return!1;return!0}var ja=null;function z(a){ja=new WeakMap();a=ka(a);ja=null;return a}function ka(a){if(!a||typeof a!=="object")return a;var b=ja.get(a);if(b)return b;if(h(a)){b=[];ja.set(a,b);for(var c=0,d=a.length;c<d;++c)b.push(ka(a[c]))}else if(ga.has(a.constructor))b=a;else{c=j(a);b=c===Object.prototype?{}:Object.create(c);ja.set(a,b);for(d in a)l(a,d)&&(b[d]=ka(a[d]))}return b}var la={}.toString;function ma(a){return la.call(a).slice(8,-1)}var na=typeof Symbol!=="undefined"?Symbol.iterator:"@@iterator",oa=typeof na==="symbol"?function(a){var b;return a!=null&&(b=a[na])&&b.apply(a)}:function(){return null};function A(a,b){b=a.indexOf(b);b>=0&&a.splice(b,1);return b>=0}var pa={};function B(a){var b,c,d,e;if(arguments.length===1){if(h(a))return a.slice();if(this===pa&&typeof a==="string")return[a];if(e=oa(a)){c=[];while(d=e.next(),!d.done)c.push(d.value);return c}if(a==null)return[a];b=a.length;if(typeof b==="number"){c=new Array(b);while(b--)c[b]=a[b];return c}return[a]}b=arguments.length;c=new Array(b);while(b--)c[b]=arguments[b];return c}var qa=typeof Symbol!=="undefined"?function(a){return a[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1};y=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"];var C=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"];y=y.concat(C);var ra={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function sa(a,b){this.name=a,this.message=b}p(sa).from(Error).extend({toString:function(){return this.name+": "+this.message}});function ta(a,b){return a+". Errors: "+Object.keys(b).map(function(a){return b[a].toString()}).filter(function(a,b,c){return c.indexOf(a)===b}).join("\n")}function ua(a,b,c,d){this.failures=b,this.failedKeys=d,this.successCount=c,this.message=ta(a,b)}p(ua).from(sa);function va(a,b){this.name="BulkError",this.failures=Object.keys(b).map(function(a){return b[a]}),this.failuresByPos=b,this.message=ta(a,this.failures)}p(va).from(sa);var wa=y.reduce(function(a,b){return a[b]=b+"Error",a},{}),xa=sa,D=y.reduce(function(b,c){var d=c+"Error";function a(a,b){this.name=d,!a?(this.message=ra[c]||d,this.inner=null):typeof a==="string"?(this.message="".concat(a).concat(b?"\n "+b:""),this.inner=b||null):typeof a==="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a)}p(a).from(xa);b[c]=a;return b},{});D.Syntax=SyntaxError;D.Type=TypeError;D.Range=RangeError;var ya=C.reduce(function(a,b){a[b+"Error"]=D[b];return a},{});function za(a,b){if(!a||a instanceof sa||a instanceof TypeError||a instanceof SyntaxError||!a.name||!ya[a.name])return a;b=new ya[a.name](b||a.message,a);"stack"in a&&o(b,"stack",{get:function(){return this.inner.stack}});return b}C=y.reduce(function(a,b){["Syntax","Type","Range"].indexOf(b)===-1&&(a[b+"Error"]=D[b]);return a},{});C.ModifyError=ua;C.DexieError=sa;C.BulkError=va;function E(){}function Aa(a){return a}function Ba(a,b){return a==null||a===Aa?b:function(c){return b(a(c))}}function F(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}function Ca(a,b){return a===E?b:function(){var c=a.apply(this,arguments);c!==void 0&&(arguments[0]=c);var d=this.onsuccess,e=this.onerror;this.onsuccess=null;this.onerror=null;var f=b.apply(this,arguments);d&&(this.onsuccess=this.onsuccess?F(d,this.onsuccess):d);e&&(this.onerror=this.onerror?F(e,this.onerror):e);return f!==void 0?f:c}}function Da(a,b){return a===E?b:function(){a.apply(this,arguments);var c=this.onsuccess,d=this.onerror;this.onsuccess=this.onerror=null;b.apply(this,arguments);c&&(this.onsuccess=this.onsuccess?F(c,this.onsuccess):c);d&&(this.onerror=this.onerror?F(d,this.onerror):d)}}function Ea(a,b){return a===E?b:function(c){var d=a.apply(this,arguments);i(c,d);var e=this.onsuccess,f=this.onerror;this.onsuccess=null;this.onerror=null;var g=b.apply(this,arguments);e&&(this.onsuccess=this.onsuccess?F(e,this.onsuccess):e);f&&(this.onerror=this.onerror?F(f,this.onerror):f);return d===void 0?g===void 0?void 0:g:i(d,g)}}function Fa(a,b){return a===E?b:function(){return b.apply(this,arguments)===!1?!1:a.apply(this,arguments)}}function Ga(a,b){return a===E?b:function(){var c=a.apply(this,arguments);if(c&&typeof c.then==="function"){var d=this,e=arguments.length,f=new Array(e);while(e--)f[e]=arguments[e];return c.then(function(){return b.apply(d,f)})}return b.apply(this,arguments)}}var G=typeof location!=="undefined"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Ha(a,b){G=a}var Ia={},Ja=100;y=typeof Promise==="undefined"?[]:function(){var a=Promise.resolve();if(typeof crypto==="undefined"||!crypto.subtle)return[a,j(a),a];var b=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[b,j(b),a]}();var Ka=y[0],H=y[1];y=y[2];H=H&&H.then;var La=Ka&&Ka.constructor,Ma=!!y;function Na(){queueMicrotask(db)}var Oa=function(a,b){Ua.push([a,b]),Qa&&(Na(),Qa=!1)},Pa=!0,Qa=!0,Ra=[],Sa=[],Ta=Aa,I={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:E,pgp:!1,env:{},finalize:E},J=I,Ua=[],Va=0,Wa=[];function K(a){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");this._listeners=[];this._lib=!1;var b=this._PSD=J;if(typeof a!=="function"){if(a!==Ia)throw new TypeError("Not a function");this._state=arguments[1];this._value=arguments[2];this._state===!1&&$a(this,this._value);return}this._state=null;this._value=null;++b.ref;Za(this,a)}var Xa={get:function(){var a=J,b=ob;function c(c,d){var e=this,f=!a.global&&(a!==J||b!==ob),g=f&&!O(),h=new K(function(b,h){bb(e,new Ya(wb(c,a,f,g),wb(d,a,f,g),b,h,a))});this._consoleTask&&(h._consoleTask=this._consoleTask);return h}c.prototype=Ia;return c},set:function(a){o(this,"then",a&&a.prototype===Ia?Xa:{get:function(){return a},set:Xa.set})}};m(K.prototype,{then:Xa,_then:function(a,b){bb(this,new Ya(null,null,a,b,J))},"catch":function(b){if(arguments.length===1)return this.then(null,b);var a=arguments[0],c=arguments[1];return typeof a==="function"?this.then(null,function(b){return b instanceof a?c(b):kb(b)}):this.then(null,function(b){return b&&b.name===a?c(b):kb(b)})},"finally":function(a){return this.then(function(b){return K.resolve(a()).then(function(){return b})},function(b){return K.resolve(a()).then(function(){return kb(b)})})},timeout:function(a,b){var c=this;return a<Infinity?new K(function(d,e){var f=setTimeout(function(){return e(new D.Timeout(b))},a);c.then(d,e)["finally"](clearTimeout.bind(null,f))}):this}});typeof Symbol!=="undefined"&&Symbol.toStringTag&&o(K.prototype,Symbol.toStringTag,"Dexie.Promise");I.env=ub();function Ya(a,b,c,d,e){this.onFulfilled=typeof a==="function"?a:null,this.onRejected=typeof b==="function"?b:null,this.resolve=c,this.reject=d,this.psd=e}m(K,{all:function(){var a=B.apply(null,arguments).map(rb);return new K(function(b,c){a.length===0&&b([]);var d=a.length;a.forEach(function(e,f){return K.resolve(e).then(function(c){a[f]=c,--d||b(a)},c)})})},resolve:function(a){if(a instanceof K)return a;if(a&&typeof a.then==="function")return new K(function(b,c){a.then(b,c)});var b=new K(Ia,!0,a);return b},reject:kb,race:function(){var a=B.apply(null,arguments).map(rb);return new K(function(b,c){a.map(function(a){return K.resolve(a).then(b,c)})})},PSD:{get:function(){return J},set:function(a){return J=a}},totalEchoes:{get:function(){return ob}},newPSD:N,usePSD:vb,scheduler:{get:function(){return Oa},set:function(a){Oa=a}},rejectionMapper:{get:function(){return Ta},set:function(a){Ta=a}},follow:function(a,b){return new K(function(c,d){return N(function(b,c){var d=J;d.unhandleds=[];d.onunhandled=c;d.finalize=F(function(){var a=this;hb(function(){a.unhandleds.length===0?b():c(a.unhandleds[0])})},d.finalize);a()},b,c,d)})}});La&&(La.allSettled&&o(K,"allSettled",function(){var a=B.apply(null,arguments).map(rb);return new K(function(b){a.length===0&&b([]);var c=a.length,d=new Array(c);a.forEach(function(a,e){return K.resolve(a).then(function(a){return d[e]={status:"fulfilled",value:a}},function(a){return d[e]={status:"rejected",reason:a}}).then(function(){return--c||b(d)})})})}),La.any&&typeof AggregateError!=="undefined"&&o(K,"any",function(){var a=B.apply(null,arguments).map(rb);return new K(function(b,c){a.length===0&&c(new AggregateError([]));var d=a.length,e=new Array(d);a.forEach(function(a,f){return K.resolve(a).then(function(a){return b(a)},function(a){e[f]=a,--d||c(new AggregateError(e))})})})}));function Za(a,b){try{b(function(b){if(a._state!==null)return;if(b===a)throw new TypeError("A promise cannot be resolved with itself.");var c=a._lib&&eb();b&&typeof b.then==="function"?Za(a,function(a,c){b instanceof K?b._then(a,c):b.then(a,c)}):(a._state=!0,a._value=b,ab(a));c&&fb()},$a.bind(null,a))}catch(b){$a(a,b)}}function $a(a,b){Sa.push(b);if(a._state!==null)return;var c=a._lib&&eb();b=Ta(b);a._state=!1;a._value=b;ib(a);ab(a);c&&fb()}function ab(a){var b=a._listeners;a._listeners=[];for(var c=0,d=b.length;c<d;++c)bb(a,b[c]);c=a._PSD;--c.ref||c.finalize();Va===0&&(++Va,Oa(function(){--Va===0&&gb()},[]))}function bb(a,b){if(a._state===null){a._listeners.push(b);return}var c=a._state?b.onFulfilled:b.onRejected;if(c===null)return(a._state?b.resolve:b.reject)(a._value);++b.psd.ref;++Va;Oa(cb,[c,a,b])}function cb(a,b,c){try{var d,e=b._value;!b._state&&Sa.length&&(Sa=[]);d=G&&b._consoleTask?b._consoleTask.run(function(){return a(e)}):a(e);!b._state&&Sa.indexOf(e)===-1&&jb(b);c.resolve(d)}catch(a){c.reject(a)}finally{--Va===0&&gb(),--c.psd.ref||c.psd.finalize()}}function db(){vb(I,function(){eb()&&fb()})}function eb(){var a=Pa;Pa=!1;Qa=!1;return a}function fb(){var a,b,c;do while(Ua.length>0){a=Ua;Ua=[];c=a.length;for(b=0;b<c;++b){var d=a[b];d[0].apply(null,d[1])}}while(Ua.length>0);Pa=!0;Qa=!0}function gb(){var a=Ra;Ra=[];a.forEach(function(a){a._PSD.onunhandled.call(null,a._value,a)});a=Wa.slice(0);var b=a.length;while(b)a[--b]()}function hb(a){function b(){a(),Wa.splice(Wa.indexOf(b),1)}Wa.push(b);++Va;Oa(function(){--Va===0&&gb()},[])}function ib(a){Ra.some(function(b){return b._value===a._value})||Ra.push(a)}function jb(a){var b=Ra.length;while(b)if(Ra[--b]._value===a._value){Ra.splice(b,1);return}}function kb(a){return new K(Ia,!1,a)}function L(a,b){var c=J;return function(){var d=eb(),e=J;try{P(c,!0);return a.apply(this,arguments)}catch(a){b&&b(a)}finally{P(e,!1),d&&fb()}}}var M={awaits:0,echoes:0,id:0},lb=0,mb=[],nb=0,ob=0,pb=0;function N(b,a,c,d){var e=J,f=Object.create(e);f.parent=e;f.ref=0;f.global=!1;f.id=++pb;I.env;f.env=Ma?{Promise:K,PromiseProp:{value:K,configurable:!0,writable:!0},all:K.all,race:K.race,allSettled:K.allSettled,any:K.any,resolve:K.resolve,reject:K.reject}:{};a&&i(f,a);++e.ref;f.finalize=function(){--this.parent.ref||this.parent.finalize()};a=vb(f,b,c,d);f.ref===0&&f.finalize();return a}function qb(){M.id||(M.id=++lb);++M.awaits;M.echoes+=Ja;return M.id}function O(){if(!M.awaits)return!1;--M.awaits===0&&(M.id=0);M.echoes=M.awaits*Ja;return!0}(""+H).indexOf("[native code]")===-1&&(qb=O=E);function rb(a){if(M.echoes&&a&&a.constructor===La){qb();return a.then(function(a){O();return a},function(a){O();return Q(a)})}return a}function sb(a){++ob,(!M.echoes||--M.echoes===0)&&(M.echoes=M.awaits=M.id=0),mb.push(J),P(a,!0)}function tb(){var a=mb[mb.length-1];mb.pop();P(a,!1)}function P(a,b){var c=J;(b?M.echoes&&(!nb++||a!==J):nb&&(!--nb||a!==J))&&queueMicrotask(b?sb.bind(null,a):tb);if(a===J)return;J=a;c===I&&(I.env=ub());if(Ma){b=I.env.Promise;var d=a.env;(c.global||a.global)&&(Object.defineProperty(f,"Promise",d.PromiseProp),b.all=d.all,b.race=d.race,b.resolve=d.resolve,b.reject=d.reject,d.allSettled&&(b.allSettled=d.allSettled),d.any&&(b.any=d.any))}}function ub(){var a=f.Promise;return Ma?{Promise:a,PromiseProp:Object.getOwnPropertyDescriptor(f,"Promise"),all:a.all,race:a.race,allSettled:a.allSettled,any:a.any,resolve:a.resolve,reject:a.reject}:{}}function vb(a,b,c,d,e){var f=J;try{P(a,!0);return b(c,d,e)}finally{P(f,!1)}}function wb(a,b,c,d){return typeof a!=="function"?a:function(){var e=J;c&&qb();P(b,!0);try{return a.apply(this,arguments)}finally{P(e,!1),d&&queueMicrotask(O)}}}function xb(a){Promise===La&&M.echoes===0?nb===0?a():enqueueNativeMicroTask(a):setTimeout(a,0)}var Q=K.reject;function yb(a,b,c,d){if(!a.idbdb||!a._state.openComplete&&!J.letThrough&&!a._vip){if(a._state.openComplete)return Q(new D.DatabaseClosed(a._state.dbOpenError));if(!a._state.isBeingOpened){if(!a._state.autoOpen)return Q(new D.DatabaseClosed());a.open()["catch"](E)}return a._state.dbReadyPromise.then(function(){return yb(a,b,c,d)})}else{var e=a._createTransaction(b,c,a._dbSchema);try{e.create(),a._state.PR1398_maxLoop=3}catch(e){if(e.name===wa.InvalidState&&a.isOpen()&&--a._state.PR1398_maxLoop>0){a.close({disableAutoOpen:!1});return a.open().then(function(){return yb(a,b,c,d)})}return Q(e)}return e._promise(b,function(a,b){return N(function(){J.trans=e;return d(a,b,e)})}).then(function(a){if(b==="readwrite")try{e.idbtrans.commit()}catch(a){}return b==="readonly"?a:e._completion.then(function(){return a})})}}Ka="4.0.1";var zb=String.fromCharCode(65535),Ab=-Infinity,R="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Bb="String expected.",Cb=[],Db="__dbnames",Eb="readonly",Fb="readwrite";function Gb(a,b){return a?b?function(){return a.apply(this,arguments)&&b.apply(this,arguments)}:a:b}var Hb={type:3,lower:-Infinity,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ib(a){return typeof a==="string"&&!/\./.test(a)?function(b){b[a]===void 0&&a in b&&(b=z(b),delete b[a]);return b}:function(a){return a}}function Jb(){throw D.Type()}function S(a,b){try{var c=Mb(a),d=Mb(b);if(c!==d){if(c==="Array")return 1;if(d==="Array")return-1;if(c==="binary")return 1;if(d==="binary")return-1;if(c==="string")return 1;if(d==="string")return-1;if(c==="Date")return 1;return d!=="Date"?NaN:-1}switch(c){case"number":case"Date":case"string":return a>b?1:a<b?-1:0;case"binary":return Lb(Nb(a),Nb(b));case"Array":return Kb(a,b)}}catch(a){}return NaN}function Kb(a,b){var c=a.length,d=b.length,e=c<d?c:d;for(var f=0;f<e;++f){var g=S(a[f],b[f]);if(g!==0)return g}return c===d?0:c<d?-1:1}function Lb(a,b){var c=a.length,d=b.length,e=c<d?c:d;for(var f=0;f<e;++f)if(a[f]!==b[f])return a[f]<b[f]?-1:1;return c===d?0:c<d?-1:1}function Mb(a){var b=typeof a;if(b!=="object")return b;if(ArrayBuffer.isView(a))return"binary";b=ma(a);return b==="ArrayBuffer"?"binary":b}function Nb(a){if(a instanceof Uint8Array)return a;return ArrayBuffer.isView(a)?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a)}var Ob=function(){function a(){}a.prototype._trans=function(b,c,d){var e=this._tx||J.trans,f=this.name,a=G&&typeof console!=="undefined"&&console.createTask&&console.createTask("Dexie: ".concat(b==="readonly"?"read":"write"," ").concat(this.name));function g(b,d,a){if(!a.schema[f])throw new D.NotFound("Table "+f+" not part of transaction");return c(a.idbtrans,a)}var h=eb();try{var i=e&&e.db._novip===this.db._novip?e===J.trans?e._promise(b,g,d):N(function(){return e._promise(b,g,d)},{trans:e,transless:J.transless||J}):yb(this.db,b,[this.name],g);a&&(i._consoleTask=a,i=i["catch"](function(a){console.trace(a);return Q(a)}));return i}finally{h&&fb()}};a.prototype.get=function(a,b){var c=this;if(a&&a.constructor===Object)return this.where(a).first(b);return a==null?Q(new D.Type("Invalid argument to Table.get()")):this._trans("readonly",function(b){return c.core.get({trans:b,key:a}).then(function(a){return c.hook.reading.fire(a)})}).then(b)};a.prototype.where=function(a){if(typeof a==="string")return new this.db.WhereClause(this,a);if(h(a))return new this.db.WhereClause(this,"[".concat(a.join("+"),"]"));var b=g(a);if(b.length===1)return this.where(b[0]).equals(a[b[0]]);var c=this.schema.indexes.concat(this.schema.primKey).filter(function(a){if(a.compound&&b.every(function(b){return a.keyPath.indexOf(b)>=0})){for(var c=0;c<b.length;++c)if(b.indexOf(a.keyPath[c])===-1)return!1;return!0}return!1}).sort(function(a,b){return a.keyPath.length-b.keyPath.length})[0];if(c&&this.db._maxKey!==zb){var d=c.keyPath.slice(0,b.length);return this.where(d).equals(d.map(function(b){return a[b]}))}!c&&G&&!1;var e=this.schema.idxByName,f=this.db._deps.indexedDB;function i(a,b){return f.cmp(a,b)===0}d=b.reduce(function(b,c){var d=b[0];b=b[1];var f=e[c],g=a[c];return[d||f,d||!f?Gb(b,f&&f.multi?function(a){a=w(a,c);return h(a)&&a.some(function(a){return i(g,a)})}:function(a){return i(g,w(a,c))}):b]},[null,null]);var j=d[0];d=d[1];return j?this.where(j.name).equals(a[j.keyPath]).filter(d):c?this.filter(d):this.where(b).equals("")};a.prototype.filter=function(a){return this.toCollection().and(a)};a.prototype.count=function(a){return this.toCollection().count(a)};a.prototype.offset=function(a){return this.toCollection().offset(a)};a.prototype.limit=function(a){return this.toCollection().limit(a)};a.prototype.each=function(a){return this.toCollection().each(a)};a.prototype.toArray=function(a){return this.toCollection().toArray(a)};a.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))};a.prototype.orderBy=function(a){return new this.db.Collection(new this.db.WhereClause(this,h(a)?"[".concat(a.join("+"),"]"):a))};a.prototype.reverse=function(){return this.toCollection().reverse()};a.prototype.mapToClass=function(a){var b=this,d=b.db,e=b.name;this.schema.mappedClass=a;a.prototype instanceof Jb&&(a=function(a){c(b,a);function b(){return a!==null&&a.apply(this,arguments)||this}Object.defineProperty(b.prototype,"db",{get:function(){return d},enumerable:!1,configurable:!0});b.prototype.table=function(){return e};return b}(a));var f=new Set();for(b=a.prototype;b;b=j(b))Object.getOwnPropertyNames(b).forEach(function(a){return f.add(a)});b=function(b){if(!b)return b;var c=Object.create(a.prototype);for(var d in b)if(!f.has(d))try{c[d]=b[d]}catch(a){}return c};this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook);this.schema.readHook=b;this.hook("reading",b);return a};a.prototype.defineClass=function(){function a(a){i(this,a)}return this.mapToClass(a)};a.prototype.add=function(a,b){var c=this,d=this.schema.primKey,e=d.auto,f=d.keyPath,g=a;f&&e&&(g=Ib(f)(a));return this._trans("readwrite",function(a){return c.core.mutate({trans:a,type:"add",keys:b!=null?[b]:null,values:[g]})}).then(function(a){return a.numFailures?K.reject(a.failures[0]):a.lastResult}).then(function(b){if(f)try{x(a,f,b)}catch(a){}return b})};a.prototype.update=function(a,b){if(typeof a==="object"&&!h(a)){var c=w(a,this.schema.primKey.keyPath);return c===void 0?Q(new D.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(c).modify(b)}else return this.where(":id").equals(a).modify(b)};a.prototype.put=function(a,b){var c=this,d=this.schema.primKey,e=d.auto,f=d.keyPath,g=a;f&&e&&(g=Ib(f)(a));return this._trans("readwrite",function(a){return c.core.mutate({trans:a,type:"put",values:[g],keys:b!=null?[b]:null})}).then(function(a){return a.numFailures?K.reject(a.failures[0]):a.lastResult}).then(function(b){if(f)try{x(a,f,b)}catch(a){}return b})};a.prototype["delete"]=function(a){var b=this;return this._trans("readwrite",function(c){return b.core.mutate({trans:c,type:"delete",keys:[a]})}).then(function(a){return a.numFailures?K.reject(a.failures[0]):void 0})};a.prototype.clear=function(){var a=this;return this._trans("readwrite",function(b){return a.core.mutate({trans:b,type:"deleteRange",range:Hb})}).then(function(a){return a.numFailures?K.reject(a.failures[0]):void 0})};a.prototype.bulkGet=function(a){var b=this;return this._trans("readonly",function(c){return b.core.getMany({keys:a,trans:c}).then(function(a){return a.map(function(a){return b.hook.reading.fire(a)})})})};a.prototype.bulkAdd=function(b,c,d){var e=this,a=Array.isArray(c)?c:void 0;d=d||(a?void 0:c);var f=d?d.allKeys:void 0;return this._trans("readwrite",function(c){var d=e.schema.primKey,g=d.auto;d=d.keyPath;if(d&&a)throw new D.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==b.length)throw new D.InvalidArgument("Arguments objects and keys must have the same length");var h=b.length;g=d&&g?b.map(Ib(d)):b;return e.core.mutate({trans:c,type:"add",keys:a,values:g,wantResults:f}).then(function(a){var b=a.numFailures,c=a.results,d=a.lastResult;a=a.failures;c=f?c:d;if(b===0)return c;throw new va("".concat(e.name,".bulkAdd(): ").concat(b," of ").concat(h," operations failed"),a)})})};a.prototype.bulkPut=function(b,c,d){var e=this,a=Array.isArray(c)?c:void 0;d=d||(a?void 0:c);var f=d?d.allKeys:void 0;return this._trans("readwrite",function(c){var d=e.schema.primKey,g=d.auto;d=d.keyPath;if(d&&a)throw new D.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==b.length)throw new D.InvalidArgument("Arguments objects and keys must have the same length");var h=b.length;g=d&&g?b.map(Ib(d)):b;return e.core.mutate({trans:c,type:"put",keys:a,values:g,wantResults:f}).then(function(a){var b=a.numFailures,c=a.results,d=a.lastResult;a=a.failures;c=f?c:d;if(b===0)return c;throw new va("".concat(e.name,".bulkPut(): ").concat(b," of ").concat(h," operations failed"),a)})})};a.prototype.bulkUpdate=function(b){var c=this,d=this.core,a=b.map(function(a){return a.key}),e=b.map(function(a){return a.changes}),f=[];return this._trans("readwrite",function(g){return d.getMany({trans:g,keys:a,cache:"clone"}).then(function(h){var i=[],j=[];b.forEach(function(a,b){var d=a.key;a=a.changes;var e=h[b];if(e){for(var g=0,k=Object.keys(a);g<k.length;g++){var l=k[g],m=a[l];if(l===c.schema.primKey.keyPath){if(S(m,d)!==0)throw new D.Constraint("Cannot update primary key in bulkUpdate()")}else x(e,l,m)}f.push(b);i.push(d);j.push(e)}});var k=i.length;return d.mutate({trans:g,type:"put",keys:i,values:j,updates:{keys:a,changeSpecs:e}}).then(function(a){var b=a.numFailures;a=a.failures;if(b===0)return k;for(var d=0,e=Object.keys(a);d<e.length;d++){var g=e[d],h=f[Number(g)];if(h!=null){var i=a[g];delete a[g];a[h]=i}}throw new va("".concat(c.name,".bulkUpdate(): ").concat(b," of ").concat(k," operations failed"),a)})})})};a.prototype.bulkDelete=function(a){var b=this,c=a.length;return this._trans("readwrite",function(c){return b.core.mutate({trans:c,type:"delete",keys:a})}).then(function(a){var d=a.numFailures,e=a.lastResult;a=a.failures;if(d===0)return e;throw new va("".concat(b.name,".bulkDelete(): ").concat(d," of ").concat(c," operations failed"),a)})};return a}();function Pb(a){var b={},c=function(d,e){if(e){var c=arguments.length,f=new Array(c-1);while(--c)f[c-1]=arguments[c];b[d].subscribe.apply(null,f);return a}else if(typeof d==="string")return b[d]};c.addEventType=f;for(var d=1,e=arguments.length;d<e;++d)f(arguments[d]);return c;function f(a,d,e){if(typeof a==="object")return i(a);d||(d=Fa);e||(e=E);var f={subscribers:[],fire:e,subscribe:function(a){f.subscribers.indexOf(a)===-1&&(f.subscribers.push(a),f.fire=d(f.fire,a))},unsubscribe:function(a){f.subscribers=f.subscribers.filter(function(b){return b!==a}),f.fire=f.subscribers.reduce(d,e)}};b[a]=c[a]=f;return f}function i(a){g(a).forEach(function(b){var c=a[b];if(h(c))f(b,a[b][0],a[b][1]);else if(c==="asap")var d=f(b,Aa,function(){var a=arguments.length,b=new Array(a);while(a--)b[a]=arguments[a];d.subscribers.forEach(function(a){aa(function(){a.apply(null,b)})})});else throw new D.InvalidArgument("Invalid event config")})}}function Qb(a,b){p(b).from({prototype:a});return b}function Rb(a){return Qb(Ob.prototype,function(b,c,d){this.db=a,this._tx=d,this.name=b,this.schema=c,this.hook=a._allTables[b]?a._allTables[b].hook:Pb(null,{creating:[Ca,E],reading:[Ba,Aa],updating:[Ea,E],deleting:[Da,E]})})}function Sb(a,b){return!(a.filter||a.algorithm||a.or)&&(b?a.justLimit:!a.replayFilter)}function Tb(a,b){a.filter=Gb(a.filter,b)}function Ub(a,b,c){var d=a.replayFilter;a.replayFilter=d?function(){return Gb(d(),b())}:b;a.justLimit=c&&!d}function Vb(a,b){a.isMatch=Gb(a.isMatch,b)}function Wb(a,b){if(a.isPrimKey)return b.primaryKey;var c=b.getIndexByKeyPath(a.index);if(!c)throw new D.Schema("KeyPath "+a.index+" on object store "+b.name+" is not indexed");return c}function Xb(a,b,c){var d=Wb(a,b.schema);return b.openCursor({trans:c,values:!a.keysOnly,reverse:a.dir==="prev",unique:!!a.unique,query:{index:d,range:a.range}})}function Yb(a,b,c,d){var e=a.replayFilter?Gb(a.filter,a.replayFilter()):a.filter;if(!a.or)return Zb(Xb(a,d,c),Gb(a.algorithm,e),b,!a.keysOnly&&a.valueMapper);else{var f={},g=function(a,c,d){if(!e||e(c,d,function(a){return c.stop(a)},function(a){return c.fail(a)})){var g=c.primaryKey,h=""+g;h==="[object ArrayBuffer]"&&(h=""+new Uint8Array(g));l(f,h)||(f[h]=!0,b(a,c,d))}};return Promise.all([a.or._iterate(g,c),Zb(Xb(a,d,c),a.algorithm,g,!a.keysOnly&&a.valueMapper)])}}function Zb(a,b,c,d){var e=d?function(a,b,e){return c(d(a),b,e)}:c,f=L(e);return a.then(function(a){if(a)return a.start(function(){var c=function(){return a["continue"]()};(!b||b(a,function(a){return c=a},function(b){a.stop(b),c=E},function(b){a.fail(b),c=E}))&&f(a.value,a,function(a){return c=a});c()})})}y=Symbol();var $b=function(){function a(a){Object.assign(this,a)}a.prototype.execute=function(a){var b;b=(b=this.replacePrefix)===null||b===void 0?void 0:b[0];return b&&typeof a==="string"&&a.startsWith(b)?this.replacePrefix[1]+a.substring(b.length):a};return a}(),ac=function(){function a(){}a.prototype._read=function(a,b){var c=this._ctx;return c.error?c.table._trans(null,Q.bind(null,c.error)):c.table._trans("readonly",a).then(b)};a.prototype._write=function(a){var b=this._ctx;return b.error?b.table._trans(null,Q.bind(null,b.error)):b.table._trans("readwrite",a,"locked")};a.prototype._addAlgorithm=function(a){var b=this._ctx;b.algorithm=Gb(b.algorithm,a)};a.prototype._iterate=function(a,b){return Yb(this._ctx,a,b,this._ctx.table.core)};a.prototype.clone=function(a){var b=Object.create(this.constructor.prototype),c=Object.create(this._ctx);a&&i(c,a);b._ctx=c;return b};a.prototype.raw=function(){this._ctx.valueMapper=null;return this};a.prototype.each=function(a){var b=this._ctx;return this._read(function(c){return Yb(b,a,c,b.table.core)})};a.prototype.count=function(a){var b=this;return this._read(function(a){var c=b._ctx,d=c.table.core;if(Sb(c,!0))return d.count({trans:a,query:{index:Wb(c,d.schema),range:c.range}}).then(function(a){return Math.min(a,c.limit)});else{var e=0;return Yb(c,function(){++e;return!1},a,d).then(function(){return e})}}).then(a)};a.prototype.sortBy=function(a,b){var c=a.split(".").reverse(),d=c[0],e=c.length-1;function f(a,b){return b?f(a[c[b]],b-1):a[d]}var g=this._ctx.dir==="next"?1:-1;function h(a,b){a=f(a,e);b=f(b,e);return a<b?-g:a>b?g:0}return this.toArray(function(a){return a.sort(h)}).then(b)};a.prototype.toArray=function(a){var b=this;return this._read(function(a){var c=b._ctx;if(c.dir==="next"&&Sb(c,!0)&&c.limit>0){var d=c.valueMapper,e=Wb(c,c.table.core.schema);return c.table.core.query({trans:a,limit:c.limit,values:!0,query:{index:e,range:c.range}}).then(function(a){a=a.result;return d?a.map(d):a})}else{var f=[];return Yb(c,function(a){return f.push(a)},a,c.table.core).then(function(){return f})}},a)};a.prototype.offset=function(a){var b=this._ctx;if(a<=0)return this;b.offset+=a;Sb(b)?Ub(b,function(){var b=a;return function(a,c){if(b===0)return!0;if(b===1){--b;return!1}c(function(){a.advance(b),b=0});return!1}}):Ub(b,function(){var b=a;return function(){return--b<0}});return this};a.prototype.limit=function(a){this._ctx.limit=Math.min(this._ctx.limit,a);Ub(this._ctx,function(){var b=a;return function(a,c,d){--b<=0&&c(d);return b>=0}},!0);return this};a.prototype.until=function(a,b){Tb(this._ctx,function(c,d,e){if(a(c.value)){d(e);return b}else return!0});return this};a.prototype.first=function(a){return this.limit(1).toArray(function(a){return a[0]}).then(a)};a.prototype.last=function(a){return this.reverse().first(a)};a.prototype.filter=function(a){Tb(this._ctx,function(b){return a(b.value)});Vb(this._ctx,a);return this};a.prototype.and=function(a){return this.filter(a)};a.prototype.or=function(a){return new this.db.WhereClause(this._ctx.table,a,this)};a.prototype.reverse=function(){this._ctx.dir=this._ctx.dir==="prev"?"next":"prev";this._ondirectionchange&&this._ondirectionchange(this._ctx.dir);return this};a.prototype.desc=function(){return this.reverse()};a.prototype.eachKey=function(a){var b=this._ctx;b.keysOnly=!b.isMatch;return this.each(function(b,c){a(c.key,c)})};a.prototype.eachUniqueKey=function(a){this._ctx.unique="unique";return this.eachKey(a)};a.prototype.eachPrimaryKey=function(a){var b=this._ctx;b.keysOnly=!b.isMatch;return this.each(function(b,c){a(c.primaryKey,c)})};a.prototype.keys=function(a){var b=this._ctx;b.keysOnly=!b.isMatch;var c=[];return this.each(function(a,b){c.push(b.key)}).then(function(){return c}).then(a)};a.prototype.primaryKeys=function(a){var b=this._ctx;if(b.dir==="next"&&Sb(b,!0)&&b.limit>0)return this._read(function(a){var c=Wb(b,b.table.core.schema);return b.table.core.query({trans:a,values:!1,limit:b.limit,query:{index:c,range:b.range}})}).then(function(a){a=a.result;return a}).then(a);b.keysOnly=!b.isMatch;var c=[];return this.each(function(a,b){c.push(b.primaryKey)}).then(function(){return c}).then(a)};a.prototype.uniqueKeys=function(a){this._ctx.unique="unique";return this.keys(a)};a.prototype.firstKey=function(a){return this.limit(1).keys(function(a){return a[0]}).then(a)};a.prototype.lastKey=function(a){return this.reverse().firstKey(a)};a.prototype.distinct=function(){var a=this._ctx;a=a.index&&a.table.schema.idxByName[a.index];if(!a||!a.multi)return this;var b={};Tb(this._ctx,function(a){a=a.primaryKey.toString();var c=l(b,a);b[a]=!0;return!c});return this};a.prototype.modify=function(a){var b=this,c=this._ctx;return this._write(function(d){var e;if(typeof a==="function")e=a;else{var f=g(a),h=f.length;e=function(b){var c=!1;for(var d=0;d<h;++d){var e=f[d],g=a[e],i=w(b,e);g instanceof $b?(x(b,e,g.execute(i)),c=!0):i!==g&&(x(b,e,g),c=!0)}return c}}var i=c.table.core,j=i.schema.primaryKey,k=j.outbound,l=j.extractKey,m=b.db._options.modifyChunkSize||200,n=[],o=0,p=[],q=function(a,b){var c=b.failures;b=b.numFailures;o+=a-b;for(a=0,b=g(c);a<b.length;a++){var d=b[a];n.push(c[d])}};return b.clone().primaryKeys().then(function(b){var f=function(g){var h=Math.min(m,b.length-g);return i.getMany({trans:d,keys:b.slice(g,g+h),cache:"immutable"}).then(function(j){var n=[],o=[],p=k?[]:null,r=[];for(var s=0;s<h;++s){var t=j[s],u={value:z(t),primKey:b[g+s]};e.call(u,u.value,u)!==!1&&(u.value==null?r.push(b[g+s]):!k&&S(l(t),l(u.value))!==0?(r.push(b[g+s]),n.push(u.value)):(o.push(u.value),k&&p.push(b[g+s])))}var v=Sb(c)&&c.limit===Infinity&&(typeof a!=="function"||a===bc)&&{index:c.index,range:c.range};return Promise.resolve(n.length>0&&i.mutate({trans:d,type:"add",values:n}).then(function(a){for(var b in a.failures)r.splice(parseInt(b),1);q(n.length,a)})).then(function(){return(o.length>0||v&&typeof a==="object")&&i.mutate({trans:d,type:"put",keys:p,values:o,criteria:v,changeSpec:typeof a!=="function"&&a}).then(function(a){return q(o.length,a)})}).then(function(){return(r.length>0||v&&a===bc)&&i.mutate({trans:d,type:"delete",keys:r,criteria:v}).then(function(a){return q(r.length,a)})}).then(function(){return b.length>g+h&&f(g+m)})})};return f(0).then(function(){if(n.length>0)throw new ua("Error modifying one or more objects",n,o,p);return b.length})})})};a.prototype["delete"]=function(){var a=this._ctx,b=a.range;return Sb(a)&&(a.isPrimKey||b.type===3)?this._write(function(c){var d=a.table.core.schema.primaryKey,e=b;return a.table.core.count({trans:c,query:{index:d,range:e}}).then(function(b){return a.table.core.mutate({trans:c,type:"deleteRange",range:e}).then(function(a){var c=a.failures;a.lastResult;a.results;a=a.numFailures;if(a)throw new ua("Could not delete some values",Object.keys(c).map(function(a){return c[a]}),b-a);return b-a})})}):this.modify(bc)};return a}(),bc=function(a,b){return b.value=null};function cc(a){return Qb(ac.prototype,function(b,c){this.db=a;var d=Hb,e=null;if(c)try{d=c()}catch(a){e=a}c=b._ctx;b=c.table;var f=b.hook.reading.fire;this._ctx={table:b,index:c.index,isPrimKey:!c.index||b.schema.primKey.keyPath&&c.index===b.schema.primKey.name,range:d,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:Infinity,error:e,or:c.or,valueMapper:f!==Aa?f:null}})}function dc(a,b){return a<b?-1:a===b?0:1}function ec(a,b){return a>b?-1:a===b?0:1}function T(a,b,c){a=a instanceof lc?new a.Collection(a):a;a._ctx.error=c?new c(b):new TypeError(b);return a}function fc(a){return new a.Collection(a,function(){return kc("")}).limit(0)}function gc(a){return a==="next"?function(a){return a.toUpperCase()}:function(a){return a.toLowerCase()}}function hc(a){return a==="next"?function(a){return a.toLowerCase()}:function(a){return a.toUpperCase()}}function ic(b,c,d,e,a,f){var g=Math.min(b.length,e.length),h=-1;for(var i=0;i<g;++i){var j=c[i];if(j!==e[i]){if(a(b[i],d[i])<0)return b.substr(0,i)+d[i]+d.substr(i+1);if(a(b[i],e[i])<0)return b.substr(0,i)+e[i]+d.substr(i+1);return h>=0?b.substr(0,h)+c[h]+d.substr(h+1):null}a(b[i],j)<0&&(h=i)}if(g<e.length&&f==="next")return b+d.substr(b.length);return g<b.length&&f==="prev"?b.substr(0,d.length):h<0?null:b.substr(0,h)+e[h]+d.substr(h+1)}function jc(a,b,c,d){var e,f,g,h,i,j,k,l=c.length;if(!c.every(function(a){return typeof a==="string"}))return T(a,Bb);function m(a){e=gc(a);f=hc(a);g=a==="next"?dc:ec;var b=c.map(function(a){return{lower:f(a),upper:e(a)}}).sort(function(a,b){return g(a.lower,b.lower)});h=b.map(function(a){return a.upper});i=b.map(function(a){return a.lower});j=a;k=a==="next"?"":d}m("next");a=new a.Collection(a,function(){return U(h[0],i[l-1]+d)});a._ondirectionchange=function(a){m(a)};var n=0;a._addAlgorithm(function(a,c,d){var e=a.key;if(typeof e!=="string")return!1;var m=f(e);if(b(m,i,n))return!0;else{var o=null;for(var p=n;p<l;++p){var q=ic(e,m,h[p],i[p],g,j);q===null&&o===null?n=p+1:(o===null||g(o,q)>0)&&(o=q)}o!==null?c(function(){a["continue"](o+k)}):c(d);return!1}});return a}function U(a,b,c,d){return{type:2,lower:a,upper:b,lowerOpen:c,upperOpen:d}}function kc(a){return{type:1,lower:a,upper:a}}var lc=function(){function a(){}Object.defineProperty(a.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0});a.prototype.between=function(a,b,c,d){c=c!==!1;d=d===!0;try{return this._cmp(a,b)>0||this._cmp(a,b)===0&&(c||d)&&!(c&&d)?fc(this):new this.Collection(this,function(){return U(a,b,!c,!d)})}catch(a){return T(this,R)}};a.prototype.equals=function(a){return a==null?T(this,R):new this.Collection(this,function(){return kc(a)})};a.prototype.above=function(a){return a==null?T(this,R):new this.Collection(this,function(){return U(a,void 0,!0)})};a.prototype.aboveOrEqual=function(a){return a==null?T(this,R):new this.Collection(this,function(){return U(a,void 0,!1)})};a.prototype.below=function(a){return a==null?T(this,R):new this.Collection(this,function(){return U(void 0,a,!1,!0)})};a.prototype.belowOrEqual=function(a){return a==null?T(this,R):new this.Collection(this,function(){return U(void 0,a)})};a.prototype.startsWith=function(a){return typeof a!=="string"?T(this,Bb):this.between(a,a+zb,!0,!0)};a.prototype.startsWithIgnoreCase=function(a){return a===""?this.startsWith(a):jc(this,function(a,b){return a.indexOf(b[0])===0},[a],zb)};a.prototype.equalsIgnoreCase=function(a){return jc(this,function(a,b){return a===b[0]},[a],"")};a.prototype.anyOfIgnoreCase=function(){var a=B.apply(pa,arguments);return a.length===0?fc(this):jc(this,function(a,b){return b.indexOf(a)!==-1},a,"")};a.prototype.startsWithAnyOfIgnoreCase=function(){var a=B.apply(pa,arguments);return a.length===0?fc(this):jc(this,function(a,b){return b.some(function(b){return a.indexOf(b)===0})},a,zb)};a.prototype.anyOf=function(){var a=this,b=B.apply(pa,arguments),c=this._cmp;try{b.sort(c)}catch(a){return T(this,R)}if(b.length===0)return fc(this);var d=new this.Collection(this,function(){return U(b[0],b[b.length-1])});d._ondirectionchange=function(d){c=d==="next"?a._ascending:a._descending,b.sort(c)};var e=0;d._addAlgorithm(function(a,d,f){var g=a.key;while(c(g,b[e])>0){++e;if(e===b.length){d(f);return!1}}if(c(g,b[e])===0)return!0;else{d(function(){a["continue"](b[e])});return!1}});return d};a.prototype.notEqual=function(a){return this.inAnyRange([[Ab,a],[a,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})};a.prototype.noneOf=function(){var a=B.apply(pa,arguments);if(a.length===0)return new this.Collection(this);try{a.sort(this._ascending)}catch(a){return T(this,R)}var b=a.reduce(function(a,b){return a?a.concat([[a[a.length-1][1],b]]):[[Ab,b]]},null);b.push([a[a.length-1],this.db._maxKey]);return this.inAnyRange(b,{includeLowers:!1,includeUppers:!1})};a.prototype.inAnyRange=function(c,d){var e=this,a=this._cmp,f=this._ascending,g=this._descending,h=this._min,i=this._max;if(c.length===0)return fc(this);if(!c.every(function(a){return a[0]!==void 0&&a[1]!==void 0&&f(a[0],a[1])<=0}))return T(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",D.InvalidArgument);var j=!d||d.includeLowers!==!1,k=d&&d.includeUppers===!0;function b(b,c){var d=0,e=b.length;for(;d<e;++d){var f=b[d];if(a(c[0],f[1])<0&&a(c[1],f[0])>0){f[0]=h(f[0],c[0]);f[1]=i(f[1],c[1]);break}}d===e&&b.push(c);return b}var l=f;function m(a,b){return l(a[0],b[0])}var n;try{n=c.reduce(b,[]),n.sort(m)}catch(a){return T(this,R)}var o=0,p=k?function(a){return f(a,n[o][1])>0}:function(a){return f(a,n[o][1])>=0},q=j?function(a){return g(a,n[o][0])>0}:function(a){return g(a,n[o][0])>=0};function r(a){return!p(a)&&!q(a)}var s=p;d=new this.Collection(this,function(){return U(n[0][0],n[n.length-1][1],!j,!k)});d._ondirectionchange=function(a){a==="next"?(s=p,l=f):(s=q,l=g),n.sort(m)};d._addAlgorithm(function(a,b,c){var d=a.key;while(s(d)){++o;if(o===n.length){b(c);return!1}}if(r(d))return!0;else if(e._cmp(d,n[o][1])===0||e._cmp(d,n[o][0])===0)return!1;else{b(function(){l===f?a["continue"](n[o][0]):a["continue"](n[o][1])});return!1}});return d};a.prototype.startsWithAnyOf=function(){var a=B.apply(pa,arguments);if(!a.every(function(a){return typeof a==="string"}))return T(this,"startsWithAnyOf() only works with strings");return a.length===0?fc(this):this.inAnyRange(a.map(function(a){return[a,a+zb]}))};return a}();function mc(a){return Qb(lc.prototype,function(b,c,d){this.db=a;this._ctx={table:b,index:c===":id"?null:c,or:d};this._cmp=this._ascending=S;this._descending=function(a,b){return S(b,a)};this._max=function(a,b){return S(a,b)>0?a:b};this._min=function(a,b){return S(a,b)<0?a:b};this._IDBKeyRange=a._deps.IDBKeyRange;if(!this._IDBKeyRange)throw new D.MissingAPI()})}function V(a){return L(function(b){nc(b);a(b.target.error);return!1})}function nc(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault()}var oc="storagemutated",pc="x-storagemutated-1",W=Pb(null,oc),qc=function(){function a(){}a.prototype._lock=function(){v(!J.global);++this._reculock;this._reculock===1&&!J.global&&(J.lockOwnerFor=this);return this};a.prototype._unlock=function(){v(!J.global);if(--this._reculock===0){J.global||(J.lockOwnerFor=null);while(this._blockedFuncs.length>0&&!this._locked()){var a=this._blockedFuncs.shift();try{vb(a[1],a[0])}catch(a){}}}return this};a.prototype._locked=function(){return this._reculock&&J.lockOwnerFor!==this};a.prototype.create=function(a){var b=this;if(!this.mode)return this;var c=this.db.idbdb,d=this.db._state.dbOpenError;v(!this.idbtrans);if(!a&&!c)switch(d&&d.name){case"DatabaseClosedError":throw new D.DatabaseClosed(d);case"MissingAPIError":throw new D.MissingAPI(d.message,d);default:throw new D.OpenFailed(d)}if(!this.active)throw new D.TransactionInactive();v(this._completion._state===null);a=this.idbtrans=a||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):c.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}));a.onerror=L(function(c){nc(c),b._reject(a.error)});a.onabort=L(function(c){nc(c),b.active&&b._reject(new D.Abort(a.error)),b.active=!1,b.on("abort").fire(c)});a.oncomplete=L(function(){b.active=!1,b._resolve(),"mutatedParts"in a&&W.storagemutated.fire(a.mutatedParts)});return this};a.prototype._promise=function(a,b,c){var d=this;if(a==="readwrite"&&this.mode!=="readwrite")return Q(new D.ReadOnly("Transaction is readonly"));if(!this.active)return Q(new D.TransactionInactive());if(this._locked())return new K(function(e,f){d._blockedFuncs.push([function(){d._promise(a,b,c).then(e,f)},J])});else if(c)return N(function(){var a=new K(function(a,c){d._lock();var e=b(a,c,d);e&&e.then&&e.then(a,c)});a["finally"](function(){return d._unlock()});a._lib=!0;return a});else{var e=new K(function(a,c){var e=b(a,c,d);e&&e.then&&e.then(a,c)});e._lib=!0;return e}};a.prototype._root=function(){return this.parent?this.parent._root():this};a.prototype.waitFor=function(a){var b=this._root(),c=K.resolve(a);if(b._waitingFor)b._waitingFor=b._waitingFor.then(function(){return c});else{b._waitingFor=c;b._waitingQueue=[];var d=b.idbtrans.objectStore(b.storeNames[0]);(function a(){++b._spinCount;while(b._waitingQueue.length)b._waitingQueue.shift()();b._waitingFor&&(d.get(-Infinity).onsuccess=a)})()}var e=b._waitingFor;return new K(function(a,d){c.then(function(c){return b._waitingQueue.push(L(a.bind(null,c)))},function(a){return b._waitingQueue.push(L(d.bind(null,a)))})["finally"](function(){b._waitingFor===e&&(b._waitingFor=null)})})};a.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new D.Abort()))};a.prototype.table=function(a){var b=this._memoizedTables||(this._memoizedTables={});if(l(b,a))return b[a];var c=this.schema[a];if(!c)throw new D.NotFound("Table "+a+" not part of transaction");c=new this.db.Table(a,c,this);c.core=this.db.core.table(a);b[a]=c;return c};return a}();function rc(a){return Qb(qc.prototype,function(b,c,d,e,f){var g=this;this.db=a;this.mode=b;this.storeNames=c;this.schema=d;this.chromeTransactionDurability=e;this.idbtrans=null;this.on=Pb(this,"complete","error","abort");this.parent=f||null;this.active=!0;this._reculock=0;this._blockedFuncs=[];this._resolve=null;this._reject=null;this._waitingFor=null;this._waitingQueue=null;this._spinCount=0;this._completion=new K(function(a,b){g._resolve=a,g._reject=b});this._completion.then(function(){g.active=!1,g.on.complete.fire()},function(a){var b=g.active;g.active=!1;g.on.error.fire(a);g.parent?g.parent._reject(a):b&&g.idbtrans&&g.idbtrans.abort();return Q(a)})})}function sc(a,b,c,d,e,f,g){return{name:a,keyPath:b,unique:c,multi:d,auto:e,compound:f,src:(c&&!g?"&":"")+(d?"*":"")+(e?"++":"")+tc(b)}}function tc(a){return typeof a==="string"?a:a?"["+[].join.call(a,"+")+"]":""}function uc(a,b,c){return{name:a,primKey:b,indexes:c,mappedClass:null,idxByName:ba(c,function(a){return[a.name,a]})}}function vc(a){return a.length===1?a[0]:a}var wc=function(a){try{a.only([[]]);wc=function(){return[[]]};return[[]]}catch(a){wc=function(){return zb};return zb}};function xc(a){if(a==null)return function(){return void 0};else if(typeof a==="string")return yc(a);else return function(b){return w(b,a)}}function yc(a){var b=a.split(".");if(b.length===1)return function(b){return b[a]};else return function(b){return w(b,a)}}function zc(a){return[].slice.call(a)}var Ac=0;function Bc(a){return a==null?":id":typeof a==="string"?a:"[".concat(a.join("+"),"]")}function Cc(a,b,c){function d(a,b){var c=zc(a.objectStoreNames);return{schema:{name:a.name,tables:c.map(function(a){return b.objectStore(a)}).map(function(a){var b=a.keyPath,c=a.autoIncrement,d=h(b),e=b==null,f={};e={name:a.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:e,compound:d,keyPath:b,autoIncrement:c,unique:!0,extractKey:xc(b)},indexes:zc(a.indexNames).map(function(b){return a.index(b)}).map(function(b){var c=b.name,d=b.unique,e=b.multiEntry;b=b.keyPath;var a=h(b);c={name:c,compound:a,keyPath:b,unique:d,multiEntry:e,extractKey:xc(b)};f[Bc(b)]=c;return c}),getIndexByKeyPath:function(a){return f[Bc(a)]}};f[":id"]=e.primaryKey;b!=null&&(f[Bc(b)]=e.primaryKey);return e})},hasGetAll:c.length>0&&"getAll"in b.objectStore(c[0])&&!(typeof navigator!=="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}function e(a){if(a.type===3)return null;if(a.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var c=a.lower,d=a.upper,e=a.lowerOpen;a=a.upperOpen;c=c===void 0?d===void 0?null:b.upperBound(d,!!a):d===void 0?b.lowerBound(c,!!e):b.bound(c,d,!!e,!!a);return c}function f(b){var c=b.name;function d(d){var f=d.trans,b=d.type,a=d.keys,g=d.values,h=d.range;return new Promise(function(d,i){d=L(d);i=f.objectStore(c);var j=i.keyPath==null,k=b==="put"||b==="add";if(!k&&b!=="delete"&&b!=="deleteRange")throw new Error("Invalid operation type: "+b);var l=(a||g||{length:1}).length;if(a&&g&&a.length!==g.length)throw new Error("Given keys array must have same length as given values array.");if(l===0)return d({numFailures:0,failures:{},results:[],lastResult:void 0});var m,n=[],o=[],p=0,q=function(a){++p,nc(a)};if(b==="deleteRange"){if(h.type===4)return d({numFailures:p,failures:o,results:[],lastResult:void 0});h.type===3?n.push(m=i.clear()):n.push(m=i["delete"](e(h)))}else{j=k?j?[g,a]:[g,null]:[a,null];var r=j[0];j=j[1];if(k)for(k=0;k<l;++k)n.push(m=j&&j[k]!==void 0?i[b](r[k],j[k]):i[b](r[k])),m.onerror=q;else for(k=0;k<l;++k)n.push(m=i[b](r[k])),m.onerror=q}var s=function(c){c=c.target.result;n.forEach(function(a,b){return a.error!=null&&(o[b]=a.error)});d({numFailures:p,failures:o,results:b==="delete"?a:n.map(function(a){return a.result}),lastResult:c})};m.onerror=function(a){q(a),s(a)};m.onsuccess=s})}function a(b){var d=b.trans,f=b.values,a=b.query,g=b.reverse,h=b.unique;return new Promise(function(b,i){b=L(b);var j=a.index,k=a.range,l=d.objectStore(c);l=j.isPrimaryKey?l:l.index(j.name);j=g?h?"prevunique":"prev":h?"nextunique":"next";var m=f||!("openKeyCursor"in l)?l.openCursor(e(k),j):l.openKeyCursor(e(k),j);m.onerror=V(i);m.onsuccess=L(function(a){var c=m.result;if(!c){b(null);return}c.___id=++Ac;c.done=!1;var e=c["continue"].bind(c),f=c.continuePrimaryKey;f&&(f=f.bind(c));var g=c.advance.bind(c);a=function(){throw new Error("Cursor not started")};var h=function(){throw new Error("Cursor not stopped")};c.trans=d;c.stop=c["continue"]=c.continuePrimaryKey=c.advance=a;c.fail=L(i);c.next=function(){var a=this,b=1;return this.start(function(){return b--?a["continue"]():a.stop()}).then(function(){return a})};c.start=function(a){var b=new Promise(function(a,b){a=L(a),m.onerror=V(b),c.fail=b,c.stop=function(b){c.stop=c["continue"]=c.continuePrimaryKey=c.advance=h,a(b)}}),d=function(){if(m.result)try{a()}catch(a){c.fail(a)}else c.done=!0,c.start=function(){throw new Error("Cursor behind last entry")},c.stop()};m.onsuccess=L(function(a){m.onsuccess=d,d()});c["continue"]=e;c.continuePrimaryKey=f;c.advance=g;d();return b};b(c)},i)})}function f(a){return function(b){return new Promise(function(f,g){f=L(f);var h=b.trans,i=b.values,j=b.limit,d=b.query,k=j===Infinity?void 0:j,l=d.index;d=d.range;h=h.objectStore(c);h=l.isPrimaryKey?h:h.index(l.name);l=e(d);if(j===0)return f({result:[]});if(a){d=i?h.getAll(l,k):h.getAllKeys(l,k);d.onsuccess=function(a){return f({result:a.target.result})};d.onerror=V(g)}else{var m=0,n=i||!("openKeyCursor"in h)?h.openCursor(l):h.openKeyCursor(l),o=[];n.onsuccess=function(a){a=n.result;if(!a)return f({result:o});o.push(i?a.value:a.primaryKey);if(++m===j)return f({result:o});a["continue"]()};n.onerror=V(g)}})}}return{name:c,schema:b,mutate:d,getMany:function(b){var d=b.trans,a=b.keys;return new Promise(function(b,e){b=L(b);var f=d.objectStore(c),g=a.length,h=new Array(g),i=0,j=0,k=function(a){a=a.target;(h[a._pos]=a.result)!=null;++j===i&&b(h)};e=V(e);for(var l=0;l<g;++l){var m=a[l];m!=null&&(m=f.get(a[l]),m._pos=l,m.onsuccess=k,m.onerror=e,++i)}i===0&&b(h)})},get:function(a){var b=a.trans,d=a.key;return new Promise(function(a,e){a=L(a);var f=b.objectStore(c);f=f.get(d);f.onsuccess=function(b){return a(b.target.result)};f.onerror=V(e)})},query:f(g),openCursor:a,count:function(b){var a=b.query,d=b.trans,f=a.index,g=a.range;return new Promise(function(a,b){var h=d.objectStore(c);h=f.isPrimaryKey?h:h.index(f.name);var i=e(g);i=i?h.count(i):h.count();i.onsuccess=L(function(b){return a(b.target.result)});i.onerror=V(b)})}}}d=d(a,c);c=d.schema;var g=d.hasGetAll;d=c.tables.map(function(a){return f(a)});var i={};d.forEach(function(a){return i[a.name]=a});return{stack:"dbcore",transaction:a.transaction.bind(a),table:function(a){var b=i[a];if(!b)throw new Error("Table '".concat(a,"' not found"));return i[a]},MIN_KEY:-Infinity,MAX_KEY:wc(b),schema:c}}function Dc(a,b){return b.reduce(function(a,b){b=b.create;return d(d({},a),b(a))},a)}function Ec(a,b,c,d){var e=c.IDBKeyRange;c.indexedDB;c=Dc(Cc(b,e,d),a.dbcore);return{dbcore:c}}function Fc(a,b){var c=b.db;c=Ec(a._middlewares,c,a._deps,b);a.core=c.dbcore;a.tables.forEach(function(b){var c=b.name;a.core.schema.tables.some(function(a){return a.name===c})&&(b.core=a.core.table(c),a[c]instanceof a.Table&&(a[c].core=b.core))})}function Gc(a,b,c,d){c.forEach(function(c){var e=d[c];b.forEach(function(b){var d=r(b,c);(!d||"value"in d&&d.value===void 0)&&(b===a.Transaction.prototype||b instanceof a.Transaction?o(b,c,{get:function(){return this.table(c)},set:function(a){n(this,c,{value:a,writable:!0,configurable:!0,enumerable:!0})}}):b[c]=new a.Table(c,e))})})}function Hc(a,b){b.forEach(function(b){for(var c in b)b[c]instanceof a.Table&&delete b[c]})}function Ic(a,b){return a._cfg.version-b._cfg.version}function Jc(a,b,c,d){var e=a._dbSchema;c.objectStoreNames.contains("$meta")&&!e.$meta&&(e.$meta=uc("$meta",Wc("")[0],[]),a._storeNames.push("$meta"));var f=a._createTransaction("readwrite",a._storeNames,e);f.create(c);f._completion["catch"](d);var h=f._reject.bind(f),i=J.transless||J;N(function(){J.trans=f;J.transless=i;if(b===0)g(e).forEach(function(a){Oc(c,a,e[a].primKey,e[a].indexes)}),Fc(a,c),K.follow(function(){return a.on.populate.fire(f)})["catch"](h);else{Fc(a,c);return Lc(a,f,b).then(function(b){return Mc(a,b,f,c)})["catch"](h)}})}function Kc(a,b){Pc(a._dbSchema,b);b.db.version%10===0&&!b.objectStoreNames.contains("$meta")&&b.db.createObjectStore("$meta").add(Math.ceil(b.db.version/10-1),"version");var c=Sc(a,a.idbdb,b);Vc(a,a._dbSchema,b);c=Nc(c,a._dbSchema);a=function(a){if(a.change.length||a.recreate)return{value:void 0};var c=b.objectStore(a.name);a.add.forEach(function(a){G&&!1,Rc(c,a)})};for(var d=0,c=c.change;d<c.length;d++){var e=c[d];e=a(e);if(typeof e==="object")return e.value}}function Lc(a,b,c){if(b.storeNames.includes("$meta"))return b.table("$meta").get("version").then(function(a){return a!=null?a:c});else return K.resolve(c)}function Mc(a,b,c,d){var e=[],f=a._versions,h=a._dbSchema=Sc(a,a.idbdb,d);f=f.filter(function(a){return a._cfg.version>=b});if(f.length===0)return K.resolve();f.forEach(function(f){e.push(function(){var e=h,i=f._cfg.dbschema;Vc(a,e,d);Vc(a,i,d);h=a._dbSchema=i;var j=Nc(e,i);j.add.forEach(function(a){Oc(d,a[0],a[1].primKey,a[1].indexes)});j.change.forEach(function(a){if(a.recreate)throw new D.Upgrade("Not yet support for changing primary key");else{var b=d.objectStore(a.name);a.add.forEach(function(a){return Rc(b,a)});a.change.forEach(function(a){b.deleteIndex(a.name),Rc(b,a)});a.del.forEach(function(a){return b.deleteIndex(a)})}});var k=f._cfg.contentUpgrade;if(k&&f._cfg.version>b){Fc(a,d);c._memoizedTables={};var l=da(i);j.del.forEach(function(a){l[a]=e[a]});Hc(a,[a.Transaction.prototype]);Gc(a,[a.Transaction.prototype],g(l),l);c.schema=l;var m=qa(k);m&&qb();var n;i=K.follow(function(){n=k(c);if(n&&m){var a=O.bind(null,null);n.then(a,a)}});return n&&typeof n.then==="function"?K.resolve(n):i.then(function(){return n})}}),e.push(function(b){var d=f._cfg.dbschema;Qc(d,b);Hc(a,[a.Transaction.prototype]);Gc(a,[a.Transaction.prototype],a._storeNames,a._dbSchema);c.schema=a._dbSchema}),e.push(function(b){a.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(a.idbdb.version/10)===f._cfg.version?(a.idbdb.deleteObjectStore("$meta"),delete a._dbSchema.$meta,a._storeNames=a._storeNames.filter(function(a){return a!=="$meta"})):b.objectStore("$meta").put(f._cfg.version,"version"))})});function i(){return e.length?K.resolve(e.shift()(c.idbtrans)).then(i):K.resolve()}return i().then(function(){Pc(h,d)})}function Nc(a,b){var c={del:[],add:[],change:[]},d;for(d in a)b[d]||c.del.push(d);for(d in b){var e=a[d],f=b[d];if(!e)c.add.push([d,f]);else{var g={name:d,def:f,recreate:!1,del:[],add:[],change:[]};if(""+(e.primKey.keyPath||"")!==""+(f.primKey.keyPath||"")||e.primKey.auto!==f.primKey.auto)g.recreate=!0,c.change.push(g);else{e=e.idxByName;f=f.idxByName;var h;for(h in e)f[h]||g.del.push(h);for(h in f){var i=e[h],j=f[h];!i?g.add.push(j):i.src!==j.src&&g.change.push(j)}(g.del.length>0||g.add.length>0||g.change.length>0)&&c.change.push(g)}}}return c}function Oc(a,b,c,d){var e=a.db.createObjectStore(b,c.keyPath?{keyPath:c.keyPath,autoIncrement:c.auto}:{autoIncrement:c.auto});d.forEach(function(a){return Rc(e,a)});return e}function Pc(a,b){g(a).forEach(function(c){b.db.objectStoreNames.contains(c)||(G&&!1,Oc(b,c,a[c].primKey,a[c].indexes))})}function Qc(a,b){[].slice.call(b.db.objectStoreNames).forEach(function(c){return a[c]==null&&b.db.deleteObjectStore(c)})}function Rc(a,b){a.createIndex(b.name,b.keyPath,{unique:b.unique,multiEntry:b.multi})}function Sc(a,b,c){var d={};a=t(b.objectStoreNames,0);a.forEach(function(a){var b=c.objectStore(a),e=b.keyPath,f=sc(tc(e),e||"",!0,!1,!!b.autoIncrement,e&&typeof e!=="string",!0),g=[];for(var h=0;h<b.indexNames.length;++h){var i=b.index(b.indexNames[h]);e=i.keyPath;i=sc(i.name,e,!!i.unique,!!i.multiEntry,!1,e&&typeof e!=="string",!1);g.push(i)}d[a]=uc(a,f,g)});return d}function Tc(a,b,c){a.verno=b.version/10;c=a._dbSchema=Sc(a,b,c);a._storeNames=t(b.objectStoreNames,0);Gc(a,[a._allTables],g(c),c)}function Uc(a,b){b=Sc(a,a.idbdb,b);b=Nc(b,a._dbSchema);return!(b.add.length||b.change.some(function(a){return a.add.length||a.change.length}))}function Vc(a,b,c){var d=c.db.objectStoreNames;for(var e=0;e<d.length;++e){var g=d[e],h=c.objectStore(g);a._hasGetAll="getAll"in h;for(var i=0;i<h.indexNames.length;++i){var j=h.indexNames[i],k=h.index(j).keyPath;k=typeof k==="string"?k:"["+t(k).join("+")+"]";if(b[g]){var l=b[g].idxByName[k];l&&(l.name=j,delete b[g].idxByName[k],b[g].idxByName[j]=l)}}}typeof navigator!=="undefined"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&f.WorkerGlobalScope&&f instanceof f.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(a._hasGetAll=!1)}function Wc(a){return a.split(",").map(function(a,b){a=a.trim();var c=a.replace(/([&*]|\+\+)/g,""),d=/^\[/.test(c)?c.match(/^\[(.*)\]$/)[1].split("+"):c;return sc(c,d||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),h(d),b===0)})}var Xc=function(){function a(){}a.prototype._parseStoresSpec=function(a,b){g(a).forEach(function(c){if(a[c]!==null){var d=Wc(a[c]),e=d.shift();e.unique=!0;if(e.multi)throw new D.Schema("Primary key cannot be multi-valued");d.forEach(function(a){if(a.auto)throw new D.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new D.Schema("Index must have a name and cannot be an empty string")});b[c]=uc(c,e,d)}})};a.prototype.stores=function(a){var b=this.db;this._cfg.storesSource=this._cfg.storesSource?i(this._cfg.storesSource,a):a;a=b._versions;var c={},d={};a.forEach(function(a){i(c,a._cfg.storesSource),d=a._cfg.dbschema={},a._parseStoresSpec(c,d)});b._dbSchema=d;Hc(b,[b._allTables,b,b.Transaction.prototype]);Gc(b,[b._allTables,b,b.Transaction.prototype,this._cfg.tables],g(d),d);b._storeNames=g(d);return this};a.prototype.upgrade=function(a){this._cfg.contentUpgrade=Ga(this._cfg.contentUpgrade||E,a);return this};return a}();function Yc(a){return Qb(Xc.prototype,function(b){this.db=a,this._cfg={version:b,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}function Zc(a,b){var c=a._dbNamesDB;c||(c=a._dbNamesDB=new Y(Db,{addons:[],indexedDB:a,IDBKeyRange:b}),c.version(1).stores({dbnames:"name"}));return c.table("dbnames")}function $c(a){return a&&typeof a.databases==="function"}function ad(a){var b=a.indexedDB;a=a.IDBKeyRange;return $c(b)?Promise.resolve(b.databases()).then(function(a){return a.map(function(a){return a.name}).filter(function(a){return a!==Db})}):Zc(b,a).toCollection().primaryKeys()}function bd(a,b){var c=a.indexedDB;a=a.IDBKeyRange;!$c(c)&&b!==Db&&Zc(c,a).put({name:b})["catch"](E)}function cd(a,b){var c=a.indexedDB;a=a.IDBKeyRange;!$c(c)&&b!==Db&&Zc(c,a)["delete"](b)["catch"](E)}function dd(a){return N(function(){J.letThrough=!0;return a()})}function ed(){var a=!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent);if(!a||!indexedDB.databases)return Promise.resolve();var b;return new Promise(function(a){var c=function(){return indexedDB.databases()["finally"](a)};b=setInterval(c,100);c()})["finally"](function(){return clearInterval(b)})}function fd(a){return!("from"in a)}var X=function(a,b){if(this)i(this,arguments.length?{d:1,from:a,to:arguments.length>1?b:a}:{d:0});else{var c=new X();a&&"d"in a&&i(c,a);return c}};m(X.prototype,(H={add:function(a){hd(this,a);return this},addKey:function(a){gd(this,a,a);return this},addKeys:function(a){var b=this;a.forEach(function(a){return gd(b,a,a)});return this}},H[na]=function(){return jd(this)},H));function gd(a,b,c){var d=S(b,c);if(isNaN(d))return;if(d>0)throw RangeError();if(fd(a))return i(a,{from:b,to:c,d:1});d=a.l;var e=a.r;if(S(c,a.from)<0){d?gd(d,b,c):a.l={from:b,to:c,d:1,l:null,r:null};return kd(a)}if(S(b,a.to)>0){e?gd(e,b,c):a.r={from:b,to:c,d:1,l:null,r:null};return kd(a)}S(b,a.from)<0&&(a.from=b,a.l=null,a.d=e?e.d+1:1);S(c,a.to)>0&&(a.to=c,a.r=null,a.d=a.l?a.l.d+1:1);b=!a.r;d&&!a.l&&hd(a,d);e&&b&&hd(a,e)}function hd(a,b){function c(a,b){var d=b.from,e=b.to,f=b.l;b=b.r;gd(a,d,e);f&&c(a,f);b&&c(a,b)}fd(b)||c(a,b)}function id(a,b){b=jd(b);var c=b.next();if(c.done)return!1;var d=c.value;a=jd(a);var e=a.next(d.from),f=e.value;while(!c.done&&!e.done){if(S(f.from,d.to)<=0&&S(f.to,d.from)>=0)return!0;S(d.from,f.from)<0?d=(c=b.next(f.from)).value:f=(e=a.next(d.from)).value}return!1}function jd(a){var b=fd(a)?null:{s:0,n:a};return{next:function(a){var c=arguments.length>0;while(b)switch(b.s){case 0:b.s=1;if(c)while(b.n.l&&S(a,b.n.from)<0)b={up:b,n:b.n.l,s:1};else while(b.n.l)b={up:b,n:b.n.l,s:1};case 1:b.s=2;if(!c||S(a,b.n.to)<=0)return{value:b.n,done:!1};case 2:if(b.n.r){b.s=3;b={up:b,n:b.n.r,s:0};continue}case 3:b=b.up}return{done:!0}}}}function kd(a){var b;b=(((b=a.r)===null||b===void 0?void 0:b.d)||0)-(((b=a.l)===null||b===void 0?void 0:b.d)||0);b=b>1?"r":b<-1?"l":"";if(b){var c=b==="r"?"l":"r",e=d({},a),f=a[b];a.from=f.from;a.to=f.to;a[b]=f[b];e[b]=f[c];a[c]=e;e.d=ld(e)}a.d=ld(a)}function ld(a){var b=a.r;a=a.l;return(b?a?Math.max(b.d,a.d):b.d:a?a.d:0)+1}function md(a,b){g(b).forEach(function(c){a[c]?hd(a[c],b[c]):a[c]=ha(b[c])});return a}function nd(a,b){return a.all||b.all||Object.keys(a).some(function(c){return b[c]&&id(b[c],a[c])})}var od={},pd={},qd=!1;function rd(a,b){md(pd,a),qd||(qd=!0,setTimeout(function(){qd=!1;var a=pd;pd={};sd(a,!1)},0))}function sd(a,b){b===void 0&&(b=!1);var c=new Set();if(a.all)for(var d=0,e=Object.values(od);d<e.length;d++){var f=e[d];td(f,a,c,b)}else for(e in a){d=/^idb\:\/\/(.*)\/(.*)\//.exec(e);if(d){var g=d[1];d=d[2];var f=od["idb://".concat(g,"/").concat(d)];f&&td(f,a,c,b)}}c.forEach(function(a){return a()})}function td(a,b,c,d){var e=[];for(var f=0,g=Object.entries(a.queries.query);f<g.length;f++){var h=g[f],i=h[0];h=h[1];var j=[];for(var k=0,h=h;k<h.length;k++){var l=h[k];nd(b,l.obsSet)?l.subscribers.forEach(function(a){return c.add(a)}):d&&j.push(l)}d&&e.push([i,j])}if(d)for(l=0,k=e;l<k.length;l++){h=k[l];var i=h[0],j=h[1];a.queries.query[i]=j}}function ud(a){var b=a._state,c=a._deps.indexedDB;if(b.isBeingOpened||a.idbdb)return b.dbReadyPromise.then(function(){return b.dbOpenError?Q(b.dbOpenError):a});b.isBeingOpened=!0;b.dbOpenError=null;b.openComplete=!1;var d=b.openCanceller,e=Math.round(a.verno*10),f=!1;function g(){if(b.openCanceller!==d)throw new D.DatabaseClosed("db.open() was cancelled")}var h=b.dbReadyResolve,i=null,j=!1,k=function(){return new K(function(d,h){g();if(!c)throw new D.MissingAPI();var l=a.name,m=b.autoSchema||!e?c.open(l):c.open(l,e);if(!m)throw new D.MissingAPI();m.onerror=V(h);m.onblocked=L(a._fireOnBlocked);m.onupgradeneeded=L(function(d){i=m.transaction;if(b.autoSchema&&!a._options.allowEmptyDB){m.onerror=nc;i.abort();m.result.close();var e=c.deleteDatabase(l);e.onsuccess=e.onerror=L(function(){h(new D.NoSuchDatabase("Database ".concat(l," doesnt exist")))})}else{i.onerror=V(h);e=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;j=e<1;a.idbdb=m.result;f&&Kc(a,i);Jc(a,e/10,i,h)}},h);m.onsuccess=L(function(){i=null;var c=a.idbdb=m.result,g=t(c.objectStoreNames);if(g.length>0)try{g=c.transaction(vc(g),"readonly");if(b.autoSchema)Tc(a,c,g);else{Vc(a,a._dbSchema,g);if(!Uc(a,g)&&!f){c.close();e=c.version+1;f=!0;return d(k())}}Fc(a,g)}catch(a){}Cb.push(a);c.onversionchange=L(function(c){b.vcFired=!0,a.on("versionchange").fire(c)});c.onclose=L(function(b){a.on("close").fire(b)});j&&bd(a._deps,l);d()},h)})["catch"](function(a){switch(a===null||a===void 0?void 0:a.name){case"UnknownError":if(b.PR1398_maxLoop>0){b.PR1398_maxLoop--;return k()}break;case"VersionError":if(e>0){e=0;return k()}break}return K.reject(a)})};return K.race([d,(typeof navigator==="undefined"?K.resolve():ed()).then(k)]).then(function(){g();b.onReadyBeingFired=[];return K.resolve(dd(function(){return a.on.ready.fire(a.vip)})).then(function c(){if(b.onReadyBeingFired.length>0){var d=b.onReadyBeingFired.reduce(Ga,E);b.onReadyBeingFired=[];return K.resolve(dd(function(){return d(a.vip)})).then(c)}})})["finally"](function(){b.openCanceller===d&&(b.onReadyBeingFired=null,b.isBeingOpened=!1)})["catch"](function(c){b.dbOpenError=c;try{i&&i.abort()}catch(a){}d===b.openCanceller&&a._close();return Q(c)})["finally"](function(){b.openComplete=!0,h()}).then(function(){if(j){var b={};a.tables.forEach(function(c){c.schema.indexes.forEach(function(d){d.name&&(b["idb://".concat(a.name,"/").concat(c.name,"/").concat(d.name)]=new X(-Infinity,[[[]]]))}),b["idb://".concat(a.name,"/").concat(c.name,"/")]=b["idb://".concat(a.name,"/").concat(c.name,"/:dels")]=new X(-Infinity,[[[]]])});W(oc).fire(b);sd(b,!0)}return a})}function vd(a){var b=function(b){return a.next(b)},c=function(b){return a["throw"](b)},d=f(b),e=f(c);function f(a){return function(b){b=a(b);var c=b.value;return b.done?c:!c||typeof c.then!=="function"?h(c)?Promise.all(c).then(d,e):d(c):c.then(d,e)}}return f(b)()}function wd(a,b,c){var d=arguments.length;if(d<2)throw new D.InvalidArgument("Too few arguments");var e=new Array(d-1);while(--d)e[d-1]=arguments[d];c=e.pop();var f=fa(e);return[a,f,c]}function xd(a,b,c,d,e){return K.resolve().then(function(){var f=J.transless||J,g=a._createTransaction(b,c,a._dbSchema,d);g.explicit=!0;f={trans:g,transless:f};if(d)g.idbtrans=d.idbtrans;else try{g.create(),g.idbtrans._explicit=!0,a._state.PR1398_maxLoop=3}catch(d){if(d.name===wa.InvalidState&&a.isOpen()&&--a._state.PR1398_maxLoop>0){a.close({disableAutoOpen:!1});return a.open().then(function(){return xd(a,b,c,null,e)})}return Q(d)}var h=qa(e);h&&qb();var i;f=K.follow(function(){i=e.call(g,g);if(i)if(h){var a=O.bind(null,null);i.then(a,a)}else typeof i.next==="function"&&typeof i["throw"]==="function"&&(i=vd(i))},f);return(i&&typeof i.then==="function"?K.resolve(i).then(function(a){return g.active?a:Q(new D.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):f.then(function(){return i})).then(function(a){d&&g._resolve();return g._completion.then(function(){return a})})["catch"](function(a){g._reject(a);return Q(a)})})}function yd(a,b,c){a=h(a)?a.slice():[a];for(var d=0;d<c;++d)a.push(b);return a}function zd(a){return d(d({},a),{table:function(b){var c=a.table(b);b=c.schema;var e={},f=[];function g(a,b,c){var h=Bc(a),i=e[h]=e[h]||[],j=a==null?0:typeof a==="string"?1:a.length,k=b>0;h=d(d({},c),{name:k?"".concat(h,"(virtual-from:").concat(c.name,")"):c.name,lowLevelIndex:c,isVirtual:k,keyTail:b,keyLength:j,extractKey:xc(a),unique:!k&&c.unique});i.push(h);h.isPrimaryKey||f.push(h);if(j>1){k=j===2?a[0]:a.slice(0,j-1);g(k,b+1,c)}i.sort(function(a,b){return a.keyTail-b.keyTail});return h}var h=g(b.primaryKey.keyPath,0,b.primaryKey);e[":id"]=[h];for(var i=0,j=b.indexes;i<j.length;i++){var k=j[i];g(k.keyPath,0,k)}function l(a){a=e[Bc(a)];return a&&a[0]}function m(b,c){return{type:b.type===1?2:b.type,lower:yd(b.lower,b.lowerOpen?a.MAX_KEY:a.MIN_KEY,c),lowerOpen:!0,upper:yd(b.upper,b.upperOpen?a.MIN_KEY:a.MAX_KEY,c),upperOpen:!0}}function n(b){var a=b.query.index;return a.isVirtual?d(d({},b),{query:{index:a.lowLevelIndex,range:m(b.query.range,a.keyTail)}}):b}k=d(d({},c),{schema:d(d({},b),{primaryKey:h,indexes:f,getIndexByKeyPath:l}),count:function(a){return c.count(n(a))},query:function(a){return c.query(n(a))},openCursor:function(d){var b=d.query.index,e=b.keyTail,f=b.isVirtual,g=b.keyLength;if(!f)return c.openCursor(d);function h(b){function c(c){c!=null?b["continue"](yd(c,d.reverse?a.MAX_KEY:a.MIN_KEY,e)):d.unique?b["continue"](b.key.slice(0,g).concat(d.reverse?a.MIN_KEY:a.MAX_KEY,e)):b["continue"]()}c=Object.create(b,{"continue":{value:c},continuePrimaryKey:{value:function(d,c){b.continuePrimaryKey(yd(d,a.MAX_KEY,e),c)}},primaryKey:{get:function(){return b.primaryKey}},key:{get:function(){var a=b.key;return g===1?a[0]:a.slice(0,g)}},value:{get:function(){return b.value}}});return c}return c.openCursor(n(d)).then(function(a){return a&&h(a)})}});return k}})}var Ad={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:zd};function Bd(a,b,c,d){c=c||{};d=d||"";g(a).forEach(function(e){if(!l(b,e))c[d+e]=void 0;else{var f=a[e],g=b[e];if(typeof f==="object"&&typeof g==="object"&&f&&g){var h=ma(f),i=ma(g);h!==i?c[d+e]=b[e]:h==="Object"?Bd(f,g,c,d+e+"."):f!==g&&(c[d+e]=b[e])}else f!==g&&(c[d+e]=b[e])}});g(b).forEach(function(e){l(a,e)||(c[d+e]=b[e])});return c}function Cd(a,b){return b.type==="delete"?b.keys:b.keys||b.values.map(a.extractKey)}var Dd={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(a){return d(d({},a),{table:function(b){var c=a.table(b),f=c.schema.primaryKey,g=d(d({},c),{mutate:function(a){var g=J.trans,h=g.table(b).hook,i=h.deleting,j=h.creating,k=h.updating;switch(a.type){case"add":if(j.fire===E)break;return g._promise("readwrite",function(){return m(a)},!0);case"put":if(j.fire===E&&k.fire===E)break;return g._promise("readwrite",function(){return m(a)},!0);case"delete":if(i.fire===E)break;return g._promise("readwrite",function(){return m(a)},!0);case"deleteRange":if(i.fire===E)break;return g._promise("readwrite",function(){return n(a)},!0)}return c.mutate(a);function m(b){var g=J.trans,a=b.keys||Cd(f,b);if(!a)throw new Error("Keys missing");b=b.type==="add"||b.type==="put"?d(d({},b),{keys:a}):d({},b);b.type!=="delete"&&(b.values=e([],b.values,!0));b.keys&&(b.keys=e([],b.keys,!0));return Ed(c,b,a).then(function(d){var e=a.map(function(a,c){var e=d[c],h={onerror:null,onsuccess:null};if(b.type==="delete")i.fire.call(h,a,e,g);else if(b.type==="add"||e===void 0){var m=j.fire.call(h,a,b.values[c],g);a==null&&m!=null&&(a=m,b.keys[c]=a,f.outbound||x(b.values[c],f.keyPath,a))}else{m=Bd(e,b.values[c]);var n=k.fire.call(h,m,a,e,g);if(n){var o=b.values[c];Object.keys(n).forEach(function(a){l(o,a)?o[a]=n[a]:x(o,a,n[a])})}}return h});return c.mutate(b).then(function(c){var f=c.failures,g=c.results,h=c.numFailures;c=c.lastResult;for(var i=0;i<a.length;++i){var j=g?g[i]:a[i],k=e[i];j==null?k.onerror&&k.onerror(f[i]):k.onsuccess&&k.onsuccess(b.type==="put"&&d[i]?b.values[i]:j)}return{failures:f,results:g,numFailures:h,lastResult:c}})["catch"](function(a){e.forEach(function(b){return b.onerror&&b.onerror(a)});return Promise.reject(a)})})}function n(a){return o(a.trans,a.range,1e4)}function o(a,b,e){return c.query({trans:a,values:!1,query:{index:f,range:b},limit:e}).then(function(c){var f=c.result;return m({type:"delete",keys:f,trans:a}).then(function(c){if(c.numFailures>0)return Promise.reject(c.failures[0]);if(f.length<e)return{failures:[],numFailures:0,lastResult:void 0};else return o(a,d(d({},b),{lower:f[f.length-1],lowerOpen:!0}),e)})})}}});return g}})}};function Ed(a,b,c){return b.type==="add"?Promise.resolve([]):a.getMany({trans:b.trans,keys:c,cache:"immutable"})}function Fd(a,b,c){try{if(!b)return null;if(b.keys.length<a.length)return null;var d=[];for(var e=0,f=0;e<b.keys.length&&f<a.length;++e){if(S(b.keys[e],a[f])!==0)continue;d.push(c?z(b.values[e]):b.values[e]);++f}return d.length===a.length?d:null}catch(a){return null}}var Gd={stack:"dbcore",level:-1,create:function(a){return{table:function(b){var c=a.table(b);return d(d({},c),{getMany:function(a){if(!a.cache)return c.getMany(a);var b=Fd(a.keys,a.trans._cache,a.cache==="clone");return b?K.resolve(b):c.getMany(a).then(function(b){a.trans._cache={keys:a.keys,values:a.cache==="clone"?z(b):b};return b})},mutate:function(a){a.type!=="add"&&(a.trans._cache=null);return c.mutate(a)}})}}}};function Hd(a,b){return a.trans.mode==="readonly"&&!!a.subscr&&!a.trans.explicit&&a.trans.db._options.cache!=="disabled"&&!b.schema.primaryKey.outbound}function Id(a,b){switch(a){case"query":return b.values&&!b.unique;case"get":return!1;case"getMany":return!1;case"count":return!1;case"openCursor":return!1}}var Jd={stack:"dbcore",level:0,name:"Observability",create:function(a){var b=a.schema.name,c=new X(a.MIN_KEY,a.MAX_KEY);return d(d({},a),{transaction:function(b,c,d){if(J.subscr&&c!=="readonly")throw new D.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(J.querier));return a.transaction(b,c,d)},table:function(e){var f=a.table(e),i=f.schema,j=i.primaryKey,k=j.extractKey,l=j.outbound,m=d(d({},f),{mutate:function(g){var k=g.trans,l=g.mutatedParts||(g.mutatedParts={}),m=function(a){a="idb://".concat(b,"/").concat(e,"/").concat(a);return l[a]||(l[a]=new X())},n=m(""),o=m(":dels"),d=g.type,p=g.type==="deleteRange"?[g.range]:g.type==="delete"?[g.keys]:g.values.length<50?[Cd(j,g).filter(function(a){return a}),g.values]:[],a=p[0];p=p[1];var q=g.trans._cache;if(h(a)){n.addKeys(a);d=d==="delete"||a.length===p.length?Fd(a,q):null;d||o.addKeys(a);(d||p)&&Kd(m,i,d,p)}else if(a){q={from:a.lower,to:a.upper};o.add(q);n.add(q)}else n.add(c),o.add(c),i.indexes.forEach(function(a){return m(a.name).add(c)});return f.mutate(g).then(function(b){a&&(g.type==="add"||g.type==="put")&&n.addKeys(b.results);k.mutatedParts=md(k.mutatedParts||{},l);return b})}}),n=function(b){b=b.query;var c=b.index;b=b.range;return[c,new X((c=b.lower)!==null&&c!==void 0?c:a.MIN_KEY,(c=b.upper)!==null&&c!==void 0?c:a.MAX_KEY)]},o={get:function(a){return[j,new X(a.key)]},getMany:function(a){return[j,new X().addKeys(a.keys)]},count:n,query:n,openCursor:n};g(o).forEach(function(a){m[a]=function(g){var h=J.subscr,i=!!h,j=Hd(J,f)&&Id(a,g),m=j?g.obsSet={}:h;if(i){var n=function(a){a="idb://".concat(b,"/").concat(e,"/").concat(a);return m[a]||(m[a]=new X())},p=n(""),q=n(":dels"),r=o[a](g),s=r[0],t=r[1];a==="query"&&s.isPrimaryKey&&!g.values?q.add(t):n(s.name||"").add(t);if(!s.isPrimaryKey)if(a==="count")q.add(c);else{var u=a==="query"&&l&&g.values&&f.query(d(d({},g),{values:!1}));return f[a].apply(this,arguments).then(function(b){if(a==="query"){if(l&&g.values)return u.then(function(a){a=a.result;p.addKeys(a);return b});var c=g.values?b.result.map(k):b.result;g.values?p.addKeys(c):q.addKeys(c)}else if(a==="openCursor"){var d=b,e=g.values;return d&&Object.create(d,{key:{get:function(){q.addKey(d.primaryKey);return d.key}},primaryKey:{get:function(){var a=d.primaryKey;q.addKey(a);return a}},value:{get:function(){e&&p.addKey(d.primaryKey);return d.value}}})}return b})}}return f[a].apply(this,arguments)}});return m}})}};function Kd(a,b,c,d){function e(b){var e=a(b.name||"");function f(a){return a!=null?b.extractKey(a):null}var g=function(a){return b.multiEntry&&h(a)?a.forEach(function(a){return e.addKey(a)}):e.addKey(a)};(c||d).forEach(function(a,b){a=c&&f(c[b]);b=d&&f(d[b]);S(a,b)!==0&&(a!=null&&g(a),b!=null&&g(b))})}b.indexes.forEach(e)}function Ld(a,b,c){if(c.numFailures===0)return b;if(b.type==="deleteRange")return null;a=b.keys?b.keys.length:"values"in b&&b.values?b.values.length:1;if(c.numFailures===a)return null;a=d({},b);h(a.keys)&&(a.keys=a.keys.filter(function(a,b){return!(b in c.failures)}));"values"in a&&h(a.values)&&(a.values=a.values.filter(function(a,b){return!(b in c.failures)}));return a}function Md(a,b){return b.lower===void 0?!0:b.lowerOpen?S(a,b.lower)>0:S(a,b.lower)>=0}function Nd(a,b){return b.upper===void 0?!0:b.upperOpen?S(a,b.upper)<0:S(a,b.upper)<=0}function Od(a,b){return Md(a,b)&&Nd(a,b)}function Pd(a,b,c,d,e,f){if(!c||c.length===0)return a;var g=b.query.index,i=g.multiEntry,j=b.query.range;d=d.schema.primaryKey;var k=d.extractKey,l=g.extractKey,m=(g.lowLevelIndex||g).extractKey;d=c.reduce(function(a,c){var d=a,e=c.type==="add"||c.type==="put"?c.values.filter(function(a){a=l(a);return i&&h(a)?a.some(function(a){return Od(a,j)}):Od(a,j)}).map(function(a){a=z(a);f&&Object.freeze(a);return a}):[];switch(c.type){case"add":d=a.concat(b.values?e:e.map(function(a){return k(a)}));break;case"put":var g=new X().addKeys(c.values.map(function(a){return k(a)}));d=a.filter(function(a){a=b.values?k(a):a;return!id(new X(a),g)}).concat(b.values?e:e.map(function(a){return k(a)}));break;case"delete":var m=new X().addKeys(c.keys);d=a.filter(function(a){a=b.values?k(a):a;return!id(new X(a),m)});break;case"deleteRange":var n=c.range;d=a.filter(function(a){return!Od(k(a),n)});break}return d},a);if(d===a)return a;d.sort(function(a,b){return S(m(a),m(b))||S(k(a),k(b))});b.limit&&b.limit<Infinity&&(d.length>b.limit?d.length=b.limit:a.length===b.limit&&d.length<b.limit&&(e.dirty=!0));return f?Object.freeze(d):d}function Qd(a,b){return S(a.lower,b.lower)===0&&S(a.upper,b.upper)===0&&!!a.lowerOpen===!!b.lowerOpen&&!!a.upperOpen===!!b.upperOpen}function Rd(a,b,c,d){if(a===void 0)return b!==void 0?-1:0;if(b===void 0)return 1;a=S(a,b);if(a===0){if(c&&d)return 0;if(c)return 1;if(d)return-1}return a}function Sd(a,b,c,d){if(a===void 0)return b!==void 0?1:0;if(b===void 0)return-1;a=S(a,b);if(a===0){if(c&&d)return 0;if(c)return-1;if(d)return 1}return a}function Td(a,b){return Rd(a.lower,b.lower,a.lowerOpen,b.lowerOpen)<=0&&Sd(a.upper,b.upper,a.upperOpen,b.upperOpen)>=0}function Ud(b,c,a,d){b=od["idb://".concat(b,"/").concat(c)];if(!b)return[];c=b.queries[a];if(!c)return[null,!1,b,null];var e=d.query?d.query.index.name:null;c=c[e||""];if(!c)return[null,!1,b,null];switch(a){case"query":e=c.find(function(a){return a.req.limit===d.limit&&a.req.values===d.values&&Qd(a.req.query.range,d.query.range)});if(e)return[e,!0,b,c];a=c.find(function(a){var b="limit"in a.req?a.req.limit:Infinity;return b>=d.limit&&(d.values?a.req.values:!0)&&Td(a.req.query.range,d.query.range)});return[a,!1,b,c];case"count":e=c.find(function(a){return Qd(a.req.query.range,d.query.range)});return[e,!!e,b,c]}}function Vd(a,b,c,d){a.subscribers.add(c),d.addEventListener("abort",function(){a.subscribers["delete"](c),a.subscribers.size===0&&Wd(a,b)})}function Wd(a,b){setTimeout(function(){a.subscribers.size===0&&A(b,a)},3e3)}var Xd={stack:"dbcore",level:0,name:"Cache",create:function(a){var b=a.schema.name,c=d(d({},a),{transaction:function(c,d,e){var f=a.transaction(c,d,e);if(d==="readwrite"){var g=new AbortController();e=g.signal;var h=function(e){return function(){g.abort();if(d==="readwrite"){var h=new Set();for(var i=0,j=c;i<j.length;i++){var k=j[i],l=od["idb://".concat(b,"/").concat(k)];if(l){k=a.table(k);var m=l.optimisticOps.filter(function(a){return a.trans===f});if(f._explicit&&e&&f.mutatedParts)for(var n=0,o=Object.values(l.queries.query);n<o.length;n++){var p=o[n];for(var q=0,r=p.slice();q<r.length;q++){var s=r[q];nd(s.obsSet,f.mutatedParts)&&(A(p,s),s.subscribers.forEach(function(a){return h.add(a)}))}}else if(m.length>0){l.optimisticOps=l.optimisticOps.filter(function(a){return a.trans!==f});for(q=0,r=Object.values(l.queries.query);q<r.length;q++){var p=r[q];for(n=0,o=p.slice();n<o.length;n++){var s=o[n];if(s.res!=null&&f.mutatedParts)if(e&&!s.dirty){l=Object.isFrozen(s.res);l=Pd(s.res,s.req,m,k,s,l);s.dirty?(A(p,s),s.subscribers.forEach(function(a){return h.add(a)})):l!==s.res&&(s.res=l,s.promise=K.resolve({result:l}))}else s.dirty&&A(p,s),s.subscribers.forEach(function(a){return h.add(a)})}}}}}h.forEach(function(a){return a()})}}};f.addEventListener("abort",h(!1),{signal:e});f.addEventListener("error",h(!1),{signal:e});f.addEventListener("complete",h(!0),{signal:e})}return f},table:function(c){var e=a.table(c),f=e.schema.primaryKey,g=d(d({},e),{mutate:function(a){var g=J.trans;if(f.outbound||g.db._options.cache==="disabled"||g.explicit)return e.mutate(a);var h=od["idb://".concat(b,"/").concat(c)];if(!h)return e.mutate(a);g=e.mutate(a);(a.type==="add"||a.type==="put")&&(a.values.length>=50||Cd(f,a).some(function(a){return a==null}))?g.then(function(b){var c=d(d({},a),{values:a.values.map(function(a,c){var e;e=((e=f.keyPath)===null||e===void 0?void 0:e.includes("."))?z(a):d({},a);x(e,f.keyPath,b.results[c]);return e})});c=Ld(h,c,b);h.optimisticOps.push(c);queueMicrotask(function(){return a.mutatedParts&&rd(a.mutatedParts)})}):(h.optimisticOps.push(a),a.mutatedParts&&rd(a.mutatedParts),g.then(function(b){if(b.numFailures>0){A(h.optimisticOps,a);b=Ld(h,a,b);b&&h.optimisticOps.push(b);a.mutatedParts&&rd(a.mutatedParts)}}),g["catch"](function(){A(h.optimisticOps,a),a.mutatedParts&&rd(a.mutatedParts)}));return g},query:function(a){var d;if(!Hd(J,e)||!Id("query",a))return e.query(a);var f=((d=J.trans)===null||d===void 0?void 0:d.db._options.cache)==="immutable";d=J;var g=d.requery;d=d.signal;var h=Ud(b,c,"query",a),i=h[0],j=h[1],k=h[2],l=h[3];if(i&&j)i.obsSet=a.obsSet;else{h=e.query(a).then(function(a){var b=a.result;i&&(i.res=b);if(f){for(var c=0,d=b.length;c<d;++c)Object.freeze(b[c]);Object.freeze(b)}else a.result=z(b);return a})["catch"](function(a){l&&i&&A(l,i);return Promise.reject(a)});i={obsSet:a.obsSet,promise:h,subscribers:new Set(),type:"query",req:a,dirty:!1};l?l.push(i):(l=[i],k||(k=od["idb://".concat(b,"/").concat(c)]={queries:{query:{},count:{}},objs:new Map(),optimisticOps:[],unsignaledParts:{}}),k.queries.query[a.query.index.name||""]=l)}Vd(i,l,g,d);return i.promise.then(function(b){return{result:Pd(b.result,a,k===null||k===void 0?void 0:k.optimisticOps,e,i,f)}})}});return g}});return c}};function Yd(a,b){return new Proxy(a,{get:function(a,c,d){return c==="db"?b:Reflect.get(a,c,d)}})}var Y=function(){function a(b,c){var e=this;this._middlewares={};this.verno=0;var f=a.dependencies;this._options=c=d({addons:a.addons,autoOpen:!0,indexedDB:f.indexedDB,IDBKeyRange:f.IDBKeyRange,cache:"cloned"},c);this._deps={indexedDB:c.indexedDB,IDBKeyRange:c.IDBKeyRange};f=c.addons;this._dbSchema={};this._versions=[];this._storeNames=[];this._allTables={};this.idbdb=null;this._novip=this;var g={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:E,dbReadyPromise:null,cancelOpen:E,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:c.autoOpen};g.dbReadyPromise=new K(function(a){g.dbReadyResolve=a});g.openCanceller=new K(function(a,b){g.cancelOpen=b});this._state=g;this.name=b;this.on=Pb(this,"populate","blocked","versionchange","close",{ready:[Ga,E]});this.on.ready.subscribe=u(this.on.ready.subscribe,function(b){return function(c,d){a.vip(function(){var a=e._state;if(a.openComplete)a.dbOpenError||K.resolve().then(c),d&&b(c);else if(a.onReadyBeingFired)a.onReadyBeingFired.push(c),d&&b(c);else{b(c);var f=e;d||b(function a(){f.on.ready.unsubscribe(c),f.on.ready.unsubscribe(a)})}})}});this.Collection=cc(this);this.Table=Rb(this);this.Transaction=rc(this);this.Version=Yc(this);this.WhereClause=mc(this);this.on("versionchange",function(a){a.newVersion>0?!1:!1,e.close({disableAutoOpen:!1})});this.on("blocked",function(a){!a.newVersion||a.newVersion<a.oldVersion?!1:!1});this._maxKey=wc(c.IDBKeyRange);this._createTransaction=function(a,b,c,d){return new e.Transaction(a,b,c,e._options.chromeTransactionDurability,d)};this._fireOnBlocked=function(a){e.on("blocked").fire(a),Cb.filter(function(a){return a.name===e.name&&a!==e&&!a._state.vcFired}).map(function(b){return b.on("versionchange").fire(a)})};this.use(Gd);this.use(Xd);this.use(Jd);this.use(Ad);this.use(Dd);var h=new Proxy(this,{get:function(a,b,c){if(b==="_vip")return!0;if(b==="table")return function(a){return Yd(e.table(a),h)};var d=Reflect.get(a,b,c);if(d instanceof Ob)return Yd(d,h);if(b==="tables")return d.map(function(a){return Yd(a,h)});return b==="_createTransaction"?function(){var a=d.apply(this,arguments);return Yd(a,h)}:d}});this.vip=h;f.forEach(function(a){return a(e)})}a.prototype.version=function(a){if(isNaN(a)||a<.1)throw new D.Type("Given version is not a positive number");a=Math.round(a*10)/10;if(this.idbdb||this._state.isBeingOpened)throw new D.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,a);var b=this._versions,c=b.filter(function(b){return b._cfg.version===a})[0];if(c)return c;c=new this.Version(a);b.push(c);b.sort(Ic);c.stores({});this._state.autoSchema=!1;return c};a.prototype._whenReady=function(a){var b=this;return this.idbdb&&(this._state.openComplete||J.letThrough||this._vip)?a():new K(function(a,c){if(b._state.openComplete)return c(new D.DatabaseClosed(b._state.dbOpenError));if(!b._state.isBeingOpened){if(!b._state.autoOpen){c(new D.DatabaseClosed());return}b.open()["catch"](E)}b._state.dbReadyPromise.then(a,c)}).then(a)};a.prototype.use=function(a){var b=a.stack,c=a.create,d=a.level;a=a.name;a&&this.unuse({stack:b,name:a});var e=this._middlewares[b]||(this._middlewares[b]=[]);e.push({stack:b,create:c,level:d==null?10:d,name:a});e.sort(function(a,b){return a.level-b.level});return this};a.prototype.unuse=function(a){var b=a.stack,c=a.name,d=a.create;b&&this._middlewares[b]&&(this._middlewares[b]=this._middlewares[b].filter(function(a){return d?a.create!==d:c?a.name!==c:!1}));return this};a.prototype.open=function(){var a=this;return vb(I,function(){return ud(a)})};a.prototype._close=function(){var a=this._state,b=Cb.indexOf(this);b>=0&&Cb.splice(b,1);if(this.idbdb){try{this.idbdb.close()}catch(a){}this.idbdb=null}a.isBeingOpened||(a.dbReadyPromise=new K(function(b){a.dbReadyResolve=b}),a.openCanceller=new K(function(b,c){a.cancelOpen=c}))};a.prototype.close=function(a){a=a===void 0?{disableAutoOpen:!0}:a;a=a.disableAutoOpen;var b=this._state;a?(b.isBeingOpened&&b.cancelOpen(new D.DatabaseClosed()),this._close(),b.autoOpen=!1,b.dbOpenError=new D.DatabaseClosed()):(this._close(),b.autoOpen=this._options.autoOpen||b.isBeingOpened,b.openComplete=!1,b.dbOpenError=null)};a.prototype["delete"]=function(a){var b=this;a===void 0&&(a={disableAutoOpen:!0});var c=arguments.length>0&&typeof arguments[0]!=="object",d=this._state;return new K(function(e,f){var g=function(){b.close(a);var c=b._deps.indexedDB.deleteDatabase(b.name);c.onsuccess=L(function(){cd(b._deps,b.name),e()});c.onerror=V(f);c.onblocked=b._fireOnBlocked};if(c)throw new D.InvalidArgument("Invalid closeOptions argument to db.delete()");d.isBeingOpened?d.dbReadyPromise.then(g):g()})};a.prototype.backendDB=function(){return this.idbdb};a.prototype.isOpen=function(){return this.idbdb!==null};a.prototype.hasBeenClosed=function(){var a=this._state.dbOpenError;return a&&a.name==="DatabaseClosed"};a.prototype.hasFailed=function(){return this._state.dbOpenError!==null};a.prototype.dynamicallyOpened=function(){return this._state.autoSchema};Object.defineProperty(a.prototype,"tables",{get:function(){var a=this;return g(this._allTables).map(function(b){return a._allTables[b]})},enumerable:!1,configurable:!0});a.prototype.transaction=function(){var a=wd.apply(this,arguments);return this._transaction.apply(this,a)};a.prototype._transaction=function(a,b,c){var d=this,e=J.trans;(!e||e.db!==this||a.indexOf("!")!==-1)&&(e=null);var f=a.indexOf("?")!==-1;a=a.replace("!","").replace("?","");var g,h;try{h=b.map(function(a){a=a instanceof d.Table?a.name:a;if(typeof a!=="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return a});if(a=="r"||a===Eb)g=Eb;else if(a=="rw"||a==Fb)g=Fb;else throw new D.InvalidArgument("Invalid transaction mode: "+a);if(e){if(e.mode===Eb&&g===Fb)if(f)e=null;else throw new D.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");e&&h.forEach(function(a){if(e&&e.storeNames.indexOf(a)===-1)if(f)e=null;else throw new D.SubTransaction("Table "+a+" not included in parent transaction.")});f&&e&&!e.active&&(e=null)}}catch(a){return e?e._promise(null,function(b,c){c(a)}):Q(a)}var i=xd.bind(null,this,g,h,e,c);return e?e._promise(g,i,"lock"):J.trans?vb(J.transless,function(){return d._whenReady(i)}):this._whenReady(i)};a.prototype.table=function(a){if(!l(this._allTables,a))throw new D.InvalidTable("Table ".concat(a," does not exist"));return this._allTables[a]};return a}(),Zd=typeof Symbol!=="undefined"&&"observable"in Symbol?Symbol.observable:"@@observable",$d=function(){function a(a){this._subscribe=a}a.prototype.subscribe=function(a,b,c){return this._subscribe(!a||typeof a==="function"?{next:a,error:b,complete:c}:a)};a.prototype[Zd]=function(){return this};return a}(),ae;try{ae={indexedDB:f.indexedDB||f.mozIndexedDB||f.webkitIndexedDB||f.msIndexedDB,IDBKeyRange:f.IDBKeyRange||f.webkitIDBKeyRange}}catch(a){ae={indexedDB:null,IDBKeyRange:null}}function be(a){var b=!1,c,d=new $d(function(d){var e=qa(a);function f(b){var c=eb();try{e&&qb();b=N(a,b);e&&(b=b["finally"](O));return b}finally{c&&fb()}}var g=!1,h,i={},j={},k={get closed(){return g},unsubscribe:function(){if(g)return;g=!0;h&&h.abort();l&&W.storagemutated.unsubscribe(o)}};d.start&&d.start(k);var l=!1,m=function(){return xb(p)};function n(){return nd(j,i)}var o=function(a){md(i,a),n()&&m()},p=function(){if(g||!ae.indexedDB)return;i={};var e={};h&&h.abort();h=new AbortController();var k={subscr:e,signal:h.signal,requery:m,querier:a,trans:null},n=f(k);Promise.resolve(n).then(function(a){b=!0;c=a;if(g||k.signal.aborted)return;i={};j=e;!ia(j)&&!l&&(W(oc,o),l=!0);xb(function(){return!g&&d.next&&d.next(a)})},function(a){b=!1,["DatabaseClosedError","AbortError"].includes(a===null||a===void 0?void 0:a.name)||(g||xb(function(){if(g)return;d.error&&d.error(a)}))})};setTimeout(m,0);return k});d.hasValue=function(){return b};d.getValue=function(){return c};return d}var ce=Y;m(ce,d(d({},C),{"delete":function(a){a=new ce(a,{addons:[]});return a["delete"]()},exists:function(a){return new ce(a,{addons:[]}).open().then(function(a){a.close();return!0})["catch"]("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(a){try{return ad(ce.dependencies).then(a)}catch(a){return Q(new D.MissingAPI())}},defineClass:function(){function a(a){i(this,a)}return a},ignoreTransaction:function(a){return J.trans?vb(J.transless,a):a()},vip:dd,async:function(a){return function(){try{var b=vd(a.apply(this,arguments));return!b||typeof b.then!=="function"?K.resolve(b):b}catch(a){return Q(a)}}},spawn:function(a,b,c){try{a=vd(a.apply(c,b||[]));return!a||typeof a.then!=="function"?K.resolve(a):a}catch(a){return Q(a)}},currentTransaction:{get:function(){return J.trans||null}},waitFor:function(a,b){a=K.resolve(typeof a==="function"?ce.ignoreTransaction(a):a).timeout(b||6e4);return J.trans?J.trans.waitFor(a):a},Promise:K,debug:{get:function(){return G},set:function(a){Ha(a)}},derive:p,extend:i,props:m,override:u,Events:Pb,on:W,liveQuery:be,extendObservabilitySet:md,getByKeyPath:w,setByKeyPath:x,delByKeyPath:ca,shallowClone:da,deepClone:z,getObjectDiff:Bd,cmp:S,asap:aa,minKey:Ab,addons:[],connections:Cb,errnames:wa,dependencies:ae,cache:od,semVer:Ka,version:Ka.split(".").map(function(a){return parseInt(a)}).reduce(function(a,b,c){return a+b/Math.pow(10,c*2)})}));ce.maxKey=wc(ce.dependencies.IDBKeyRange);typeof dispatchEvent!=="undefined"&&typeof addEventListener!=="undefined"&&(W(oc,function(a){if(!Z){a=new CustomEvent(pc,{detail:a});Z=!0;dispatchEvent(a);Z=!1}}),addEventListener(pc,function(a){a=a.detail;Z||de(a)}));function de(a){var b=Z;try{Z=!0,W.storagemutated.fire(a),sd(a,!0)}finally{Z=b}}var Z=!1,$,ee=function(){};typeof BroadcastChannel!=="undefined"&&(ee=function(){$=new BroadcastChannel(pc),$.onmessage=function(a){return a.data&&de(a.data)}},ee(),typeof $.unref==="function"&&$.unref(),W(oc,function(a){Z||$.postMessage(a)}));typeof addEventListener!=="undefined"&&(addEventListener("pagehide",function(a){if(!Y.disableBfCache&&a.persisted){G&&!1;$===null||$===void 0?void 0:$.close();for(var a=0,b=Cb;a<b.length;a++){var c=b[a];c.close({disableAutoOpen:!1})}}}),addEventListener("pageshow",function(a){!Y.disableBfCache&&a.persisted&&(G&&!1,ee(),de({all:new X(-Infinity,[[]])}))}));function fe(a,b){return new $b({replacePrefix:[a,b]})}K.rejectionMapper=za;Ha(G);H=Object.freeze({__proto__:null,Dexie:Y,liveQuery:be,Entity:Jb,cmp:S,PropModSymbol:y,PropModification:$b,replacePrefix:fe,"default":Y,RangeSet:X,mergeRanges:hd,rangesOverlap:id});d(Y,H,{"default":Y});return Y})}var j=!1;function k(){j||(j=!0,i());return h.exports}function b(a){switch(a){case void 0:return k()}}e.exports=b}),null);
__d("dexie_maw-next",["dexie-4.0.1"],(function(a,b,c,d,e,f){e.exports=b("dexie-4.0.1")()}),null);
/**
 * License: https://www.facebook.com/legal/license/t3hOLs8wlXy/
 */
__d("file-saver-2.0.2",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){(function(a,b){"undefined"!=typeof g?b():(b(),a.FileSaver={exports:{}}.exports)})(this,function(){function b(b,a){return"undefined"==typeof a?a={autoBom:!1}:"object"!=typeof a&&(!1,a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(b.type)?new Blob(["\ufeff",b],{type:b.type}):b}function c(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="blob",d.onload=function(){g(d.response,b,c)},d.onerror=function(){},d.send()}function d(b){var a=new XMLHttpRequest;a.open("HEAD",b,!1);try{a.send()}catch(a){}return 200<=a.status&&299>=a.status}function e(b){try{b.dispatchEvent(new MouseEvent("click"))}catch(c){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),b.dispatchEvent(a)}}var f="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof a&&a.global===a?a:void 0,g=f.saveAs||("object"!=typeof window||window!==f?function(){}:"download"in HTMLAnchorElement.prototype?function(a,b,g){var h=f.URL||f.webkitURL,i=document.createElement("a");b=b||a.name||"download",i.download=b,i.rel="noopener","string"==typeof a?(i.href=a,i.origin===location.origin?e(i):d(i.href)?c(a,b,g):e(i,i.target="_blank")):(i.href=h.createObjectURL(a),setTimeout(function(){h.revokeObjectURL(i.href)},4e4),setTimeout(function(){e(i)},0))}:"msSaveOrOpenBlob"in navigator?function(a,f,g){if(f=f||a.name||"download","string"!=typeof a)navigator.msSaveOrOpenBlob(b(a,g),f);else if(d(a))c(a,f,g);else{var h=document.createElement("a");h.href=a,h.target="_blank",setTimeout(function(){e(h)})}}:function(e,a,b,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),"string"==typeof e)return c(e,a,b);a="application/octet-stream"===e.type;b=/constructor/i.test(f.HTMLElement)||f.safari;var g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||a&&b)&&"object"==typeof FileReader){var h=new FileReader;h.onloadend=function(){var a=h.result;a=g?a:a.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=a:location=a,d=null},h.readAsDataURL(e)}else{var i=f.URL||f.webkitURL,j=i.createObjectURL(e);d?d.location=j:location.href=j,d=null,setTimeout(function(){i.revokeObjectURL(j)},4e4)}});f.saveAs=g.saveAs=g,"undefined"!=typeof h&&(h.exports=g)})}var j=!1;function k(){j||(j=!0,i());return h.exports}function b(a){switch(a){case void 0:return k()}}e.exports=b}),null);
__d("file-saver",["file-saver-2.0.2"],(function(a,b,c,d,e,f){e.exports=b("file-saver-2.0.2")()}),null);/*FB_PKG_DELIM*/
__d("DisappearingMessagesMode",[],(function(a,b,c,d,e,f){a=Object.freeze({OFF:0,ON:1,OPEN_ON_DEPRECATED_DO_NOT_USE:2});f["default"]=a}),66);
__d("MAWBridge",["WABridge"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("WABridge").getBridge()}g.getBridge=a}),98);
__d("IIGDAPI",["MAWBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(){for(var b=arguments.length,c=new Array(b),e=0;e<b;e++)c[e]=arguments[e];return d("MAWBridge").getBridge().sendAndReceive("backend","igdapi",{args:c,type:a})}}g.makeBridgedApi=a}),98);
__d("IGDBridgedAPI",["IIGDAPI"],(function(a,b,c,d,e,f,g){"use strict";b={33:(a=d("IIGDAPI")).makeBridgedApi("33"),46:a.makeBridgedApi("46"),sendEditMessage:a.makeBridgedApi("sendEditMessage"),sendMediaMessage:a.makeBridgedApi("sendMediaMessage"),sendOrRemoveReaction:a.makeBridgedApi("sendOrRemoveReaction"),sendXmaReceiverFetch:a.makeBridgedApi("sendXmaReceiverFetch")};c=b;g["default"]=c}),98);
__d("MAWUnsafeCoerce",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.unsafeCoerce=a}),66);
__d("WAAssertUnreachable",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){throw c("err")("Impossible value, the default statement should never be reached for value: "+a)}g["default"]=a}),98);
__d("WAJids",["WAAssertUnreachable","err"],(function(a,b,c,d,e,f,g){"use strict";var h=0,i="@me",j="@system",k="status@broadcast",aa="0@s.whatsapp.net",l="call",m="@g.us",n=/^([1-9][0-9]{0,19}|(?!10)[1-9][0-9]{4,19}-[1-9][0-9]{9})@g.us$/,ba="@call",o="@msgr",ca="msgr",p="@interop",da="interop",q=/^([1-9][0-9]{0,2}-[1-9][0-9]{0,14}(:[0])?)@interop$/,r=/^([1-9][0-9]{0,2}-[1-9][0-9]{0,14}(:[0])?)@interop$/,s=/^([1-9][0-9]{0,19}(:[1-9][0-9]{0,2})?)@msgr$/,t=/^([1-9][0-9]{0,19})@msgr$/,u=/^([1-9][0-9]{0,19})(:0)?@msgr$/,ea="@s.whatsapp.net",fa="s.whatsapp.net",v="@s.whatsapp.net",w="s.whatsapp.net",x="lid",y="@newsletter",z=/^([1-9][0-9]{0,19})@newsletter$/,A=/^(0|((?!10)[1-9][0-9]{4,19}(\.[0-9]{1,2})?(:[0-9]{1,2})))@s.whatsapp.net$/,B=/^(0|((?!10)[1-9][0-9]{4,19})(\.[0-9]{1,2})?)@s.whatsapp.net$/,C="@lid",ga="lid",D=/^([1-9][0-9]{0,14})@lid$/,E=/^([1-9][0-9]{0,14}(:[0-9]{1,2})?)@lid$/,ha="@broadcast",F=/^(status|location|[1-9][0-9]{0,19})@broadcast$/,G=/^([0-9a-fA-F]{18,32})@call$/,H="@hosted",I="hosted",J=/^(((?!10)[1-9][0-9]{4,19})):99@hosted$/,K="@hosted.lid",ia="hosted.lid",L=/^([1-9][0-9]{0,14}):99@hosted.lid$/,M="@bot",ja=/^[1-9][0-9]{0,19}(:0)?@bot$/,ka="16505361212"+v,la=/([0-9a-zA-Z-:]+)@(g\.us|call|s\.whatsapp\.net|broadcast|msgr|lid)/g;function a(a){return""+a+v}function b(a){return""+a+C}function N(a){return""+a+o}function d(a){return a.endsWith(m)?a:""+a+m}function e(a){return a.endsWith(y)?a:""+a+y}function f(a){return a.endsWith(H)?a:""+a+H}function ma(a){return a.endsWith(K)?a:""+a+K}function na(){return m}function O(a){if(a.endsWith(v))return a.slice(0,-v.length);else if(a.endsWith(o))return a.slice(0,-o.length);else if(a.endsWith(p))return a.slice(0,-p.length);else if(a.endsWith(C))return a.slice(0,-C.length);else if(a.endsWith(M))return a.slice(0,-M.length);else throw c("err")('userIdFromJid called with non-user jid "'+a+'"')}function oa(a,b){return Y(O(a)+":"+b+v)}function pa(a,b){return Z(O(a)+":"+b+o)}function qa(a,b){return zb(P(a)+":"+b+C)}function ra(a,b){return X(O(a)+":"+b+W(a))}function sa(a){return""+a+ha}function ta(a){return a.split("@")[0]}function ua(a){return a.split("@")[0]}function va(a){a=a.split("@")[0];a=a.split(":");var b=a[0];a=a[1];a=parseInt(a,10);return{userId:b,deviceID:a}}function wa(a){a=va(a);return a.deviceID}function xa(a,b){if(a===i||a===j)return b;else return ta(a)}function ya(a){return a===i||a===j?null:a}function za(a){if(a===i||a===j)return null;return!a.endsWith(v)?null:a}function Aa(a){if(!a.endsWith(v))throw c("err")('phoneNumberFromJid called with non-user jid "'+a+'"');return a.slice(0,-v.length)}function Ba(a){if(a.endsWith(v))return Aa(a);else if(a.endsWith(C))return P(a);throw c("err")('lidOrPhoneFromUserJid called with non phone or lid jid "'+a+'"')}function Ca(a){return a.endsWith(v)||a.endsWith(p)||a.endsWith(o)||a.endsWith(C)?a:null}function Da(a){return a.endsWith(v)?a:null}function Ea(a){return a===k?null:$(a)}function Fa(a){return a===k?null:$(a)}function Ga(a){return a===k?k:null}function P(a){if(!a.endsWith(C))throw c("err")('lidFromLidUserJid called with non-LidUserJid "'+a+'"');return a.slice(0,-C.length)}function Q(a){a=a.split("@");var b=a[0];a=a[1];b=b.split(":")[0];b=b.split(".")[0];a===I&&(a=w);a===ia&&(a=x);return Ab(b+"@"+a)}function Ha(a){return Q(a)}function Ia(a){return Q(a)}function Ja(a){if(a.jidType==="phoneDevice")return a.deviceJid;else if(a.jidType==="interopDevice")return a.deviceJid;else if(a.jidType==="lidDevice")return a.deviceJid;else if(a.jidType==="msgrDevice")return a.deviceJid;else if(a.jidType==="lidUser")return a.userJid;else if(a.jidType==="interopUser")return a.userJid;else if(a.jidType==="msgrUser")return a.userJid;else if(a.jidType==="phoneUser")return a.userJid;else if(a.jidType==="group")return a.groupJid;else if(a.jidType==="status")return a.statusJid;else if(a.jidType==="call")return a.callJid;else if(a.jidType==="newsletter")return a.newsletterJid;else if(a.jidType==="hosted")return a.hostedDeviceJid;else if(a.jidType==="hostedLid")return a.hostedLidDeviceJid;else if(a.jidType==="bot")return a.botJid;else{a.jidType;return a.broadcastJid}}function Ka(a){return Y(O(a)+":"+h+v)}function La(a){return Z(O(a)+":"+h+o)}function Ma(a){return qa(a,h)}function Na(a){return wa(a)===h}function Oa(a){return Eb(a)}function Pa(a){return a}function R(a){a=a.split("@");var b=a[0];a=a[1];b=b.split(":");var c=b[0];b=b[1];c=c.split(".");var d=c[0];c=c[1];return{user:d,device:b,agent:c,server:a}}function Qa(a){a=R(a);var b=a.user,c=a.agent;c=c===void 0?"0":c;var d=a.device;d=d===void 0?"0":d;a=a.server;return b+"."+c+":"+d+"@"+a}function Ra(a){switch(a.jidType){case"interopUser":return a.userJid;case"lidUser":return a.userJid;case"msgrUser":return a.userJid;case"phoneUser":return a.userJid;case"group":return a.groupJid;case"status":return a.statusJid;case"interopDevice":return a.deviceJid;case"lidDevice":return a.deviceJid;case"msgrDevice":return a.deviceJid;case"phoneDevice":return a.deviceJid;case"broadcast":return a.broadcastJid;case"call":return a.callJid;case"newsletter":return a.newsletterJid;case"hosted":return a.hostedDeviceJid;case"hostedLid":return a.hostedLidDeviceJid;case"bot":return a.botJid;default:return c("WAAssertUnreachable")(a.jidType)}}function Sa(a){if(a===l)return{jidType:"call",callJid:l};if(a===k)return{jidType:"status",statusJid:k};else if(B.test(a))return{jidType:"phoneUser",userJid:Bb(a)};else if(r.test(a))return{jidType:"interopUser",userJid:Cb(a)};else if(t.test(a))return{jidType:"msgrUser",userJid:Db(a)};else if(u.test(a)){var b=a.substr(0,a.indexOf(":"));return{jidType:"msgrUser",userJid:N(b)}}else if(A.test(a))return{jidType:"phoneDevice",deviceJid:Y(a)};else if(q.test(a))return{jidType:"interopDevice",deviceJid:yb(a)};else if(s.test(a))return{jidType:"msgrDevice",deviceJid:Z(a)};else if(n.test(a))return{jidType:"group",groupJid:a.endsWith(m)?a:""+a+m};else if(F.test(a))return{jidType:"broadcast",broadcastJid:a};else if(G.test(a))return{jidType:"call",callJid:a};else if(D.test(a))return{jidType:"lidUser",userJid:a};else if(E.test(a))return{jidType:"lidDevice",deviceJid:a};else if(z.test(a))return{jidType:"newsletter",newsletterJid:a};else if(J.test(a))return{jidType:"hosted",hostedDeviceJid:a};else if(L.test(a))return{jidType:"hostedLid",hostedLidDeviceJid:a};else if(ja.test(a))return{jidType:"bot",botJid:a};else return{jidType:"unknown"}}function Ta(a){return a==="status@broadcast"?a:null}function Ua(a){if(B.test(a)||r.test(a)||t.test(a)||D.test(a))return a;else if(u.test(a)){a=a.substr(0,a.indexOf(":"));return N(a)}else return null}function Va(a){return F.test(a)?a:null}function Wa(a){if(A.test(a)||s.test(a)||q.test(a)||E.test(a)||J.test(a)||L.test(a))return a;if(B.test(a))return ub(a);return ja.test(a)?vb(a):null}function Xa(a){return q.test(a)?a:null}function S(a){return n.test(a)?a:null}function Ya(a){return Ta(a)||S(a)||Va(a)?a:null}function Za(a){return G.test(a)?a:null}function $a(a){return a==="s.whatsapp.net"||a==="g.us"||a==="call"?a:null}function ab(a){return Ua(a)||S(a)}function bb(a){return z.test(a)?a:null}function cb(a){return J.test(a)?a:null}function db(a){return L.test(a)?a:null}function eb(a){return Ca(a)==null?$(a):null}function fb(a){a=R(a);var b=a.user,c=a.device;c=c===void 0?"0":c;a=a.server;return Y(b+":"+c+"@"+a)}function gb(a){if(a.endsWith(m))return a.slice(0,-m.length);else throw c("err")('groupId called with non-group jid "'+a+'"')}function hb(a){var b=Sa(a);if(b.jidType==="unknown")return a;if(b.jidType==="status")return b.statusJid;b.jidType;return Ra(b).replace(/^([^@]*)([^@][^@][^@][^@])@(.*)$/,"...$2@$3")}function ib(a){return!a.includes("@")?a:a.replace(la,hb)}function T(a){if(a.endsWith(m))return $(a);else return null}function U(a,b){if(a.endsWith(v))return b.phoneUser(a);else if(a.endsWith(o))return b.msgrUser(a);else if(a.endsWith(p))return b.interopUser(a);else if(a.endsWith(C))return b.lidUser(a);else if(T(a)!=null)return b.group($(a));throw c("err")("Can not switch on chat jid "+a)}function jb(a,b){if(a.endsWith(o))return b.user(a);else if(T(a)!=null)return b.group(a);throw c("err")("Can not switch on chat jid "+a)}function V(a,b){if(a.endsWith(v))return b.user(a);else if(T(a)!=null)return b.group(a);throw c("err")("Can not switch on chat jid "+a)}function kb(a,b){return U(a,{lidUser:function(a){return b.user(a)},interopUser:function(a){return b.user(a)},msgrUser:function(a){return b.user(a)},phoneUser:function(a){return b.user(a)},group:function(a){return b.group(a)}})}function lb(a,b){return a===k?b.status():V(a,{user:b.user,group:b.group})}function mb(a,b){return a===k?b.status():U(a,{interopUser:b.interopUser,phoneUser:b.phoneUser,msgrUser:b.msgrUser,lidUser:b.lidUser,group:b.group})}function nb(a,b){return a===k?b.multicast(k):V(a,{user:b.user,group:b.multicast})}function ob(a){return a.endsWith(C)}function pb(a){return a==="@me"}function qb(a){return a==="@system"}function rb(){return o}function sb(){return v}function tb(){return ea}function W(a){if(a.endsWith(v))return v;else if(a.endsWith(o))return o;else if(a.endsWith(C))return C;else if(a.endsWith(M))return M;else throw c("err")('userDomainFromJid called with non-user jid "'+a+'"')}function ub(a){return X(O(a)+":"+h+W(a))}function vb(a){return X(""+O(a)+W(a))}function wb(a){a=a.platform;var b=a==="msgr"?o:v;function c(a){return""+a+b}function d(){return b}return{toUserJid:c,getUserDomain:d}}function xb(a){return a}function X(a){return a}function Y(a){return a}function Z(a){return a}function yb(a){return a}function zb(a){return a}function Ab(a){return a}function Bb(a){return a}function Cb(a){return a}function Db(a){return a}function $(a){return a}function Eb(a){return a}function Fb(a){return a}function Gb(a){return a}function Hb(a){return a}function Ib(a){return U(a,{group:function(a){return gb(a)},lidUser:function(a){return O(a)},interopUser:function(a){return O(a)},phoneUser:function(a){return O(a)},msgrUser:function(a){return O(a)}})}function Jb(){return ba}g.DEFAULT_DEVICE_ID=h;g.AUTHOR_ME=i;g.AUTHOR_SYSTEM=j;g.STATUS_JID=k;g.PSA_JID=aa;g.CALL_LINK_JID=l;g.MSGR_USER_DOMAIN=o;g.MSGR_USER_JID_SUFFIX=ca;g.INTEROP_DOMAIN=p;g.INTEROP_USER_JID_SUFFIX=da;g.WA_SERVER_JID_SUFFIX=fa;g.WA_USER_DOMAIN=v;g.WA_USER_JID_SUFFIX=w;g.WA_LID_SUFFIX=x;g.WA_NEWSLETTER_JID_DOMAIN=y;g.LID_DOMAIN=C;g.LID_SUFFIX=ga;g.HOSTED_DOMAIN=H;g.HOSTED_SUFFIX=I;g.HOSTED_LID_DOMAIN=K;g.HOSTED_LID_SUFFIX=ia;g.BOT_DOMAIN=M;g.SURVEY_USER_JID=ka;g.toPhoneUserJid=a;g.toLidUserJid=b;g.toMsgrUserJid=N;g.toGroupJid=d;g.toNewsletterJid=e;g.toHostedDeviceJid=f;g.toHostedLidDeviceJid=ma;g.getGroupDomain=na;g.userIdFromJid=O;g.toPhoneDeviceJid=oa;g.toMsgrDeviceJid=pa;g.toLidDeviceJid=qa;g.toDeviceJid=ra;g.toBroadcastJid=sa;g.extractUserId=ta;g.extractChatId__DANGEROUS=ua;g.extractDeviceIDParts=va;g.extractDeviceId=wa;g.authorToUserId=xa;g.authorAsUserJid=ya;g.authorAsPhoneUserJid=za;g.phoneNumberFromJid=Aa;g.lidOrPhoneFromUserJid=Ba;g.interpretAsUserJid=Ca;g.interpretAsPhoneUserJid=Da;g.asChatJid=Ea;g.asPhoneChatJid=Fa;g.asStatusJid=Ga;g.lidFromLidUserJid=P;g.extractUserJid=Q;g.extractPhoneUserJid=Ha;g.extractLidUserJid=Ia;g.extractJidFromJidWithType=Ja;g.defaultPhoneDeviceJidForUser=Ka;g.defaultMsgrDeviceJidForUser=La;g.defaultLidDeviceJidForLidUserJid=Ma;g.isPrimaryDevice=Na;g.interpretAsDeviceId=Oa;g.interpretAsNumber=Pa;g.parseJidParts=R;g.fullFormDeviceJidString=Qa;g.extractFromJid=Ra;g.interpretAndValidateJid=Sa;g.validateStatusJid=Ta;g.validateUserJid=Ua;g.validateBroadcastJid=Va;g.validateDeviceJid=Wa;g.validateInteropDeviceJid=Xa;g.validateGroupJid=S;g.validateMulticastJid=Ya;g.validateCallJid=Za;g.validateDomainJid=$a;g.validateChatJid=ab;g.validateNewsletterJid=bb;g.validateHostedDeviceJid=cb;g.validateHostedLidDeviceJid=db;g.asMulticastJid=eb;g.stripAgentIdFromPhoneDeviceJid=fb;g.groupIdFromJid=gb;g.sanitizeJidForLogging=hb;g.maybeSanitizeLogLineText=ib;g.interpretAsGroupJid=T;g.switchOnChatJidType=U;g.switchOnMsgrChatJidType=jb;g.switchOnPhoneChatJidType=V;g.switchOnUserChatJidType=kb;g.switchOnPhoneJidType=lb;g.switchOnJidType=mb;g.switchOnMulticastJidType=nb;g.isLidUser=ob;g.isAuthorMe=pb;g.isAuthorSystem=qb;g.getMsgrUserDomain=rb;g.getWhatsappUserDomain=sb;g.getServerDomain=tb;g.defaultDeviceJidForUser=ub;g.defaultDeviceJidForBot=vb;g.createJidUtils=wb;g.unsafeCoerceToChatJid=xb;g.unsafeCoerceToDeviceJid=X;g.unsafeCoerceToPhoneDeviceJid=Y;g.unsafeCoerceToMsgrDeviceJid=Z;g.unsafeCoerceToInteropDeviceJid=yb;g.unsafeCoerceToLidDeviceJid=zb;g.unsafeCoerceToUserJid=Ab;g.unsafeCoerceToPhoneUserJid=Bb;g.unsafeCoerceToInteropUserJid=Cb;g.unsafeCoerceToMsgrUserJid=Db;g.unsafeCoerceToGroupJid=$;g.unsafeCoerceToDeviceId=Eb;g.unsafeCoerceToNewsletterJid=Fb;g.unsafeCoerceToHostedDeviceJid=Gb;g.unsafeCoerceToHostedLidDeviceJid=Hb;g.threadIdForChatJid=Ib;g.getGroupCallDomain=Jb}),98);
__d("InstamadilloMessageIdUtils",["FBLogger","I64","MAWUnsafeCoerce","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c;(h||(h=d("I64"))).isI64(a)?c=(h||(h=d("I64"))).to_string(a):c=a;return c+":"+b}function a(a){a=a.split(":");if(a.length!==2)throw c("FBLogger")("igd_web").mustfixThrow("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return{stanzaId:a[1],threadKey:a[0]}}function b(a){a=a.split(":");if(a.length!==2){c("FBLogger")("igd_web").warn("Invalid instamadillo message id format. Format is <threadKey>:<stanzaId>.");return null}return{stanzaId:a[1],threadKey:a[0]}}function e(a){a=a.message.decrypted.id;return j(a)}function j(a){var b=a.externalId;a=d("WAJids").threadIdForChatJid(a.chat);return i(a,b)}function f(a,b,c){return{author:d("WAJids").toMsgrUserJid(c),chat:d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a)),externalId:d("MAWUnsafeCoerce").unsafeCoerce(b)}}g.toInstamadilloMessageId=i;g.fromInstamadilloMessageId=a;g.maybeFromInstamadilloMessageId=b;g.getInstamadilloMessageIdFromStanza=e;g.getInstamadilloMessageIdFromProtocolMsgId=j;g.toProtocolMsgId=f}),98);
__d("LSClientDependencies",[],(function(a,b,c,d,e,f){}),null);
__d("LSDynamicDependencies",["Bootloader","LSDynamicDependenciesEventEmitter","ODS","Promise","SiteData","asyncToGeneratorRuntime","clearTimeout","cr:19620","cr:21165","err","justknobx","nullthrows","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;h=(h=b("cr:21165"))!=null?h:b("cr:19620");var k=babelHelpers["extends"]({},h);function a(a){Object.assign(k,a)}var l={_tombstone:!0};function e(a){var e=new Map();for(a of a){var f=a.name;f!=null&&!o(f)&&e.set(f,c("nullthrows")(a.value))}if(e.size===0)return(j||(j=b("Promise"))).resolve();var g=new(j||(j=b("Promise")))(function(a){var f={},h=[],j=function(c){var a=c[0];c=c[1];c=c==null?void 0:c.__dr;f[c]={be:1,r:[]};h.push(c);(i||(i=d("ODS"))).bumpEntityKey(3185,"ls_download_dependency.relay",c);k[a]={load:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield g;return k[a]});function d(){return c.apply(this,arguments)}return d}()}};for(var l of e)j(l);c("Bootloader").handlePayload({compMap:f,consistency:{rev:c("SiteData").client_revision}});m(c("Bootloader"),h,function(b){Array.from(e.entries()).forEach(function(a,c){var d=a[0];a[1];k[d]=b[c]}),a()})});return g}function m(a,b,c){return a.loadModules.call(a,b,function(){for(var a=arguments.length,b=new Array(a),d=0;d<a;d++)b[d]=arguments[d];return c(b)})}function n(a){return a.charAt(0).toUpperCase()+a.slice(1)}function o(a){return a in k&&k[a]!==l}var p=c("justknobx")._("2800");function f(a,e,f){var g=new Map();for(a of a!=null?a:[])o(a)||g.set(a,"LS"+n(a));for(a of e!=null?e:[])!o(a+".bs")?g.set(a+".bs","LS"+n(a)+".nop"):a+".nop"in k||g.set(a+".nop","LS"+n(a)+".nop");for(e of f!=null?f:[])e in k||g.set(e,"LS"+n(e));if(g.size===0)return(j||(j=b("Promise"))).resolve();var h=new(j||(j=b("Promise")))(function(a,e){var f={},j=[],n=function(a){var c=a[0];a=a[1];(i||(i=d("ODS"))).bumpEntityKey(3185,"ls_download_dependency.bootloader",a);d("LSDynamicDependenciesEventEmitter").emitLoadModuleEvent(a);f[a]={be:1,r:[]};j.push(a);k[c]={load:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield h}catch(a){k[c]=l;throw a}return k[c]});function d(){return a.apply(this,arguments)}return d}()}};for(var o of g)n(o);c("Bootloader").handlePayload({compMap:f,consistency:{rev:c("SiteData").client_revision}});var q=m(c("Bootloader"),j,function(b){c("clearTimeout")(r),Array.from(g.entries()).forEach(function(a,c){var d=a[0];a[1];k[d]=b[c]}),a()}),r=c("setTimeout")(function(){q.remove(),e(c("err")("Dynamic sproc loading timeout (%s ms); was loading: %s",p,Array.from(g.keys())))},p)});return h}g.cachedModules=k;g.addToCachedModules=a;g.TOMBSTONE=l;g.downloadRelayDependencies=e;g.downloadBootloaderDependencies=f}),98);
__d("XPlatReactCrypto",["err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h=self.crypto)==null?void 0:h.subtle;function a(a){var b;if(typeof ((b=self.crypto)==null?void 0:b.getRandomValues)!=="function")throw c("err")("crypto.getRandomValues: Not implemented");self.crypto.getRandomValues(a);return a}function b(){var a;if(typeof ((a=self.crypto)==null?void 0:a.randomUUID)!=="function")return null;a=self.crypto.randomUUID();return typeof a==="string"?a:null}function d(a,b,d,e,f){if(i==null)throw c("err")("crypto.subtle.importKey: Not implemented");return i.importKey(a,b,d,e,f)}function e(a,b){if(i==null)throw c("err")("crypto.subtle.exportKey: Not implemented");return i.exportKey(a,b)}function f(a,b,d){if(i==null)throw c("err")("crypto.subtle.generateKey: Not implemented");return i.generateKey(a,b,d)}function j(a,b,d){if(i==null)throw c("err")("crypto.subtle.encrypt: Not implemented");return i.encrypt(a,b,d)}function k(a,b,d){if(i==null)throw c("err")("crypto.subtle.decrypt: Not implemented");return i.decrypt(a,b,d)}function l(a,b,d){if(i==null)throw c("err")("crypto.subtle.sign: Not implemented");return i.sign(a,b,d)}function m(a,b){if(i==null)throw c("err")("crypto.subtle.digest: Not implemented");return i.digest(a,b)}function n(a,b,d){if(i==null)throw c("err")("crypto.subtle.deriveBits: Not implemented");return i.deriveBits(a,b,d)}function o(a,b,d,e,f){if(i==null)throw c("err")("crypto.subtle.deriveKey: Not implemented");return i.deriveKey(a,b,d,e,f)}g.getRandomValues=a;g.randomUUID=b;g.subtleImportKey=d;g.subtleExportKey=e;g.subtleGenerateKey=f;g.subtleEncrypt=j;g.subtleDecrypt=k;g.subtleSign=l;g.subtleDigest=m;g.subtleDeriveBits=n;g.subtleDeriveKey=o}),98);
__d("LSInt64Lite",["FBLogger","I64","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;a={add:(h||(h=d("I64"))).add,and_:h.and_,asr_:h.asr_,cast:function(a){return(h||(h=d("I64"))).mk(a[1],a[0])},div:h.div,eq:function(a,b){return a==null&&b==null||a!=null&&b!=null&&(h||(h=d("I64"))).equal(a,b)},from_string:function(a){try{return(h||(h=d("I64"))).of_string(a)}catch(b){throw c("FBLogger")("messenger_web").mustfixThrow('Unable to cast "%s" to int64',a)}},ge:h.ge,gt:h.gt,le:h.le,lsl_:h.lsl_,lsr_:h.lsr_,lt:h.lt,max:h.max,min:h.min,mod_:h.mod_,mul:h.mul,neq:function(a,b){return a==null&&b!=null||a!=null&&b==null||a!=null&&b!=null&&!(h||(h=d("I64"))).equal(a,b)},of_float:h.of_float,of_int32:h.of_int32,or_:h.or_,random:function(){var a=Array.from(d("XPlatReactCrypto").getRandomValues(new Uint32Array(2)));a[0]>>>=1;return(h||(h=d("I64"))).add(h.lsl_(h.of_float(a[0]),32),h.of_float(a[1]))},sub:h.sub,to_float:h.to_float,to_int32:h.to_int32,to_string:function(a){return a==null?a:(h||(h=d("I64"))).to_string(a)},xor:h.xor};g["default"]=a}),98);
__d("LSMaybeSyncIteration",["LSSynchronousPromise","isPromise"],(function(a,b,c,d,e,f,g){"use strict";var h,i={__val__:"__stop_iteration__"};function a(a){return{__val__:"__next_value__",next:a}}function j(a){return a!=null&&typeof a==="object"&&a.__val__==="__next_value__"}function k(a,b,e){var f=l(a,e);while(!(h||(h=c("isPromise")))(f)){if(f.done)return d("LSSynchronousPromise").makeSynchronousPromise(f);e=d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(b(f));if(!(h||(h=c("isPromise")))(e)){if(e===i)return d("LSSynchronousPromise").makeSynchronousPromise(f);var g=j(e)?e.next:void 0;f=l(a,g)}else return e.then(function(c){if(c===i)return f;c=j(c)?c.next:void 0;return k(a,b,c)})}var n=m(b);return f.then(function(c){return c.done?c:n(c).then(function(d){if(d===i)return c;d=j(d)?d.next:void 0;return k(a,b,d)})})}function l(a,b){a=a.next(b);return!(h||(h=c("isPromise")))(a)?a:d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a)}function m(a){return function(b){b=a(b);return d("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(b)}}g.STOP_ITERATION=i;g.wrapNextValue=a;g.iteratorLoop=k}),98);
__d("LSIterationOperations",["I64","LSDict","LSMaybeSyncIteration","LSSynchronousPromise","ReStoreKeyComparer"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){var c;return c={},c[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return j(a,b)},c.next=function(){var c={done:!0},e=function(a){return d("LSSynchronousPromise").wrapInMaybeSyncPromiseIfNotPromise(b(a.value.item)).then(function(b){if(b){c=a;return d("LSMaybeSyncIteration").STOP_ITERATION}})};return d("LSMaybeSyncIteration").iteratorLoop(a,e).then(function(){return c})},c}function k(a,b,c){var e,f=0;return e={},e[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return k(a,b,c)},e.next=function(){if(f>=c)return d("LSSynchronousPromise").maybeMakeSynchronousPromise({done:!0});var e={done:!0},g=function(a){if(f++<b)return;e=a;return d("LSMaybeSyncIteration").STOP_ITERATION};return d("LSMaybeSyncIteration").iteratorLoop(a,g).then(function(){return e})},e}function a(a,b){return l(a).then(function(a){return a.reduce(function(a,c){return a.then(function(){return b(c)})},d("LSSynchronousPromise").maybeMakeSynchronousPromise(void 0))})}function l(a){var b=[],c=function(a){b.push(a.value)};return d("LSMaybeSyncIteration").iteratorLoop(a,c).then(function(){return b})}function m(a,b,c){var e;c===void 0&&(c=[]);var f={ASC:1,DESC:-1},g=function(a,c){a=a.item;c=c.item;for(var e=0;e<b.length;e++){var g=b[e];g=g[0];var i=a[g];g=c[g];var j;i==null&&g==null?j=0:i==null&&g!=null?j=-1:i!=null&&g==null?j=1:j=(h||(h=d("ReStoreKeyComparer"))).compareValue(i,g);if(j===0)continue;return j*f[b[e][1]]}return 0},i,j=[],k=[],l=function(a){var b=[];for(var d=c.length-1;d>=0;d--)b.push(a[c[d]]);return b},n=function(){k=j,k.sort(g),j=[]};return e={},e[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return m(a,b,c)},e.next=function(){if(k.length)return d("LSSynchronousPromise").maybeMakeSynchronousPromise({done:!1,value:k.shift()});var b=function(a){var b=l(a.value.item);if(i!=null&&(h||(h=d("ReStoreKeyComparer"))).compareKey(i,b)!==0){n();j.push(a.value);i=b;return d("LSMaybeSyncIteration").STOP_ITERATION}i=b;j.push(a.value)};return d("LSMaybeSyncIteration").iteratorLoop(a,b).then(function(){!k.length&&j.length&&n();if(k.length)return{done:!1,value:k.shift()};else return{done:!0}})},e}function b(a){var b=0,c=function(){b++};return d("LSMaybeSyncIteration").iteratorLoop(a,c).then(function(){return(i||(i=d("I64"))).of_int32(b)})}function e(a,b){return{forEach:function(e){return l(a).then(function(a){a=a.reduce(function(a,c){c=c.item[b];var d=(a.get(c)||0)+1;return a.set(c,d)},new(c("LSDict"))());var f=d("LSSynchronousPromise").maybeMakeSynchronousPromise(void 0),g=function(a){var c=a[0],g=a[1];f=f.then(function(){var a;return e((a={},a[b]=c,a.group_count=(i||(i=d("I64"))).of_int32(g),a))})};for(a of a.entries())g(a);return f})}}}g.filter=j;g.slice=k;g.forEach=a;g.toArray=l;g.sortBy=m;g.count=b;g.groupBy=e}),98);
__d("LSJson",["FBLogger","I64","LSDict","LSVec"],(function(a,b,c,d,e,f,g){"use strict";var h,i=512,j={useLSTypes:!1};function a(a,b){b=b===void 0?j:b;var e=b.useLSTypes;function f(a,b){return function(){return function(c){c=a()(c);if(c!=null){var d=c[0];c=c[1];return[b(d),c]}}}}function g(a){return JSON.parse('"'+a+'"')}function i(a){return function(){return function(b){var c=g(a);if(b.startsWith(c))return[c,b.substr(c.length)];else return void 0}}}function k(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(){return function(a){var c=[];a=a;for(var d of b){var e=d()(a);if(e==null)return void 0;a=e[1];c.push(e[0])}return[c,a]}}}function l(a){return function(){return function(b){var c=a.exec(b);return c!=null?[c,b.substr(c[0].length)]:void 0}}}function m(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return function(){return function(a){for(var c of b){var d=c()(a);if(d!=null)return d}}}}function n(a){return function(){return function(b){var c=a()(b);return c!=null?c:[void 0,b]}}}function o(a){return function(){return function(b){var c=a()(b),d=[];b=b;while(c!=null)b=c[1],d.push(c[0]),c=a()(b);return[d,b]}}}b=l(/^[\n\r\s]*/);var p=f(l(/^\"((?:[^\"\\]|\\.)*)\"/),function(a){a=a[1];return g(a)}),q=f(l(/^-?\d+(?:(?:\.\d+)?[eE][-\+]?\d+|\.\d+)/),function(a){a=a[0];return Number(a)});l=f(l(/^-?\d+/),function(a){a=a[0];return(h||(h=d("I64"))).of_string(a)});var r=f(i("null"),function(a){return null}),s=f(i("true"),function(a){return!0}),t=f(i("false"),function(a){return!1}),u=f(k(b,p,b,i(":"),function(){return v()}),function(a){var b=a[1];a=a[4];return[b,a]});u=f(k(u,o(k(b,i(","),u))),function(a){var b=a[0];a=a[1];return[b].concat(a.map(function(a){a=a[2];return a}))});u=f(k(i("{"),n(u),b,i("}")),function(a){a=a[1];a=a===void 0?[]:a;return e?new(c("LSDict"))(a):Object.fromEntries(a)});o=f(k(function(){return v()},o(k(b,i(","),function(){return v()}))),function(a){var b=a[0];a=a[1];return[b].concat(a.map(function(a){a=a[2];return a}))});n=f(k(i("["),b,n(o),b,i("]")),function(a){a=a[2];a=a===void 0?[]:a;return e?c("LSVec").ofArray(a):a});var v=f(k(b,m(u,p,q,l,n,r,s,t),b),function(a){a=a[1];return a});o=v()(a);if(o==null)throw c("FBLogger")("messenger_web").mustfixThrow("error parsing string");if(o[1]!=="")throw c("FBLogger")("messenger_web").mustfixThrow("unexpected %s",o[1]);return o[0]}function k(a,b,e){b===void 0&&(b=0);e===void 0&&(e="");if(b>i)throw c("FBLogger")("messenger_web").mustfixThrow("recursion limit exceeded");if(typeof a==="string"||typeof a==="number")return JSON.stringify(a);else if(typeof a==="boolean")return a?"1":"0";else if(a==null)return"null";else if(typeof a==="object")if(Array.isArray(a)){if(a.tag==="ls-array")return"["+a.map(function(a,c){return k(a,b+1,e+"/"+c.toString())}).join(",")+"]";a._tag!=="i64"&&c("FBLogger")("messenger_web").warn("LSJson payload contains untagged i64: %s",e);return(h||(h=d("I64"))).to_string(a)}else if(a instanceof c("LSDict"))return"{"+Array.from(a.entries()).map(function(a){var d=a[0];a=a[1];if(typeof d==="string")return JSON.stringify(d)+":"+k(a,b+1,e+"/"+d);else throw c("FBLogger")("messenger_web").mustfixThrow("key must be a string")}).join(",")+"}";throw c("FBLogger")("messenger_web").mustfixThrow("type not supported: %s, path: %s",a===null?"null":typeof a,e)}g.parse=a;g.stringify=k}),98);
__d("LSPendingTasksPluginType",[],(function(a,b,c,d,e,f){a=Object.freeze({LS_BROKER:0,PAYMENTS:1,EPHEMERAL_MESSAGING:2,CARRIER_MESSAGING:3,BUG_REPORTER:4,MESSAGE_DENORMALIZATIONS:5,SEEN_HEADS:6,MEDIA_UPLOAD:7,SECURE_THREAD_SEEN_HEADS:8,WHATSAPP_THREAD:9,SECURE_THREAD_OVER_WA_MESSAGE_SEND:10,CONTACT_PRUNING:11,MEDIA_MANAGER:12,SECURE_THREAD_OVER_WA_ENCRYPTION:13,STORY_POST:14,CO_PRESENCE_HEARTBEAT:16,SECURE_THREAD_OVER_WA_GROUP_MANAGEMENT:17,ENCRYPTED_BACKUPS:23,ANONYMOUS_REQUEST:25,MESSAGE_ACTIONS:28,MESSAGE_UNSEND_ATTACHMENT_CLEANUP:39,IGD_INSTAMADILLO:40,PENDING_MESSAGE_SEND:46});f["default"]=a}),66);
__d("isNativeTask",["I64","LSPendingTasksPluginType"],(function(a,b,c,d,e,f,g){"use strict";var h,i="4",j="16",k=new Set([c("LSPendingTasksPluginType").IGD_INSTAMADILLO]);function a(a){var b=k.has((h||(h=d("I64"))).to_float(a.pluginType));a=a.context===j||a.context===i;return b||a}g["default"]=a}),98);
__d("LSIterationHelpers",["FBLogger","LSMaybeSyncIteration","LSSynchronousPromise","ReStoreKeyComparer","ReStoreVaulting","gkx","isNativeTask"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set(["messages","attachments","reactions"]);function j(a){return i.has(a)}function k(a,b,d){return a&&b.name==="pending_tasks"&&d!=null&&c("isNativeTask")(d)}function l(a){for(var b of Object.keys(a))a[b]===void 0&&delete a[b];return a}function m(a,b,c){c===void 0&&(c="asc");var e=a.entries(new WeakMap(),c);function f(){var a;return a={},a[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=f,a.next=function(){var a={done:!0},f=0,g="start",i=[],j=function(e){var j=function(){var a=f,j=b[a]||{},k=j.end;j=j.start;var l=e.value[0];if(j&&g==="start"){var m=(h||(h=d("ReStoreKeyComparer"))).compareValue(l[a],j[0]),n=m*(c==="asc"?1:-1)<j[1];if(n){g="start_verify";i=l.slice(0,a);if(a===l.length-1&&m===0)return{v:void 0};else{n=[].concat(i,[j[0]],j[1]&&c==="asc"||!j[1]&&c==="desc"?[(h||(h=d("ReStoreKeyComparer"))).MAX_KEY]:[]);return{v:d("LSMaybeSyncIteration").wrapNextValue(n)}}}else g="check_end"}if(j&&g==="start_verify"&&!i.every(function(a,b){return(h||(h=d("ReStoreKeyComparer"))).compareValue(a,l[b])===0})){f=0;g="start";return{v:void 0}}if(k&&(h||(h=d("ReStoreKeyComparer"))).compareValue(k[0],l[a])*(c==="asc"?1:-1)<k[1]){f=0;g="start";return{v:d("LSMaybeSyncIteration").wrapNextValue([].concat(l.slice(0,a),c==="asc"?[(h||(h=d("ReStoreKeyComparer"))).MAX_KEY]:[]))}}f++;g="start"};while(f<b.length){var k=j();if(typeof k==="object")return k.v}a=e;return d("LSMaybeSyncIteration").STOP_ITERATION};return d("LSMaybeSyncIteration").iteratorLoop(e,j).then(function(){return a})},a}return f()}function n(a,b,c){c===void 0&&(c="asc");var e=a.entries(new WeakMap(),c);function f(){var a;return a={},a[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=f,a.next=async function(){var a=await e.next();outer:while(!a.done){var f=async function(f){var g=b[f]||{},i=g.end;g=g.start;var j=a.value[0],k=j.slice(0,f);if(g){var l=(h||(h=d("ReStoreKeyComparer"))).compareValue(j[f],g[0]);if(l*(c==="asc"?1:-1)<g[1]){if(f===j.length-1&&l===0)a=await e.next();else{l=[].concat(k,[g[0]],g[1]&&c==="asc"||!g[1]&&c==="desc"?[(h||(h=d("ReStoreKeyComparer"))).MAX_KEY]:[]);a=await e.next(l)}if(a.done)return{v:{done:!0}};j=a.value[0];if(!k.every(function(b,a){return(h||(h=d("ReStoreKeyComparer"))).compareValue(b,j[a])===0}))return"continue|outer"}}if(i&&(h||(h=d("ReStoreKeyComparer"))).compareValue(i[0],j[f])*(c==="asc"?1:-1)<i[1]){a=await e.next([].concat(j.slice(0,f),c==="asc"?[(h||(h=d("ReStoreKeyComparer"))).MAX_KEY]:[]));return"continue|outer"}};for(var g=0;g<b.length;g++){var i=await f(g);switch(i){case"continue|outer":continue outer;default:if(typeof i==="object")return i.v}}break}return a},a}return f()}function o(a,b,d,e,f){return{delete:function(){return d.delete.apply(d,a)},item:b,update:function(g){var h=f&&j(e.name)?{transportKey:"FBBroker"}:{};g=babelHelpers.extends({},b,{},g,{},h);if(k(f,e,g))throw c("FBLogger")("messenger_web").mustfixThrow("cannot insert native task in dynamic mode");return d.upsert(a,l(g))}}}function p(a,b){var c;return c={},c[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return p(a,b)},c.next=function(){var c={done:!0},e=function(a){c=a;return d("LSMaybeSyncIteration").STOP_ITERATION};return d("LSMaybeSyncIteration").iteratorLoop(a,e).then(function(){if(c.done)return d("LSMaybeSyncIteration").iteratorLoop(b,e)}).then(function(){return c})},c}function q(a,b,c){var e,f=[{done:!0},{done:!0}],g=function(a){var b=f[a];f[a]={done:!0};return b};return e={},e[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return q(a,b,c)},e.next=function(){var e=function(a){return function(b){a==="a"?f[0]=b:f[1]=b;return d("LSMaybeSyncIteration").STOP_ITERATION}},i=d("LSSynchronousPromise").maybeMakeSynchronousPromise();f[0].done&&(i=i.then(function(){return d("LSMaybeSyncIteration").iteratorLoop(a,e("a"))}));f[1].done&&(i=i.then(function(){return d("LSMaybeSyncIteration").iteratorLoop(b,e("b"))}));return i.then(function(){if(f[0].done&&f[1].done)return{done:!0};if(f[0].done)return g(1);if(f[1].done)return g(0);var a=(h||(h=d("ReStoreKeyComparer"))).compareKey(f[0].value[0],f[1].value[0]);if(a===0)return g(0);return a*(c==="asc"?1:-1)<0?g(0):g(1)})},e}var r=(b={},b[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=function(){return r},b.next=function(){return d("LSSynchronousPromise").maybeMakeSynchronousPromise({done:!0})},b);function a(a,b,e,f,g,h,i,l){var s=new Set(),t=a.length>1,u=a.length===1&&a[0][1]==null,v=a.map(function(a){var i=a[0],j=a[1];return i.map(function(a){f.key_lookup===!0&&a.length!==0;f.table_scan===!0&&a.length===0;var i=a.map(function(a){return h(a,b)});a=i.length===(j==null?e.primaryKeyIds:e.indexes[j]).length&&i.every(function(a){var b=a.end;a=a.start;return a&&b&&a[0]===b[0]&&a[1]===0&&b[1]===0});if(a){a=function a(){var b,c=!1;return b={},b[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=a,b.next=function(){var a;if(c)return d("LSSynchronousPromise").maybeMakeSynchronousPromise({done:!0});c=!0;var b=i.map(function(a){a=a.start;return a[0]});return(a=j==null?g:g.index(j)).get.apply(a,b).then(function(a){if(!a)return{done:!0};a=d("ReStoreVaulting").maybeUnvaultDbRow(a,e.name);return{done:!1,value:[b,a]}})},b};return a()}a=c("gkx")("2839")?m:n;return a(j==null?g:g.index(j),i,b)})}).flat().reduce(function(c,d,e){e=e===0&&c==null?r:c;return a.length>1?p(e,d):q(e,d,b)});function w(){var a;return a={},a[typeof Symbol==="function"?Symbol.asyncIterator:"@@asyncIterator"]=w,a.next=function(){var a=!0,b,f,h,m,n=function(c){a=!1;var g=c.value;f=g[0];h=g[1];b=u?f:e.primaryKeyIds.map(function(a){return h[a]});if(k(i,e,h)){m=c;a=!0;return}if(j(e.name)&&i&&h!=null&&h.transportKey!=="FBBroker"){m=c;a=!0;return}if(t){g=JSON.stringify(b);if(s.has(g)){a=!0;return}s.add(g)}return d("LSMaybeSyncIteration").STOP_ITERATION};return d("LSMaybeSyncIteration").iteratorLoop(v,n).then(function(){if(m!=null){var d=m.value[1].transportKey;c("FBLogger")("messenger_web").warn('Expected transportKey to equal ("FBBroker") in %s, provided transportKey: %s',l,d)}return a||b==null||h==null?{done:!0}:{done:!1,value:o(b,h,g,e,i)}})},a}return w()}g.isTranportKeyEnforcedTable=j;g.isNativePendingTaskViolation=k;g.stripUndefinedProperties=l;g.unionIterators=p;g.mergeIterators=q;g.fetch=a}),98);
__d("LSRuntimeDb",["FBLogger","LSIterationHelpers"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.name.match(/secure_|inbox(?!_)/i)}function a(a,b,d,e,f,g){return{metadata:d,table:function(j){j=d.tableNames[d.tableIds[j]];if(b===0&&h(j))throw c("FBLogger")("messenger_web").mustfixThrow("cannot access secure table from dynamic mode");return i(a,j,e,f,g)},transactionId:a.__internal__transaction_id}}function i(a,b,e,f,g){var h=a.transactionTable(b.name,f[f.length-1]);return{add:async function(a){d("LSIterationHelpers").isTranportKeyEnforcedTable(b.name)&&g&&(a.transportKey="FBBroker"),await h.add(a)},fetch:function(){for(var a=arguments.length,c=new Array(a),i=0;i<a;i++)c[i]=arguments[i];return d("LSIterationHelpers").fetch(c.length===0?[[[[]],void 0]]:c,"asc",b,e,h,j,g,f.join(", "))},fetchDesc:function(){for(var a=arguments.length,c=new Array(a),i=0;i<a;i++)c[i]=arguments[i];return d("LSIterationHelpers").fetch(c.length===0?[[[[]],void 0]]:c,"desc",b,e,h,j,g,f.join(", "))},peekNextAutoIncrementId:function(){return h.peekNextAutoIncrementId()},put:async function(a){d("LSIterationHelpers").isTranportKeyEnforcedTable(b.name)&&g&&(a.transportKey="FBBroker");if(d("LSIterationHelpers").isNativePendingTaskViolation(g,b,a))throw c("FBLogger")("messenger_web").mustfixThrow("cannot put native task via LS transport");var e=b.primaryKeyIds.map(function(b){if(a[b]!==void 0)return a[b];throw c("FBLogger")("messenger_web").mustfixThrow("primary key must be defined on object")});await h.delete.apply(h,e);await h.add(d("LSIterationHelpers").stripUndefinedProperties(babelHelpers.extends({},a)))}}}function j(a,b){if(typeof a==="object"&&!Array.isArray(a)){var d,e;if(b==="asc"){Object.prototype.hasOwnProperty.call(a,"gt")&&(d=[a.gt,1]);if(Object.prototype.hasOwnProperty.call(a,"gte")){if(d!=null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot specify both gt and gte");d=[a.gte,0]}Object.prototype.hasOwnProperty.call(a,"lt")&&(e=[a.lt,1]);if(Object.prototype.hasOwnProperty.call(a,"lte")){if(e!=null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot specify both lt and lte");e=[a.lte,0]}}else{Object.prototype.hasOwnProperty.call(a,"lt")&&(d=[a.lt,1]);if(Object.prototype.hasOwnProperty.call(a,"lte")){if(d!=null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot specify both lt and lte");d=[a.lte,0]}Object.prototype.hasOwnProperty.call(a,"gt")&&(e=[a.gt,1]);if(Object.prototype.hasOwnProperty.call(a,"gte")){if(e!=null)throw c("FBLogger")("messenger_web").mustfixThrow("Cannot specify both gt and gte");e=[a.gte,0]}}return{end:e,start:d}}return{end:[a,0],start:[a,0]}}g.LSRuntimeDb=a;g.parseConstraint=j}),98);
__d("XPlatReactTextDecoder",[],(function(a,b,c,d,e,f){"use strict";a=self.TextDecoder;f.TextDecoder=a}),66);
__d("LS",["ExecutionEnvironment","FBLogger","I64","LSDict","LSDynamicDependencies","LSInt64Lite","LSIterationOperations","LSJson","LSRuntimeDb","LSSynchronousPromise","LSVec","MessengerLogHistory","MetaConfig","ODS","ReStoreKeyComparer","XPlatReactTextDecoder","XPlatReactTextEncoder","base64Binary","cr:1088","cr:4790","emptyFunction","err","gkx","isPromise","justknobx","qpl","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l;function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["2"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["0"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["0"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["2"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["2"]);q=function(){return a};return a}var r="LS_WEB",s=d("MessengerLogHistory").getInstance("ls");function t(a){return d("base64Binary").decode(a).buffer}var u={compareTo:function(a,b){a=new Uint8Array(a);b=new Uint8Array(b);var c=Math.min(a.length,b.length);for(var d=0;d<c;d++){var e=a[d]-b[d];if(e!==0)return e}return a.length===b.length?0:a.length-b.length},eq:function(a,b){if(a==null&&b==null)return!0;if(a==null||b==null)return!1;a=new Uint8Array(a);b=new Uint8Array(b);if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},ge:function(a,b){return u.compareTo(a,b)>=0},gt:function(a,b){return u.compareTo(a,b)>0},le:function(a,b){return u.compareTo(a,b)<=0},lt:function(a,b){return u.compareTo(a,b)<0},neq:function(a,b){return!u.eq(a,b)},of_string:function(a){if(a==null)return void 0;var b=new(d("XPlatReactTextEncoder").TextEncoder)();return b.encode(a).buffer},to_string:function(a){if(a==null)return void 0;var b=new(d("XPlatReactTextDecoder").TextDecoder)();return b.decode(a)}};function v(a){if(a.length!==1)throw c("FBLogger")("messenger_web").mustfixThrow("only literal strings supported");a=a[0];var b=parseInt(a.substr(-8),16);a=parseInt(a.substr(0,a.length-8),16);return(l||(l=d("I64"))).mk((b>>>1)+(a&1)*2147483648^-(b&1),a>>>1^-(b&1))}function w(a){var b="unknown_sproc";a=a.displayName;var c=/\[from (.*)\]/;c=c.exec(a);c!=null&&(b=c[1]);return b}var x=function(){var a=0;function d(d){var e=d.args,f=d.shouldLog;d=d.sprocName;b("cr:1088")==null?void 0:b("cr:1088").logStoredProcedureCall(d,e);if(!f||!b("cr:4790"))return;e=++a;b("cr:4790").markerStart(c("qpl")._(25302991,"143"),e);b("cr:4790").markerAnnotate(c("qpl")._(25302991,"143"),{string:{name:d}},{instanceKey:e});return e}function e(a,d,e){a=a.shouldLog;if(!a||d==null)return;b("cr:4790")==null?void 0:b("cr:4790").markerEnd(c("qpl")._(25302991,"143"),e,d)}function f(a){return c("gkx")("26381")?Math.random()*c("MetaConfig")._("10")<1:!1}return{call:d,logSprocDone:e,shouldLogSproc:f}}(),y="Native operation timeout; transaction blocked",z=30*1e3;function A(a,b,e,f,g,l,B){g===void 0&&(g={});l===void 0&&(l=void 0);var C=[],D=d("LSRuntimeDb").LSRuntimeDb(f,a,b,g,C,B),E=function(b,g){for(var h=arguments.length,i=new Array(h>2?h-2:0),j=2;j<h;j++)i[j-2]=arguments[j];var k;if(typeof g==="string"){k=e[g.toString()];if(k==null)throw c("FBLogger")("messenger_web").mustfixThrow("Attempted to call unimplemented native type op with type: %s and id: %s",b,g);if(k===d("LSDynamicDependencies").TOMBSTONE)throw c("err")("Concurrent native type op loading failed for: %s (retryable)",g);k.load&&(k=k.load())}else k=g;return d("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(k).then(function(b){return b.call.apply(b,[f,a].concat(i))})},F=function(b){for(var g=arguments.length,i=new Array(g>1?g-1:0),j=1;j<g;j++)i[j-1]=arguments[j];var l;if(typeof b==="string"){l=e[b+".bs"]||e[b+".nop"];if(l==null)throw c("FBLogger")("messenger_web").mustfixThrow("Attempted to call unimplemented native op with id: %s",b);if(l===d("LSDynamicDependencies").TOMBSTONE)throw c("err")("Concurrent native type op loading failed for: %s (retryable)",b);l.load&&(l=l.load())}else l=b;var m;return d("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(l).then(function(b){var e;m=(e=(e=b.__nop_name__)!=null?e:b==null?void 0:b.toString())!=null?e:"<unknown nop name>";e=d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(b.apply(void 0,[f,a].concat(i)));return!(h||(h=c("isPromise")))(e)?e:c("justknobx")._("3895")&&(k||(k=c("ExecutionEnvironment"))).isInBrowser?Promise.race([e,new Promise(function(a,b){return c("setTimeout")(function(){return b(c("err")(y))},z)})]):e}).then(function(a){return a},function(a){c("FBLogger")("messenger_web").catching(a).addMetadata(r,"NATIVE_OP_ID",m).mustfixThrow("Native operation %s failed: was_timeout: %s, is_in_worker: %s",m,(a==null?void 0:a.message)===y,(k||(k=c("ExecutionEnvironment"))).isInWorker)})},G=function(a){return a.slice(1).reduce(function(b,d){if(typeof d!=="function"){c("FBLogger")("messenger_web").mustfix("Non-function passed (%s, type %s) in sequence (%s)",d,typeof d,JSON.stringify(a.map(function(a){return typeof a})));return b}return b.then(d)},a[0]())},H=function(a,b){return a.slice(b)};return{Map:c("LSDict"),blob:t,blobs:u,constructor:{n:v},count:d("LSIterationOperations").count,createArray:function(){return c("LSVec").ofArray([])},createArrayWithElements:function(){for(var a=arguments.length,b=new Array(a),d=0;d<a;d++)b[d]=arguments[d];return c("LSVec").ofArray(b)},db:D,filter:d("LSIterationOperations").filter,forEach:d("LSIterationOperations").forEach,groupBy:d("LSIterationOperations").groupBy,i64:c("LSInt64Lite"),islc:d("LSIterationOperations").slice,like:function(a,b){b=b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/%/g,".*").replace(/_/g,".");return RegExp(b).test(a)},logger:function(a){if(l)return{debug:l,info:l,mustfix:l,warn:l};var b=c("FBLogger")("messenger_web"),e=a.startsWith("epoch mismatch"),f=a.startsWith("cursor mismatch");if(e||f){a=function(a){s.error(a,"error");a=function(){if(e)return"epoch_mismatch";else if(f)return"cursor_mismatch";else return"fixme_could_not_produce_key"}();(i||(i=d("ODS"))).bumpEntityKey(3185,"lsplatform",a)};return{debug:function(a){return s.debug(a)},info:function(a){return s.debug(a)},mustfix:a,warn:a}}else{c("gkx")("26382")||(b.info=c("emptyFunction"));return b}},loopAsync:function(a,b){function e(f){if(c("LSInt64Lite").lt(f,a)){var g=f;f=d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(b(g));while(!(h||(h=c("isPromise")))(f)){g=c("LSInt64Lite").add(g,v(q()));if(!c("LSInt64Lite").lt(g,a))return d("LSSynchronousPromise").makeSynchronousPromise(void 0);f=d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(b(g))}return f.then(function(){return e(c("LSInt64Lite").add(g,v(p())))})}return d("LSSynchronousPromise").maybeMakeSynchronousPromise(void 0,self.Promise)}return e(v(o()))},loopSync:function(a,b){for(var d=v(n());c("LSInt64Lite").lt(d,a);d=c("LSInt64Lite").add(d,v(m())))b(d)},merge:function(){function a(a,b){return(j||(j=d("ReStoreKeyComparer"))).compareValue(a,b)>0?a:b}function b(a,b){return(j||(j=d("ReStoreKeyComparer"))).compareValue([a[0],-a[1]],[b[0],-b[1]])<0?a:b}for(var c=arguments.length,e=new Array(c),f=0;f<c;f++)e[f]=arguments[f];var g=e.reduce(function(c,e){e=d("LSRuntimeDb").parseConstraint(e,"asc");return{end:c.end&&e.end?b(e.end,c.end):e.end||c.end,start:c.start&&e.start?a(e.start,c.start):e.start||c.start}},{});return babelHelpers.extends({},g.start?g.start[1]?{gt:g.start[0]}:{gte:g.start[0]}:null,{},g.end?g.end[1]?{lt:g.end[0]}:{lte:g.end[0]}:null)},n:v,nativeOperation:F,nativeTypeOperation:E,notnull:function(a){if(a===null)throw c("FBLogger")("messenger_web").mustfixThrow("value should not be null");return a},print:function(a){},resolve:function(a){return d("LSSynchronousPromise").wrapInMaybeSyncPromiseIfNotPromise(a,self.Promise)},resolveGuaranteeAsync:function(a){var b;return((b=self.Promise)!=null?b:Promise).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))},rm:c("LSInt64Lite").of_int32(a),sequence:G,slice:H,sortBy:d("LSIterationOperations").sortBy,storedProcedure:function(h){for(var i=arguments.length,j=new Array(i>1?i-1:0),k=1;k<i;k++)j[k-1]=arguments[k];var m;if(typeof h==="string"){m=e[h];if(m==null)throw c("FBLogger")("messenger_web").mustfixThrow("Attempted to call unimplemented stored procedure with id: %s",h);if(m===d("LSDynamicDependencies").TOMBSTONE)throw c("err")("Concurrent sproc loading failed for: %s (retryable)",h);m.load&&(m=m.load())}else m=h;var n=this;switch(a){case 0:n=A(2,b,e,f,g,l,B);break;case 2:n=A(1,b,e,f,g,l,B);break}var o,p,q;return d("LSSynchronousPromise").wrapInSyncPromiseIfNotPromise(m).then(function(a){p=w(a);q=x.shouldLogSproc(p);C.push(p);o=x.call({args:j,shouldLog:q,sprocName:p});f.reportUsedTablesForSyncAccess(a.__tables__);return a.apply(void 0,j.concat([n]))}).then(function(a){C.pop();x.logSprocDone({args:j,shouldLog:q,sprocName:p},o,2);return a},function(a){C.pop();x.logSprocDone({args:j,shouldLog:q,sprocName:p},o,3);c("FBLogger")("messenger_web").catching(a).addMetadata(r,"SPROC_STACK",C.join("\n")).warn("Sproc %s failed",h);throw a})},throw:function(a){throw c("FBLogger")("messenger_web").mustfixThrow(a)},toArray:d("LSIterationOperations").toArray,toJSON:function(a){return d("LSJson").stringify(a)}}}A.n=v;g.default=A}),98);
__d("LSAuthorityLevel",[],(function(a,b,c,d,e,f){a=Object.freeze({OPTIMISTIC:20,CLIENT_PARTIAL:40,SERVER_PARTIAL:60,AUTHORITATIVE_PENDING_REPLACEMENT:75,AUTHORITATIVE:80,CLIENT_AUTHORITATIVE_DELETE:100});f["default"]=a}),66);
__d("LSFactory",["ExecutionEnvironment","LS","LSDynamicDependencies","LSMetadata","cr:8709"],(function(a,b,c,d,e,f,g){"use strict";var h,i={dynamic:!1};function a(a,e){e===void 0&&(e=i);a=c("LS")(1,d("LSMetadata").schema,d("LSDynamicDependencies").cachedModules,a,void 0,void 0,e.dynamic);return b("cr:8709")!=null&&(h||(h=c("ExecutionEnvironment"))).isInBrowser?b("cr:8709").wrapSprocInvocationWithProfiler(a):a}g["default"]=a}),98);
__d("LSMessageReplySourceType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,LIGHTWEIGHT_STATUS:6,LIGHTWEIGHT_STATUS_REACTION:7,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,HIGHLIGHTS_TAB_CARDS_FOR_MOM:19,HIGHLIGHTS_TAB_CARDS_FOR_BIRTHDAY:20,NOTE_MENTION:21,AI_PERSONA_NOTE_REPLY:26,AI_PERSONA_NOTE_REACTION:27,FB_MSGR_NOTE:28});f["default"]=a}),66);
__d("LSMessageReplySourceTypeV2",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,MESSAGE:1,STORY:2,FORWARD:3,FB_STORY_SHARE:4,IG_STORY_SHARE:5,STORY_BASE64_ENCODED:6,LIGHTWEIGHT_STATUS:7,CLOSE_FRIENDS:8,XMA:9,IG_NOTE:10,CLOSE_FRIENDS_NOTE_REPLY:11,LIGHTWEIGHT_STATUS_REACTION:12,FB_FEED_POST:13,HIGHLIGHTS_TAB_POST_REPLY:14,HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:15,SHARED_ALBUM:16,AVATAR_DETAIL:17,NOTE_REPLY_ARMADILLO:18,HIGHLIGHTS_TAB_CARDS_FOR_MOM:19,HIGHLIGHTS_TAB_CARDS_FOR_BIRTHDAY:20,NOTE_MENTION:21,FB_STORY_MENTION:22,EXPIRED_STORY:23,FB_PRODUCER_STORY_REPLY:24,FB_POST_MENTION:25,AI_PERSONA_NOTE_REPLY:26,AI_PERSONA_NOTE_REACTION:27,FB_MSGR_NOTE:28});f["default"]=a}),66);
__d("LSMessageSendStatus",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,SENDING_TO_SERVER:1,SERVER_RECEIVED:2,NON_RETRIABLE_ERROR:4,RETRIABLE_ERROR:5});f["default"]=a}),66);
__d("LSReplyMessageAttachmentType",[],(function(a,b,c,d,e,f){a=Object.freeze({OTHER:0,PHOTO:1,VIDEO:2,GIF:3,STICKER:4,LINK:5,MULTIPHOTO:6,PERMANENT_RAVEN_PHOTO:7,PERMANENT_RAVEN_VIDEO:8,AUDIO:10,ROLL_CALL_PHOTO_CONTRIBUTION:11,ROLL_CALL_VIDEO_CONTRIBUTION:12,FEED_POST:13,POWER_UP:14,XMA:15,ROLL_CALL_TEXT_CONTRIBUTION:16,BLOKS_XMA:17,EPHEMERAL_RAVEN_MESSAGE:18,THIRD_PARTY_STICKER:19,SOUND_BITE:9});f["default"]=a}),66);
__d("LSXmaContentType",[],(function(a,b,c,d,e,f){a=Object.freeze({TEST:-1,NONE:0,IG_SINGLE_IMAGE_POST_SHARE:1e3,IG_MULTIPOST_SHARE:1001,IG_STORY_REPLY:1002,IG_STORY_PHOTO_SHARE:1003,IG_STORY_PHOTO_MENTION:1004,IG_CLIPS_SHARE:1005,IG_SINGLE_VIDEO_POST_SHARE:1006,IG_STORY_VIDEO_SHARE:1007,IG_STORY_REACTION:1008,IG_IGTV_SHARE:1009,IG_SHOP_SHARE:1010,IG_PROFILE_SHARE:1011,IG_STORY_PHOTO_HIGHLIGHT_SHARE:1012,IG_STORY_VIDEO_HIGHLIGHT_SHARE:1013,IG_STORY_VIDEO_MENTION:1014,IG_STORY_HIGHLIGHT_REPLY:1015,IG_STORY_HIGHLIGHT_REACTION:1016,IG_EXTERNAL_LINK:1017,IG_RECEIVER_FETCH:1018,IG_TEXT_POST_APP_SHARE:1019,IG_MULTI_MEDIA_RESPONSE:1020,FB_FEED_SHARE:2e3,FB_STORY_REPLY:2001,FB_STORY_SHARE:2002,FB_STORY_MENTION:2003,FB_FEED_VIDEO_SHARE:2004,FB_GAMING_CUSTOM_UPDATE:2005,FB_PRODUCER_STORY_REPLY:2006,FB_EVENT:2007,FB_FEED_POST_PRIVATE_REPLY:2008,FB_SHORT:2009,FB_COMMENT_MENTION_SHARE:2010,FB_STORY_LWI_REPLY:2011,FB_COMMENT_SHARE:2012,FB_POST_MENTION:2013,FB_PROFILE_DIRECTORY_ITEM:2014,MSG_EXTERNAL_LINK_SHARE:3e3,MSG_P2P_PAYMENT:3001,MSG_LOCATION_SHARING:3002,MSG_LOCATION_SHARING_V2:3003,MSG_HIGHLIGHTS_TAB_FRIEND_UPDATES_REPLY:3004,MSG_HIGHLIGHTS_TAB_LOCAL_EVENT_REPLY:3005,MSG_RECEIVER_FETCH:3006,MSG_IG_MEDIA_SHARE:3007,MSG_GEN_AI_SEARCH_PLUGIN_RESPONSE:3008,MSG_REELS_LIST:3009,MSG_CONTACT:3010,MSG_THREADS_POST_SHARE:3011,MSG_FILE:3012,MSG_AVATAR_DETAILS:3013,MSG_AI_CONTACT:3014,MSG_MEMORIES_SHARE:3015,MSG_SHARED_ALBUM_REPLY:3016,MSG_SHARED_ALBUM:3017,MSG_OCCAMADILLO_XMA:3018,MSG_GEN_AI_1P_SEARCH_RESULT:3019,MSG_EARLY_ACCESS_FB_SHARE:3020,MSG_GEN_AI_SUBSCRIPTION:3021,MSG_GEN_AI_REMINDER:3022,MSG_GEN_AI_MEMU_ONBOARDING_RESPONSE:3023,MSG_MAGICAL_MESSENGER_PLACES:3024,MSG_RECEIVER_FETCH_FALLBACK:3025,MSG_MAGICAL_MESSENGER_TASKS:3026,MSG_NOTE_REPLY:3027,MSG_NOTE_MENTION:3028,MSG_PROMPT_REPLY:3029,MSG_GEN_AI_TASK:3030,MSG_GEN_AI_RICH_RESPONSE:3040,MSG_RECEIVER_FETCH_ENT_DELETED:3041,MSG_GEN_AI_APP_DOWNLOAD_LINK:3042,MSG_GEN_AI_ENTITY:3043,MSG_OPG_P2P_PAYMENT:3044,RTC_AUDIO_CALL:4e3,RTC_VIDEO_CALL:4001,RTC_MISSED_AUDIO_CALL:4002,RTC_MISSED_VIDEO_CALL:4003,RTC_GROUP_AUDIO_CALL:4004,RTC_GROUP_VIDEO_CALL:4005,RTC_MISSED_GROUP_AUDIO_CALL:4006,RTC_MISSED_GROUP_VIDEO_CALL:4007,RTC_ONGOING_AUDIO_CALL:4008,RTC_ONGOING_VIDEO_CALL:4009,DATACLASS_SENDER_COPY:5e3,OC_AVATAR_STATIC_STICKER:6e3,LIVE_LOCATION:7e3});f["default"]=a}),66);
__d("MAWODSProxy",["CurrentMessengerUser","ExecutionEnvironment","ODS","WABridge","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=!((b=c("gkx")("23949"))!=null?b:!1);function a(a,b){var e=a.amount,f=a.entity;a=a.key;b===void 0&&(b=!0);(i||(i=c("ExecutionEnvironment"))).isInWorker&&!j?d("WABridge").getBridge().fireAndForget("event","odsBumpEntityKey",{amount:e,entity:f,key:a},b):(h||(h=d("ODS"))).bumpEntityKey(3185,f,a+"."+(d("CurrentMessengerUser").getAppID()||"unknown"),e)}g.odsBumpEntityKey=a}),98);
__d("WAGlobals",["WAJids","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}var i=null;function a(a){i=a}function j(){if(i==null)throw c("err")("WaMsgr api called before set");return i}function k(){var a;return(a=j().myJids)==null?void 0:a.deviceJid}function b(){var a;return(a=j().myJids)==null?void 0:a.userJid}function e(a){return d("WAJids").extractUserJid(a)===d("WAJids").extractUserJid(k())}function f(){return j().config}function l(){return j().dependencies}var m="WAOneQueue is not defined";function n(){var a=j().waOneQueue;if(a==null){d("WALogger").ERROR(h(),m);throw c("err")(m)}return a}function o(){return j().hmacKey}g.setGlobals=a;g.getMyDeviceJid=k;g.getMyUserJid=b;g.isPeerDevice=e;g.getConfig=f;g.getDependencies=l;g.getWaOneQueue=n;g.getHMACKey=o}),98);
__d("MAWUserJidWrapper",["ExecutionEnvironment","MAWCurrentUser","MAWODSProxy","WAGlobals","WAJids","WAOdsEnums"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=d("WAJids").toMsgrUserJid(d("MAWCurrentUser").getID());if((h||(h=c("ExecutionEnvironment"))).isInWorker){var b=d("WAGlobals").getMyUserJid();d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_MY_USER_JID_GETTER,key:b===a?"same":"different"});return b}return a}g.getMyUserJid=a}),98);
__d("MAWAuthor",["MAWUserJidWrapper","WAJids","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){if(a==null||a===d("WAJids").AUTHOR_SYSTEM)return null;if(d("WAJids").isAuthorMe(a))return d("MAWUserJidWrapper").getMyUserJid();var b=d("WAJids").authorAsUserJid(a);if(b==null||c("isStringNullOrEmpty")(d("WAJids").userIdFromJid(b)))return null;else return d("WAJids").authorAsUserJid(a)};g.getAuthorUserJid=a}),98);
__d("WAStanzaUtils",[],(function(a,b,c,d,e,f){"use strict";var g=/^[0-9A-Za-z-]{1,32}$/;function a(a){return a}function b(a){return g.test(a)?a:null}f.toStanzaId=a;f.validateCallId=b}),66);
__d("MAWExternalId",["I64","Random","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i=131071;function j(a){return Math.floor(c("Random").random()*a)}function a(){return d("WAStanzaUtils").toStanzaId((h||(h=d("I64"))).to_string(h.and_(h.or_(h.lsl_(h.of_float(Date.now()),22),h.and_(h.of_float(j(i)),h.of_float(i))),h.max_int)))}g.generateExternalId=a}),98);
__d("MAWJids",["I64","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h;e=d("WAJids").createJidUtils({platform:"msgr"});var i=e.toUserJid,j=function(a,b){a=(h||(h=d("I64"))).to_string(a);return b?d("WAJids").toGroupJid(a):i(a)};function a(a){return j(a,!1)}function b(a){return j(a,!0)}f=function(a){a=d("WAJids").threadIdForChatJid(a);return(h||(h=d("I64"))).of_string(a)};function c(a){return d("WAJids").unsafeCoerceToChatJid(a)}g.jidUtils=e;g.toUserJid=i;g.convertIntJidToChatJid=j;g.convertIntJidToOneToOneChatJid=a;g.convertIntJidToGroupJid=b;g.convertChatJidToIntJid=f;g.threadIdToChatJid=c}),98);
__d("MNLSXMALayoutType",[],(function(a,b,c,d,e,f){a=Object.freeze({SINGLE:0,HSCROLL:1,XCENTER:2,PORTRAIT:4,LAYERED:5,PLACEHOLDER:6,EXPIRED_PLACEHOLDER:7,PILE_PROMPT:8,STACK:9,SHARED_STACK:10,STACK_CARD:11,STANDARD_DXMA:12,DXMA_PLACEHOLDER:13,THREAD_SHORTCUT:14,LIST_DXMA:15,GRID:16,BLOKS_XMA:17,TWO_CARD:18,NOTE:19,VSTACK:20,SQUIRCLE:21,REPLY:22,RICH_RESPONSE:23,CODE:24,TABLE:25,SQUIRCLE_SHARED_STACK:26,UNIFIED_RESPONSE:27});f["default"]=a}),66);
__d("MNXMAPreviewImageDecorationType",[],(function(a,b,c,d,e,f){a=Object.freeze({DEFAULT:0,COLLAGE:1,VIDEO:2,MESSENGER_ICON:3,INSTAGRAM_ICON:4,SHOPPING:5,UPCOMING_EVENT:6,LIVE:7,REEL:8,IGTV:9,YOUTUBE_VIDEO:10,YOUTUBE_SHORTS:11,COMMENT:12,BLUR:13,PILL:14,MESSENGER_CHANNEL_IMAGE:15,TROPHY:16,DXMA_LIVE:17,DXMA_LIVE_ENDED:18,LIKE_BUBBLE_REPLY:19,LIKE_BUBBLES:20,REPOST:21});f["default"]=a}),66);
__d("MessagingAttachmentType",[],(function(a,b,c,d,e,f){a=Object.freeze({NONE:0,STICKER:1,IMAGE:2,ANIMATED_IMAGE:3,VIDEO:4,AUDIO:5,FILE:6,XMA:7,EPHEMERAL_IMAGE:8,EPHEMERAL_VIDEO:9,SELFIE_STICKER:10,SOUND_BITE:12,CATALOG_ITEM:13,POWER_UP:14,THIRD_PARTY_STICKER:15});f["default"]=a}),66);
__d("OfflineThreadingId",["I64","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=d("I64"))).of_string("4194303");function a(){return(h||(h=d("I64"))).to_string(j())}function j(){var a=d("XPlatReactCrypto").getRandomValues(new Uint8Array(8));a=new DataView(a.buffer);a=(h||(h=d("I64"))).add(h.lsl_(h.of_int32(a.getUint32(0)),32),h.of_int32(a.getUint32(4)));return k(Date.now(),a)}function k(a,b){return(h||(h=d("I64"))).and_(h.or_(h.lsl_(h.of_float(a),22),h.and_(b,i)),h.max_int)}function b(a){var b=j(),c=[];for(var e=0;e<a.length;e++)c.push([a[e],(h||(h=d("I64"))).to_string(b)]),b=l(b);return c}function l(a,b){b===void 0&&(b=(h||(h=d("I64"))).one);var c=m(a);a=n(a);return k(c,(h||(h=d("I64"))).add(a,b))}function m(a){return(h||(h=d("I64"))).to_float(h.lsr_(a,22))}function n(a){return(h||(h=d("I64"))).and_(a,i)}g.createOfflineThreadingID=a;g.createForItemsInOrder=b;g.extractTimestamp=m}),98);
__d("RetUtil",["LSResult"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return c("LSResult")(a)}g.getNullableRetResult=a}),98);
__d("URLMatcherConfig",[],(function(a,b,c,d,e,f){e.exports={tlds:"(?:\\.(com|\ud55c\uad6d|\uc0bc\uc131|\ub2f7\ucef4|\ub2f7\ub137|\u9999\u6e2f|\u9999\u683c\u91cc\u62c9|\u9910\u5385|\u98df\u54c1|\u98de\u5229\u6d66|\u96fb\u8a0a\u76c8\u79d1|\u96c6\u56e2|\u901a\u8ca9|\u8d2d\u7269|\u8c37\u6b4c|\u8bfa\u57fa\u4e9a|\u8054\u901a|\u7f51\u7edc|\u7f51\u7ad9|\u7f51\u5e97|\u7f51\u5740|\u7ec4\u7ec7\u673a\u6784|\u79fb\u52a8|\u73e0\u5b9d|\u70b9\u770b|\u6fb3\u9580|\u6e38\u620f|\u6de1\u9a6c\u9521|\u673a\u6784|\u66f8\u7c4d|\u65f6\u5c1a|\u65b0\u95fb|\u65b0\u52a0\u5761|\u653f\u5e9c|\u653f\u52a1|\u624b\u8868|\u624b\u673a|\u6211\u7231\u4f60|\u6148\u5584|\u5fae\u535a|\u5e7f\u4e1c|\u5de5\u884c|\u5bb6\u96fb|\u5a31\u4e50|\u5929\u4e3b\u6559|\u5927\u62ff|\u5927\u4f17\u6c7d\u8f66|\u5728\u7ebf|\u5609\u91cc\u5927\u9152\u5e97|\u5609\u91cc|\u5546\u6807|\u5546\u5e97|\u5546\u57ce|\u53f0\u7063|\u53f0\u6e7e|\u516c\u76ca|\u516c\u53f8|\u516b\u5366|\u5065\u5eb7|\u4fe1\u606f|\u4f5b\u5c71|\u4f01\u4e1a|\u4e2d\u6587\u7f51|\u4e2d\u570b|\u4e2d\u56fd|\u4e2d\u4fe1|\u4e16\u754c|\u30dd\u30a4\u30f3\u30c8|\u30d5\u30a1\u30c3\u30b7\u30e7\u30f3|\u30bb\u30fc\u30eb|\u30b9\u30c8\u30a2|\u30b3\u30e0|\u30b0\u30fc\u30b0\u30eb|\u30af\u30e9\u30a6\u30c9|\u307f\u3093\u306a|\u10d2\u10d4|\u0e44\u0e17\u0e22|\u0e04\u0e2d\u0e21|\u0dbd\u0d82\u0d9a\u0dcf|\u0d2d\u0d3e\u0d30\u0d24\u0d02|\u0cad\u0cbe\u0cb0\u0ca4|\u0c2d\u0c3e\u0c30\u0c24\u0c4d|\u0b9a\u0bbf\u0b99\u0bcd\u0b95\u0baa\u0bcd\u0baa\u0bc2\u0bb0\u0bcd|\u0b87\u0bb2\u0b99\u0bcd\u0b95\u0bc8|\u0b87\u0ba8\u0bcd\u0ba4\u0bbf\u0baf\u0bbe|\u0b2d\u0b3e\u0b30\u0b24|\u0aad\u0abe\u0ab0\u0aa4|\u0a2d\u0a3e\u0a30\u0a24|\u09ad\u09be\u09f0\u09a4|\u09ad\u09be\u09b0\u09a4|\u09ac\u09be\u0982\u09b2\u09be|\u0938\u0902\u0917\u0920\u0928|\u092d\u093e\u0930\u094b\u0924|\u092d\u093e\u0930\u0924\u092e\u094d|\u092d\u093e\u0930\u0924|\u0928\u0947\u091f|\u0915\u0949\u092e|\u0680\u0627\u0631\u062a|\u067e\u0627\u06a9\u0633\u062a\u0627\u0646|\u0647\u0645\u0631\u0627\u0647|\u0645\u0648\u0642\u0639|\u0645\u0648\u0628\u0627\u064a\u0644\u064a|\u0645\u0644\u064a\u0633\u064a\u0627|\u0645\u0635\u0631|\u0643\u0648\u0645|\u0643\u0627\u062b\u0648\u0644\u064a\u0643|\u0642\u0637\u0631|\u0641\u0644\u0633\u0637\u064a\u0646|\u0639\u0645\u0627\u0646|\u0639\u0631\u0628|\u0639\u0631\u0627\u0642|\u0634\u0628\u0643\u0629|\u0633\u0648\u0631\u064a\u0629|\u0633\u0648\u062f\u0627\u0646|\u062a\u0648\u0646\u0633|\u0628\u06be\u0627\u0631\u062a|\u0628\u064a\u062a\u0643|\u0628\u0627\u0632\u0627\u0631|\u0628\u0627\u0631\u062a|\u0627\u06cc\u0631\u0627\u0646|\u0627\u0645\u0627\u0631\u0627\u062a|\u0627\u0644\u0645\u063a\u0631\u0628|\u0627\u0644\u0639\u0644\u064a\u0627\u0646|\u0627\u0644\u0633\u0639\u0648\u062f\u064a\u0629|\u0627\u0644\u062c\u0632\u0627\u0626\u0631|\u0627\u0644\u0627\u0631\u062f\u0646|\u0627\u0631\u0627\u0645\u0643\u0648|\u0627\u062a\u0635\u0627\u0644\u0627\u062a|\u0627\u0628\u0648\u0638\u0628\u064a|\u05e7\u05d5\u05dd|\u0570\u0561\u0575|\u049b\u0430\u0437|\u0443\u043a\u0440|\u0441\u0440\u0431|\u0441\u0430\u0439\u0442|\u0440\u0444|\u0440\u0443\u0441|\u043e\u0440\u0433|\u043e\u043d\u043b\u0430\u0439\u043d|\u043c\u043e\u0441\u043a\u0432\u0430|\u043c\u043e\u043d|\u043c\u043a\u0434|\u043a\u043e\u043c|\u043a\u0430\u0442\u043e\u043b\u0438\u043a|\u0435\u044e|\u0434\u0435\u0442\u0438|\u0431\u0435\u043b|\u0431\u0433|\u03b5\u03bb|zw|zuerich|zone|zm|zip|zero|zara|zappos|za|yun|yt|youtube|you|yokohama|yoga|yodobashi|ye|yandex|yamaxun|yahoo|yachts|xyz|xxx|xn--zfr164b|xn--ygbi2ammx|xn--yfro4i67o|xn--y9a3aq|xn--xkc2dl3a5ee0h|xn--xkc2al3hye2a|xn--xhq521b|xn--wgbl6a|xn--wgbh1c|xn--w4rs40l|xn--w4r85el8fhu5dnra|xn--vuq861b|xn--vhquv|xn--vermgensberatung-pwb|xn--vermgensberater-ctb|xn--unup4y|xn--tiq49xqyj|xn--tckwe|xn--t60b56a|xn--ses554g|xn--s9brj9c|xn--rvc1e0am3e|xn--rovu88b|xn--rhqv96g|xn--qxam|xn--qxa6a|xn--qcka1pmc|xn--q9jyb4c|xn--q7ce6a|xn--pssy2u|xn--pgbs0dh|xn--p1ai|xn--p1acf|xn--otu796d|xn--ogbpf8fl|xn--o3cw4h|xn--nyqy26a|xn--nqv7fs00ema|xn--nqv7f|xn--node|xn--ngbrx|xn--ngbe9e0a|xn--ngbc5azd|xn--mxtq1m|xn--mk1bu44c|xn--mix891f|xn--mgbx4cd0ab|xn--mgbtx2b|xn--mgbt3dhd|xn--mgbpl2fh|xn--mgbi4ecexp|xn--mgbgu82a|xn--mgberp4a5d4ar|xn--mgbcpq6gpa1a|xn--mgbca7dzdo|xn--mgbc0a9azcg|xn--mgbbh1a71e|xn--mgbbh1a|xn--mgbayh7gpa|xn--mgbai9azgqp6j|xn--mgbah1a3hjkrd|xn--mgbab2bd|xn--mgbaam7a8h|xn--mgba7c0bbn0a|xn--mgba3a4f16a|xn--mgba3a3ejt|xn--mgb9awbf|xn--lgbbat1ad8j|xn--l1acc|xn--kput3i|xn--kpry57d|xn--kprw13d|xn--kcrx77d1x4a|xn--jvr189m|xn--jlq480n2rg|xn--j6w193g|xn--j1amh|xn--j1aef|xn--io0a7i|xn--imr513n|xn--i1b6b1a6a2e|xn--hxt814e|xn--h2brj9c8c|xn--h2brj9c|xn--h2breg3eve|xn--gk3at1e|xn--gecrj9c|xn--gckr3f0f|xn--g2xx48c|xn--fzys8d69uvgm|xn--fzc2c9e2c|xn--fpcrj9c3d|xn--flw351e|xn--fjq720a|xn--fiqz9s|xn--fiqs8s|xn--fiq64b|xn--fiq228c5hs|xn--fhbei|xn--fct429k|xn--efvy88h|xn--eckvdtc9d|xn--e1a4c|xn--d1alf|xn--d1acj3b|xn--czru2d|xn--czrs0t|xn--czr694b|xn--clchc0ea0b2g2a9gcd|xn--cg4bki|xn--cckwcxetd|xn--cck2b3b|xn--c2br7g|xn--c1avg|xn--bck1b9a5dre4c|xn--b4w605ferd|xn--9krt00a|xn--9et52u|xn--9dbq2a|xn--90ais|xn--90ae|xn--90a3ac|xn--8y0a063a|xn--80aswg|xn--80asehdb|xn--80aqecdr1a|xn--80ao21a|xn--80adxhks|xn--6qq986b3xl|xn--6frz82g|xn--5tzm5g|xn--5su34j936bgsg|xn--55qx5d|xn--55qw42g|xn--54b7fta0cc|xn--4gbrim|xn--4dbrk0ce|xn--45q11c|xn--45brj9c|xn--45br5cyl|xn--42c2d9a|xn--3pxu8k|xn--3hcrj9c|xn--3e0b707e|xn--3ds443g|xn--3bst00m|xn--30rr7y|xn--2scrj9c|xn--1qqw23a|xn--1ck2e1b|xn--11b4c3d|xin|xihuan|xerox|xbox|wtf|wtc|ws|wow|world|works|work|woodside|wolterskluwer|wme|winners|wine|windows|win|williamhill|wiki|wien|whoswho|wf|weir|weibo|wedding|wed|website|weber|webcam|weatherchannel|weather|watches|watch|wanggou|wang|walter|walmart|wales|vu|voyage|voto|voting|vote|volvo|vodka|vn|vlaanderen|vivo|viva|vision|visa|virgin|vip|vin|villas|viking|vig|video|viajes|vi|vg|vet|versicherung|verisign|ventures|vegas|ve|vc|vanguard|vana|vacations|va|uz|uy|us|ups|uol|uno|university|unicom|uk|ug|ubs|ubank|ua|tz|tw|tvs|tv|tushu|tunes|tui|tube|tt|trv|trust|travelersinsurance|travelers|travel|training|trading|trade|tr|toys|toyota|town|tours|total|toshiba|toray|top|tools|tokyo|today|to|tn|tmall|tm|tl|tkmaxx|tk|tjx|tjmaxx|tj|tirol|tires|tips|tienda|tickets|tiaa|theatre|theater|thd|th|tg|tf|teva|tennis|temasek|tel|technology|tech|team|tdk|td|tci|tc|taxi|tax|tattoo|tatar|tatamotors|target|taobao|talk|taipei|tab|sz|systems|sydney|sy|sx|swiss|swatch|sv|suzuki|surgery|surf|support|supply|supplies|sucks|su|style|study|studio|stream|store|storage|stockholm|stcgroup|stc|statefarm|statebank|star|staples|stada|st|ss|srl|sr|spot|sport|space|spa|soy|sony|song|solutions|solar|sohu|software|softbank|social|soccer|so|sncf|sn|smile|smart|sm|sling|sl|skype|sky|skin|ski|sk|sj|site|singles|sina|silk|si|show|shouji|shopping|shop|shoes|shiksha|shia|shell|sharp|shangrila|sh|sg|sfr|sexy|sex|sew|seven|services|sener|select|seek|security|secure|seat|search|se|sd|scot|science|schwarz|schule|school|scholarships|schmidt|schaeffler|scb|sc|sbs|sbi|sb|saxo|save|sas|sarl|sap|sanofi|sandvikcoromant|sandvik|samsung|samsclub|salon|sale|sakura|safety|safe|saarland|sa|ryukyu|rwe|rw|run|ruhr|rugby|ru|rsvp|rs|room|rogers|rodeo|rocks|ro|rip|rio|ril|ricoh|richardli|rich|rexroth|reviews|review|restaurant|rest|republican|report|repair|rentals|rent|ren|reliance|reit|reisen|reise|rehab|redumbrella|redstone|red|recipes|realty|realtor|realestate|read|re|radio|racing|quest|quebec|qpon|qa|py|pwc|pw|pub|pt|ps|prudential|pru|protection|property|properties|promo|progressive|prof|productions|prod|pro|prime|press|praxi|pramerica|pr|post|porn|politie|poker|pohl|pnc|pn|pm|plus|plumbing|playstation|play|place|pl|pk|pizza|pioneer|pink|ping|pin|pid|pictures|pictet|pics|physio|photos|photography|photo|phone|philips|phd|pharmacy|ph|pg|pfizer|pf|pet|pe|pccw|pay|party|parts|partners|pars|paris|panasonic|page|pa|ovh|ott|otsuka|osaka|origins|organic|org|orange|oracle|open|ooo|online|onl|ong|one|omega|om|ollo|olayangroup|olayan|okinawa|office|observer|obi|nz|nyc|nu|ntt|nrw|nra|nr|np|nowtv|nowruz|now|norton|nokia|no|nl|nissay|nissan|ninja|nikon|nike|nico|ni|nhk|ngo|ng|nfl|nf|nexus|nextdirect|next|news|new|neustar|network|netflix|netbank|net|nec|ne|nc|nba|navy|name|nagoya|nab|na|mz|my|mx|mw|mv|music|museum|mu|mtr|mtn|mt|msd|ms|mr|mq|mp|movie|mov|motorcycles|moto|moscow|mortgage|mormon|monster|money|monash|mom|moi|moe|moda|mobile|mobi|mo|mn|mma|mm|mls|mlb|ml|mk|mitsubishi|mit|mint|mini|mil|microsoft|miami|mh|mg|merckmsd|menu|men|memorial|meme|melbourne|meet|media|med|me|md|mckinsey|mc|mba|mattel|marshalls|marriott|markets|marketing|market|map|mango|management|man|makeup|maison|maif|madrid|ma|ly|lv|luxury|luxe|lundbeck|lu|ltda|ltd|lt|ls|lr|lplfinancial|lpl|love|lotto|lotte|london|lol|locus|locker|loans|loan|llp|llc|lk|living|live|lipsy|link|lincoln|limo|limited|lilly|like|lighting|lifestyle|lifeinsurance|life|lidl|li|lgbt|lexus|lego|legal|lefrak|leclerc|lease|lds|lc|lb|lawyer|law|latrobe|latino|lat|lasalle|lanxess|landrover|land|lancaster|lamer|lamborghini|lacaixa|la|kz|kyoto|ky|kw|kuokgroup|kred|krd|kr|kpn|kpmg|kp|kosher|komatsu|koeln|kn|km|kiwi|kitchen|kindle|kim|kids|kia|ki|kh|kg|kfh|kerryproperties|kerrylogistics|kerryhotels|ke|kddi|kaufen|juniper|juegos|jprs|jpmorgan|jp|joy|jot|joburg|jobs|jo|jnj|jmp|jm|jll|jio|jewelry|jetzt|jeep|je|jcb|java|jaguar|itv|itau|it|istanbul|ist|ismaili|is|irish|ir|iq|ipiranga|io|investments|intuit|international|int|insure|insurance|institute|ink|ing|info|infiniti|industries|inc|in|immobilien|immo|imdb|imamat|im|il|ikano|ifm|ieee|ie|id|icu|ice|icbc|ibm|hyundai|hyatt|hughes|hu|ht|hsbc|hr|how|house|hotmail|hotels|hot|hosting|host|hospital|horse|honda|homesense|homes|homegoods|homedepot|holiday|holdings|hockey|hn|hm|hkt|hk|hiv|hitachi|hisamitsu|hiphop|hermes|here|helsinki|help|healthcare|health|hdfcbank|hdfc|hbo|haus|hangout|hamburg|hair|gy|gw|guru|guitars|guide|guge|gucci|gu|gt|gs|group|grocery|gripe|green|gratis|graphics|grainger|gr|gq|gp|gov|got|gop|google|goog|goodyear|goo|golf|goldpoint|gold|godaddy|gn|gmx|gmo|gmbh|gmail|gm|globo|global|gle|glass|gl|giving|gives|gifts|gift|gi|gh|ggee|gg|gf|george|genting|gent|gea|ge|gdn|gd|gbiz|gb|gay|garden|gap|games|game|gallup|gallo|gallery|gal|ga|fyi|futbol|furniture|fund|fun|fujitsu|ftr|frontier|frogans|frl|fresenius|free|fr|fox|foundation|forum|forsale|forex|ford|football|food|foo|fo|fm|fly|flowers|florist|flir|flights|flickr|fk|fj|fitness|fit|fishing|fish|firmdale|firestone|fire|financial|finance|final|film|fido|fidelity|fi|ferrero|ferrari|feedback|fedex|fast|fashion|farmers|farm|fans|fan|family|faith|fairwinds|fail|fage|extraspace|express|exposed|expert|exchange|events|eus|eurovision|eu|et|estate|esq|es|erni|ericsson|er|equipment|epson|enterprises|engineering|engineer|energy|emerck|email|eg|ee|education|edu|edeka|eco|ec|eat|earth|dz|dvr|dvag|durban|dupont|dunlop|dubai|dtv|drive|download|dot|domains|dog|doctor|docs|do|dnp|dm|dk|dj|diy|dish|discover|discount|directory|direct|digital|diet|diamonds|dhl|dev|design|desi|dentist|dental|democrat|delta|deloitte|dell|delivery|degree|deals|dealer|deal|de|dds|dclk|day|datsun|dating|date|data|dance|dad|cz|cyou|cymru|cy|cx|cw|cv|cuisinella|cu|cruises|cruise|crs|crown|cricket|creditunion|creditcard|credit|cr|cpa|courses|coupons|coupon|country|corsica|coop|cool|cooking|contractors|contact|consulting|construction|condos|comsec|computer|compare|company|community|commbank|com|cologne|college|coffee|codes|coach|co|cn|cm|clubmed|club|cloud|clothing|clinique|clinic|click|cleaning|claims|cl|ck|city|citic|citi|citadel|cisco|circle|cipriani|ci|church|chrome|christmas|chintai|cheap|chat|chase|charity|channel|chanel|ch|cg|cfd|cfa|cf|cern|ceo|center|cd|cc|cbre|cbn|cba|catholic|catering|cat|casino|cash|case|casa|cars|careers|career|care|cards|caravan|car|capitalone|capital|capetown|canon|camp|camera|cam|calvinklein|call|cal|cafe|cab|ca|bzh|bz|by|bw|bv|buzz|buy|business|builders|build|bt|bs|brussels|brother|broker|broadway|bridgestone|bradesco|br|box|boutique|bot|boston|bostik|bosch|booking|book|boo|bond|bom|bofa|boehringer|boats|bo|bnpparibas|bn|bmw|bms|bm|blue|bloomberg|blog|blockbuster|blackfriday|black|bj|biz|bio|bingo|bing|bike|bid|bible|bi|bharti|bh|bg|bf|bet|bestbuy|best|berlin|bentley|beer|beauty|beats|be|bd|bcn|bcg|bbva|bbt|bbc|bb|bayern|bauhaus|basketball|baseball|bargains|barefoot|barclays|barclaycard|barcelona|bar|bank|band|banamex|baidu|baby|ba|azure|az|axa|ax|aws|aw|autos|auto|author|auspost|audio|audible|audi|auction|au|attorney|athleta|at|associates|asia|asda|as|arte|art|arpa|army|archi|aramco|arab|ar|aquarelle|aq|apple|app|apartments|aol|ao|anz|anquan|android|analytics|amsterdam|amica|amfam|amex|americanfamily|americanexpress|amazon|am|alstom|alsace|ally|allstate|allfinanz|alipay|alibaba|al|akdn|airtel|airforce|airbus|aig|ai|agency|agakhan|ag|africa|afl|af|aetna|aero|aeg|ae|adult|ads|ad|actor|aco|accountants|accountant|accenture|academy|ac|abudhabi|abogado|able|abc|abbvie|abbott|abb|aarp|aaa))"}}),null);
__d("URLMatcher",["URLMatcherConfig"],(function(a,b,c,d,e,f){d="!\"#%&'()*,-./:;<>?@[\\]^_`{|}";f="\u2000-\u206f\xab\xbb\uff08\uff09";var g="(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])",h="(?:https?)://";g="(?:(^|\\s)(?:"+g+"[.]){3}"+g+")";g=g;var i="\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]",j="(?:\\b)www\\d{0,3}[.]";d="[^\\s"+d+f+"]";f="(?:(?:(?:[.:\\-_%@]|"+d+")*"+d+")|"+i+")";d="(?::\\d+){0,1}";var k="(?=[/?#])";b=b("URLMatcherConfig").tlds;var l="(?:(?:"+h+f+d+")|(?:"+g+d+")|(?:"+i+d+")|(?:"+j+f+b+d+")|(?:"+f+b+d+k+"))";k="(?:(?:"+h+f+d+")|(?:"+g+d+")|(?:"+i+d+")|(?:"+j+f+b+d+")|(?:"+f+b+d+"))";g="[/#?]";i="\\([^\\s()<>]+\\)";var m="[^\\s()<>?#]+",n=new RegExp(l,"im"),o="^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]",p=new RegExp(o,"im"),q="(?:(?:"+g+")(?:(?:"+i+"|"+m+")*)*)*",r=new RegExp("((?:"+k+")(?:"+q+"))","im");function a(){r.compile()}var s=new RegExp("((?:"+h+f+d+")|(?:"+j+f+b+d+"))"),t=/[\s\'\";]/,u=new RegExp(g,"im"),v=new RegExp("[\\s!\"#%&'()*,./:;<>?@[\\]^`{|}\xab\xbb\u2000-\u206f\uff08\uff09]","im"),w=new RegExp("[\\s()<>?#]","im"),x=new RegExp("\\s()<>"),y=function(a){if(a!=null&&a.indexOf("@")!==-1)return s.exec(a)?a:null;else return a},z=function(a){return new RegExp("((?:"+l+")(?:"+q+"))",a)};function c(){return r.source}o=function(a){return A(a,z("im"))};i=function(a){return B(a,z("igm"))};m=function(a){return A(a,r)};var A=function(a,b){b=b.exec(a);return b==null||b.length===0?null:y(b[1]||null)},B=function(a,b){a=a.match(b);return a==null?[]:a.filter(Boolean)||[]};k=function(a){return n.exec(a)};h=function(a){return!t.test(a.charAt(a.length-1))};j=function(a){a=a;var b=!1;do{var c,d=n.exec(a);if(!d)return null;((c=d[1])==null?void 0:c.trim())===""&&(d[0]=d[0].trim(),d.index+=d[1].length);b=!1;if(d[0][0]==="["&&d.index>0&&a[d.index-1]==="@"){c=p.exec(d[0]);c&&(b=!0,a=a.substr(d.index+c[0].length))}}while(b);if(!d)return null;c=a.substr(d.index+d[0].length);if(c.length===0||!u.test(c[0]))return y(d[0]);b=0;a=0;var e=1,f=["(","["],g=[")","]"],h=0,i=a;for(var j=1;j<c.length;j++){var k=c[j];if(i===a){if(f.includes(k))h+=1,i=e;else if(u.test(k)||!v.test(k))b=j;else if(w.test(k))break}else if(f.includes(k))h+=1;else if(g.includes(k))h-=1,h===0&&(i=a,b=j);else if(x.test(k))break}return y(d[0]+c.substring(0,b+1))};f={compilePermissiveHostPathMatcher:a,permissiveHostPathMatch:m,permissiveMatch:o,permissiveMultiMatch:i,matchToPattern:A,multiMatchToPattern:B,matchHost:k,trigger:h,match:j,getPermissiveHostPathMatcherSource:c};e.exports=f}),null);
__d("WALongInt",["WAHex","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is over 64 bits']);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(['"','" is not a valid decimal string']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose([""," is not a safe integer"]);j=function(){return a};return a}function k(a){if(typeof a!=="number"){d("WALogger").LOG(j(),a).color("red");throw new Error("numberOrThrowIfTooLarge is given a non-safe integer")}return a}f=function(a){return a==null?a:k(a)};function a(a){return a==null||typeof a!=="number"?null:a}function b(a,b){if(typeof a==="number"&&typeof b==="number")return a>b;a=typeof a==="number"?d("WAHex").hexLongFromNumber(a):a;b=typeof b==="number"?d("WAHex").hexLongFromNumber(b):b;return d("WAHex").isBiggerHexLong(a,b)}function c(a){if(typeof a==="number")return a.toString(10);var b=d("WAHex").hexLongToHex(a),c=[0],e=0;for(var f=0;f<b.length;f++){e=d("WAHex").hexAt(b,f);for(var g=0;g<c.length;g++)c[g]=c[g]*16+e,e=c[g]/10|0,c[g]%=10;while(e>0)c.push(e%10),e=e/10|0}g=c.reverse().join("");return d("WAHex").hexLongIsNegative(a)?"-"+g:g}function e(a){if(!/^-?\d+$/.test(a)){d("WALogger").LOG(i(),a).color("red");throw new Error("decimalStringToLongInt is given an invalid decimal string")}var b=a[0]==="-",c=a.replace(/^-?0*/,""),e=c.length;if(e<16||e===16&&c<="9007199254740991")return b?-Number(c):Number(c);if(e>20||e===20&&c>"18446744073709551615"||b&&(e>19||e===19&&c>"9223372036854775807")){d("WALogger").LOG(h(),a).color("red");throw new Error("decimalStringToHexLong is given value over 64 bits")}a=0;var f=0;for(var g=0;g<e;g++)a=a*10+Number(c[g]),f=f*10+Math.floor(a/4294967296),a=a%4294967296;return d("WAHex").createHexLongFrom32Bits(f,a,b)}g.numberOrThrowIfTooLarge=k;g.maybeNumberOrThrowIfTooLarge=f;g.maybeNumber=a;g.isBiggerLongInt=b;g.longIntToDecimalString=c;g.decimalStringToLongInt=e}),98);
__d("WATextEncoding",[],(function(a,b,c,d,e,f){"use strict";e=TextEncoder;var g=TextDecoder,h=e,i=g;function a(){return new h()}function b(){return new i()}function c(a){h=a}function d(a){i=a}f.newTextEncoder=a;f.newTextDecoder=b;f.setTextEncoderClass=c;f.setTextDecoderClass=d}),66);
__d("last",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=null;if(Array.isArray(a)||typeof a==="string")a.length&&(b={value:a[a.length-1]});else for(a of a)b=b||{},b.value=a;return b?b.value:null}f["default"]=a}),66);